/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Mar 13 22:06
*/
KISSY.add("dd/base",function(f,i,g,e){f={Draggable:g,DDM:i,DraggableDelegate:e};return KISSY.DD=f},{requires:["./base/ddm","./base/draggable","./base/draggable-delegate"]});
KISSY.add("dd/base/ddm",function(f,i,g,e,u){function j(){j.superclass.constructor.apply(this,arguments)}function q(b){var a;if(b=k._normalEvent(b))if(b.preventDefault(),a=this.__activeToDrag)a._move(b);else if(a=this.get("activeDrag"))a._move(b),this.__needDropCheck&&r(this,b,a)}function m(b){b.preventDefault();D.call(this,b)}function r(b,v,d){var c=b.get("validDrops"),p=d.get("mode"),e=0,o=0,g=l(d.get("node")),s=a(g);f.each(c,function(b){var c;if(c=b.getNodeFromTarget(v,d.get("dragNode")[0],d.get("node")[0]))if("point"==
p)w(l(c),d.mousePos)&&(c=a(l(c)),e?c<o&&(e=b,o=c):(e=b,o=c));else if("intersect"==p)c=a(h(g,l(c))),c>o&&(o=c,e=b);else if("strict"==p&&(c=a(h(g,l(c))),c==s))return e=b,!1});if((c=b.get("activeDrop"))&&c!=e)c._handleOut(v),d._handleOut(v);b.setInternal("activeDrop",e);e&&(c!=e?e._handleEnter(v):e._handleOver(v))}function c(b){b._shim=(new e('<div style="background-color:red;position:'+(y?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+k.get("dragCursor")+";z-index:"+E+';"></div>')).prependTo(n.body||
n.documentElement).css("opacity",0);c=s;if(y)g.on(o,"resize scroll",z,b);s(b)}function s(b){var a=b.get("activeDrag").get("activeHandler"),c="auto";a&&(c=a.css("cursor"));"auto"==c&&(c=b.get("dragCursor"));b._shim.css({cursor:c,display:"block"});y&&z.call(b)}function t(b){var a=b.get("drops");b.setInternal("validDrops",[]);a.length&&f.each(a,function(b){b._active()})}function x(b){var a=b.get("drops");b.setInternal("validDrops",[]);a.length&&f.each(a,function(b){b._deActive()})}function l(b){var a=
b.offset();return{left:a.left,right:a.left+(b.__dd_cached_width||b.outerWidth()),top:a.top,bottom:a.top+(b.__dd_cached_height||b.outerHeight())}}function w(b,a){return b.left<=a.left&&b.right>=a.left&&b.top<=a.top&&b.bottom>=a.top}function a(b){return b.top>=b.bottom||b.left>=b.right?0:(b.right-b.left)*(b.bottom-b.top)}function h(b,a){var c=Math.max(b.top,a.top),d=Math.min(b.right,a.right),h=Math.min(b.bottom,a.bottom);return{left:Math.max(b.left,a.left),right:d,top:c,bottom:h}}function d(b){b&&(b.__dd_cached_width=
b.outerWidth(),b.__dd_cached_height=b.outerHeight())}var p=f.UA,o=f.Env.host,n=o.document,y=6===p.ie,E=999999,A=g.Gesture,B=A.move,C=A.end+" touchcancel";j.ATTRS={dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var D=8>p.ie?f.throttle(q,30):q,z=f.throttle(function(){var b;(b=this.get("activeDrag"))&&b.get("shim")&&this._shim.css({width:i.docWidth(),height:i.docHeight()})},30);f.extend(j,u,{__activeToDrag:0,
_regDrop:function(b){this.get("drops").push(b)},_unRegDrop:function(b){var a=this.get("drops"),b=f.indexOf(b,a);-1!=b&&a.splice(b,1)},_regToDrag:function(b){this.__activeToDrag=b;g.on(n,C,this._end,this);g.on(n,B,m,this);6===p.ie&&n.body.setCapture()},_start:function(){this.get("drops");var b=this.__activeToDrag;this.setInternal("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&c(this);this.__needDropCheck=0;b.get("groups")&&(t(this),this.get("validDrops").length&&(d(b.get("node")),this.__needDropCheck=
1))},_addValidDrop:function(b){this.get("validDrops").push(b)},_end:function(b){var a=this.__activeToDrag,c=this.get("activeDrag"),d=this.get("activeDrop"),b=k._normalEvent(b);a&&a._move(b);c&&c._move(b);g.remove(n,B,m,this);g.remove(n,C,this._end,this);6===p.ie&&n.body.releaseCapture();a&&(a._end(b),this.__activeToDrag=0);this._shim&&this._shim.hide();c&&(c._end(b),x(this),d&&d._end(b),this.setInternal("activeDrag",null),this.setInternal("activeDrop",null))}});var k=new j;k.inRegion=w;k.region=l;
k.area=a;k.cacheWH=d;k.PREFIX_CLS="ks-dd-";k._normalEvent=function(b){var a=""+b.type;if(a="touchend"==a||"touchcancel"==a?b.changedTouches:b.touches){if(1!=a.length)return;a=a[0];b.target=b.target||a.target;b.currentTarget=b.currentTarget||a.currentTarget;b.which=1;b.pageX=a.pageX;b.pageY=a.pageY}return b};return k},{requires:["dom","event","node","base"]});
KISSY.add("dd/base/draggable-delegate",function(f,i,g,e,u,j){var q=i.PREFIX_CLS,m=j.Gesture.start,r=function(c){if(c=i._normalEvent(c)){var e,f;if(this._checkDragStartValid(c)){e=this.get("handlers");var g=new u(c.target);(e=e.length?this._getHandler(g):g)&&(f=this._getNode(e));f&&(this.setInternal("activeHandler",e),this.setInternal("node",f),this.setInternal("dragNode",f),this._prepare(c))}}};return g.extend({_onSetNode:function(){},_onSetContainer:function(){this.bindDragEvent()},_onSetDisabledChange:function(c){this.get("container")[c?
"addClass":"removeClass"](q+"-disabled")},bindDragEvent:function(){this.get("container").on(m,r,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(){this.get("container").detach(m,r,this).detach("dragstart",this._fixDragStart)},_getHandler:function(c){for(var g=void 0,i=this.get("container"),j=this.get("handlers");c&&c[0]!==i[0];){f.each(j,function(f){if(e.test(c[0],f))return g=c,!1});if(g)break;c=c.parent()}return g},_getNode:function(c){return c.closest(this.get("selector"),this.get("container"))}},
{ATTRS:{container:{setter:function(c){return u.one(c)}},selector:{},handlers:{value:[],getter:0}}})},{requires:["./ddm","./draggable","dom","node","event"]});
KISSY.add("dd/base/draggable",function(f,i,g,e,u){function j(){return!1}var q=i.all,m=f.each,r=u.Gesture.start,c=f.UA.ie,s=f.Features.isTouchSupported(),t=e.PREFIX_CLS,x=f.Env.host.document,g=g.extend({initializer:function(){this.addTarget(e);this._allowMove=this.get("move")},_onSetNode:function(a){this.setInternal("dragNode",a);this.bindDragEvent()},bindDragEvent:function(){this.get("node").on(r,w,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(){this.get("node").detach(r,w,this).detach("dragstart",
this._fixDragStart)},_bufferTimer:null,_onSetDisabledChange:function(a){this.get("dragNode")[a?"addClass":"removeClass"](t+"-disabled")},_fixDragStart:function(a){a.preventDefault()},_checkHandler:function(a){var c=this,d=c.get("handlers"),e=0;m(d,function(d){if(d[0]==a||d.contains(a))return e=1,c.setInternal("activeHandler",d),!1});return e},_checkDragStartValid:function(a){return this.get("primaryButtonOnly")&&1!=a.which||this.get("disabled")?0:1},_prepare:function(a){if(a){var h=this;c&&(l=x.body.onselectstart,
x.body.onselectstart=j);h.get("halt")&&a.stopPropagation();s||a.preventDefault();var d=a.pageX,f=a.pageY;h.setInternal("startMousePos",h.mousePos={left:d,top:f});if(h._allowMove){var g=h.get("node").offset();h.setInternal("startNodePos",g);h.setInternal("deltaPos",{left:d-g.left,top:f-g.top})}e._regToDrag(h);if(d=h.get("bufferTime"))h._bufferTimer=setTimeout(function(){h._start(a)},1E3*d)}},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(a){var c=
a.pageX,d=a.pageY;if(!this.get("dragging")){var e=this.get("startMousePos"),f=0,g=this.get("clickPixelThresh");if(Math.abs(c-e.left)>=g||Math.abs(d-e.top)>=g)this._start(a),f=1;if(!f)return}this.mousePos={left:c,top:d};a={pageX:c,pageY:d,drag:this};if(e=this._allowMove)f=this.get("deltaPos"),c-=f.left,d-=f.top,a.left=c,a.top=d,this.setInternal("actualPos",{left:c,top:d}),this.fire("dragalign",a);d=1;!1===this.fire("drag",a)&&(d=0);d&&e&&this.get("node").offset(this.get("actualPos"))},stopDrag:function(){e._end()},
_end:function(a){var a=a||{},f;this._clearBufferTimer();c&&(x.body.onselectstart=l);this.get("dragging")&&(this.get("node").removeClass(t+"drag-over"),(f=e.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:f}):this.fire("dragdropmiss",{drag:this}),this.setInternal("dragging",0),this.fire("dragend",{drag:this,pageX:a.pageX,pageY:a.pageY}))},_handleOut:function(){this.get("node").removeClass(t+"drag-over");this.fire("dragexit",{drag:this,drop:e.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(t+
"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(a){this._clearBufferTimer();this.setInternal("dragging",1);this.setInternal("dragStartMousePos",{left:a.pageX,top:a.pageY});e._start();this.fire("dragstart",{drag:this,pageX:a.pageX,pageY:a.pageY})},destructor:function(){this.detachDragEvent();this.detach()}},{name:"Draggable",ATTRS:{node:{setter:function(a){if(!(a instanceof i))return q(a)}},clickPixelThresh:{valueFn:function(){return e.get("clickPixelThresh")}},
bufferTime:{valueFn:function(){return e.get("bufferTime")}},dragNode:{},shim:{value:!s},handlers:{value:[],getter:function(a){var c=this;a.length||(a[0]=c.get("node"));m(a,function(d,e){f.isFunction(d)&&(d=d.call(c));"string"==typeof d&&(d=c.get("node").one(d));d.nodeType&&(d=q(d));a[e]=d});c.setInternal("handlers",a);return a}},activeHandler:{},dragging:{value:!1,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](t+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},
primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:!0},startMousePos:{},dragStartMousePos:{},startNodePos:{},deltaPos:{},actualPos:{}}});g.DropMode={POINT:"point",INTERSECT:"intersect",STRICT:"strict"};var l,w=function(a){if(a=e._normalEvent(a)){var c=a.target;this._checkDragStartValid(a)&&this._checkHandler(c)&&this._prepare(a)}};return g},{requires:["node","rich-base","./ddm","event"]});
