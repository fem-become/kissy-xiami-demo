/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 23 00:53
*/
KISSY.add("imagezoom",function(j,q,l,B,d){function r(a){var b=a.get("imageNode"),e=b.offset(),c,o,f,g,m=a.get("bigImageWidth"),h=a.get("bigImageHeight"),s=a.get("width"),i=a.get("height"),d;c=a.imageLeft=e.left;d=a.imageTop=e.top;e=a.imageWidth=b.width();o=a.imageHeight=b.height();f=a.zoomMultipleH=h/o;g=a.zoomMultipleW=m/e;g=a.lensWidth=s/g;f=a.lensHeight=i/f;a.minLensLeft=c;a.minLensTop=d;a.maxLensTop=d+o-f;a.maxLensLeft=c+e-g;a.maxBigImageLeft=0;a.maxBigImageTop=0;a.minBigImageLeft=-(m-s);a.minBigImageTop=
-(h-i);a.get("type")===t?a.set("align",{node:b,points:["cc","cc"]}):(c=a.get("align")||{},m=c.node,delete c.node,c=j.clone(c),c.node=m||b,a.set("align",c));a.icon.hide();u.on("mousemove mouseleave",v,a)}function w(){var a=this.lens;u.detach("mousemove mouseleave",v,this);this.icon.show();a&&a.hide()}function z(a){var b=a.get("imageNode"),e,c=a.get("type"),d=function(){function c(){h||(h=j.later(function(){h=0;p(b);r(a);a.show();a.lens.show().css({width:a.lensWidth,height:a.lensHeight});a.set("currentMouse",
e)},50))}var h;c.stop=function(){h.cancel();h=0};return c}(),f=j.buffer(function(){p(b);r(a);a.show();var c=a,h=e,d=c.bigImage;d.add(c.bigImageCopy);d.stop();d.css({width:c.imageWidth,height:c.imageHeight,left:0,top:0});d.animate(j.mix({width:c.get("bigImageWidth"),height:c.get("bigImageHeight")},x(c,h)),0.4)},50),g="inner"==c?f:d;b.on("mouseenter",a.__onImgEnter=function(c){a.get("hasZoom")&&(e=c,b.on("mousemove"+n,function(a){e=a;g()}).on("mouseleave"+n,function(){g.stop();p(b)}),g())});a.on("afterImageSrcChange",
A,a);a.on("afterHasZoomChange",y,a);y.call(a,{newVal:a.get("hasZoom")})}function p(a){a.detach("mouseleave"+n);a.detach("mousemove"+n)}function v(a){var b=this.imageLeft,e=this.imageTop,c=this.imageWidth,d=a.pageX,f=a.pageY,g=this.imageHeight;"mouseleave"==""+a.type?this.hide():d>b&&d<b+c&&f>e&&f<e+g?this.set("currentMouse",{pageX:d,pageY:f}):this.hide()}function y(a){this.icon[a.newVal?"show":"hide"]()}function A(a){var a=a.newVal,b;this.get("imageNode").attr("src",a);(b=this.bigImageCopy)&&b.attr("src",
a)}function x(a,b){var d=a.get("width"),c=a.get("height");return{left:Math.min(Math.max(-(b.pageX-a.imageLeft)*a.zoomMultipleW+d/2,a.minBigImageLeft),a.maxBigImageLeft),top:Math.min(Math.max(-(b.pageY-a.imageTop)*a.zoomMultipleH+c/2,a.minBigImageTop),a.maxBigImageTop)}}var i=q.all,k=j.substitute,u=i(j.Env.host.document),n=".ks-imagezoom-img-mouse",t="inner",l=l.extend({initializer:function(){!this.get("bigImageWidth")||this.get("bigImageHeight");var a,b;b=this.get("imageNode");a=this.imageWrap=i(k("<span class='{wrapClass}'></span>",
{wrapClass:this.prefixCls+"imagezoom-wrap"})).insertBefore(b,d);a.prepend(b);b=this.icon=i(k("<span class='{iconClass}'></span>",{iconClass:this.prefixCls+"imagezoom-icon"}));a.append(b);z(this)},createDom:function(){var a=this.get("imageNode"),b=this.get("contentEl");this.bigImage=i(k('<img src="{src}"  style="position:absolute;top:-9999px;left:-9999px;"  />',{src:this.get("bigImageSrc")})).appendTo(b,d);this.bigImageCopy=i(k('<img src="{src}"  style="position:absolute;top:-9999px;left:-9999px;"  />',
{src:a.attr("src")})).prependTo(b,d);this.get("type")!=t&&(this.lens=i(k('<span  style="position:absolute;top:-9999px;left:-9999px;"  class="{prefixCls}imagezoom-lens"></span>',{prefixCls:this.prefixCls})).appendTo(this.imageWrap,d))},bindUI:function(){this.on("hide",w,this)},destructor:function(){var a=this.get("imageNode"),b;w.call(this);if(b=this.imageWrap)a.insertBefore(b,d),b.remove();a.detach("mouseenter",this.__onImgEnter)},_onSetBigImageWidth:function(a){this.bigImage.width(a);this.bigImageCopy.width(a)},
_onSetBigImageHeight:function(a){this.bigImage.height(a);this.bigImageCopy.height(a)},_onSetBigImageSrc:function(a){this.bigImage.attr("src",a)},_onSetCurrentMouse:function(a){var b,d;b=a.pageX;d=a.pageY;var c=this.lens;this.bigImage.isRunning()||(c&&(b-=this.lensWidth/2,d-=this.lensHeight/2,c.offset({left:this.lensLeft=Math.min(Math.max(b,this.minLensLeft),this.maxLensLeft),top:this.lensTop=Math.min(Math.max(d,this.minLensTop),this.maxLensTop)})),a=x(this,a),this.bigImageCopy.css(a),this.bigImage.css(a))}},
{ATTRS:{imageNode:{setter:function(a){return q.one(a)}},imageSrc:{valueFn:function(){return this.get("imageNode").attr("src")}},width:{valueFn:function(){return this.get("imageNode").width()}},height:{valueFn:function(){return this.get("imageNode").height()}},hasZoom:{value:!0,setter:function(a){return!!a}},type:{value:"standard"},bigImageSrc:{valueFn:function(){return this.get("imageNode").attr("data-ks-imagezoom")}},bigImageWidth:{},bigImageHeight:{},currentMouse:{}}},{xclass:"imagezoom-viewer"});
l.ZoomType={STANDARD:"standard",INNER:"inner"};return l},{requires:["node","overlay"]});
