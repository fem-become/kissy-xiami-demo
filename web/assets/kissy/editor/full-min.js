/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Mar 11 10:34
*/
/*
 thanks to CKSource's intelligent work on CKEditor
 @author yiminghe@gmail.com
*/
KISSY.add("editor/core/base",function(d,g,j){g=j.Controller.extend({initializer:function(){this.__commands={};this.__controls={}}},{Config:{},XHTML_DTD:g.DTD,ATTRS:{textarea:{},iframe:{},window:{},document:{},toolBarEl:{},statusBarEl:{},handleMouseEvents:{value:!1},focusable:{value:!1},mode:{value:1},data:{getter:function(d){var f=this._getData();return void 0===f?d:f}},formatData:{getter:function(){return this._getData(1)}},customStyle:{value:""},customLink:{value:[]}}},{xclass:"editor"});g.HTML_PARSER=
{textarea:function(d){return d.one("."+this.get("prefixCls")+"editor-textarea")},data:function(d){return d.one("."+this.get("prefixCls")+"editor-textarea").val()}};d.mix(g,d.EventTarget);return KISSY.Editor=g},{requires:["htmlparser","component/base","core"]});
KISSY.add("editor/core/clipboard",function(d,g,j,h){function f(a){this.editor=a;this._init()}function a(a){if(c.ie&&"BackCompat"!=a.get("document")[0].compatMode){var m=a.getSelection(),l;if(m.getType()==h.SELECTION_ELEMENT&&(l=m.getSelectedElement())){var e=m.getRanges()[0],p=b(a.get("document")[0].createTextNode(""));p.insertBefore(l);e.setStartBefore(p);e.setEndAfter(l);m.selectRanges([e]);setTimeout(function(){l.parent()&&(p.remove(),m.selectElement(l))},0)}}}var b=d.all,c=d.UA,e=g.RANGE,k=d.Event;
d.augment(f,{_init:function(){var a=this.editor,b=a.get("document")[0].body;k.on(b,c.ie?"beforepaste":"paste",this._paste,this);k.on(b,"contextmenu",function(){m=1;setTimeout(function(){m=0},10)});a.addCommand("copy",new r("copy"));a.addCommand("cut",new r("cut"));a.addCommand("paste",new r("paste"))},_paste:function(){if(!m){var a=this.editor,f=a.get("document")[0];if(!f.getElementById("ke_pastebin")){var l=a.getSelection(),i=new j(f),p=b(c.webkit?"<body></body>":f.createElement("div"),null,f);p.attr("id",
"ke_pastebin");c.webkit&&p[0].appendChild(f.createTextNode("\u00a0"));f.body.appendChild(p[0]);p.css({position:"absolute",top:l.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});p.css("left","-1000px");var k=l.createBookmarks();i.setStartAt(p,e.POSITION_AFTER_START);i.setEndAt(p,e.POSITION_BEFORE_END);i.select(!0);setTimeout(function(){var m;p=c.webkit&&(m=p.first())&&m.hasClass("Apple-style-span")?m:p;l.selectBookmarks(k);p.remove();var b=p.html();if(b=d.trim(b.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,
"")))m=a.fire("paste",{html:b,holder:p}),void 0!==m&&(b=m),/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(b)?d.use("editor/plugin/word-filter/dynamic/",function(m,c){a.insertHtml(c.toDataFormat(b,a))}):a.insertHtml(b)},0)}}}});var i=function(a,m){var l=a.get("document")[0],e=b(l.body),p=!1,d=function(){p=!0};e.on(m,d);(7<c.ie?l:l.selection.createRange()).execCommand(m);e.detach(m,d);return p},o=c.ie?function(a,m){return i(a,m)}:function(a,m){try{return a.get("document")[0].execCommand(m)}catch(b){return!1}},
s={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},r=function(a){this.type=a};r.prototype={constructor:r,exec:function(m){"cut"==this.type&&a(m);(m=o(m,this.type))||alert(s[this.type]);return m}};var n={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"},m;return{init:function(a){a.docReady(function(){new f(a)});var m={copy:1,cut:1,paste:1};a.on("contextmenu",function(b){b=b.contextmenu;if(!b.__copy_fix){b.__copy_fix=
1;for(var c in m)b.addChild({content:n[c],value:c});b.on("click",function(b){var c=b.target.get("value");m[c]&&(this.hide(),setTimeout(function(){a.execCommand(c)},30))})}})}}},{requires:["./base","./range","./selection"]});
KISSY.add("editor/core/dom",function(d,g,j){function h(a,b){var e=a[b?"next":"prev"](f,1);if(e&&e[0].nodeType==c.ELEMENT_NODE){for(var l=[];e.attr("_ke_bookmark")||e._4e_isEmptyInlineRemovable(f);)if(l.push(e),e=b?e.next(f,1):e.prev(f,1),!e)return;if(a._4e_isIdentical(e,f)){for(var d=new k(b?a[0].lastChild:a[0].firstChild);l.length;)l.shift()._4e_move(a,!b,f);e._4e_moveChildren(a,!b,f);e.remove();d[0]&&d[0].nodeType==c.ELEMENT_NODE&&d._4e_mergeSiblings()}}}var f=f,a=g.XHTML_DTD,b=d.DOM,c=b.NodeType,
e=d.UA,k=d.Node,i={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};g.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var o=g.POSITION,s={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,
"table-column":1,"table-cell":1,"table-caption":1},r={hr:1},n=function(a){return a&&(a[0]||a)};j.injectDom({_4e_sameLevel:function(a,b){var b=n(b),c=a.parentNode;return c&&c==b.parentNode},_4e_isBlockBoundary:function(a,c){var e=d.merge(r,c);return!(!s[b.css(a,"display")]&&!e[b.nodeName(a)])},_4e_index:function(a,b){for(var c=a.parentNode.childNodes,e,d=-1,p=0;p<c.length;p++)if(e=c[p],!b||!(3==e.nodeType&&e.previousSibling&&3==e.previousSibling.nodeType))if(d++,e===a)return d;return-1},_4e_move:function(a,
b,c){b=n(b);c?b.insertBefore(a,b.firstChild):b.appendChild(a)},_4e_isIdentical:function(a,c){if(!c)return!1;c=n(c);if(b.nodeName(a)!=b.nodeName(c))return!1;var e=a.attributes,l=c.attributes,d=e.length,p=l.length;if(d!=p)return!1;for(var f=0;f<d;f++){var i=e[f],k=i.name;if(i.specified&&b.attr(a,k)!=b.attr(c,k))return!1}if(8>j.ieEngine)for(f=0;f<p;f++)if(i=l[f],k=i.name,i.specified&&b.attr(a,k)!=b.attr(c,k))return!1;return!0},_4e_isEmptyInlineRemovable:function(m){if(!a.$removeEmpty[b.nodeName(m)])return!1;
for(var m=m.childNodes,e=0,f=m.length;e<f;e++){var l=m[e],i=l.nodeType;if(!(i==c.ELEMENT_NODE&&l.getAttribute("_ke_bookmark"))&&(i==c.ELEMENT_NODE&&!b._4e_isEmptyInlineRemovable(l)||i==b.NodeType.TEXT_NODE&&d.trim(l.nodeValue)))return!1}return!0},_4e_moveChildren:function(a,b,c){b=n(b);if(a!=b)if(c)for(;c=a.lastChild;)b.insertBefore(a.removeChild(c),b.firstChild);else for(;c=a.firstChild;)b.appendChild(a.removeChild(c))},_4e_mergeSiblings:function(a){a=new k(a);i[a.nodeName()]&&(h(a,!0),h(a))},_4e_splitText:function(a,
c){var d=a.ownerDocument;if(a.nodeType==b.NodeType.TEXT_NODE){if(e.ie&&c==a.nodeValue.length){var l=d.createTextNode("");b.insertAfter(l,a);return l}l=a.splitText(c);d.documentMode&&(d=d.createTextNode(""),b.insertAfter(d,l),b.remove(d));return l}},_4e_parents:function(a,b){var c=[];c.__IS_NODELIST=1;do c[b?"push":"unshift"](a);while(a=a.parentNode);return c},_4e_nextSourceNode:function(a,e,d,l){if(l&&!l.call)var f=n(l),l=function(a){return a!==f};var e=!e&&a.firstChild,p=a;if(!e){if(a.nodeType==
c.ELEMENT_NODE&&l&&!1===l(a,!0))return null;e=a.nextSibling}for(;!e&&(p=p.parentNode);){if(l&&!1===l(p,!0))return null;e=p.nextSibling}return!e||l&&!1===l(e)?null:d&&d!=e.nodeType?b._4e_nextSourceNode(e,!1,d,l):e},_4e_previousSourceNode:function(a,e,d,l){if(l&&!l.call)var f=n(l),l=function(a){return a!==f};var e=!e&&a.lastChild,p=a;if(!e){if(a.nodeType==c.ELEMENT_NODE&&l&&!1===l(a,!0))return null;e=a.previousSibling}for(;!e&&(p=p.parentNode);){if(l&&!1===l(p,!0))return null;e=p.previousSibling}return!e||
l&&!1===l(e)?null:d&&e.nodeType!=d?b._4e_previousSourceNode(e,!1,d,l):e},_4e_commonAncestor:function(a,c){c=n(c);if(a===c)return a;if(b.contains(c,a))return c;var e=a;do if(b.contains(e,c))return e;while(e=e.parentNode);return null},_4e_hasAttributes:9>j.ieEngine?function(a){for(var c=a.attributes,b=0;b<c.length;b++){var e=c[b];switch(e.name){case "class":if(a.getAttribute("class"))return!0;break;default:if(e.specified)return!0}}return!1}:function(a){e.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},
_4e_position:function(a,e){var d=n(e);if(a.compareDocumentPosition)return a.compareDocumentPosition(d);if(a==d)return o.POSITION_IDENTICAL;if(a.nodeType==c.ELEMENT_NODE&&d.nodeType==c.ELEMENT_NODE){if(b.contains(a,d))return o.POSITION_CONTAINS+o.POSITION_PRECEDING;if(b.contains(d,a))return o.POSITION_IS_CONTAINED+o.POSITION_FOLLOWING;if("sourceIndex"in a)return 0>a.sourceIndex||0>d.sourceIndex?o.POSITION_DISCONNECTED:a.sourceIndex<d.sourceIndex?o.POSITION_PRECEDING:o.POSITION_FOLLOWING}for(var l=
b._4e_address(a),d=b._4e_address(d),f=Math.min(l.length,d.length),p=0;p<=f-1;p++)if(l[p]!=d[p])return l[p]<d[p]?o.POSITION_PRECEDING:o.POSITION_FOLLOWING;return l.length<d.length?o.POSITION_CONTAINS+o.POSITION_PRECEDING:o.POSITION_IS_CONTAINED+o.POSITION_FOLLOWING},_4e_address:function(a,c){for(var e=[],d=a.ownerDocument.documentElement,f=a;f&&f!=d;)e.unshift(b._4e_index(f,c)),f=f.parentNode;return e},_4e_remove:function(a,e){var c=a.parentNode;if(c){if(e)for(var b;b=a.firstChild;)c.insertBefore(a.removeChild(b),
a);c.removeChild(a)}return a},_4e_trim:function(a){b._4e_ltrim(a);b._4e_rtrim(a)},_4e_ltrim:function(a){for(var c;c=a.firstChild;){if(c.nodeType==b.NodeType.TEXT_NODE){var e=j.ltrim(c.nodeValue),d=c.nodeValue.length;if(e)e.length<d&&(b._4e_splitText(c,d-e.length),a.removeChild(a.firstChild));else{a.removeChild(c);continue}}break}},_4e_rtrim:function(a){for(var c;c=a.lastChild;){if(c.type==b.NodeType.TEXT_NODE){var d=j.rtrim(c.nodeValue),l=c.nodeValue.length;if(d)d.length<l&&(b._4e_splitText(c,d.length),
a.removeChild(a.lastChild));else{a.removeChild(c);continue}}break}!e.ie&&!e.opera&&(c=a.lastChild)&&1==c.nodeType&&"br"==b.nodeName(c)&&a.removeChild(c)},_4e_appendBogus:function(a){for(var c=a.lastChild;c&&c.nodeType==b.NodeType.TEXT_NODE&&!d.trim(c.nodeValue);)c=c.previousSibling;if(!c||c.nodeType==b.NodeType.TEXT_NODE||"br"!==b.nodeName(c))c=e.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br"),e.gecko&&c.setAttribute("type","_moz"),a.appendChild(c)},_4e_outerHtml:function(a){if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,
"");var c=a.ownerDocument.createElement("div");c.appendChild(a.cloneNode(!0));return c.innerHTML},_4e_setMarker:function(a,c,e,b){var a=new k(a),f=a.data("list_marker_id")||a.data("list_marker_id",d.guid()).data("list_marker_id"),p=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");c[f]=a;p[e]=1;return a.data(e,b)},_4e_clearMarkers:function(a,c,e){var a=new k(a),b=a.data("list_marker_names"),d=a.data("list_marker_id"),p;for(p in b)a.removeData(p);a.removeData("list_marker_names");
e&&(a.removeData("list_marker_id"),delete c[d])},_4e_copyAttributes:function(a,c,d){for(var c=new k(c),l=a.attributes,d=d||{},f=0;f<l.length;f++){var p=l[f],i=p.name.toLowerCase(),v;if(!(i in d))if("checked"==i&&(v=b.attr(a,i)))c.attr(i,v);else if(p.specified||e.ie&&p.value&&"value"==i)v=b.attr(a,i),null===v&&(v=p.nodeValue),c.attr(i,v)}""!==a.style.cssText&&(c[0].style.cssText=a.style.cssText)},_4e_isEditable:function(c){c=b.nodeName(c);return(c=!a.$nonEditable[c]&&(a[c]||a.span))&&c["#text"]},_4e_getByAddress:function(a,
c,e){for(var a=a.documentElement,b=0;a&&b<c.length;b++){var d=c[b];if(e)for(var p=-1,f=0;f<a.childNodes.length;f++){var i=a.childNodes[f];if(!(!0===e&&3==i.nodeType&&i.previousSibling&&3==i.previousSibling.nodeType)&&(p++,p==d)){a=i;break}}else a=a.childNodes[d]}return a}})},{requires:["./base","./utils"]});
KISSY.add("editor/core/domIterator",function(d){function g(a){1>arguments.length||(this.range=a,this.forceBrBreak=h,this.enlargeBr=j,this.enforceRealBlocks=h,this._||(this._={}))}var j=!0,h=!1,f=d.Editor,a=d.UA,b=f.Walker,c=f.Range,e=f.RANGE,k=f.ElementPath,i=d.Node,o=d.DOM,s=/^[\r\n\t ]*$/;d.augment(g,{getNextParagraph:function(f){var g,m,q,t,l;if(!this._.lastNode){m=this.range.clone();m.shrink(e.SHRINK_ELEMENT,j);m.enlarge(this.forceBrBreak||!this.enlargeBr?e.ENLARGE_LIST_ITEM_CONTENTS:e.ENLARGE_BLOCK_CONTENTS);
var u=new b(m),p=b.bookmark(j,j);u.evaluator=p;this._.nextNode=u.next();u=new b(m);u.evaluator=p;u=u.previous();this._.lastNode=u._4e_nextSourceNode(j);this._.lastNode&&this._.lastNode[0].nodeType==o.NodeType.TEXT_NODE&&!d.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()&&(p=new c(m.document),p.moveToPosition(this._.lastNode,e.POSITION_AFTER_END),p.checkEndOfBlock()&&(p=new k(p.endContainer),this._.lastNode=(p.block||p.blockLimit)._4e_nextSourceNode(j)));this._.lastNode||
(this._.lastNode=this._.docEndMarker=new i(m.document.createTextNode("")),o.insertAfter(this._.lastNode[0],u[0]));m=null}p=this._.nextNode;u=this._.lastNode;for(this._.nextNode=null;p;){var w=h,v=p[0].nodeType!=o.NodeType.ELEMENT_NODE,z=h;if(v)p[0].nodeType==o.NodeType.TEXT_NODE&&s.test(p[0].nodeValue)&&(v=h);else{var x=p.nodeName();if(p._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if("br"==x)v=j;else if(!m&&!p[0].childNodes.length&&"hr"!=x){g=p;q=p.equals(u);break}m&&(m.setEndAt(p,e.POSITION_BEFORE_START),
"br"!=x&&(this._.nextNode=p));w=j}else{if(p[0].firstChild){m||(m=new c(this.range.document),m.setStartAt(p,e.POSITION_BEFORE_START));p=new i(p[0].firstChild);continue}v=j}}v&&!m&&(m=new c(this.range.document),m.setStartAt(p,e.POSITION_BEFORE_START));q=(!w||v)&&p.equals(u);if(m&&!w)for(;!p[0].nextSibling&&!q;){x=p.parent();if(x._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){w=j;q||x.equals(u);break}p=x;v=j;q=p.equals(u);z=j}v&&m.setEndAt(p,e.POSITION_AFTER_END);p=p._4e_nextSourceNode(z,null,u);if((q=
!p)||w&&m)break}if(!g){if(!m)return this._.docEndMarker&&this._.docEndMarker._4e_remove(),this._.nextNode=null;g=new k(m.startContainer);p=g.blockLimit;w={div:1,th:1,td:1};g=g.block;if((!g||!g[0])&&!this.enforceRealBlocks&&w[p.nodeName()]&&m.checkStartOfBlock()&&m.checkEndOfBlock())g=p;else if(!g||this.enforceRealBlocks&&"li"==g.nodeName())g=new i(this.range.document.createElement(f||"p")),g[0].appendChild(m.extractContents()),g._4e_trim(),m.insertNode(g),t=l=j;else if("li"!=g.nodeName()){if(!m.checkStartOfBlock()||
!m.checkEndOfBlock())g=g.clone(h),g[0].appendChild(m.extractContents()),g._4e_trim(),l=m.splitBlock(),t=!l.wasStartOfBlock,l=!l.wasEndOfBlock,m.insertNode(g)}else q||(this._.nextNode=g.equals(u)?null:m.getBoundaryNodes().endNode._4e_nextSourceNode(j,null,u))}t&&(m=new i(g[0].previousSibling),m[0]&&m[0].nodeType==o.NodeType.ELEMENT_NODE&&("br"==m.nodeName()?m._4e_remove():m[0].lastChild&&"br"==o.nodeName(m[0].lastChild)&&o._4e_remove(m[0].lastChild)));l&&(m=b.bookmark(h,j),t=new i(g[0].lastChild),
t[0]&&t[0].nodeType==o.NodeType.ELEMENT_NODE&&"br"==t.nodeName()&&(a.ie||t.prev(m,1)||t.next(m,1))&&t.remove());this._.nextNode||(this._.nextNode=q||g.equals(u)?null:g._4e_nextSourceNode(j,null,u));return g}});c.prototype.createIterator=function(){return new g(this)};return g},{requires:["./base","./range","./elementPath","./walker"]});
KISSY.add("editor",function(d,g,j,h,f,a,b,c,e,k){function i(a,c){var e=a.body;B(function(){a.designMode="on";setTimeout(function(){a.designMode="off";e.focus();arguments.callee.retry||(arguments.callee.retry=m)},50)},function(){a.designMode="off";v.attr(e,"contentEditable",l);v.attr(e,"contentEditable",m);!c&&i(a,1)})}function o(a){a.get("iframe");var c=a.get("textarea")[0],e=a.get("window")[0],b=a.get("document")[0];p.webkit&&(y.on(b,"click",function(a){var c=new x(a.target);d.inArray(c.nodeName(),
["input","select"])&&a.preventDefault()}),y.on(b,"mouseup",function(a){var c=new x(a.target);d.inArray(c.nodeName(),["input","textarea"])&&a.preventDefault()}));if(p.gecko||w||p.opera){var f;f=(new x('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>')).insertAfter(c);f.on("focus",function(){a.focus()});a.activateGecko=function(){p.gecko&&a.__iframeFocus&&f[0].focus()};a.on("destroy",function(){f.detach();f.remove()})}y.on(e,"focus",function(){p.gecko?i(b,l):p.opera&&
b.body.focus();a.notifySelectionChange()});if(p.gecko)y.on(b,"mousedown",function(){a.__iframeFocus||i(b,l)});if(w&&(y.on(b,"keydown",function(c){if(c.keyCode in{8:1,46:1}){var b=a.getSelection(),e=b.getSelectedElement();if(e){a.execCommand("save");var d=b.getRanges()[0].createBookmark();e.remove();b.selectBookmarks([d]);a.execCommand("save");c.preventDefault()}}}),"CSS1Compat"==b.compatMode)){var k={33:1,34:1};y.on(b,"keydown",function(c){c.keyCode in k&&setTimeout(function(){a.getSelection().scrollIntoView()},
0)})}if(p.webkit)y.on(b,"mousedown",function(c){c=new x(c.target);d.inArray(c.nodeName(),["img","hr","input","textarea","select"])&&a.getSelection().selectElement(c)});if(p.gecko)y.on(b,"dragstart",function(a){var c=new x(a.target);c.nodeName()==="img"&&/ke_/.test(c[0].className)&&a.preventDefault()});h.add(a)}function s(a,c,b,e){var p="",f,l=j.debugUrl("theme/editor-iframe.css");for(f=0;f<b.length;f++)p+=d.substitute('<link href="{href}" rel="stylesheet" />',{href:b[f]});return d.substitute(C,{doctype:8===
u.documentMode?'<meta http-equiv="X-UA-Compatible" content="IE=7" />':"",title:"${title}",href:l,style:c,data:e||"&nbsp;",script:a?'<script id="ke_active_script">'+(v.isCustomDomain()?'document.domain="'+u.domain+'";':"")+'parent.KISSY.Editor._initIFrame("'+a+'");<\/script>':""})}function r(a,c){function b(){l=f.document;a.setInternal("document",new x(l));a.setInternal("window",new x(f));e.detach();l.open("text/html","replace");l.write(d);l.close()}var e=a.get("iframe"),d=s(a._UUID,a.get("customStyle"),
a.get("customLink"),c),p=e[0],f=p.contentWindow,l;e.__loaded=1;try{l=f.document}catch(i){if(p.src=p.src,7>w){setTimeout(b,10);return}}b()}function n(a,c){var b=v.getEmptyIframeSrc()||"";b&&(b=' src="'+b+'" ');var b=new x(d.substitute(D,{iframeSrc:b})),e=a.get("textarea");e.hasAttr("tabindex")&&b.attr("tabindex",p.webkit?-1:e.attr("tabindex"));e.parent().prepend(b);a.set("iframe",b);a.__docReady=0;if(p.gecko&&!b.__loaded)b.on("load",function(){r(a,c)},a);else r(a,c)}var m=!0,q=q,t=d.all,l=!1,u=document,
p=d.UA,w=p.ie,v=d.DOM,z=v.NodeType,x=d.Node,y=d.Event,B=j.tryThese,C='<!doctype html><html><head>{doctype}<title>{title}</title><link href="{href}" rel="stylesheet" /><style>{style}</style>{links}</head><body class="ks-editor" >{data}{script}</body></html>',D='<iframe style="width:100%;height:100%;border:none;"  frameborder="0"  title="kissy-editor"  allowTransparency="true"  {iframeSrc} ></iframe>',A='<div class="{prefixCls}editor-tools"></div><div class="{prefixCls}editor-textarea-wrap" '+(p.mobile?
'style="overflow:scroll;-webkit-overflow-scrolling:touch;"':"")+'></div><div class="{prefixCls}editor-status"></div>';d.mix(g,{SOURCE_MODE:0,WYSIWYG_MODE:1});var F=g.WYSIWYG_MODE;d.augment(g,{createDom:function(){var a,c=this.get("prefixCls"),b=this.get("textarea"),e;b?(this.set("textarea",b=t(b)),b[0].parentNode&&b.remove()):(a=this.get("data"),this.set("textarea",b=t('<textarea class="'+c+'-editor-textarea"></textarea>')),b.val(a));e=this.get("el");e.html(d.substitute(A,{prefixCls:c}));a=e.one(d.substitute(".{prefixCls}editor-textarea-wrap",
{prefixCls:c}));this._UUID=d.guid();this.set({toolBarEl:e.one(d.substitute(".{prefixCls}editor-tools",{prefixCls:c})),statusBarEl:e.one(d.substitute(".{prefixCls}editor-status",{prefixCls:c}))},{silent:1});b.css("width","100%");b.css("display","none");a.append(b);h.register(this)},renderUI:function(){b.init(this);c.init(this);e.init(this);k.init(this)},bindUI:function(){function a(){c.detach("docReady",a);if(c.get("focused"))c.focus();else{var b=c.getSelection();b&&b.removeAllRanges()}}var c=this,
b,e=c.get("prefixCls"),d=c.get("textarea");if(c.get("attachForm")&&(b=d[0].form))y.on(b,"submit",c.sync,c);c.on("docReady",a);c.on("blur",function(){c.get("el").removeClass(e+"editor-focused")});c.on("focus",function(){c.get("el").addClass(e+"editor-focused")})},syncUI:function(){this.get("rendered")&&this.get("textarea").val(this.get("data"))},_onSetHeight:function(a){var c=this.get("textarea"),b=this.get("toolBarEl"),e=this.get("statusBarEl"),a=parseInt(a,10),a=a-((b&&b.outerHeight()||0)+(e&&e.outerHeight()||
0));c.parent().css("height",a);c.css("height",a)},_onSetMode:function(a){this.get("rendered");var c=this.get("iframe"),b=this.get("textarea");a==F?(this._setData(b.val()),b.hide(),this.fire("wysiwygMode")):(c&&(b.val(this._getData(1,F)),c.hide()),b.show(),this.fire("sourceMode"))},_onSetFocused:function(a){a&&this.__docReady&&this.focus()},_onSetData:function(a){this.get("rendered")&&this._setData(a)},destructor:function(){var a,c=this.get("textarea"),b=this.get("document")[0],e=this.get("window");
this.get("attachForm")&&(a=c[0].form)&&y.detach(a,"submit",this.sync,this);h.remove(this);y.remove([b,b.documentElement,b.body,e[0]]);d.each(this.__controls,function(a){a.destroy&&a.destroy()});this.__commands={};this.__controls={}},getControl:function(a){return this.__controls[a]},getControls:function(){return this.__controls},addControl:function(a,c){this.__controls[a]=c},showDialog:function(a,c){var a=a+"/dialog",b=this.__controls[a];b.show(c);this.fire("dialogShow",{dialog:b.dialog,pluginDialog:b,
dialogName:a})},addCommand:function(a,c){this.__commands[a]=c},hasCommand:function(a){return this.__commands[a]},execCommand:function(a){var c=this.__commands[a],b=d.makeArray(arguments);b.shift();b.unshift(this);return c?c.exec.apply(c,b):q},queryCommandValue:function(a){return this.execCommand(j.getQueryCmd(a))},_getData:function(a,c){var b=this.htmlDataProcessor,e;if(!this.get("rendered"))return q;c==q&&(c=this.get("mode"));e=c==F&&this.isDocReady()?this.get("document")[0].body.innerHTML:b.toDataFormat(this.get("textarea").val());
e=a?b.toHtml(e):b.toServer(e);e=d.trim(e);/^(?:<(p)>)?(?:(?:&nbsp;)|\s)*(?:<\/\1>)?$/.test(e)&&(e="");return e},_setData:function(a){var c,b=a;if(this.get("mode")!=F)this.get("textarea").val(a);else{if(c=this.htmlDataProcessor)b=c.toDataFormat(a);if(this.get("iframe")){a=this.get("iframe");c=this.get("window")[0];var e=this.get("document")[0];y.remove([e,e.documentElement,e.body,c]);a.remove()}n(this,b)}},getDocHtml:function(){return s(0,this.get("customStyle"),this.get("customLink"),this.get("formatData"))},
getSelection:function(){return g.Selection.getSelection(this.get("document")[0])},focus:function(){var a=this.get("window");if(a){var c=this.get("document")[0],a=a[0];p.ie||a&&a.parent&&a.parent.focus();a&&a.focus();try{c.body.focus()}catch(b){}this.notifySelectionChange()}},blur:function(){this.get("window")[0].blur();this.get("document")[0].body.blur()},addCustomStyle:function(a,c){var b=this.get("window"),e=this.get("customStyle")||"";this.set("customStyle",e+("\n"+a));b&&v.addStyleSheet(b,a,c)},
removeCustomStyle:function(a){v.remove(v.get("#"+a,this.get("window")[0]))},addCustomLink:function(a){var c=this.get("customLink")||[],b=this.get("document")[0];c.push(a);this.set("customLink",c);c=b.createElement("link");c.rel="stylesheet";b.getElementsByTagName("head")[0].appendChild(c);c.href=a},removeCustomLink:function(a){for(var c=this.get("document")[0],c=v.query("link",c),b=0;b<c.length;b++)v.attr(c[b],"href")==a&&v.remove(c[b]);c=this.get("customLink")||[];a=d.indexOf(a,c);-1!=a&&c.splice(a,
1)},docReady:function(a){this.on("docReady",a);this.__docReady&&a.call(this)},isDocReady:function(){return this.__docReady},checkSelectionChange:function(){var a=this;a.__checkSelectionChangeId&&clearTimeout(a.__checkSelectionChangeId);a.__checkSelectionChangeId=setTimeout(function(){var c=a.getSelection();if(c&&!c.isInvalid){var b=c.getStartElement(),e=new g.ElementPath(b);if(!a.__previousPath||!a.__previousPath.compare(e))a.__previousPath=e,a.fire("selectionChange",{selection:c,path:e,element:b})}},
100)},notifySelectionChange:function(){this.__previousPath=null;this.checkSelectionChange()},insertElement:function(a){if(this.get("mode")!==F)return q;this.focus();var c,b=a.nodeName(),e=g.XHTML_DTD,d=e.$block[b],p=g.RANGE,f=(b=this.getSelection())&&b.getRanges(),l,i,k;if(!f||0==f.length)return q;this.execCommand("save");for(i=f.length-1;0<=i;i--)l=f[i],c=!i&&a||a.clone(m),l.insertNodeByDtd(c),k||(k=c);if(!k)return q;l.moveToPosition(k,p.POSITION_AFTER_END);d&&(a=g.Walker.whitespaces(!0),(a=(k=k.next(a,
1))&&k[0].nodeType==z.ELEMENT_NODE&&k.nodeName())&&e.$block[a]&&e[a]["#text"]&&l.moveToElementEditablePosition(k));b.selectRanges([l]);this.focus();c&&1==c[0].nodeType&&c.scrollIntoView(q,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0});E.call(this);return c},insertHtml:function(a,c){var b=this,e,d=b.get("document")[0];if(b.get("mode")===F){if(e=b.htmlDataProcessor)a=e.toDataFormat(a,c);b.focus();b.execCommand("save");if(w){e=d.selection;"Control"==e.type&&e.clear();try{e.createRange().pasteHTML(a)}catch(f){}}else try{d.execCommand("inserthtml",
l,a)}catch(p){setTimeout(function(){if(0==b.getSelection().getRanges().length){var c=new g.Range(d),e=v.first(d.body,function(a){return 1==a.nodeType&&"br"!=v.nodeName(a)});e||(e=new x(d.createElement("p")),e._4e_appendBogus(q),d.body.appendChild(e[0]));c.setStartAt(e,g.RANGE.POSITION_AFTER_START);c.select()}d.execCommand("inserthtml",l,a)},50)}setTimeout(function(){b.getSelection().scrollIntoView()},50);E.call(b)}}});g._initIFrame=function(a){var c=h.getInstance(a),b=c.get("document")[0],a=b.getElementById("ke_active_script");
v.remove(a);o(c);var e=b.body;w?(e.hideFocus=m,e.disabled=m,e.contentEditable=m,e.removeAttribute("disabled")):setTimeout(function(){p.gecko||p.opera?e.contentEditable=m:p.webkit?e.parentNode.contentEditable=m:b.designMode="on"},0);if(p.gecko||p.opera){var d=b.documentElement;y.on(d,"mousedown",function(a){if(a.target==d){p.gecko&&i(b,l);c.activateGecko()}})}setTimeout(function(){w&&setTimeout(function(){if(b){e.runtimeStyle.marginBottom="0px";e.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){c.__docReady=
1;c.fire("docReady");var a=c.get("disableObjectResizing"),d=c.get("disableInlineTableEditing");if(a||d)try{b.execCommand("enableObjectResizing",l,!a);b.execCommand("enableInlineTableEditing",l,!d)}catch(f){y.on(e,w?"resizestart":"resize",function(c){var b=new x(c.target);(a||b.nodeName()==="table"&&d)&&c.preventDefault()})}},10)};var E=d.buffer(function(){this.execCommand("save")},50);return g},{requires:"editor/core/base,editor/core/utils,editor/core/focusManager,editor/core/styles,editor/core/zIndexManager,editor/core/clipboard,editor/core/enterKey,editor/core/htmlDataProcessor,editor/core/selectionFix".split(",")});
KISSY.add("editor/core/elementPath",function(d){function g(e){for(var d=a,i=a,g=[];e;){if(e[0].nodeType==h.NodeType.ELEMENT_NODE){this.lastElement||(this.lastElement=e);var j=e.nodeName();if(!i&&(!d&&b[j]&&(d=e),c[j])){var r;if(r=!d)if(r="div"==j){a:{r=e[0].childNodes;for(var n=0,m=r.length;n<m;n++){var q=r[n];if(q.nodeType==h.NodeType.ELEMENT_NODE&&f.$block[q.nodeName.toLowerCase()]){r=!0;break a}}r=!1}r=!r}r?d=e:i=e}g.push(e);if("body"==j)break}e=e.parent()}this.block=d;this.blockLimit=i;this.elements=
g}var j=d.Editor,h=d.DOM,f=j.XHTML_DTD,a=null,b={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},c={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};g.prototype={constructor:g,compare:function(a){var c=this.elements,a=a&&a.elements;if(!a||c.length!=a.length)return!1;for(var b=0;b<c.length;b++)if(!h.equals(c[b],a[b]))return!1;return!0},contains:function(c){for(var b=this.elements,d=0;d<b.length;d++)if(b[d].nodeName()in c)return b[d];return a},toString:function(){var a=
this.elements,c,b=[];for(c=0;c<a.length;c++)b.push(a[c].nodeName());return b.toString()}};return j.ElementPath=g},{requires:["./base","./dom"]});
KISSY.add("editor/core/enterKey",function(d,g,j,h){function f(a){var f;f=a.getSelection().getRanges();for(var i=f.length-1;0<i;i--)f[i].deleteContents();f=f[0];i=f.document;if(f.checkStartOfBlock()&&f.checkEndOfBlock()){var g=(new h(f.startContainer)).block;if(g&&("li"==g.nodeName()||"li"==g.parent().nodeName()))return a.hasCommand("outdent")?(a.execCommand("save"),a.execCommand("outdent"),a.execCommand("save"),!0):!1}var m=f.splitBlock("p");if(!m)return!0;var a=m.previousBlock,g=m.nextBlock,q=m.wasStartOfBlock,
t=m.wasEndOfBlock,l;if(g)l=g.parent(),"li"==l.nodeName()&&(g._4e_breakParent(l),g._4e_move(g.next(),!0));else if(a&&(l=a.parent())&&"li"==l.nodeName())a._4e_breakParent(l),f.moveToElementEditablePosition(a.next()),a._4e_move(a.prev());if(!q&&!t){if("li"==g.nodeName()&&(l=g.first(j.invisible(!0)))&&d.inArray(l.nodeName(),["ul","ol"]))(b.ie?new k(i.createTextNode("\u00a0")):new k(i.createElement("br"))).insertBefore(l);g&&f.moveToElementEditablePosition(g)}else{var u;if(a){if("li"==a.nodeName()||!c.test(a.nodeName()))u=
a.clone()}else g&&(u=g.clone());u||(u=new k("<p>",null,i));if(l=m.elementPath)for(var m=0,p=l.elements.length;m<p;m++){var w=l.elements[m];if(w.equals(l.block)||w.equals(l.blockLimit))break;e.$removeEmpty[w.nodeName()]&&(w=w.clone(),u._4e_moveChildren(w),u.append(w))}b.ie||u._4e_appendBogus();f.insertNode(u);if(b.ie&&q&&(!t||!a[0].childNodes.length))f.moveToElementEditablePosition(t?a:u),f.select();f.moveToElementEditablePosition(q&&!t?g:u)}b.ie||(g?(u=new k(i.createElement("span")),u.html("&nbsp;"),
f.insertNode(u),u.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}),f.deleteContents()):u.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}));f.select();return!0}function a(a){var c=a.get("document")[0];i.on(c,"keydown",function(c){if(13===c.keyCode&&!c.shiftKey&&!c.ctrlKey&&!c.metaKey){a.execCommand("save");var b=a.execCommand("enterBlock");a.execCommand("save");!1!==b&&c.preventDefault()}})}var b=d.UA,c=/^h[1-6]$/,e=g.XHTML_DTD,
k=d.Node,i=d.Event;return{init:function(c){c.addCommand("enterBlock",{exec:f});c.docReady(function(){a(c)})}}},{requires:["./base","./walker","./elementPath"]});
KISSY.add("editor/core/focusManager",function(d){function g(){var a=this;a.__iframeFocus=e;c=a;b&&clearTimeout(b);b=setTimeout(function(){a.fire("focus")},100)}function j(){var a=this;a.__iframeFocus=k;c=i;b&&clearTimeout(b);b=setTimeout(function(){a.fire("blur")},100)}var h=d.Editor,f=d.Event,a={},b,c,d={refreshAll:function(){for(var c in a){var b=a[c].get("document")[0];b.designMode="off";b.designMode="on"}},currentInstance:function(){return c},getInstance:function(c){return a[c]},add:function(a){var c=
a.get("window")[0];f.on(c,"focus",g,a);f.on(c,"blur",j,a)},register:function(c){a[c._UUID]=c},remove:function(c){delete a[c._UUID];var b=c.get("window")[0];f.remove(b,"focus",g,c);f.remove(b,"blur",j,c)}},e=!0,k=!1,i=null;d.refreshAll=d.refreshAll;h.focusManager=d;h.getInstances=function(){return a};return d},{requires:["./base","./dom"]});
KISSY.add("editor/core/htmlDataProcessor",function(d,g){return{init:function(j){function h(a){if((a.getAttribute("class")+"").match(/Apple-\w+-span/)||!a.attributes.length)a.setTagName(null);else if(!a.childNodes.length&&!a.attributes.length)return!1}function f(a){return a.replace(s,function(a,c,b){return"<"+c+b.replace(r,function(a,c){return-1==b.indexOf("_ke_saved_"+c)?" _ke_saved_"+a+" "+a:a})+">"})}function a(a){return a.replace(m,function(a){return"<ke:encoded>"+encodeURIComponent(a)+"</ke:encoded>"})}
function b(a){return a.replace(q,function(a,c){return d.urlDecode(c)})}var c=d.Node,e=d.UA,k=d.require("htmlparser"),i=new k.Filter,o=new k.Filter;(function(){function a(c){c=k.serialize(c);return new k.Comment(n+encodeURIComponent(c).replace(/--/g,"%2D%2D"))}var c={tagNames:[[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]],tags:{script:a,noscript:a,span:h}},b={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(a){if(a.attributes.length)for(var c=
["name","href","src"],b,e=0;e<c.length;e++)b="_ke_saved_"+c[e],a.getAttribute(b)&&a.removeAttribute(c[e]);return a},embed:function(a){var c=a.parentNode;if(c&&"object"==c.nodeName){var b=c.getAttribute("width"),c=c.getAttribute("height");b&&a.setAttribute("width",b);c&&a.setAttribute("width",c)}},a:function(a){if(!a.childNodes.length&&!a.attributes.length)return!1},span:h},attributes:{style:function(a){if(!d.trim(a))return!1}},attributeNames:[[/^_ke_saved_/,""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,
""],[/^_ks.*/,""]],text:function(a){if(e.webkit)return a.replace(/\u200b/g,"")},comment:function(a){if(a.substr(0,n.length)==n)return a=d.trim(d.urlDecode(a.substr(n.length))),k.parse(a).childNodes[0]}};e.ie&&(b.attributes.style=function(a){return a.replace(/(^|;)([^:]+)/g,function(a){return a.toLowerCase()})});i.addRules(b);o.addRules(c)})();(function(){function a(c){for(var c=c.childNodes,b=c.length,e=c[b-1];e&&3==e.nodeType&&!d.trim(e.nodeValue);)e=c[--b];return e}function c(b,d){var f=a(b);f&&
((d||!e.ie)&&1==f.nodeType&&"br"==f.nodeName?b.removeChild(f):3==f.nodeType&&m.test(f.nodeValue)&&b.removeChild(f))}function b(c){var e=a(c);return!e||1==e.nodeType&&"br"==e.nodeName||"form"==c.nodeName&&"input"==e.nodeName}function f(a){c(a,!0);b(a)&&(e.ie?a.appendChild(new k.Text("\u00a0")):(a.appendChild(new k.Text("&nbsp;")),a.appendChild(new k.Tag("br"))))}function l(a){c(a,!1);b(a)&&a.appendChild(new k.Text("\u00a0"))}var m=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,h=g.XHTML_DTD,q=d.merge(h.$block,h.$listItem,h.$tableContent),
u;for(u in q)"br"in h[u]||delete q[u];delete q.td;delete q.pre;var h={tags:{}},j={tags:{}};for(u in q)h.tags[u]=f,j.tags[u]=l;o.addRules(h);i.addRules(j)})();i.addRules({text:function(a){return a.replace(/\xa0/g,"&nbsp;")}});var s=/<(a|area|img|input)\b([^>]*)>/gi,r=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,n="{ke_protected}",m=/(?:<textarea[^>]*>[\s\S]*<\/textarea>)|(?:<style[^>]*>[\s\S]*<\/style>)|(?:<(:?link|meta|base)[^>]*>)/gi,q=/<ke:encoded>([^<]*)<\/ke:encoded>/gi,
t=/(<\/?)((?:object|embed|param|html|body|head|title|script|noscript)[^>]*>)/gi,l=/(<\/?)ke:((?:object|embed|param|html|body|head|title|script|noscript)[^>]*>)/gi,u=/<ke:(param|embed)([^>]*?)\/?>(?!\s*<\/ke:\1)/gi;j.htmlDataProcessor={dataFilter:o,htmlFilter:i,toHtml:function(a){var c=new k.BeautifyWriter;(new k.Parser(a)).parse().writeHtml(c,i);return a=c.getHtml()},toDataFormat:function(e,d){var d=d||o,e=a(e),e=f(e),e=e.replace(t,"$1ke:$2"),e=e.replace(u,"<ke:$1$2></ke:$1>"),i=new c("<div>");i.html("a"+
e);e=i.html().substr(1);e=e.replace(l,"$1$2");e=b(e);i=new k.BasicWriter;(new k.Parser(e)).parse().writeHtml(i,d);return e=i.getHtml()},toServer:function(a){var c=new k.MinifyWriter;(new k.Parser(a)).parse().writeHtml(c,i);return c.getHtml()}}}}},{requires:["./base"]});
KISSY.config("modules",{"editor/plugin/heading/cmd":{requires:["editor"]},"editor/plugin/page-break/index":{requires:["editor","editor/plugin/fake-objects/"]},"editor/plugin/italic/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/font-size/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/image/dialog":{requires:["io","editor","editor/plugin/dialog/","tabs","editor/plugin/menubutton/"]},"editor/plugin/underline/index":{requires:["editor","editor/plugin/font/ui",
"editor/plugin/underline/cmd"]},"editor/plugin/maximize/cmd":{requires:["editor"]},"editor/plugin/contextmenu/index":{requires:["editor","menu","editor/plugin/focus-fix/"]},"editor/plugin/heading/index":{requires:["editor","editor/plugin/heading/cmd"]},"editor/plugin/drag-upload/index":{requires:["editor"]},"editor/plugin/color/cmd":{requires:["editor"]},"editor/plugin/code/index":{requires:["editor","editor/plugin/dialog-loader/"]},"editor/plugin/flash/dialog":{requires:["editor","editor/plugin/flash-common/utils",
"editor/plugin/dialog/","editor/plugin/menubutton/"]},"editor/plugin/strike-through/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/unordered-list/index":{requires:["editor","editor/plugin/list-utils/btn","editor/plugin/unordered-list/cmd"]},"editor/plugin/outdent/cmd":{requires:["editor","editor/plugin/dent-utils/cmd"]},"editor/plugin/italic/index":{requires:["editor","editor/plugin/font/ui","editor/plugin/italic/cmd"]},"editor/plugin/remove-format/cmd":{requires:["editor"]},"editor/plugin/font-size/index":{requires:["editor",
"editor/plugin/font/ui","editor/plugin/font-size/cmd"]},"editor/plugin/indent/cmd":{requires:["editor","editor/plugin/dent-utils/cmd"]},"editor/plugin/table/index":{requires:["editor","editor/plugin/dialog-loader/","editor/plugin/contextmenu/"]},"editor/plugin/word-filter/dynamic/index":{requires:["htmlparser"]},"editor/plugin/justify-left/cmd":{requires:["editor/plugin/justify-utils/cmd"]},"editor/plugin/resize/index":{requires:["editor","dd/base"]},"editor/plugin/video/dialog":{requires:["editor",
"editor/plugin/flash/dialog","editor/plugin/menubutton/"]},"editor/plugin/focus-fix/index":{requires:["editor"]},"editor/plugin/xiami-music/index":{requires:["editor","editor/plugin/flash-common/baseClass","editor/plugin/flash-common/utils","editor/plugin/fake-objects/"]},"editor/plugin/maximize/index":{requires:["editor","editor/plugin/maximize/cmd"]},"editor/plugin/color/color-picker/dialog":{requires:["editor","editor/plugin/dialog/"]},"editor/plugin/smiley/index":{requires:["editor","editor/plugin/overlay/"]},
"editor/plugin/separator/index":{requires:["editor"]},"editor/plugin/video/index":{requires:["editor","editor/plugin/flash-common/utils","editor/plugin/flash-common/baseClass","editor/plugin/fake-objects/"]},"editor/plugin/multiple-upload/index":{requires:["editor","editor/plugin/dialog-loader/"]},"editor/plugin/undo/btn":{requires:["editor","editor/plugin/button/"]},"editor/plugin/menubutton/index":{requires:["editor","menubutton"]},"editor/plugin/flash/index":{requires:["editor","editor/plugin/flash-common/baseClass",
"editor/plugin/flash-common/utils","editor/plugin/fake-objects/"]},"editor/plugin/dialog/index":{requires:["editor","overlay","editor/plugin/focus-fix/","dd/plugin/constrain","component/plugin/drag"]},"editor/plugin/overlay/index":{requires:["editor","overlay","editor/plugin/focus-fix/"]},"editor/plugin/link/utils":{requires:["editor"]},"editor/plugin/xiami-music/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton/"]},"editor/plugin/list-utils/cmd":{requires:["editor",
"editor/plugin/list-utils/"]},"editor/plugin/button/index":{requires:["editor","button"]},"editor/plugin/checkbox-source-area/index":{requires:["editor"]},"editor/plugin/strike-through/index":{requires:["editor","editor/plugin/font/ui","editor/plugin/strike-through/cmd"]},"editor/plugin/fore-color/index":{requires:["editor","editor/plugin/color/btn","editor/plugin/fore-color/cmd"]},"editor/plugin/flash-bridge/index":{requires:["swf","editor"]},"editor/plugin/fore-color/cmd":{requires:["editor/plugin/color/cmd"]},
"editor/plugin/table/dialog":{requires:["editor","editor/plugin/dialog/","editor/plugin/menubutton/"]},"editor/plugin/justify-utils/cmd":{requires:["editor"]},"editor/plugin/undo/index":{requires:["editor","editor/plugin/undo/btn","editor/plugin/undo/cmd"]},"editor/plugin/justify-right/cmd":{requires:["editor/plugin/justify-utils/cmd"]},"editor/plugin/image/index":{requires:["editor","editor/plugin/button/","editor/plugin/bubble/","editor/plugin/contextmenu/","editor/plugin/dialog-loader/"]},"editor/plugin/dent-utils/cmd":{requires:["editor",
"editor/plugin/list-utils/"]},"editor/plugin/ordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]},"editor/plugin/list-utils/index":{requires:["editor"]},"editor/plugin/dialog-loader/index":{requires:["overlay","editor"]},"editor/plugin/flash-common/utils":{requires:["swf"]},"editor/plugin/font-family/index":{requires:["editor","editor/plugin/font/ui","editor/plugin/font-family/cmd"]},"editor/plugin/undo/cmd":{requires:["editor"]},"editor/plugin/indent/index":{requires:["editor",
"editor/plugin/indent/cmd"]},"editor/plugin/font/cmd":{requires:["editor"]},"editor/plugin/ordered-list/index":{requires:["editor","editor/plugin/list-utils/btn","editor/plugin/ordered-list/cmd"]},"editor/plugin/color/btn":{requires:["editor","editor/plugin/button/","editor/plugin/overlay/","editor/plugin/dialog-loader/"]},"editor/plugin/bold/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/local-storage/index":{requires:["editor","overlay","editor/plugin/flash-bridge/"]},"editor/plugin/bubble/index":{requires:["overlay",
"editor"]},"editor/plugin/underline/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/bold/index":{requires:["editor","editor/plugin/font/ui","editor/plugin/bold/cmd"]},"editor/plugin/back-color/index":{requires:["editor","editor/plugin/color/btn","editor/plugin/back-color/cmd"]},"editor/plugin/draft/index":{requires:["editor","editor/plugin/local-storage/","overlay","editor/plugin/menubutton/"]},"editor/plugin/link/index":{requires:["editor","editor/plugin/bubble/","editor/plugin/link/utils",
"editor/plugin/dialog-loader/","editor/plugin/button/"]},"editor/plugin/remove-format/index":{requires:["editor","editor/plugin/remove-format/cmd","editor/plugin/button/"]},"editor/plugin/font/ui":{requires:["editor","editor/plugin/button/","editor/plugin/menubutton/"]},"editor/plugin/element-path/index":{requires:["editor"]},"editor/plugin/source-area/index":{requires:["editor","editor/plugin/button/"]},"editor/plugin/justify-right/index":{requires:["editor","editor/plugin/justify-right/cmd"]},"editor/plugin/list-utils/btn":{requires:["editor",
"editor/plugin/button/","editor/plugin/menubutton/"]},"editor/plugin/justify-left/index":{requires:["editor","editor/plugin/justify-left/cmd"]},"editor/plugin/outdent/index":{requires:["editor","editor/plugin/outdent/cmd"]},"editor/plugin/fake-objects/index":{requires:["editor"]},"editor/plugin/font-family/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/back-color/cmd":{requires:["editor/plugin/color/cmd"]},"editor/plugin/link/dialog":{requires:["editor","editor/plugin/dialog/",
"editor/plugin/link/utils"]},"editor/plugin/multiple-upload/dialog":{requires:"editor,component/plugin/drag,editor/plugin/progressbar/,editor/plugin/dialog/,editor/plugin/flash-bridge/,editor/plugin/local-storage/,swf".split(",")},"editor/plugin/code/dialog":{requires:["editor","editor/plugin/dialog/","menubutton"]},"editor/plugin/justify-center/cmd":{requires:["editor/plugin/justify-utils/cmd"]},"editor/plugin/flash-common/baseClass":{requires:["editor","editor/plugin/contextmenu/","editor/plugin/bubble/",
"editor/plugin/dialog-loader/","editor/plugin/flash-common/utils"]},"editor/plugin/justify-center/index":{requires:["editor","editor/plugin/justify-center/cmd"]},"editor/plugin/unordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]}});
KISSY.add("editor/core/range",function(d,g,j,h,f){function a(a){var c=a.nodeType!=q.NodeType.TEXT_NODE&&q.nodeName(a)in l.$removeEmpty,b=a.nodeType==q.NodeType.TEXT_NODE&&!d.trim(a.nodeValue),a=!!a.parentNode.getAttribute("_ke_bookmark");return c||b||a}function b(a){return!v(a)&&!z(a)}function c(a){var c=s;return function(b){if(z(b))return o;if(b.nodeType==q.NodeType.TEXT_NODE){if(d.trim(b.nodeValue).length)return s}else if(b.nodeType==q.NodeType.ELEMENT_NODE&&(b=q.nodeName(b),!B[b]))if(!a&&!t.ie&&
"br"==b&&!c)c=o;else return s;return o}}function e(a,c){var b=a.startContainer,e=a.endContainer,d=a.startOffset,f=a.endOffset,l,p=s,i=s,g=void 0,k=a.document,m;0<c&&(g=k.createDocumentFragment());if(a.collapsed)return g;a.optimizeBookmark();e[0].nodeType==q.NodeType.TEXT_NODE?(i=o,e=e._4e_splitText(f)):0<e[0].childNodes.length&&(f>=e[0].childNodes.length?(e=new u(e[0].appendChild(k.createTextNode(""))),m=o):e=new u(e[0].childNodes[f]));b[0].nodeType==q.NodeType.TEXT_NODE?(p=o,b._4e_splitText(d)):
d?d>=b[0].childNodes.length?(b=new u(b[0].appendChild(k.createTextNode(""))),l=o):b=new u(b[0].childNodes[d].previousSibling):(l=new u(k.createTextNode("")),b.prepend(l),b=l,l=o);var h=b._4e_parents(),v=e._4e_parents();h.each(function(a,c){h[c]=a});v.each(function(a,c){v[c]=a});for(var j,w,k=0;k<h.length&&!(j=h[k],w=v[k],!j.equals(w));k++);for(var d=g,n,t,z=k;z<h.length;z++){n=h[z];f=0<c&&!n.equals(b)?d.appendChild(n.clone()[0]):null;n=n[0].nextSibling;t=v[z];for(var r=e[0],x=t&&t[0];n&&!(x==n||r==
n);)t=n.nextSibling,2==c?d.appendChild(n.cloneNode(o)):(q._4e_remove(n),1==c&&d.appendChild(n)),n=t;f&&(d=f)}for(d=g;k<v.length;k++){n=v[k];f=0<c&&!n.equals(e)?d.appendChild(n.clone()[0]):null;if(!h[k]||!n._4e_sameLevel(h[k]))for(n=n[0].previousSibling;n;)t=n.previousSibling,2==c?d.insertBefore(n.cloneNode(o),d.firstChild):(q._4e_remove(n),1==c&&d.insertBefore(n,d.firstChild)),n=t;f&&(d=f)}if(2==c){if(p&&(j=b[0],j.nodeType==q.NodeType.TEXT_NODE&&j.nextSibling&&j.nextSibling.nodeType==q.NodeType.TEXT_NODE&&
(j.data+=j.nextSibling.data,j.parentNode.removeChild(j.nextSibling))),i)i=e[0],i.nodeType==q.NodeType.TEXT_NODE&&i.previousSibling&&i.previousSibling.nodeType==q.NodeType.TEXT_NODE&&(i.previousSibling.data+=i.data,i.parentNode.removeChild(i))}else{if(j&&w&&(!b._4e_sameLevel(j)||!e._4e_sameLevel(w)))i=j._4e_index(),l&&j._4e_sameLevel(b)&&i--,a.setStart(j.parent(),i+1);a.collapse(o)}l&&b.remove();m&&e.remove();return g}function k(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer[0]==
a.endContainer[0]&&a.startOffset==a.endOffset}function i(a){this.endOffset=this.endContainer=this.startOffset=this.startContainer=r;this.collapsed=o;this.document=a}g.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var o=!0,s=!1,r=null,n=g.RANGE,m=g.POSITION,q=d.DOM,t=d.UA,l=g.XHTML_DTD,u=d.Node,p=u.all,w={area:1,base:1,br:1,col:1,hr:1,
img:1,input:1,link:1,meta:1,param:1},v=new h.whitespaces,z=new h.bookmark,x=h.whitespaces(o),y=h.bookmark(!1,!0),B={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};d.augment(i,{toString:function(){var a=[],c=this.startContainer[0],b=this.endContainer[0];a.push((c.id||c.nodeName)+":"+this.startOffset);a.push((b.id||b.nodeName)+":"+this.endOffset);return a.join("<br/>")},optimize:function(){var a=
this.startContainer,c=this.startOffset;a[0].nodeType!=q.NodeType.ELEMENT_NODE&&(c?c>=a[0].nodeValue.length&&this.setStartAfter(a):this.setStartBefore(a));a=this.endContainer;c=this.endOffset;a[0].nodeType!=q.NodeType.ELEMENT_NODE&&(c?c>=a[0].nodeValue.length&&this.setEndAfter(a):this.setEndBefore(a))},setStartAfter:function(a){this.setStart(a.parent(),a._4e_index()+1)},setStartBefore:function(a){this.setStart(a.parent(),a._4e_index())},setEndAfter:function(a){this.setEnd(a.parent(),a._4e_index()+
1)},setEndBefore:function(a){this.setEnd(a.parent(),a._4e_index())},optimizeBookmark:function(){var a=this.startContainer,c=this.endContainer;a&&"span"==a.nodeName()&&a.attr("_ke_bookmark")&&this.setStartBefore(a);c&&"span"==c.nodeName()&&c.attr("_ke_bookmark")&&this.setEndAfter(c)},setStart:function(a,c){a[0].nodeType==q.NodeType.ELEMENT_NODE&&w[a.nodeName()]&&(a=a.parent(),c=a._4e_index());this.startContainer=a;this.startOffset=c;this.endContainer||(this.endContainer=a,this.endOffset=c);k(this)},
setEnd:function(a,c){a[0].nodeType==q.NodeType.ELEMENT_NODE&&w[a.nodeName()]&&(a=a.parent(),c=a._4e_index()+1);this.endContainer=a;this.endOffset=c;this.startContainer||(this.startContainer=a,this.startOffset=c);k(this)},setStartAt:function(a,c){switch(c){case n.POSITION_AFTER_START:this.setStart(a,0);break;case n.POSITION_BEFORE_END:a[0].nodeType==q.NodeType.TEXT_NODE?this.setStart(a,a[0].nodeValue.length):this.setStart(a,a[0].childNodes.length);break;case n.POSITION_BEFORE_START:this.setStartBefore(a);
break;case n.POSITION_AFTER_END:this.setStartAfter(a)}k(this)},setEndAt:function(a,c){switch(c){case n.POSITION_AFTER_START:this.setEnd(a,0);break;case n.POSITION_BEFORE_END:a[0].nodeType==q.NodeType.TEXT_NODE?this.setEnd(a,a[0].nodeValue.length):this.setEnd(a,a[0].childNodes.length);break;case n.POSITION_BEFORE_START:this.setEndBefore(a);break;case n.POSITION_AFTER_END:this.setEndAfter(a)}k(this)},cloneContents:function(){return e(this,2)},deleteContents:function(){return e(this,0)},extractContents:function(){return e(this,
1)},collapse:function(a){a?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,this.startOffset=this.endOffset);this.collapsed=o},clone:function(){var a=new i(this.document);a.startContainer=this.startContainer;a.startOffset=this.startOffset;a.endContainer=this.endContainer;a.endOffset=this.endOffset;a.collapsed=this.collapsed;return a},getEnclosedNode:function(){var a=this.clone();a.optimize();if(a.startContainer[0].nodeType!=q.NodeType.ELEMENT_NODE||
a.endContainer[0].nodeType!=q.NodeType.ELEMENT_NODE)return r;var c=new h(a);c.evaluator=function(a){return x(a)&&y(a)};a=c.next();c.reset();c=c.previous();return a&&a.equals(c)?a:r},shrink:function(a,c){if(!this.collapsed){var a=a||n.SHRINK_TEXT,b=this.clone(),e=this.startContainer,d=this.endContainer,f=this.startOffset,l=this.endOffset,i=o,p,k,g=o;e&&e[0].nodeType==q.NodeType.TEXT_NODE&&(f?f>=e[0].nodeValue.length?b.setStartAfter(e):(b.setStartBefore(e),i=s):b.setStartBefore(e));d&&d[0].nodeType==
q.NodeType.TEXT_NODE&&(l?l>=d[0].nodeValue.length?b.setEndAfter(d):(b.setEndAfter(d),g=s):b.setEndBefore(d));if(i||g)k=new h(b),k.evaluator=function(c){return c.nodeType==(a==n.SHRINK_ELEMENT?q.NodeType.ELEMENT_NODE:q.NodeType.TEXT_NODE)},k.guard=function(c,b){if(a==n.SHRINK_ELEMENT&&c.nodeType==q.NodeType.TEXT_NODE||b&&c==p)return s;!b&&c.nodeType==q.NodeType.ELEMENT_NODE&&(p=c);return o};i&&(b=k[a==n.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(b,c?n.POSITION_AFTER_START:n.POSITION_BEFORE_START);
g&&(k.reset(),(k=k[a==n.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(k,c?n.POSITION_BEFORE_END:n.POSITION_AFTER_END));return i||g}},createBookmark2:function(a){var c=this.startContainer,b=this.endContainer,e=this.startOffset,d=this.endOffset,f,l;if(!c||!b)return{start:0,end:0};if(a){if(c[0].nodeType==q.NodeType.ELEMENT_NODE&&(f=new u(c[0].childNodes[e]))&&f[0]&&f[0].nodeType==q.NodeType.TEXT_NODE&&0<e&&f[0].previousSibling.nodeType==q.NodeType.TEXT_NODE)c=f,e=0;for(;c[0].nodeType==
q.NodeType.TEXT_NODE&&(l=c.prev(void 0,1))&&l[0].nodeType==q.NodeType.TEXT_NODE;)c=l,e+=l[0].nodeValue.length;if(!this.collapsed){if(b[0].nodeType==q.NodeType.ELEMENT_NODE&&(f=new u(b[0].childNodes[d]))&&f[0]&&f[0].nodeType==q.NodeType.TEXT_NODE&&0<d&&f[0].previousSibling.nodeType==q.NodeType.TEXT_NODE)b=f,d=0;for(;b[0].nodeType==q.NodeType.TEXT_NODE&&(l=b.prev(void 0,1))&&l[0].nodeType==q.NodeType.TEXT_NODE;)b=l,d+=l[0].nodeValue.length}}return{start:c._4e_address(a),end:this.collapsed?r:b._4e_address(a),
startOffset:e,endOffset:d,normalized:a,is2:o}},createBookmark:function(a){var c,b,e,f,l=this.collapsed;c=new u("<span>",r,this.document);c.attr("_ke_bookmark",1);c.css("display","none");c.html("&nbsp;");a&&(e=d.guid("ke_bm_"),c.attr("id",e+"S"));l||(b=c.clone(),b.html("&nbsp;"),a&&b.attr("id",e+"E"),f=this.clone(),f.collapse(),f.insertNode(b));f=this.clone();f.collapse(o);f.insertNode(c);b?(this.setStartAfter(c),this.setEndBefore(b)):this.moveToPosition(c,n.POSITION_AFTER_END);return{startNode:a?
e+"S":c,endNode:a?e+"E":b,serializable:a,collapsed:l}},moveToPosition:function(a,c){this.setStartAt(a,c);this.collapse(o)},trim:function(a,c){var b=this.startContainer,e=this.startOffset,d=this.collapsed;if((!a||d)&&b[0]&&b[0].nodeType==q.NodeType.TEXT_NODE){if(e)if(e>=b[0].nodeValue.length)e=b._4e_index()+1,b=b.parent();else{var f=b._4e_splitText(e),e=b._4e_index()+1,b=b.parent();q.equals(this.startContainer,this.endContainer)?this.setEnd(f,this.endOffset-this.startOffset):q.equals(b,this.endContainer)&&
(this.endOffset+=1)}else e=b._4e_index(),b=b.parent();this.setStart(b,e);if(d){this.collapse(o);return}}b=this.endContainer;e=this.endOffset;!c&&!d&&b[0]&&b[0].nodeType==q.NodeType.TEXT_NODE&&(e?(e>=b[0].nodeValue.length||b._4e_splitText(e),e=b._4e_index()+1):e=b._4e_index(),b=b.parent(),this.setEnd(b,e))},insertNode:function(a){this.optimizeBookmark();this.trim(s,o);var c=this.startContainer;c[0].insertBefore(a[0],c[0].childNodes[this.startOffset]||null);c[0]==this.endContainer[0]&&this.endOffset++;
this.setStartBefore(a)},moveToBookmark:function(a){var c=p(this.document);if(a.is2){var b=c._4e_getByAddress(a.start,a.normalized),e=a.startOffset,c=a.end&&c._4e_getByAddress(a.end,a.normalized),a=a.endOffset;this.setStart(b,e);c?this.setEnd(c,a):this.collapse(o)}else b=(e=a.serializable)?d.one("#"+a.startNode,c):a.startNode,a=e?d.one("#"+a.endNode,c):a.endNode,this.setStartBefore(b),b._4e_remove(),a&&a[0]?(this.setEndBefore(a),a._4e_remove()):this.collapse(o)},getCommonAncestor:function(a,c){var b=
this.startContainer,e=this.endContainer,b=b[0]==e[0]?a&&b[0].nodeType==q.NodeType.ELEMENT_NODE&&this.startOffset==this.endOffset-1?new u(b[0].childNodes[this.startOffset]):b:b._4e_commonAncestor(e);return c&&b[0].nodeType==q.NodeType.TEXT_NODE?b.parent():b},enlarge:function(){function a(c,b,e,d){var f=c[b?"startContainer":"endContainer"],l,i=b?0:1,k=0,g=b?"previousSibling":"nextSibling";l=c[b?"startOffset":"endOffset"];if(f[0].nodeType==q.NodeType.TEXT_NODE){if(b){if(l)return}else if(l<f[0].nodeValue.length)return;
l=f[0][g];f=f[0].parentNode}else l=f[0].childNodes[l+(b?-1:1)]||null,f=f[0];for(;f;){for(;l;)if(v(l)||z(l))l=l[g];else break;if(l){if(!k)c[b?"setStartAfter":"setEndBefore"](p(l));break}f=p(f);if("body"==f.nodeName())break;if(k||f.equals(d))e[i]=f,k=1;else c[b?"setStartBefore":"setEndAfter"](f);l=f[0][g];f=f[0].parentNode}}return function(c){switch(c){case n.ENLARGE_ELEMENT:if(this.collapsed)break;var c=this.getCommonAncestor(),b=[];a(this,1,b,c);a(this,0,b,c);b[0]&&b[1]&&(c=b[0].contains(b[1])?b[1]:
b[0],this.setStartBefore(c),this.setEndAfter(c));break;case n.ENLARGE_BLOCK_CONTENTS:case n.ENLARGE_LIST_ITEM_CONTENTS:var e=new i(this.document),b=new u(this.document.body);e.setStartAt(b,n.POSITION_AFTER_START);e.setEnd(this.startContainer,this.startOffset);var e=new h(e),d,f,l=h.blockBoundary(c==n.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:r),k=function(a){var c=l(a);c||(d=p(a));return c},g=function(a){var c=k(a);!c&&"br"==q.nodeName(a)&&(f=p(a));return c};e.guard=k;e=e.lastBackward();d=d||b;this.setStartAt(d,
"br"!=d.nodeName()&&(!e&&this.checkStartOfBlock()||e&&d.contains(e))?n.POSITION_AFTER_START:n.POSITION_AFTER_END);e=this.clone();e.collapse();e.setEndAt(b,n.POSITION_BEFORE_END);e=new h(e);e.guard=c==n.ENLARGE_LIST_ITEM_CONTENTS?g:k;d=r;e=e.lastForward();d=d||b;this.setEndAt(d,!e&&this.checkEndOfBlock()||e&&d.contains(e)?n.POSITION_BEFORE_END:n.POSITION_BEFORE_START);f&&this.setEndAfter(f)}}}(),checkStartOfBlock:function(){var a=this.startContainer,b=this.startOffset;if(b&&a[0].nodeType==q.NodeType.TEXT_NODE&&
d.trim(a[0].nodeValue.substring(0,b)).length)return s;this.trim();a=new f(this.startContainer);b=this.clone();b.collapse(o);b.setStartAt(a.block||a.blockLimit,n.POSITION_AFTER_START);a=new h(b);a.evaluator=c(o);return a.checkBackward()},checkEndOfBlock:function(){var a=this.endContainer,b=this.endOffset;if(a[0].nodeType==q.NodeType.TEXT_NODE&&d.trim(a[0].nodeValue.substring(b)).length)return s;this.trim();a=new f(this.endContainer);b=this.clone();b.collapse(s);b.setEndAt(a.block||a.blockLimit,n.POSITION_BEFORE_END);
a=new h(b);a.evaluator=c(s);return a.checkForward()},checkBoundaryOfElement:function(c,b){var e=this.clone();e[b==n.START?"setStartAt":"setEndAt"](c,b==n.START?n.POSITION_AFTER_START:n.POSITION_BEFORE_END);e=new h(e);e.evaluator=a;return e[b==n.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var a=this.startContainer,c=this.endContainer,b=this.startOffset,e=this.endOffset,d;if(a[0].nodeType==q.NodeType.ELEMENT_NODE)if(d=a[0].childNodes.length,d>b)a=p(a[0].childNodes[b]);else if(0==
d)a=a._4e_previousSourceNode();else{for(a=a[0];a.lastChild;)a=a.lastChild;a=p(a);a=a._4e_nextSourceNode()||a}if(c[0].nodeType==q.NodeType.ELEMENT_NODE)if(d=c[0].childNodes.length,d>e)c=p(c[0].childNodes[e])._4e_previousSourceNode(o);else if(0==d)c=c._4e_previousSourceNode();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=p(c)}a._4e_position(c)&m.POSITION_FOLLOWING&&(a=c);return{startNode:a,endNode:c}},fixBlock:function(a,c){var b=this.createBookmark(),e=p(this.document.createElement(c));this.collapse(a);
this.enlarge(n.ENLARGE_BLOCK_CONTENTS);e[0].appendChild(this.extractContents());e._4e_trim();t.ie||e._4e_appendBogus();this.insertNode(e);this.moveToBookmark(b);return e},splitBlock:function(a){var c=new f(this.startContainer),b=new f(this.endContainer),e=c.block,l=b.block,i=r;if(!c.blockLimit.equals(b.blockLimit))return r;"br"!=a&&(e||(e=this.fixBlock(o,a),l=(new f(this.endContainer)).block),l||(l=this.fixBlock(s,a)));a=e&&this.checkStartOfBlock();c=l&&this.checkEndOfBlock();this.deleteContents();
e&&e[0]==l[0]&&(c?(i=new f(this.startContainer),this.moveToPosition(l,n.POSITION_AFTER_END),l=r):a?(i=new f(this.startContainer),this.moveToPosition(e,n.POSITION_BEFORE_START),e=r):(l=this.splitElement(e),!t.ie&&!d.inArray(e.nodeName(),["ul","ol"])&&e._4e_appendBogus()));return{previousBlock:e,nextBlock:l,wasStartOfBlock:a,wasEndOfBlock:c,elementPath:i}},splitElement:function(a){if(!this.collapsed)return r;this.setEndAt(a,n.POSITION_BEFORE_END);var c=this.extractContents(),b=a.clone(s);b[0].appendChild(c);
b.insertAfter(a);this.moveToPosition(a,n.POSITION_AFTER_END);return b},moveToElementEditablePosition:function(a,c){for(var e=0;a;){if(a[0].nodeType==q.NodeType.TEXT_NODE){this.moveToPosition(a,c?n.POSITION_AFTER_END:n.POSITION_BEFORE_START);e=1;break}a[0].nodeType==q.NodeType.ELEMENT_NODE&&a._4e_isEditable()&&(this.moveToPosition(a,c?n.POSITION_BEFORE_END:n.POSITION_AFTER_START),e=1);var d=a,f=e,l=void 0;d[0].nodeType==q.NodeType.ELEMENT_NODE&&d._4e_isEditable()&&(l=d[c?"last":"first"](b,1));!f&&
!l&&(l=d[c?"prev":"next"](b,1));a=l}return!!e},selectNodeContents:function(a){var c=a[0];this.setStart(a,0);this.setEnd(a,c.nodeType==q.NodeType.TEXT_NODE?c.nodeValue.length:c.childNodes.length)},insertNodeByDtd:function(a){var c,b,e,d=a.nodeName();c=l.$block[d];this.deleteContents();if(c){for(c=this.getCommonAncestor(s,o);(b=l[c.nodeName()])&&(!b||!b[d]);){var f=c.parent();this.checkStartOfBlock()&&this.checkEndOfBlock()?(this.setStartBefore(c),this.collapse(o),c.remove()):e=c;c=f}e&&this.splitElement(e)}this.insertNode(a)}});
j.injectDom({_4e_breakParent:function(a,c){var c=p(c),a=p(a),b,e=new g.Range(a[0].ownerDocument);e.setStartAfter(a);e.setEndAfter(c);b=e.extractContents();e.insertNode(a.remove());a.after(b)}});return g.Range=i},{requires:["./base","./utils","./walker","./elementPath","./dom"]});
KISSY.add("editor/core/selection",function(d){function g(a){this.document=a;this._={cache:{}};if(o)try{var c=this.getNative().createRange();if(!c||c.item&&c.item(0).ownerDocument!=a||c.parentElement&&c.parentElement().ownerDocument!=a)this.isInvalid=f}catch(b){this.isInvalid=f}}function j(c){c=new g(c);return!c||c.isInvalid?a:c}var h=d.Editor;h.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var f=!0,a=null,b=d.UA,c=d.DOM,e=d.Node,k=h.SELECTION,i=h.RANGE,o=b.ie,s=h.Walker,r=h.Range,
n={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};d.augment(g,{getNative:!o?function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=c.getWindow(this.document).getSelection())}:function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=this.document.selection)},getType:!o?function(){var a=this._.cache;if(a.type)return a.type;var b=k.SELECTION_TEXT,e=this.getNative();if(e){if(1==e.rangeCount){var e=
e.getRangeAt(0),d=e.startContainer;d==e.endContainer&&d.nodeType==c.NodeType.ELEMENT_NODE&&1==Number(e.endOffset-e.startOffset)&&n[d.childNodes[e.startOffset].nodeName.toLowerCase()]&&(b=k.SELECTION_ELEMENT)}}else b=k.SELECTION_NONE;return a.type=b}:function(){var a=this._.cache;if(a.type)return a.type;var c=k.SELECTION_NONE;try{var b=this.getNative(),e=b.type;"Text"==e&&(c=k.SELECTION_TEXT);"Control"==e&&(c=k.SELECTION_ELEMENT);b.createRange().parentElement&&(c=k.SELECTION_TEXT)}catch(d){}return a.type=
c},getRanges:o?function(){var b=function(b,e){b=b.duplicate();b.collapse(e);for(var d=b.parentElement(),f=d.childNodes,l,i=0;i<f.length;i++){var k=f[i];if(k.nodeType==c.NodeType.ELEMENT_NODE){l=b.duplicate();l.moveToElementText(k);var k=l.compareEndPoints("StartToStart",b),g=l.compareEndPoints("EndToStart",b);l.collapse();if(0<k)break;else{if(!k||1==g&&-1==k)return{container:d,offset:i};if(!g)return{container:d,offset:i+1}}l=a}}l||(l=b.duplicate(),l.moveToElementText(d),l.collapse(!1));l.setEndPoint("StartToStart",
b);l=(""+l.text).replace(/\r\n|\r/g,"\n").length;try{for(;0<l;)l-=f[--i].nodeValue.length}catch(m){l=0}return 0===l?{container:d,offset:i}:{container:f[i],offset:-l}};return function(a){var c=this._.cache;if(c.ranges&&!a)return c.ranges;var d=this.getNative(),a=d&&d.createRange(),i=this.getType();if(!d)return[];if(i==k.SELECTION_TEXT)return d=new r(this.document),i=b(a,f),d.setStart(new e(i.container),i.offset),i=b(a),d.setEnd(new e(i.container),i.offset),c.ranges=[d];if(i==k.SELECTION_ELEMENT){c=
c.ranges=[];for(i=0;i<a.length;i++){for(var g=a.item(i),m=g.parentNode,h=0,d=new r(this.document);h<m.childNodes.length&&m.childNodes[h]!=g;h++);d.setStart(new e(m),h);d.setEnd(new e(m),h+1);c.push(d)}return c}return c.ranges=[]}}():function(a){var c=this._.cache;if(c.ranges&&!a)return c.ranges;var a=[],b=this.getNative();if(!b)return[];for(var d=0;d<b.rangeCount;d++){var f=b.getRangeAt(d),i=new r(this.document);i.setStart(new e(f.startContainer),f.startOffset);i.setEnd(new e(f.endContainer),f.endOffset);
a.push(i)}return c.ranges=a},getStartElement:function(){var a=this._.cache;if(void 0!==a.startElement)return a.startElement;var b,d=this.getNative();switch(this.getType()){case k.SELECTION_ELEMENT:return this.getSelectedElement();case k.SELECTION_TEXT:var i=this.getRanges()[0];if(i&&!i.collapsed){for(i.optimize();f;)if(b=i.startContainer,i.startOffset==(b[0].nodeType===c.NodeType.ELEMENT_NODE?b[0].childNodes.length:b[0].nodeValue.length)&&!b._4e_isBlockBoundary())i.setStartAfter(b);else break;b=i.startContainer;
if(b[0].nodeType!=c.NodeType.ELEMENT_NODE)return b.parent();b=new e(b[0].childNodes[i.startOffset]);if(!b[0]||b[0].nodeType!=c.NodeType.ELEMENT_NODE)return i.startContainer;for(i=b[0].firstChild;i&&i.nodeType==c.NodeType.ELEMENT_NODE;)b=new e(i),i=i.firstChild;return b}if(o)i=d.createRange(),i.collapse(f),b=new e(i.parentElement());else{if((b=d.anchorNode)&&b.nodeType!=c.NodeType.ELEMENT_NODE)b=b.parentNode;b&&(b=new e(b))}}return a.startElement=b},getSelectedElement:function(){var a,b=this._.cache;
if(void 0!==b.selectedElement)return b.selectedElement;o&&(a=this.getNative().createRange(),a=a.item&&a.item(0));var d;if(a)d=new e(a);else{a=this.getRanges()[0];for(var f,k=2;k&&(!(d=a.getEnclosedNode())||!(d[0].nodeType==c.NodeType.ELEMENT_NODE&&n[d.nodeName()]&&(f=d)));k--)a.shrink(i.SHRINK_ELEMENT);d=f}return b.selectedElement=d},reset:function(){this._.cache={}},selectElement:function(a){var c,b=this.document;if(o)try{c=b.body.createControlRange(),c.addElement(a[0]),c.select()}catch(e){c=b.body.createTextRange(),
c.moveToElementText(a[0]),c.select()}finally{}else c=b.createRange(),c.selectNode(a[0]),a=this.getNative(),a.removeAllRanges(),a.addRange(c);this.reset()},selectRanges:function(a){if(o){if(1<a.length){var e=a[a.length-1];a[0].setEnd(e.endContainer,e.endOffset);a.length=1}a[0]&&a[0].select()}else{e=this.getNative();if(!e)return;e.removeAllRanges();for(var d=0;d<a.length;d++){var f=a[d],i=this.document.createRange(),k=f.startContainer;if(f.collapsed&&(b.gecko&&1.09>b.gecko||b.opera||b.webkit)&&k[0].nodeType==
c.NodeType.ELEMENT_NODE&&!k[0].childNodes.length)k[0].appendChild(this.document.createTextNode(b.webkit?"\u200b":"")),f.startOffset++,f.endOffset++;i.setStart(k[0],f.startOffset);i.setEnd(f.endContainer[0],f.endOffset);e.addRange(i)}}this.reset()},createBookmarks2:function(a){for(var c=[],b=this.getRanges(),e=0;e<b.length;e++)c.push(b[e].createBookmark2(a));return c},createBookmarks:function(a,b){for(var e=[],i=this.document,k,b=b||this.getRanges(),g=b.length,m=0;m<g;m++){e.push(k=b[m].createBookmark(a,
f));var h=(a=k.serializable)?d.one("#"+k.startNode,i):k.startNode;k=a?d.one("#"+k.endNode,i):k.endNode;for(var q=m+1;q<g;q++){var j=b[q],o=j.startContainer,n=j.endContainer;c.equals(o,h.parent())&&j.startOffset++;c.equals(o,k.parent())&&j.startOffset++;c.equals(n,h.parent())&&j.endOffset++;c.equals(n,k.parent())&&j.endOffset++}}return e},selectBookmarks:function(a){for(var c=[],b=0;b<a.length;b++){var e=new r(this.document);e.moveToBookmark(a[b]);c.push(e)}this.selectRanges(c);return this},getCommonAncestor:function(){var a=
this.getRanges();return a[0].startContainer._4e_commonAncestor(a[a.length-1].endContainer)},scrollIntoView:function(){var a=this.getStartElement();a&&a.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})},removeAllRanges:function(){var a=this.getNative();o?a&&a.clear():a&&a.removeAllRanges()}});var m={table:1,tbody:1,tr:1},q=s.whitespaces(f),t=/\ufeff|\u00a0/;r.prototype.select=r.prototype.select=!o?function(){var a=this.startContainer;this.collapsed&&a[0].nodeType==
c.NodeType.ELEMENT_NODE&&!a[0].childNodes.length&&a[0].appendChild(this.document.createTextNode(""));var b=this.document.createRange();b.setStart(a[0],this.startOffset);try{b.setEnd(this.endContainer[0],this.endOffset)}catch(e){if(0<=e.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))this.collapse(f),b.setEnd(this.endContainer[0],this.endOffset);else throw e;}a=j(this.document).getNative();a.removeAllRanges();a.addRange(b)}:function(a){var b=this.collapsed,d,k;if(this.startContainer[0]===this.endContainer[0]&&
1==this.endOffset-this.startOffset){var h=this.startContainer[0].childNodes[this.startOffset];if(h.nodeType==c.NodeType.ELEMENT_NODE){(new g(this.document)).selectElement(new e(h));return}}(this.startContainer[0].nodeType==c.NodeType.ELEMENT_NODE&&this.startContainer.nodeName()in m||this.endContainer[0].nodeType==c.NodeType.ELEMENT_NODE&&this.endContainer.nodeName()in m)&&this.shrink(i.SHRINK_ELEMENT,f);var j=this.createBookmark(),h=j.startNode,o;b||(o=j.endNode);j=this.document.body.createTextRange();
j.moveToElementText(h[0]);j.moveStart("character",1);if(o)a=this.document.body.createTextRange(),a.moveToElementText(o[0]),j.setEndPoint("EndToEnd",a),j.moveEnd("character",-1);else{for(d=h[0].nextSibling;d&&!q(d);)d=d.nextSibling;d=!(d&&d.nodeValue&&d.nodeValue.match(t))&&(a||!h[0].previousSibling||h[0].previousSibling&&"br"==c.nodeName(h[0].previousSibling));k=new e(this.document.createElement("span"));k.html("&#65279;");k.insertBefore(h);d&&c.insertBefore(this.document.createTextNode("\ufeff"),h[0]||
h)}this.setStartBefore(h);h._4e_remove();if(b){if(d?(j.moveStart("character",-1),j.select(),this.document.selection.clear()):j.select(),k)this.moveToPosition(k,i.POSITION_BEFORE_START),k._4e_remove()}else this.setEndBefore(o),o._4e_remove(),j.select()};g.getSelection=j;return h.Selection=g},{requires:["./base","./walker","./range","./dom"]});
KISSY.add("editor/core/selectionFix",function(d,g){function j(a){function c(a,b){var d=g.body.createTextRange();try{d.moveToPoint(a,b)}catch(f){d=e}return d}function b(){var a=g.selection.createRange();h&&!a.item&&0===a.compareEndPoints("StartToEnd",a)&&h.select();i.remove(g,"mouseup",b);i.remove(g,"mousemove",d);h=f=0}function d(a){if(a.button){if(a=c(a.pageX,a.pageY))0<a.compareEndPoints("StartToStart",h)?a.setEndPoint("StartToStart",h):a.setEndPoint("EndToEnd",h),a.select()}else b()}var f,k=a.get("window")[0],
g=a.get("document")[0],h;i.on(g,"mousedown contextmenu",function(a){var e=g.documentElement;if(a.target===e&&(f&&b(),!(e.scrollHeight>e.clientHeight)&&(f=1,h=c(a.pageX,a.pageY))))i.on(g,"mouseup",b),i.on(g,"mousemove",d),k.focus(),h.select()})}function h(a){function d(c){if(j){var e=a.getSelection(),i=e&&e.getType(),k=e&&f.selection;if(c&&k&&i==r.SELECTION_NONE&&!f.queryCommandEnabled("InsertImage"))setTimeout(function(){d(b)},50);else{var l;if(!k||!k.type||!("Control"!=k.type&&(l=k.createRange())&&
(l=l.parentElement())&&(l=l.nodeName)&&l.toLowerCase()in{input:1,textarea:1}))h=k&&e.getRanges()[0],a.checkSelectionChange()}}}var f=a.get("document")[0],i=new s(f.body),k=new s(f.documentElement);if(8>g.Utils.ieEngine)k.on("click",function(c){"html"===(new s(c.target)).nodeName()&&a.getSelection().getNative().createRange().select()});var h,j,o=b;k.on("mousedown",function(){o=c});k.on("mouseup",function(){o=b});i.on("focusin",function(a){if("body"==(new s(a.target)).nodeName()&&h){try{o&&h.select()}catch(c){}h=
e}});i.on("focus",function(){j=b;d()});i.on("beforedeactivate",function(a){a.relatedTarget||(j=c,o=b)});i.on("mousedown",function(){j=c});i.on("mouseup",function(){j=b;setTimeout(function(){d(b)},0)});i.on("keydown",function(){j=c});i.on("keyup",function(){j=b;setTimeout(function(){d()},0)})}function f(a){var c=a.get("document")[0];i.on(c,"mouseup keyup selectionchange",function(){a.checkSelectionChange()})}function a(a){function e(a){var c=g.XHTML_DTD;return a._4e_isBlockBoundary()&&c.$empty[a.nodeName()]}
function d(a){return i(a)&&h(a)}var f=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<\!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,i=g.Walker.whitespaces(b),h=g.Walker.bookmark(c,b),j=function(a){return i(a)&&8!=a.nodeType};a.on("selectionChange",function(i){var l=i.path,h=new s(a.get("document")[0].body),i=(i=i.selection)&&i.getRanges()[0],r=l.blockLimit;if(k.gecko){var u=l.block||l.blockLimit,B=u&&u.last(d);u&&u._4e_isBlockBoundary()&&(!B||!(1==B[0].nodeType&&
B._4e_isBlockBoundary()))&&"pre"!=u.nodeName()&&!u._4e_getBogus()&&u._4e_appendBogus()}if(i&&i.collapsed&&!l.block){if("body"==r.nodeName()){if((l=i.fixBlock(b,"p"))&&l[0]!=h[0].lastChild&&l._4e_outerHtml().match(f))if((r=l.next(j,1))&&r[0].nodeType==o.NodeType.ELEMENT_NODE&&!e[r])i.moveToElementEditablePosition(r),l._4e_remove();else if((r=l.prev(j,1))&&r[0].nodeType==o.NodeType.ELEMENT_NODE&&!e[r])i.moveToElementEditablePosition(r,r._4e_outerHtml().match(f)?c:b),l._4e_remove();i.select();a.notifySelectionChange()}l=
a.get("document")[0];i=new g.Range(l);i.moveToElementEditablePosition(h,b);"body"!==(new g.ElementPath(i.startContainer)).blockLimit.nodeName()&&(h=(new s(l.createElement("p"))).appendTo(h),k.ie||h._4e_appendBogus())}})}var b=!0,c=!1,e=null,k=d.UA,i=d.Event,o=d.DOM,s=d.Node,r=g.SELECTION;return{init:function(c){c.docReady(function(){k.ie?(j(c),h(c)):f(c)});a(c)}}},{requires:["./base","./selection"]});
KISSY.add("editor/core/styles",function(d,g){function j(a){return!y.attr(a,"_ke_bookmark")}function h(a,c){for(var b in a)"string"==typeof a[b]?a[b]=a[b].replace(M,function(a,b){return c[b]}):h(a[b],c)}function f(a,c){c&&(a=d.clone(a),h(a,c));var b=this.element=this.element=(a.element||"*").toLowerCase();this.type=this.type="#text"==b||L[b]?B.STYLE_BLOCK:J[b]?B.STYLE_OBJECT:B.STYLE_INLINE;this._={definition:a}}function a(a,c){var b=c?this.removeFromRange:this.applyToRange;a.body.focus();for(var e=
new D(a),d=e.getRanges(),f=0;f<d.length;f++)b.call(this,d[f]);e.selectRanges(d)}function b(a,c,b){var e=a.element;"*"==e&&(e="span");c=new E(c.createElement(e));b&&b._4e_copyAttributes(c);b=a._.definition;a=b.attributes;b=f.getStyleText(b);if(a)for(var d in a)c.attr(d,a[d]);b&&(c[0].style.cssText=b);return c}function c(a){var c=a.createBookmark(w),d=a.createIterator();d.enforceRealBlocks=w;d.enlargeBr=w;for(var f,l=a.document;f=d.getNextParagraph();){var h=b(this,l,f),g=h,h="pre"==g.nodeName,m="pre"==
f.nodeName,j=!h&&m;h&&!m?(m=f,j=m.html(),j=e(j,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),j=j.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),j=j.replace(/([ \t\n\r]+|&nbsp;)/g," "),j=j.replace(/<br\b[^>]*>/gi,"\n"),H.ie?(m=m[0].ownerDocument.createElement("div"),m.appendChild(g[0]),g[0].outerHTML="<pre>"+j+"</pre>",g=new E(m.firstChild),g._4e_remove()):g.html(j)):j?g=i(k(f),g):f._4e_moveChildren(g);f[0].parentNode.replaceChild(g[0],f[0]);if(h&&(f=g,h=void 0,(h=f._4e_previousSourceNode(w,y.NodeType.ELEMENT_NODE))&&
"pre"==h.nodeName()))g=e(h.html(),/\n$/,"")+"\n\n"+e(f.html(),/^\n/,""),H.ie?f[0].outerHTML="<pre>"+g+"</pre>":f.html(g),h._4e_remove()}a.moveToBookmark(c)}function e(a,c,b){var e="",d="",a=a.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(a,c,b){c&&(e=c);b&&(d=b);return""});return e+a.replace(c,b)+d}function k(a){var c=[];e(a._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(a,c,b){return c+"</pre>"+b+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(a,b){c.push(b)});return c}function i(a,c){for(var b=c[0].ownerDocument.createDocumentFragment(),d=0;d<a.length;d++){var f=a[d],f=f.replace(/(\r\n|\r)/g,"\n"),f=e(f,/^[ \t]*\n/,""),f=e(f,/\n$/,""),f=e(f,/^[ \t]+|[ \t]+$/g,function(a,c){return 1==a.length?"&nbsp;":c?" "+Array(a.length).join("&nbsp;"):Array(a.length).join("&nbsp;")+" "}),f=f.replace(/\n/g,"<br>"),f=f.replace(/[ \t]{2,}/g,function(a){return Array(a.length).join("&nbsp;")+" "}),i=c.clone();i.html(f);b.appendChild(i[0])}return b}
function o(a){var c=a.document;if(a.collapsed)c=b(this,c,void 0),a.insertNode(c),a.moveToPosition(c,C.POSITION_BEFORE_END);else{var e=this.element,d=this._.definition,f,i=G[e];i||(f=w,i=G.span);var k=a.createBookmark();a.enlarge(C.ENLARGE_ELEMENT);a.trim();for(var g=a.createBookmark(),h=g.startNode,g=g.endNode,m=h,q;m&&m[0];){var p=v;if(y.equals(m,g))m=z,p=w;else{var o=m[0].nodeType,n=o==y.NodeType.ELEMENT_NODE?m.nodeName():z;if(n&&m.attr("_ke_bookmark")){m=m._4e_nextSourceNode(w);continue}if(!n||
i[n]&&(m._4e_position(g)|A.POSITION_PRECEDING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_PRECEDING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED&&(!d.childRule||d.childRule(m))){var t=m.parent();if(t&&"a"==e&&t.nodeName()==e)o=b(this,c,void 0),t._4e_moveChildren(o),t[0].parentNode.replaceChild(o[0],t[0]),o._4e_mergeSiblings();else if(t&&t[0]&&((G[t.nodeName()]||G.span)[e]||f)&&(!d.parentRule||d.parentRule(t))){if(!q&&(!n||!G.$removeEmpty[n]||(m._4e_position(g)|A.POSITION_PRECEDING|A.POSITION_IDENTICAL|
A.POSITION_IS_CONTAINED)==A.POSITION_PRECEDING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED))q=new F(c),q.setStartBefore(m);if(o==y.NodeType.TEXT_NODE||o==y.NodeType.ELEMENT_NODE&&!m[0].childNodes.length){t=m;for(o=null;(p=!t.next(j,1))&&(o=t.parent())&&i[o.nodeName()]&&(o._4e_position(h)|A.POSITION_FOLLOWING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_FOLLOWING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED&&(!d.childRule||d.childRule(o));)t=o;q.setEndAfter(t)}}else p=w}else p=w;m=m._4e_nextSourceNode()}if(p&&
q&&!q.collapsed){for(var p=b(this,c,void 0),t=q.getCommonAncestor(),o={},n={},r,u=null,s;p&&t&&p[0]&&t[0];){if(t.nodeName()==e){for(r in d.attributes)if(!n[r]&&(s=t.attr(u)))p.attr(r)==s?p.removeAttr(r):n[r]=1;for(u in d.styles)if(!o[u]&&(s=t.style(u)))p.style(u)==s?p.style(u,""):o[u]=1;if(!p._4e_hasAttributes()){p=z;break}}t=t.parent()}p?(p[0].appendChild(q.extractContents()),l(this,p),q.insertNode(p),p._4e_mergeSiblings(),H.ie||p[0].normalize()):(p=new E(c.createElement("span")),p[0].appendChild(q.extractContents()),
q.insertNode(p),l(this,p),p._4e_remove(!0));q=z}}h._4e_remove();g._4e_remove();a.moveToBookmark(k);a.shrink(C.SHRINK_TEXT)}}function s(a){a.enlarge(C.ENLARGE_ELEMENT);var c=a.createBookmark(),b=c.startNode;if(a.collapsed){for(var e=new I(b.parent()),d,f=0,i;f<e.elements.length&&(i=e.elements[f])&&!(i==e.block||i==e.blockLimit);f++)if(this.checkElementRemovable(i)){var k=a.checkBoundaryOfElement(i,C.END),l=!k&&a.checkBoundaryOfElement(i,C.START);l||k?(d=i,d.match=l?"start":"end"):(i._4e_mergeSiblings(),
i.nodeName()!=this.element?(k=m(this),u(i,k[i.nodeName()]||k["*"])):q(this,i))}if(d){i=b;for(f=0;;f++){k=e.elements[f];if(k.equals(d))break;else if(k.match)continue;else k=k.clone();k[0].appendChild(i[0]);i=k}i["start"==d.match?"insertBefore":"insertAfter"](d);e=d.html();!e||"\u200b"==e?d.remove():H.webkit&&x(a.document.createTextNode("\u200b")).insertBefore(i)}}else{var g=c.endNode,h=this;d=function(){for(var a=new I(b.parent()),c=new I(g.parent()),e=z,d=z,f=0;f<a.elements.length;f++){var i=a.elements[f];
if(i==a.block||i==a.blockLimit)break;h.checkElementRemovable(i)&&(e=i)}for(f=0;f<c.elements.length;f++){i=c.elements[f];if(i==c.block||i==c.blockLimit)break;h.checkElementRemovable(i)&&(d=i)}d&&g._4e_breakParent(d);e&&b._4e_breakParent(e)};d();for(e=new E(b[0].nextSibling);e[0]!==g[0];){f=e._4e_nextSourceNode();if(e[0]&&e[0].nodeType==y.NodeType.ELEMENT_NODE&&this.checkElementRemovable(e)&&(e.nodeName()==this.element?q(this,e):(i=m(this),u(e,i[e.nodeName()]||i["*"])),f[0].nodeType==y.NodeType.ELEMENT_NODE&&
f.contains(b)))d(),f=new E(b[0].nextSibling);e=f}}a.moveToBookmark(c)}function r(a){var c={};(""+a).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,b,e){c[b]=e});return c}function n(a,c){var b="";c!==v?(b=document.createElement("span"),b.style.cssText=a,b=b.style.cssText||""):b=a;return b.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function m(a){if(a._.overrides)return a._.overrides;var c=a._.overrides={},b=a._.definition.overrides;
if(b){d.isArray(b)||(b=[b]);for(var e=0;e<b.length;e++){var f=b[e],i,k,l;"string"==typeof f?i=f.toLowerCase():(i=f.element?f.element.toLowerCase():a.element,k=f.attributes,l=f.styles);f=c[i]||(c[i]={});if(k){i=f.attributes=f.attributes||[];for(var g in k)i.push([g.toLowerCase(),k[g]])}if(l){var f=f.styles=f.styles||[],h;for(h in l)f.push([h.toLowerCase(),l[h]])}}}return c}function q(a,c){var b=a._.definition,e=m(a),f=d.merge(b.attributes,(e[c.nodeName()]||e["*"]||{}).attributes),b=d.merge(b.styles,
(e[c.nodeName()]||e["*"]||{}).styles),e=d.isEmptyObject(f)&&d.isEmptyObject(b),i;for(i in f)("class"==i||a._.definition.fullMatch)&&c.attr(i)!=t(i,f[i])||(e=e||!!c.hasAttr(i),c.removeAttr(i));for(var k in b)a._.definition.fullMatch&&c.style(k)!=t(k,b[k],w)||(e=e||!!c.style(k),c.style(k,""));p(c)}function t(a,c,b){var e=new E("<span>");e[b?"style":"attr"](a,c);return e[b?"style":"attr"](a)}function l(a,c){for(var b=m(a),e=c.all(a.element),d=e.length;0<=--d;)q(a,new E(e[d]));for(var f in b)if(f!=a.element){e=
c.all(f);for(d=e.length-1;0<=d;d--){var i=new E(e[d]);u(i,b[f])}}}function u(a,c){var b,e=c&&c.attributes;if(e)for(b=0;b<e.length;b++){var d=e[b][0],f;if(f=a.attr(d)){var i=e[b][1];(i===z||i.test&&i.test(f)||"string"==typeof i&&f==i)&&a[0].removeAttribute(d)}}if(e=c&&c.styles)for(b=0;b<e.length;b++)if(d=e[b][0],i=a.css(d)){var k=e[b][1];(k===z||k.test&&k.test(f)||"string"==typeof k&&i==k)&&a.css(d,"")}p(a)}function p(a){if(!a._4e_hasAttributes()){var c=a[0].firstChild,b=a[0].lastChild;a._4e_remove(w);
c&&(c.nodeType==y.NodeType.ELEMENT_NODE&&y._4e_mergeSiblings(c),b&&c!=b&&b.nodeType==y.NodeType.ELEMENT_NODE&&y._4e_mergeSiblings(b))}}var w=!0,v=!1,z=null,x=d.all,y=d.DOM,B={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},C=g.RANGE,D=g.Selection,A=g.POSITION,F=g.Range,E=d.Node,H=d.UA,I=g.ElementPath,L={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},G=g.XHTML_DTD,J={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},K=/\s*(?:;\s*|$)/g,M=/#\((.+?)\)/g;g.STYLE=
B;f.prototype={constructor:f,apply:function(c){a.call(this,c,v)},remove:function(c){a.call(this,c,w)},applyToRange:function(a){return(this.applyToRange=this.type==B.STYLE_INLINE?o:this.type==B.STYLE_BLOCK?c:z).call(this,a)},removeFromRange:function(a){return(this.removeFromRange=this.type==B.STYLE_INLINE?s:z).call(this,a)},checkElementRemovable:function(a,c){if(!a)return v;var b=this._.definition,e;if(a.nodeName()==this.element){if(!c&&!a._4e_hasAttributes())return w;var d=b._AC;if(d)b=d;else{var d=
{},i=0,k=b.attributes;if(k)for(var l in k)i++,d[l]=k[l];if(k=f.getStyleText(b))d.style||i++,d.style=k;d._length=i;b=b._AC=d}if(b._length){for(var g in b)if("_length"!=g){i=a.attr(g)||"";if("style"==g)a:{d=b[g];i=n(i,v);"string"==typeof d&&(d=r(d));"string"==typeof i&&(i=r(i));k=void 0;for(k in d)if(!(k in i&&(i[k]==d[k]||"inherit"==d[k]||"inherit"==i[k]))){d=v;break a}d=w}else d=b[g]==i;if(d){if(!c)return w}else if(c)return v}if(c)return w}else return w}g=m(this);if(g=g[a.nodeName()]||g["*"]){if(!(b=
g.attributes)&&!(e=g.styles))return w;if(b)for(d=0;d<b.length;d++)if(g=b[d][0],g=a.attr(g))if(i=b[d][1],i===z||"string"==typeof i&&g==i||i.test&&i.test(g))return w;if(e)for(d=0;d<e.length;d++)if(g=a.css(e[d][0]))if(b=e[d][1],b===z||"string"==typeof b&&g==b||b.test&&b.test(g))return w}return v},checkActive:function(a){switch(this.type){case B.STYLE_BLOCK:return this.checkElementRemovable(a.block||a.blockLimit,w);case B.STYLE_OBJECT:case B.STYLE_INLINE:for(var c=a.elements,b=0,e;b<c.length;b++)if(e=
c[b],!(this.type==B.STYLE_INLINE&&(y.equals(e,a.block)||y.equals(e,a.blockLimit))))if((this.type!=B.STYLE_OBJECT||e.nodeName()in J)&&this.checkElementRemovable(e,w))return w}return v}};f.getStyleText=function(a){var c=a._ST;if(c)return c;var c=a.styles,b=a.attributes&&a.attributes.style||"",e="";b.length&&(b=b.replace(K,";"));for(var d in c){var f=c[d],i=(d+":"+f).replace(K,";");"inherit"==f?e+=i:b+=i}b.length&&(b=n(b));return a._ST=b+e};return g.Style=f},{requires:["./base","./range","./selection",
"./domIterator","./elementPath"]});
KISSY.add("editor/core/utils",function(d){var g=d.Node,j=d.DOM,h=d.UA,f={debugUrl:function(a){var b=d.Config;b.debug||(a=a.replace(/\.(js|css)/i,"-min.$1"));-1==a.indexOf("?t")&&(a=-1!=a.indexOf("?")?a+"&":a+"?",a+="t="+encodeURIComponent(b.tag));return b.base+"editor/"+a},lazyRun:function(a,b,c){var e=a[b],d=a[c];a[b]=function(){e.apply(this,arguments);a[b]=a[c];return d.apply(this,arguments)}},getXY:function(a,b){var c=a.left,e=a.top,d=b.get("window")[0],c=c-j.scrollLeft(d),e=e-j.scrollTop(d),d=
b.get("iframe").offset(),c=c+d.left,e=e+d.top;return{left:c,top:e}},tryThese:function(a){for(var b,c=0,e=arguments.length;c<e;c++){var d=arguments[c];try{b=d();break}catch(f){}}return b},arrayCompare:function(a,b){if(!a&&!b)return!0;if(!a||!b||a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0},clearAllMarkers:function(a){for(var b in a)a[b]._4e_clearMarkers(a,!0,void 0)},ltrim:function(a){return a.replace(/^\s+/,"")},rtrim:function(a){return a.replace(/\s+$/,
"")},isNumber:function(a){return/^\d+(.\d+)?$/.test(d.trim(a))},verifyInputs:function(a){for(var b=0;b<a.length;b++){var c=new g(a[b]),e=d.trim(f.valInput(c)),k=c.attr("data-verify"),c=c.attr("data-warning");if(k&&!RegExp(k).test(e))return alert(c),!1}return!0},sourceDisable:function(a,b){a.on("sourceMode",b.disable,b);a.on("wysiwygMode",b.enable,b)},resetInput:function(a){var b=a.attr("placeholder");b&&h.ie?(a.addClass("ks-editor-input-tip"),a.val(b)):h.ie||a.val("")},valInput:function(a,b){if(void 0===
b)return a.hasClass("ks-editor-input-tip")?"":a.val();a.removeClass("ks-editor-input-tip");a.val(b)},placeholder:function(a,b){a.attr("placeholder",b);h.ie&&(a.on("blur",function(){d.trim(a.val())||(a.addClass("ks-editor-input-tip"),a.val(b))}),a.on("focus",function(){a.removeClass("ks-editor-input-tip");d.trim(a.val())==b&&a.val("")}))},htmlEncode:function(a){return!a?a:(""+a).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},normParams:function(a){var a=d.clone(a),
b;for(b in a){var c=a[b];d.isFunction(c)&&(a[b]=c())}return a},map:function(a,b){for(var c=0;c<a.length;c++)a[c]=b(a[c]);return a},ieEngine:document.documentMode||h.ie,preventFocus:function(a){h.ie?a.unselectable(void 0):a.attr("onmousedown","return false;")},injectDom:function(a){d.mix(j,a);for(var b in a)(function(c){g.prototype[c]=function(){var b=[].slice.call(arguments,0);b.unshift(this[0]);return(b=a[c].apply(null,b))&&(b.nodeType||d.isWindow(b))?new g(b):d.isArray(b)&&(b.__IS_NODELIST||b[0]&&
b[0].nodeType)?new g(b):b}})(b)},addRes:function(){var a=this.__res=this.__res||[];a.push.apply(a,d.makeArray(arguments))},destroyRes:function(){for(var a=this.__res||[],b=0;b<a.length;b++){var c=a[b];d.isFunction(c)?c():c.destroy?c.destroy():c.remove&&c.remove()}this.__res=[]},getQueryCmd:function(a){return"query"+("-"+a).replace(/-(\w)/g,function(a,c){return c.toUpperCase()})+"Value"}};return d.Editor.Utils=f},{requires:["./base"]});
KISSY.add("editor/core/walker",function(d,g){function j(e,d){if(this._.end)return c;var f,i=this.range,g,h=this.guard,m=this.type,j=e?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start&&(this._.start=1,i.trim(),i.collapsed))return this.end(),c;if(!e&&!this._.guardLTR){var n=i.endContainer[0],r=n.childNodes[i.endOffset];this._.guardLTR=function(a,c){return c&&(n==a||"body"==k.nodeName(a))?!1:a!=r}}if(e&&!this._.guardRTL){var s=i.startContainer[0],C=0<i.startOffset&&s.childNodes[i.startOffset-
1]||null;this._.guardRTL=function(a,c){return c&&(s==a||"body"==k.nodeName(a))?!1:a!=C}}var D=e?this._.guardRTL:this._.guardLTR;g=h?function(a,c){return D(a,c)===b?b:h(a,c)}:D;this.current?f=this.current[j](b,m,g):e?(f=i.endContainer,0<i.endOffset?(f=new o(f[0].childNodes[i.endOffset-1]),g(f[0])===b&&(f=c)):f=g(f,a)===b?c:f._4e_previousSourceNode(a,m,g,void 0)):(f=i.startContainer,f=new o(f[0].childNodes[i.startOffset]),f.length?g(f[0])===b&&(f=c):f=g(i.startContainer,a)===b?c:i.startContainer._4e_nextSourceNode(a,
m,g,void 0));for(;f&&!this._.end;){this.current=f;if(!this.evaluator||this.evaluator(f[0])!==b){if(!d)return f}else if(d&&this.evaluator)return b;f=f[j](b,m,g)}this.end();return this.current=c}function h(a){for(var b,e=c;b=j.call(this,a);)e=b;return e}function f(a){this.range=a;this.guard=this.evaluator=c;this._={}}var a=!0,b=!1,c=null,e=d.UA,k=d.DOM,i=g.XHTML_DTD,o=d.Node;d.augment(f,{end:function(){this._.end=1},next:function(){return j.call(this)},previous:function(){return j.call(this,a)},checkForward:function(){return j.call(this,
b,a)!==b},checkBackward:function(){return j.call(this,a,a)!==b},lastForward:function(){return h.call(this)},lastBackward:function(){return h.call(this,a)},reset:function(){delete this.current;this._={}},_iterator:j});d.mix(f,{blockBoundary:function(a){return function(c){return!(c.nodeType==k.NodeType.ELEMENT_NODE&&k._4e_isBlockBoundary(c,a))}},bookmark:function(a,c){function b(a){return"span"==k.nodeName(a)&&k.attr(a,"_ke_bookmark")}return function(e){var d,f;d=e.nodeType==k.NodeType.TEXT_NODE&&(f=
e.parentNode)&&b(f);d=a?d:d||b(e);return!!(c^d)}},whitespaces:function(a){return function(c){c=c.nodeType==k.NodeType.TEXT_NODE&&!d.trim(c.nodeValue);return!!(a^c)}},invisible:function(a){var c=f.whitespaces();return function(b){b=c(b)||b.nodeType==k.NodeType.ELEMENT_NODE&&!b.offsetHeight;return!!(a^b)}}});var s=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,r=f.whitespaces(),n=f.bookmark(),m=function(a){var c=k.nodeName(a);return n(a)||r(a)||1==a.nodeType&&c in i.$inline&&!(c in i.$empty)};g.Utils.injectDom({_4e_getBogus:function(a){a=
new o(a);do a=a._4e_previousSourceNode();while(a&&m(a[0]));return a&&(!e.ie?"br"==a.nodeName():3==a[0].nodeType&&s.test(a.text()))?a[0]:!1}});return g.Walker=f},{requires:["./base","./utils","./dom"]});KISSY.add("editor/core/zIndexManager",function(d){var g=d.Editor,d=g.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};g.baseZIndex=function(d){return(g.Config.baseZIndex||1E4)+d};return d},{requires:["./base"]});
KISSY.add("editor/plugin/back-color/cmd",function(d,g){var j={element:"span",styles:{"background-color":"#(color)"},overrides:[{element:"*",styles:{"background-color":null}}],childRule:function(d){return!!d.style("background-color")}};return{init:function(d){d.hasCommand("backColor")||d.addCommand("backColor",{exec:function(d,a){d.execCommand("save");g.applyColor(d,a,j);d.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/back-color/index",function(d,g,j,h){function f(a){this.config=a||{}}d.augment(f,{pluginRenderUI:function(a){h.init(a);j.init(a,{defaultColor:"rgb(255, 217, 102)",cmdType:"backColor",tooltip:"\u80cc\u666f\u989c\u8272"})}});return f},{requires:["editor","../color/btn","./cmd"]});
KISSY.add("editor/plugin/bold/cmd",function(d,g,j){var h=new g.Style({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]});return{init:function(d){j.addButtonCmd(d,"bold",h)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/bold/index",function(d,g,j,h){function f(){}d.augment(f,{pluginRenderUI:function(a){h.init(a);a.addButton("bold",{cmdType:"bold",tooltip:"\u7c97\u4f53 "},j.Button);a.docReady(function(){a.get("document").on("keydown",function(b){b.ctrlKey&&b.keyCode==d.Node.KeyCodes.B&&(a.execCommand("bold"),b.preventDefault())})})}});return f},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/bubble/index",function(d,g,j){function h(a){var c=null,e=a.get("editor").getControls();d.each(e,function(e){var d;if(d=e.get)if(d=-1!=(e.get("elCls")||"").indexOf("bubble"))if(d=e!==a)if(d=e.get("visible")){d=a.get("y");var f=d+a.get("el").outerHeight(),g=e.get("y"),h=g+e.get("el").outerHeight();d=d<=h&&f>=h||d<=g&&f>=g}d&&(c?c.get("y")<e.get("y")&&(c=e):c=e)});return c}var f={}.a,a={zIndex:j.baseZIndex(j.zIndexManager.BUBBLE_VIEW),elCls:"{prefixCls}editor-bubble",prefixCls:"{prefixCls}editor-",
effect:{effect:"fade",duration:0.3}};j.prototype.addBubble=function(b,c,e){function k(){m.hide();var a=r.get("window");a&&(a.detach("scroll",o),q.stop())}function i(){var a;var c=m;if(a=c.get("editorSelectedEl")){var b=c.get("editor"),e=b.get("window"),i=b.get("iframe").offset(),c=i.top,i=i.left,g=i+e.width(),e=c+e.height(),k=a.offset(),k=j.Utils.getXY(k,b),b=k.top,k=k.left,q=k+a.width(),o=b+a.height(),n,r;d.UA.ie&&"img"==a[0].nodeName.toLowerCase()&&o>e?a=f:(o>e&&b<e?r=e-30:o>c&&o<e&&(r=o),q>i&&
k<i?n=i:k>i&&k<g&&(n=k),a=n!==f&&r!==f?[n,r]:f)}else a=f;if(a){m.set("xy",a);if(n=h(m))a[1]=n.get("y")+n.get("el").outerHeight(),m.set("xy",a);m.get("visible")||m.show()}}function o(){m.get("editorSelectedEl")&&(m.get("el"),m.hide(),q())}function s(){r.get("window").on("scroll",o);i()}var r=this,n=r.get("prefixCls"),m,e=e||{};e.editor=r;d.mix(e,a);e.elCls=d.substitute(e.elCls,{prefixCls:n});e.prefixCls=d.substitute(e.prefixCls,{prefixCls:n});m=new g(e);r.addControl(b+"/bubble",m);r.on("selectionChange",
function(a){var a=a.path,b=a.elements;if(a&&b&&(a=a.lastElement))(a=c(a))?(m.set("editorSelectedEl",a),m.hide(),d.later(s,10)):k()});r.on("sourceMode",k);var q=d.buffer(i,350)}},{requires:["overlay","editor"]});
KISSY.add("editor/plugin/button/index",function(d,g,j){g.prototype.addButton=function(h,f,a){void 0===a&&(a=j);var b=this.get("prefixCls")+"editor-toolbar-";f.elCls&&(f.elCls=b+f.elCls);f.elCls=b+"button "+(f.elCls||"");var c=(new a(d.mix({render:this.get("toolBarEl"),content:'<span class="'+b+"item "+b+h+'"></span>',prefixCls:this.get("prefixCls")+"editor-",editor:this},f))).render();c.get("el").unselectable();if(!f.content){var e=c.get("el").one("span");c.on("afterContentClsChange",function(a){e[0].className=
b+"item "+b+a.newVal})}c.get("mode")==g.WYSIWYG_MODE&&(this.on("wysiwygMode",function(){c.set("disabled",false)}),this.on("sourceMode",function(){c.set("disabled",true)}));this.addControl(h+"/button",c);return c};return j},{requires:["editor","button"]});
KISSY.add("editor/plugin/checkbox-source-area/index",function(d,g){function j(a){this.editor=a;this._init()}function h(){}var f=d.Node,a=g.SOURCE_MODE,b=g.WYSIWYG_MODE;d.augment(j,{_init:function(){var a=this.editor,b=a.get("statusBarEl");this.holder=(new f("<span style='zoom:1;display:inline-block;height:22px;line-height:22px;'><input style='margin:0 5px;vertical-align:middle;' type='checkbox' /><span style='vertical-align:middle;'>\u7f16\u8f91\u6e90\u4ee3\u7801</span></span>")).appendTo(b);(this.el=this.holder.one("input")).on("click",
this._check,this);a.on("wysiwygMode",this._wysiwygmode,this);a.on("sourceMode",this._sourcemode,this)},_sourcemode:function(){this.el.attr("checked",!0)},_wysiwygmode:function(){this.el.attr("checked",!1)},_check:function(){var c=this.editor;this.el.attr("checked")?c.set("mode",a):c.set("mode",b)},destroy:function(){this.holder.remove()}});d.augment(h,{pluginRenderUI:function(a){var b=new j(a);a.on("destroy",function(){b.destroy()})}});return h},{requires:["editor"]});
KISSY.add("editor/plugin/code/index",function(d,g,j){function h(){}d.augment(h,{pluginRenderUI:function(d){d.addButton("code",{tooltip:"\u63d2\u5165\u4ee3\u7801",listeners:{click:function(){j.useDialog(d,"code")}},mode:g.WYSIWYG_MODE})}});return h},{requires:["editor","../dialog-loader/"]});
KISSY.add("editor/plugin/color/btn",function(d,g,j,h,f){function a(a,c,b){setTimeout(function(){a.execCommand(c,b)},0)}var b=d.Node,c=["000,444,666,999,CCC,EEE,F3F3F3,FFF".split(","),"F00,F90,FF0,0F0,0FF,00F,90F,F0F".split(","),"F4CCCC,FCE5CD,FFF2CC,D9EAD3,D0E0E3,CFE2F3,D9D2E9,EAD1DC,EA9999,F9CB9C,FFE599,B6D7A8,A2C4C9,9FC5E8,B4A7D6,D5A6BD,E06666,F6B26B,FFD966,93C47D,76A5AF,6FA8DC,8E7CC3,C27BAD,CC0000,E69138,F1C232,6AA84F,45818E,3D85C6,674EA7,A64D79,990000,B45F06,BF9000,38761D,134F5C,0B5394,351C75,741B47,660000,783F04,7F6000,274E13,0C343D,073763,20124D,4C1130".split(",")],e;
(function(){e="<div class='{prefixCls}editor-color-panel'><a class='{prefixCls}editor-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";for(var a=0;3>a;a++){e+="<div class='{prefixCls}editor-color-palette'><table>";for(var b=c[a],d=b.length/8,f=0;f<d;f++){e+="<tr>";for(var k=0;8>k;k++){var g="#"+b[8*f+k];e+="<td>";e+="<a href='javascript:void(0);' class='{prefixCls}editor-color-a' style='background-color:"+g+"'></a>";e+="</td>"}e+="</tr>"}e+="</table></div>"}e+="<div><a class='{prefixCls}editor-button {prefixCls}editor-color-others ks-inline-block'>\u5176\u4ed6\u989c\u8272</a></div></div>"})();
var k=j.extend({initializer:function(){var a=this;a.on("blur",function(){setTimeout(function(){a.colorWin&&a.colorWin.hide()},150)});a.on("click",function(){a.get("checked")?a._prepare():a.colorWin&&a.colorWin.hide()})},_prepare:function(){var a=this,c=a.get("editor"),b=c.get("prefixCls"),k;a.colorWin=(new h({elAttrs:{tabindex:0},elCls:b+"editor-popup",content:d.substitute(e,{prefixCls:b}),width:172,zIndex:g.baseZIndex(g.zIndexManager.POPUP_MENU)})).render();var j=a.colorWin;k=j.get("contentEl");
k.on("click",a._selectColor,a);j.on("hide",function(){a.set("checked",!1)});k.one("."+b+"editor-color-others").on("click",function(b){b.halt();j.hide();f.useDialog(c,"color/color-picker",a)});a._prepare=a._show;a._show()},_show:function(){var a=this.get("el"),c=this.colorWin;c.set("align",{node:a,points:["bl","tl"],offset:[0,2],overflow:{adjustX:1,adjustY:1}});c.show()},_selectColor:function(a){a.halt();var c=this.get("editor").get("prefixCls"),a=new b(a.target);a.hasClass(c+"editor-color-a")&&this.fire("selectColor",
{color:a.style("background-color")})},destructor:function(){this.colorWin&&this.colorWin.destroy()}},{ATTRS:{checkable:{value:!0},mode:{value:g.WYSIWYG_MODE}}});k.init=function(c,b){var e=c.get("prefixCls")+"editor-toolbar-",f=b.cmdType,h=b.tooltip,m=c.addButton(f,{elCls:f+"Btn",content:d.substitute('<div class="{icon}"></div><div style="background-color:{defaultColor}" class="{indicator}"></div>',{defaultColor:b.defaultColor,icon:e+"item "+e+f,indicator:e+"color-indicator"}),mode:g.WYSIWYG_MODE,
tooltip:"\u8bbe\u7f6e"+h}),h=c.addButton(f+"Arrow",{tooltip:"\u9009\u62e9\u5e76\u8bbe\u7f6e"+h,elCls:f+"ArrowBtn"},k),j=m.get("el").one("."+e+"color-indicator");h.on("selectColor",function(b){j.css("background-color",b.color);a(c,f,b.color)});m.on("click",function(){a(c,f,j.style("background-color"))})};return k},{requires:["editor","../button/","../overlay/","../dialog-loader/"]});
KISSY.add("editor/plugin/color/cmd",function(d,g){return{applyColor:function(d,h,f){var a=d.get("document")[0];d.execCommand("save");h?(new g.Style(f,{color:h})).apply(a):(new g.Style(f,{color:"inherit"})).remove(a);d.execCommand("save")}}},{requires:["editor"]});
KISSY.add("editor/plugin/contextmenu/index",function(d,g,j,h){g.prototype.addContextMenu=function(f,a,b){var c=this,b=b||{};b.prefixCls=c.get("prefixCls")+"editor-";b.editor=c;b.focusable=1;b.zIndex=g.baseZIndex(g.zIndexManager.POPUP_MENU);var e=new j.PopupMenu(b);h.init(e);e.on("afterRenderUI",function(){e.get("el").on("keydown",function(a){a.keyCode==d.Event.KeyCodes.ESC&&e.hide()})});c.docReady(function(){var b=c.get("document");b.on("mousedown",function(a){1==a.which&&e.hide()});b.delegate("contextmenu",
a,function(a){var b=d.all(a.target);a.halt();var f=a.pageX,k=a.pageY;f&&(a=g.Utils.getXY({left:f,top:k},c),f=a.left,k=a.top,setTimeout(function(){e.set("editorSelectedEl",b,{silent:1});e.set("xy",[f,k]);e.show();c.fire("contextmenu",{contextmenu:e});window.focus();document.body.focus();e.get("el")[0].focus()},30))})});c.addControl(f+"/contextmenu",e);return e}},{requires:["editor","menu","../focus-fix/"]});
KISSY.add("editor/plugin/dent-utils/cmd",function(d,g,j){function h(a){return a.nodeType==e.NodeType.ELEMENT_NODE&&"li"==e.nodeName(a)}function f(a,c,d){for(var f=a.startContainer,h=a.endContainer;f&&!f.parent().equals(c);)f=f.parent();for(;h&&!h.parent().equals(c);)h=h.parent();if(f&&h){for(var n=f,f=[],v=!1;!v;)n.equals(h)&&(v=!0),f.push(n),n=n.next();if(!(1>f.length)){var r=c._4e_parents(!0,void 0);r.each(function(a,c){r[c]=a});for(h=0;h<r.length;h++)if(b[r[h].nodeName()]){c=r[h];break}for(var n=
"indent"==d?1:-1,h=f[0],v=f[f.length-1],f={},s=j.listToArray(c,f),y=s[v.data("listarray_index")].indent,h=h.data("listarray_index");h<=v.data("listarray_index");h++){s[h].indent+=n;var B=s[h].parent;s[h].parent=new k(B[0].ownerDocument.createElement(B.nodeName()))}for(h=v.data("listarray_index")+1;h<s.length&&s[h].indent>y;h++)s[h].indent+=n;v=j.arrayToList(s,f,null,"p");n=[];if("outdent"==d){var C;if((C=c.parent())&&"li"==C.nodeName())for(var d=v.listNode.childNodes,D,h=d.length-1;0<=h;h--)(D=new k(d[h]))&&
"li"==D.nodeName()&&n.push(D)}v&&(e.insertBefore(v.listNode[0]||v.listNode,c[0]||c),c.remove());if(n&&n.length)for(h=0;h<n.length;h++){for(D=c=n[h];(D=D.next())&&D.nodeName()in b;)i.ie&&!c.first(function(a){return o(a)&&m(a)},1)&&c[0].appendChild(a.document.createTextNode("\u00a0")),c[0].appendChild(D[0]);e.insertAfter(c[0],C[0])}g.Utils.clearAllMarkers(f)}}}function a(a,c){var b=parseInt(a.style(s),10);isNaN(b)&&(b=0);b+=("indent"==c?1:-1)*r;if(0>b)return!1;b=Math.max(b,0);b=Math.ceil(b/r)*r;a.css(s,
b?b+n:"");""===a[0].style.cssText&&a.removeAttr("style");return!0}var b={ol:1,ul:1},c=g.Walker,e=d.DOM,k=d.Node,i=d.UA,o=c.whitespaces(!0),s="margin-left",r=40,n="px",m=c.bookmark(!1,!0);return{checkOutdentActive:function(a){var c=a.blockLimit;return a.contains(b)?!0:(a=a.block||c)&&a.style(s)},addCommand:function(d,i){d.hasCommand(i)||d.addCommand(i,{exec:function(d){d.execCommand("save");var k=d.getSelection(),g=k&&k.getRanges()[0];if(g){for(var m=g.startContainer,j=g.endContainer,q=g.getCommonAncestor();q&&
!(q[0].nodeType==e.NodeType.ELEMENT_NODE&&b[q.nodeName()]);)q=q.parent();q&&m[0].nodeType==e.NodeType.ELEMENT_NODE&&m.nodeName()in b&&(m=new c(g),m.evaluator=h,g.startContainer=m.next());q&&j[0].nodeType==e.NodeType.ELEMENT_NODE&&j.nodeName()in b&&(m=new c(g),m.evaluator=h,g.endContainer=m.previous());j=k.createBookmarks(!0);if(q){for(m=q.first();m&&"li"!=m.nodeName();)m=m.next();var o=g.startContainer;(!(m[0]==o[0]||m.contains(o))||!a(q,i))&&f(g,q,i)}else{g=g.createIterator();g.enforceRealBlocks=
!0;for(g.enlargeBr=!0;q=g.getNextParagraph();)a(q,i)}k.selectBookmarks(j)}d.execCommand("save");d.notifySelectionChange()}})}}},{requires:["editor","../list-utils/"]});
KISSY.add("editor/plugin/dialog-loader/index",function(d,g,j){var h,f={loading:function(a){h||(h=new g({x:0,width:6==d.UA.ie?d.DOM.docWidth():"100%",y:0,zIndex:j.baseZIndex(j.zIndexManager.LOADING),prefixCls:a+"editor-",elCls:a+"editor-global-loading"}));h.set("height",d.DOM.docHeight());h.show();h.loading()},unloading:function(){h.hide()}};return{useDialog:function(a,b,c,e){a.focus();var g=a.get("prefixCls");a.getControl(b+"/dialog")?setTimeout(function(){a.showDialog(b,e)},0):(f.loading(g),d.use("editor/plugin/"+
b+"/dialog",function(d,g){f.unloading();a.addControl(b+"/dialog",new g(a,c));a.showDialog(b,e)}))}}},{requires:["overlay","editor"]});
KISSY.add("editor/plugin/dialog/index",function(d,g,j,h,f,a){var b=j.Dialog.extend({initializer:function(){this.plug(new a({handlers:[".ks-editor-stdmod-header"],plugins:[new f({constrain:window})]}))},bindUI:function(){h.init(this)},show:function(){this.center();var a=this.get("y");200<a-d.DOM.scrollTop()&&(a=d.DOM.scrollTop()+200,this.set("y",a));b.superclass.show.call(this)}},{ATTRS:{prefixCls:{value:"ks-editor-"},zIndex:{value:g.baseZIndex(g.zIndexManager.OVERLAY)}}});return b},{requires:["editor",
"overlay","../focus-fix/","dd/plugin/constrain","component/plugin/drag"]});
KISSY.add("editor/plugin/draft/index",function(d,g,j,h,f){function a(a,c,b){for(a+="";a.length<c;)a=b+a;return a}function b(c){d.isNumber(c)&&(c=new Date(c));return c instanceof Date?[c.getFullYear(),"-",a(c.getMonth()+1,2,"0"),"-",a(c.getDate(),2,"0")," ",a(c.getHours(),2,"0"),":",a(c.getMinutes(),2,"0"),":",a(c.getSeconds(),2,"0")].join(""):c}function c(a,c){this.editor=a;this.config=c;this._init()}function e(a,b){var e=new c(a,b);a.on("destroy",function(){e.destroy()})}function k(a){this.config=
a||{}}var i=d.Node,o=d.Event,s=d.JSON,r=g.Utils.addRes,n=g.Utils.destroyRes;d.augment(c,{_getSaveKey:function(){var a=this.config;return a.draft&&a.draft.saveKey||"ks-editor-draft-save20110503"},_getDrafts:function(){if(!this.drafts){var a=j.getItem(this._getSaveKey()),c=[];a&&(c=j==window.localStorage?s.parse(d.urlDecode(a)):a);this.drafts=c}return this.drafts},_init:function(){var a=this,c=a.editor,b=c.get("prefixCls"),e=c.get("statusBarEl"),k=this.config;k.draft=k.draft||{};a.draftInterval=k.draft.interval=
k.draft.interval||5;a.draftLimit=k.draft.limit=k.draft.limit||5;e=(new i("<div class='"+b+"editor-draft'><span class='"+b+"editor-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+k.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(e);a.timeTip=(new i("<span class='"+b+"editor-draft-time'/>")).appendTo(e);var h=(new i(d.substitute("<a href='#' onclick='return false;' class='{prefixCls}editor-button {prefixCls}editor-draft-save-btn ks-inline-block' style='vertical-align:middle;padding:1px 9px;'><span class='{prefixCls}editor-draft-save'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>",
{prefixCls:b}))).unselectable(void 0).appendTo(e),j=(new f({render:e,collapseOnClick:!0,width:"100px",prefixCls:b+"editor-",menu:{width:"225px",align:{points:["tr","br"]}},matchElWidth:!1,content:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"})).render();a.versions=j;j.on("beforeCollapsedChange",function(c){c.newValue||(j.detach("beforeCollapsedChange",arguments.callee),a.sync())});h.on("click",function(c){a.save(!1);c.halt()});r.call(a,h);c.get("textarea")[0].form&&function(){function b(){a.save(!0)}var e=c.get("textarea")[0].form;o.on(e,
"submit",b);r.call(a,function(){o.remove(e,"submit",b)})}();var n=setInterval(function(){a.save(!0)},6E4*a.draftInterval);r.call(a,function(){clearInterval(n)});j.on("click",a.recover,a);r.call(a,j);a.holder=e;if(k.draft.helpHtml){var s=(new i('<a tabindex="0" hidefocus="hidefocus" class="'+b+'editor-draft-help" title="\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9" href="javascript:void(\'\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9 \')">\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9</a>')).unselectable(void 0).appendTo(e);s.on("click",function(){s[0].focus();a.helpPopup&&a.helpPopup.get("visible")?a.helpPopup.hide():
a._prepareHelp()});s.on("blur",function(){a.helpPopup&&a.helpPopup.hide()});a.helpBtn=s;r.call(a,s);g.Utils.lazyRun(a,"_prepareHelp","_realHelp")}r.call(a,e)},_prepareHelp:function(){var a=this.editor.get("prefixCls"),c=new i(this.config.draft.helpHtml||""),b=new i("<div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
c.append(b);c.css({border:"1px solid #ACB4BE","text-align":"left"});this.helpPopup=(new h({content:c,prefixCls:a+"editor-",width:c.width()+"px",zIndex:g.baseZIndex(g.zIndexManager.OVERLAY),mask:!1})).render();this.helpPopup.get("el").css("border","none");this.helpPopup.arrow=b},_realHelp:function(){var a=this.helpPopup,c=this.helpBtn,b=a.arrow;a.show();c=c.offset();a.get("el").offset({left:c.left-a.get("el").width()+17,top:c.top-a.get("el").height()-7});b.offset({left:c.left-2,top:c.top-8})},disable:function(){this.holder.css("visibility",
"hidden")},enable:function(){this.holder.css("visibility","")},sync:function(){var a;a=this.draftLimit;var c=this.timeTip,e=this.versions,d=this._getDrafts(),f;d.length>a&&d.splice(0,d.length-a);e.removeItems(!0);for(a=0;a<d.length;a++)f=d[a],f=(f.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+b(f.date),e.addItem({xclass:"menuitem",content:f,value:a});c.html(f);j.setItem(this._getSaveKey(),j==window.localStorage?encodeURIComponent(s.stringify(d)):d)},save:function(a){var c=this._getDrafts(),b=this.editor.get("formatData");
b&&(c[c.length-1]&&b==c[c.length-1].content&&(c.length-=1),this.drafts=c.concat({content:b,date:(new Date).getTime(),auto:a}),this.sync())},recover:function(a){var c=this.editor,e=this._getDrafts(),d=a.target.get("value");confirm("\u786e\u8ba4\u6062\u590d "+b(e[d].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")&&(c.execCommand("save"),c.set("data",e[d].content),c.execCommand("save"));a.halt()},destroy:function(){n.call(this)}});d.augment(k,{pluginRenderUI:function(a){var c=this.config;j.ready?j.ready(function(){e(a,c)}):e(a,c)}});return k},{requires:["editor",
"../local-storage/","overlay","../menubutton/"]});
KISSY.add("editor/plugin/drag-upload/index",function(d,g){function j(a){this.config=a||{}}var h=d.Node,f=d.Event,a=g.Utils,b=d.DOM;d.augment(j,{pluginRenderUI:function(c){function e(a){a=a.originalEvent.target;"img"==b.nodeName(a)&&a.src.match(/^file:\/\//)&&(q[a.src]=a)}function k(a,c){var b=new window.FileReader;b.onload=function(e){var d=a.name,e=e.target.result,f=new XMLHttpRequest;f.open("POST",n,!0);f.onreadystatechange=function(){if(4==f.readyState){if(200==f.status||304==f.status){if(""!=
f.responseText){var a=window.JSON.parse(f.responseText);c[0].src=a.imgUrl}}else alert("\u670d\u52a1\u5668\u7aef\u51fa\u9519\uff01"),c.remove();f.onreadystatechange=null}};d="\r\n------kissy-editor-yiminghe\r\n"+('Content-Disposition: form-data; name="'+j+'"; filename="'+encodeURIComponent(d)+'"\r\n');d+="Content-Type: "+(a.type||"application/octet-stream")+"\r\n\r\n";d+=e+"\r\n";r=g.Utils.normParams(r);for(var i in r)d+="------kissy-editor-yiminghe\r\n",d+='Content-Disposition: form-data; name="'+i+'"\r\n\r\n',d+=r[i]+"\r\n";d+="------kissy-editor-yiminghe--";
f.setRequestHeader("Content-Type","multipart/form-data, boundary=----kissy-editor-yiminghe");f.sendAsBinary("Content-Type: multipart/form-data; boundary=----kissy-editor-yiminghe\r\nContent-Length: "+d.length+"\r\n"+d+"\r\n");b.onload=null};b.readAsBinaryString(a)}var i=this.config,j=i.fileInput||"Filedata",s=i.sizeLimit||Number.MAX_VALUE,r=i.serverParams||{},n=i.serverUrl||"",m=RegExp((i.suffix||"png,jpg,jpeg,gif").split(/,/).join("|")+"$","i"),q={},t=!1;c.docReady(function(){var i=c.get("document")[0];
f.on(i,"dragenter",function(){t||(f.on(i,"DOMNodeInserted",e),t=!0)});f.on(i,"drop",function(c){f.remove(i,"DOMNodeInserted",e);t=!1;c.halt();var c=c.originalEvent,g,j;d.isEmptyObject(q)?(j=i.elementFromPoint(c.clientX,c.clientY),g=j.lastChild):(d.each(q,function(a){"img"==b.nodeName(a)&&(g=a.nextSibling,j=a.parentNode,b.remove(a))}),q={});c=c.dataTransfer;c.dropEffect="copy";if(c=c.files)for(var o=0;o<c.length;o++){var n=c[o],r=n.size;if(n.name.match(m)&&!(r/1E3>s)){var r=new h("<img src='"+a.debugUrl("theme/tao-loading.gif")+
"'/>"),y=r[0];j.insertBefore(y,g);var B=b.nodeName(y.parentNode);("head"==B||"html"==B)&&b.insertBefore(y,i.body.firstChild);k(n,r)}}})});window.XMLHttpRequest&&!XMLHttpRequest.prototype.sendAsBinary&&(XMLHttpRequest.prototype.sendAsBinary=function(a,c){for(var b=new (window.BlobBuilder||window.WebKitBlobBuilder),e=a.length,d=new window.Uint8Array(e),f=0;f<e;f++)d[f]=a.charCodeAt(f);b.append(d.buffer);this.send(b.getBlob(c))})}});return j},{requires:["editor"]});
KISSY.add("editor/plugin/element-path/index",function(d,g){function j(a){this.cfg=a;this._cache=[];this._init()}function h(){}var f=d.Node;d.augment(j,{_init:function(){var a=this.cfg.editor;this.holder=new f("<span>");this.holder.appendTo(a.get("statusBarEl"),void 0);a.on("selectionChange",this._selectionChange,this);g.Utils.sourceDisable(a,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(a){var b=this.cfg.editor,
c=b.get("prefixCls"),e=this.holder,a=a.path.elements,d,i;d=this._cache;for(i=0;i<d.length;i++)d[i].remove();this._cache=[];for(i=0;i<a.length;i++){d=a[i];var g=d.attr("_ke_real_element_type")||d.nodeName(),h=new f("<a href='javascript(\""+g+"\")' class='"+c+"editor-element-path'>"+g+"</a>");this._cache.push(h);(function(a){h.on("click",function(c){c.halt();b.focus();setTimeout(function(){b.getSelection().selectElement(a)},50)})})(d);e.prepend(h)}},destroy:function(){this.holder.remove()}});d.augment(h,
{pluginRenderUI:function(a){var b=new j({editor:a});a.on("destroy",function(){b.destroy()})}});return h},{requires:["editor"]});
KISSY.add("editor/plugin/fake-objects/index",function(d,g){var j=d.Node,h=d.DOM,f=g.Utils.debugUrl("theme/spacer.gif"),a=d.require("htmlparser");d.augment(g,{createFakeElement:function(a,b,g,i,h,s){var r=a.attr("style")||"";a.attr("width")&&(r="width:"+a.attr("width")+"px;"+r);a.attr("height")&&(r="height:"+a.attr("height")+"px;"+r);var n=d.trim(a.attr("class")),a={"class":b+" "+n,src:f,_ke_realelement:encodeURIComponent(h||a._4e_outerHtml(void 0)),_ke_real_node_type:a[0].nodeType,style:r};s&&(delete s.width,
delete s.height,d.mix(a,s,!1));g&&(a._ke_real_element_type=g);i&&(a._ke_resizable=i);return new j("<img/>",a,this.get("document")[0])},restoreRealElement:function(a){if(a.attr("_ke_real_node_type")!=h.NodeType.ELEMENT_NODE)return null;var a=d.urlDecode(a.attr("_ke_realelement")),b=new j("<div>",null,this.get("document")[0]);b.html(a);return b.first().remove()}});var b={tags:{$:function(c){var b=c.getAttribute("_ke_realelement"),f;b&&(f=(new a.Parser(d.urlDecode(b))).parse());if(b=f&&f.childNodes[0]){if(f=
c.getAttribute("style")){var i=/(?:^|\s)width\s*:\s*(\d+)/i.exec(f),c=i&&i[1];f=(i=/(?:^|\s)height\s*:\s*(\d+)/i.exec(f))&&i[1];c&&b.setAttribute("width",c);f&&b.setAttribute("height",f)}return b}}}};return{init:function(c){var e=c.htmlDataProcessor,g=e&&e.htmlFilter;e.createFakeParserElement||(g&&g.addRules(b),d.mix(e,{restoreRealElement:function(a){if(a.attr("_ke_real_node_type")!=h.NodeType.ELEMENT_NODE)return null;var a=d.urlDecode(a.attr("_ke_realelement")),b=new j("<div>",null,c.get("document")[0]);
b.html(a);return b.first().remove()},createFakeParserElement:function(c,b,e,g,h){var k=a.serialize(c),j=c.getAttribute("style")||"";c.getAttribute("width")&&(j="width:"+c.getAttribute("width")+"px;"+j);c.getAttribute("height")&&(j="height:"+c.getAttribute("height")+"px;"+j);var t=d.trim(c.getAttribute("class")),c={"class":b+" "+t,src:f,_ke_realelement:encodeURIComponent(k),_ke_real_node_type:c.nodeType+"",style:j,align:c.getAttribute("align")||""};h&&(delete h.width,delete h.height,d.mix(c,h,!1));
e&&(c._ke_real_element_type=e);g&&(c._ke_resizable="_ke_resizable");return new a.Tag("img",c)}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/flash-bridge/index",function(d,g,j){function h(a){this._init(a)}var f={};d.augment(h,d.EventTarget,{_init:function(a){var b=d.guid("flashbridge-");a.id=b;a.attrs=a.attrs||{};a.params=a.params||{};var c=a.attrs,e=a.params,h=e.flashVars=e.flashVars||{};d.mix(c,{width:1,height:1},!1);d.mix(e,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},!1);d.mix(h,{shareData:!1,useCompression:!1},!1);c={YUISwfId:b,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};
a.ajbridge&&(c={swfID:b,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"});d.mix(h,c);f[b]=this;this.id=b;this.swf=new g(a);this._expose(a.methods)},_expose:function(a){for(var b=this,c=0;c<a.length;c++)(function(a){b[a]=function(){return b._callSWF(a,d.makeArray(arguments))}})(a[c])},_callSWF:function(a,b){return this.swf.callSWF(a,b)},_eventHandler:function(a){var b=a.type;"log"!==b&&b&&this.fire(b,a)},ready:function(a){if(this._ready)a.call(this);else this.on("contentReady",a)},destroy:function(){this.swf.destroy();
delete f[this.id]}});h.EventHandler=function(a,b){var c=f[a];c&&setTimeout(function(){c._eventHandler.call(c,b)},100)};return j.FlashBridge=h},{requires:["swf","editor"]});
KISSY.add("editor/plugin/flash-common/baseClass",function(d,g,j,h,f,a){function b(){b.superclass.constructor.apply(this,arguments);this._init()}var c=d.Node;b.ATTRS={cls:{},type:{},label:{value:"\u5728\u65b0\u7a97\u53e3\u67e5\u770b"},bubbleId:{},contextMenuId:{},contextMenuHandlers:{}};d.extend(b,d.Base,{_init:function(){var a=this,c=a.get("cls"),b=a.get("editor"),f=b.get("prefixCls"),h=[],j=a.get("bubbleId"),n=a.get("contextMenuId"),m=a.get("contextMenuHandlers");d.each(m,function(a,c){h.push({content:c})});b.addContextMenu(n,
"."+c,{width:"120px",children:h,listeners:{click:function(a){a=a.target.get("content");m[a]&&m[a].call(this)}}});b.addBubble(j,function(a){return a.hasClass(c,void 0)&&a},{listeners:{afterRenderUI:function(){var c=this,h=c.get("contentEl");h.html(d.substitute(' <a class="{prefixCls}editor-bubble-url" target="_blank" href="#">{label}</a>   |    <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-change">\u7f16\u8f91</span>   |    <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-remove">\u5220\u9664</span>',
{label:a.get("label"),prefixCls:f}));var k=h.one("."+f+"editor-bubble-url"),j=h.one("."+f+"editor-bubble-change"),m=h.one("."+f+"editor-bubble-remove");g.Utils.preventFocus(h);j.on("click",function(b){a.show(c.get("editorSelectedEl"));b.halt()});m.on("click",function(a){if(d.UA.webkit){var e=b.getSelection().getRanges();if(e=e&&e[0])e.collapse(!0),e.select()}c.get("editorSelectedEl").remove();c.hide();b.notifySelectionChange();a.halt()});c.on("show",function(){var b=c.get("editorSelectedEl");b&&a._updateTip(k,
b)})}}});b.docReady(function(){b.get("document").on("dblclick",a._dbClick,a)})},_getFlashUrl:function(c){return a.getUrl(c)},_updateTip:function(a,c){var b=this.get("editor").restoreRealElement(c);b&&(b=this._getFlashUrl(b),a.attr("href",b))},_dbClick:function(a){var b=new c(a.target);"img"===b.nodeName()&&b.hasClass(this.get("cls"),void 0)&&(this.show(b),a.halt())},show:function(a){var c=this.get("editor");f.useDialog(c,this.get("type"),this.get("pluginConfig"),a)}});return b},{requires:["editor",
"../contextmenu/","../bubble/","../dialog-loader/","./utils"]});
KISSY.add("editor/plugin/flash-common/utils",function(d,g){var j=d.DOM,h={insertFlash:function(d,a,b,c,e){a=h.createSWF({src:a,attrs:b,document:d.get("document")[0]});b=d.createFakeElement(a.el,c||"ke_flash",e||"flash",!0,a.html,b);d.insertElement(b);return b},isFlashEmbed:function(d){return"application/x-shockwave-flash"==j.attr(d,"type")||/\.swf(?:$|\?)/i.test(j.attr(d,"src")||"")},getUrl:function(d){return g.getSrc(d)},createSWF:function(f){var a=j.create('<div style="position:absolute;left:-9999px;top:-9999px;"></div>',
void 0,f.document);f.htmlMode="full";j.append(a,f.document.body);f.render=a;f=new g(f);j.remove(a);return{el:d.all(f.get("el")),html:f.get("html")}}};return h},{requires:["swf"]});
KISSY.add("editor/plugin/flash/index",function(d,g,j,h,f){function a(a){this.config=a||{}}d.augment(a,{pluginRenderUI:function(a){f.init(a);var c=a.htmlDataProcessor;c.dataFilter.addRules({tags:{object:function(a){var b;if(!a.getAttribute("classid")){var e=a.childNodes;for(b=0;b<e.length;b++)if("embed"==e[b].nodeName)if(h.isFlashEmbed(e[b][b]))break;else return c.createFakeParserElement(a,"ke_flash","flash",!0);return null}return c.createFakeParserElement(a,"ke_flash","flash",!0)},embed:function(a){return h.isFlashEmbed(a)?
c.createFakeParserElement(a,"ke_flash","flash",!0):null}}},5);var e=new j({editor:a,cls:"ke_flash",type:"flash",pluginConfig:this.config,bubbleId:"flash",contextMenuId:"flash",contextMenuHandlers:{"Flash\u5c5e\u6027":function(){var a=this.get("editorSelectedEl");a&&e.show(a)}}});this.flashControl=e;a.addButton("flash",{tooltip:"\u63d2\u5165Flash",listeners:{click:function(){e.show()}},mode:g.WYSIWYG_MODE})}});return a},{requires:["editor","../flash-common/baseClass","../flash-common/utils","../fake-objects/"]});
KISSY.add("editor/plugin/focus-fix/index",function(d,g){function j(){var b=this._focusEditor=a.currentInstance();if(f.ie&&b){window.focus();document.body.focus();var c=b.get("document")[0].selection,e;try{e=c.createRange()}catch(d){e=0}e&&e.item&&e.item(0).ownerDocument==b.get("document")[0]&&(b=document.body.createTextRange(),b.moveToElementText(this.get("el").first()[0]),b.collapse(!0),b.select())}}function h(){var a=this._focusEditor;a&&a.focus()}var f=d.UA,a=g.focusManager;return{init:function(a){a.on("beforeVisibleChange",
function(c){c.newVal&&j.call(a)});a.on("hide",function(){h.call(a)})}}},{requires:["editor"]});KISSY.add("editor/plugin/font-family/cmd",function(d,g,j){var h={element:"span",styles:{"font-family":"#(value)"},overrides:[{element:"font",attributes:{face:null}}]};return{init:function(d){j.addSelectCmd(d,"fontFamily",h)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/font-family/index",function(d,g,j,h){function f(a){this.config=a||{}}d.augment(f,{pluginRenderUI:function(a){h.init(a);var b=this.config,c={};d.mix(c,{children:[{content:"\u5b8b\u4f53",value:"SimSun"},{content:"\u9ed1\u4f53",value:"SimHei"},{content:"\u96b6\u4e66",value:"LiSu"},{content:"\u6977\u4f53",value:"KaiTi_GB2312"},{content:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{content:"Georgia",value:"Georgia"},{content:"Times New Roman",value:"Times New Roman"},{content:"Impact",value:"Impact"},{content:"Courier New",value:"Courier New"},
{content:"Arial",value:"Arial"},{content:"Verdana",value:"Verdana"},{content:"Tahoma",value:"Tahoma"}],width:"130px"});d.each(c.children,function(a){var c=a.elAttrs||{},b=a.value;c.style=c.style||"";c.style+=";font-family:"+b;a.elAttrs=c});b.menu=d.mix(c,b.menu);a.addSelect("fontFamily",d.mix({cmdType:"fontFamily",defaultCaption:"\u5b57\u4f53",width:130,mode:g.WYSIWYG_MODE},b),j.Select)}});return f},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/font-size/cmd",function(d,g,j){var h={element:"span",styles:{"font-size":"#(value)"},overrides:[{element:"font",attributes:{size:null}}]};return{init:function(d){j.addSelectCmd(d,"fontSize",h)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/font-size/index",function(d,g,j,h){function f(a){this.config=a||{}}d.augment(f,{pluginRenderUI:function(a){h.init(a);var b=this.config;b.menu=d.mix({children:function(a){var b=[];d.each(a,function(a){b.push({content:a,value:a})});return b}("8px,10px,12px,14px,18px,24px,36px,48px,60px,72px,84px,96px".split(","))},b.menu);a.addSelect("fontSize",d.mix({cmdType:"fontSize",defaultCaption:"\u5927\u5c0f",width:"70px",mode:g.WYSIWYG_MODE},b),j.Select)}});return f},{requires:["editor","../font/ui",
"./cmd"]});
KISSY.add("editor/plugin/font/cmd",function(d,g){function j(d,a){var b=d.nodeName();if(a.element!=b)return!1;var c=a.styles,e,g;for(g in c)if(e=d.style(g))return e;c=a.overrides;for(g=0;g<c.length;g++)if(e=c[g],e.element==b){var i=e.attributes,h;for(h in i)if(e=d.attr(h))return e}return!1}var h=g.Utils.getQueryCmd;return{addButtonCmd:function(d,a,b){var c=h(a);d.hasCommand(a)||(d.addCommand(a,{exec:function(c){var d=c.get("document")[0];c.execCommand("save");c.queryCommandValue(a)?b.remove(d):b.apply(d);
c.execCommand("save");c.notifySelectionChange()}}),d.addCommand(c,{exec:function(a){if((a=a.getSelection())&&!a.isInvalid)return a=a.getStartElement(),a=new g.ElementPath(a),b.checkActive(a)}}))},addSelectCmd:function(d,a,b){var c=h(a);d.hasCommand(a)||(d.addCommand(a,{exec:function(c,d){c.focus();var f=c.queryCommandValue(a)||"",h=new g.Style(b,{value:d}),j=c.get("document")[0];c.execCommand("save");d.toLowerCase()==f.toLowerCase()?h.remove(j):h.apply(j);c.execCommand("save")}}),d.addCommand(c,{exec:function(a){if((a=
a.getSelection())&&!a.isInvalid){var a=a.getStartElement(),a=new g.ElementPath(a),c=a.elements,d,f,h;for(f=0;f<c.length;f++)if(d=c[f],!(a.block&&d[0]==a.block[0]||a.blockLimit&&d[0]==a.blockLimit[0]))if(h=j(d,b),!1!==h)break;return h}}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/font/ui",function(d,g,j,h){d=h.Select.extend({initializer:function(){var d=this,a=d.get("editor");d.on("click",function(b){var b=b.target.get("value"),c=d.get("cmdType");a.execCommand(c,b)});a.on("selectionChange",function(){if(a.get("mode")!=g.SOURCE_MODE){var b=d.get("cmdType"),c=d.get("menu");if(c=c.get&&c.get("children")){b=a.queryCommandValue(b);if(!1!==b)for(var b=(b+"").toLowerCase(),e=0;e<c.length;e++){var h=c[e].get("value");if(b==h.toLowerCase()){d.set("value",h);
return}}d.set("value",null)}}})}});return{Button:j.extend({initializer:function(){var d=this,a=d.get("editor"),b=d.get("cmdType");d.on("click",function(){d.get("checked")?a.execCommand(b):a.execCommand(b,!1);a.focus()});a.on("selectionChange",function(){if(a.get("mode")!=g.SOURCE_MODE){var c=d.get("cmdType");a.queryCommandValue(c)?d.set("checked",!0):d.set("checked",!1)}})}},{ATTRS:{checkable:{value:!0},mode:{value:g.WYSIWYG_MODE}}}),Select:d}},{requires:["editor","../button/","../menubutton/"]});
KISSY.add("editor/plugin/fore-color/cmd",function(d,g){var j={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}],childRule:function(d){return!("a"==d.nodeName()||d.all("a").length)}};return{init:function(d){d.hasCommand("foreColor")||d.addCommand("foreColor",{exec:function(d,a){d.execCommand("save");g.applyColor(d,a,j);d.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/fore-color/index",function(d,g,j,h){function f(a){this.config=a||{}}d.augment(f,{pluginRenderUI:function(a){h.init(a);j.init(a,{cmdType:"foreColor",defaultColor:"rgb(204, 0, 0)",tooltip:"\u6587\u672c\u989c\u8272"})}});return f},{requires:["editor","../color/btn","./cmd"]});
KISSY.add("editor/plugin/heading/cmd",function(d,g){return{init:function(d){if(!d.hasCommand("heading")){d.addCommand("heading",{exec:function(d,a){d.execCommand("save");if("p"!=a)var b=d.queryCommandValue("heading");a==b&&(a="p");(new g.Style({element:a})).apply(d.get("document")[0]);d.execCommand("save")}});var h=g.Utils.getQueryCmd("heading");d.addCommand(h,{exec:function(d){if((d=d.getSelection())&&!d.isInvalid)if(d=d.getStartElement(),d=new g.ElementPath(d),d=(d=d.block||d.blockLimit)&&d.nodeName()||
"",d.match(/^h\d$/)||"p"==d)return d}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/heading/index",function(d,g,j){function h(){}d.augment(h,{pluginRenderUI:function(d){j.init(d);var a=[],b={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},c={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},e;for(e in b)a.push({content:e,value:b[e],elAttrs:{style:"font-size:"+c[b[e]]}});d.addSelect("heading",{defaultCaption:"\u6807\u9898",width:"120px",menu:{children:a},mode:g.WYSIWYG_MODE,listeners:{click:function(a){a=a.target.get("value");
d.execCommand("heading",a)},afterSyncUI:function(){var a=this;d.on("selectionChange",function(){if(d.get("mode")!=g.SOURCE_MODE){var b=d.queryCommandValue("heading"),e;for(e in c)if(e==b){a.set("value",e);return}a.set("value",null)}})}}})}});return h},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/image/index",function(d,g,j,h,f,a){function b(a){this.config=a||{}}var c=d.UA,e=KISSY.NodeList,k=d.all,i=d.Event,o=function(a){a=k(a);if("img"===a.nodeName()&&!/(^|\s+)ke_/.test(a[0].className))return a};d.augment(b,{pluginRenderUI:function(b){function f(c){a.useDialog(b,"image",h.config,c)}var h=this,j=b.get("prefixCls");b.addButton("image",{tooltip:"\u63d2\u5165\u56fe\u7247",listeners:{click:function(){f(null)}},mode:g.WYSIWYG_MODE});var q=[{content:"\u56fe\u7247\u5c5e\u6027",fn:function(){var a=o(this.get("editorSelectedEl"));
a&&(this.hide(),f(k(a)))}},{content:"\u63d2\u5165\u65b0\u884c",fn:function(){this.hide();var a=b.get("document")[0],d=new e(a.createElement("p"));c.ie||d._4e_appendBogus(void 0);a=new g.Range(a);a.setStartAfter(this.get("editorSelectedEl"));a.select();b.insertElement(d);a.moveToElementEditablePosition(d,1);a.select()}}],t=[];d.each(q,function(a){t.push({content:a.content})});b.addContextMenu("image",o,{width:120,children:t,listeners:{click:function(a){var c=this,b=a.target.get("content");d.each(q,function(a){a.content==
b&&a.fn.call(c)})}}});b.docReady(function(){i.on(b.get("document")[0],"dblclick",function(a){a.halt();a=k(a.target);o(a)&&f(a)})});b.addBubble("image",o,{listeners:{afterRenderUI:function(){var a=this,e=a.get("contentEl");e.html(d.substitute('<a class="{prefixCls}editor-bubble-url" target="_blank" href="#">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  |  <a class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-change" href="#">\u7f16\u8f91</a>  |  <a class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-remove" href="#">\u5220\u9664</a>',
{prefixCls:j}));var i=e.one("."+j+"editor-bubble-url"),h=e.one("."+j+"editor-bubble-change"),k=e.one("."+j+"editor-bubble-remove");g.Utils.preventFocus(e);h.on("click",function(c){f(a.get("editorSelectedEl"));c.halt()});k.on("click",function(d){if(c.webkit){var e=b.getSelection().getRanges();e&&e[0]&&(e[0].collapse(),e[0].select())}a.get("editorSelectedEl").remove();a.hide();b.notifySelectionChange();d.halt()});a.on("show",function(){var c=a.get("editorSelectedEl");c&&(c=c.attr("_ke_saved_src")||
c.attr("src"),i.attr("href",c))})}}})}});return b},{requires:["editor","../button/","../bubble/","../contextmenu/","../dialog-loader/"]});KISSY.add("editor/plugin/indent/cmd",function(d,g,j){var h=j.addCommand;return{init:function(d){h(d,"indent")}}},{requires:["editor","../dent-utils/cmd"]});
KISSY.add("editor/plugin/indent/index",function(d,g,j){function h(){}d.augment(h,{pluginRenderUI:function(d){j.init(d);d.addButton("indent",{tooltip:"\u589e\u52a0\u7f29\u8fdb\u91cf ",listeners:{click:function(){d.execCommand("indent");d.focus()}},mode:g.WYSIWYG_MODE})}});return h},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/italic/cmd",function(d,g,j){var h=new g.Style({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]});return{init:function(d){j.addButtonCmd(d,"italic",h)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/italic/index",function(d,g,j,h){function f(){}d.augment(f,{pluginRenderUI:function(a){h.init(a);a.addButton("italic",{cmdType:"italic",tooltip:"\u659c\u4f53 "},j.Button);a.docReady(function(){a.get("document").on("keydown",function(b){b.ctrlKey&&b.keyCode==d.Node.KeyCodes.I&&(a.execCommand("italic"),b.preventDefault())})})}});return f},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/justify-center/cmd",function(d,g){return{init:function(d){g.addCommand(d,"justifyCenter","center")}}},{requires:["../justify-utils/cmd"]});
KISSY.add("editor/plugin/justify-center/index",function(d,g,j){function h(){var a=this.get("editor");a.execCommand("justifyCenter");a.focus()}function f(){}d.augment(f,{pluginRenderUI:function(a){j.init(a);a.addButton("justifyCenter",{tooltip:"\u5c45\u4e2d\u5bf9\u9f50",checkable:!0,listeners:{click:h,afterSyncUI:function(){var b=this;a.on("selectionChange",function(){a.get("mode")!=g.SOURCE_MODE&&(a.queryCommandValue("justifyCenter")?b.set("checked",!0):b.set("checked",!1))})}},mode:g.WYSIWYG_MODE});a.docReady(function(){a.get("document").on("keydown",
function(b){b.ctrlKey&&b.keyCode==d.Node.KeyCodes.E&&(a.execCommand("justifyCenter"),b.preventDefault())})})}});return f},{requires:["editor","./cmd"]});KISSY.add("editor/plugin/justify-left/cmd",function(d,g){return{init:function(d){g.addCommand(d,"justifyLeft","left")}}},{requires:["../justify-utils/cmd"]});
KISSY.add("editor/plugin/justify-left/index",function(d,g,j){function h(){var a=this.get("editor");a.execCommand("justifyLeft");a.focus()}function f(){}d.augment(f,{pluginRenderUI:function(a){j.init(a);a.addButton("justifyLeft",{tooltip:"\u5de6\u5bf9\u9f50",checkable:!0,listeners:{click:h,afterSyncUI:function(){var b=this;a.on("selectionChange",function(){a.get("mode")!=g.SOURCE_MODE&&(a.queryCommandValue("justifyLeft")?b.set("checked",!0):b.set("checked",!1))})}},mode:g.WYSIWYG_MODE});a.docReady(function(){a.get("document").on("keydown",
function(b){b.ctrlKey&&b.keyCode==d.Node.KeyCodes.L&&(a.execCommand("justifyLeft"),b.preventDefault())})})}});return f},{requires:["editor","./cmd"]});KISSY.add("editor/plugin/justify-right/cmd",function(d,g){return{init:function(d){g.addCommand(d,"justifyRight","right")}}},{requires:["../justify-utils/cmd"]});
KISSY.add("editor/plugin/justify-right/index",function(d,g,j){function h(){var a=this.get("editor");a.execCommand("justifyRight");a.focus()}function f(){}d.augment(f,{pluginRenderUI:function(a){j.init(a);a.addButton("justifyRight",{tooltip:"\u53f3\u5bf9\u9f50",checkable:!0,listeners:{click:h,afterSyncUI:function(){var b=this;a.on("selectionChange",function(){a.get("mode")!=g.SOURCE_MODE&&(a.queryCommandValue("justifyRight")?b.set("checked",!0):b.set("checked",!1))})}},mode:g.WYSIWYG_MODE});a.docReady(function(){a.get("document").on("keydown",
function(b){b.ctrlKey&&b.keyCode==d.Node.KeyCodes.R&&(a.execCommand("justifyRight"),b.preventDefault())})})}});return f},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justify-utils/cmd",function(d,g){var j=/(-moz-|-webkit-|start|auto)/gi;return{addCommand:function(d,f,a){d.hasCommand(f)||(d.addCommand(f,{exec:function(b){b.focus();b.execCommand("save");for(var c=b.getSelection(),d=c.createBookmarks(),f=c.getRanges(),i,g,h=f.length-1;0<=h;h--){i=f[h].createIterator();for(i.enlargeBr=!0;g=i.getNextParagraph();)g.removeAttr("align"),(g.css("text-align").replace(j,"")||"left")==a?g.css("text-align",""):g.css("text-align",a)}c.selectBookmarks(d);
b.execCommand("save");b.notifySelectionChange()}}),d.addCommand(g.Utils.getQueryCmd(f),{exec:function(b){if((b=b.getSelection())&&!b.isInvalid)return b=b.getStartElement(),b=new g.ElementPath(b),b=b.block||b.blockLimit,!b||"body"===b.nodeName()?!1:(b.css("text-align").replace(j,"")||"left")==a}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/link/index",function(d,g,j,h,f){function a(a){a=c(a);return a.closest("a",void 0)}function b(a){this.config=a||{}}var c=d.all;d.augment(b,{pluginRenderUI:function(c){var b=c.get("prefixCls");c.addButton("link",{tooltip:"\u63d2\u5165\u94fe\u63a5",listeners:{click:function(){f.useDialog(c,"link",i.config,void 0)}},mode:g.WYSIWYG_MODE});var i=this;c.addBubble("link",a,{listeners:{afterRenderUI:function(){var a=this,j=a.get("contentEl");j.html(d.substitute('<a href=""  target="_blank" class="{prefixCls}editor-bubble-url">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  \u2013   <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-change">\u7f16\u8f91</span>   |    <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-remove">\u53bb\u9664</span>',
{prefixCls:b}));var r=j.one("."+b+"editor-bubble-url"),n=j.one("."+b+"editor-bubble-change"),m=j.one("."+b+"editor-bubble-remove");g.Utils.preventFocus(j);n.on("click",function(b){var d=a.get("editorSelectedEl");f.useDialog(c,"link",i.config,d);b.halt()});m.on("click",function(b){h.removeLink(c,a.get("editorSelectedEl"));b.halt()});a.on("show",function(){var c=a.get("editorSelectedEl");c&&(c=c.attr(h._ke_saved_href)||c.attr("href"),r.html(c),r.attr("href",c))})}}})}});return b},{requires:["editor",
"../bubble/","./utils","../dialog-loader/","../button/"]});
KISSY.add("editor/plugin/link/utils",function(d,g){var j=d.Node,h=g.Style,f={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};return{removeLink:function(a,b){a.execCommand("save");var c=a.getSelection(),d=c.getRanges()[0];if(d&&d.collapsed)d=c.createBookmarks(),b._4e_remove(!0),c.selectBookmarks(d);else if(d){for(var c=b[0],d=c.attributes,g={},i=0;i<d.length;i++){var j=d[i];j.specified&&(g[j.name]=j.value)}c.style.cssText&&(g.style=c.style.cssText);
(new h(f,g)).remove(a.get("document")[0])}a.execCommand("save");a.notifySelectionChange()},applyLink:function(a,b,c){b._ke_saved_href=b.href;c?(a.execCommand("save"),c.attr(b)):(c=(c=a.getSelection())&&c.getRanges()[0],!c||c.collapsed?(b=new j("<a>"+b.href+"</a>",b,a.get("document")[0]),a.insertElement(b)):(a.execCommand("save"),(new h(f,b)).apply(a.get("document")[0])));a.execCommand("save");a.notifySelectionChange()},_ke_saved_href:"_ke_saved_href"}},{requires:["editor"]});
KISSY.add("editor/plugin/list-utils/btn",function(d,g){return{init:function(d,h){var f=h.buttonId,a=h.cmdType,b=h.tooltip,c=d.addButton(f,{elCls:f+"Btn",mode:g.WYSIWYG_MODE,tooltip:"\u8bbe\u7f6e"+b});d.on("selectionChange",function(){var b;(b=d.queryCommandValue(a))?(c.set("checked",!0),e.set("value",b)):c.set("checked",!1)});var e=d.addSelect(f+"Arrow",{tooltip:"\u9009\u62e9\u5e76\u8bbe\u7f6e"+b,mode:g.WYSIWYG_MODE,menu:h.menu,matchElWidth:!1,elCls:"toolbar-"+f+"ArrowBtn"});e.on("click",function(b){b=b.target.get("value");c.listValue=
b;d.execCommand(a,b);d.focus()});c.on("click",function(){var b=c.listValue;c.get("checked")&&(b=e.get("value"));d.execCommand(a,b);d.focus()})}}},{requires:["editor","../button/","../menubutton/"]});
KISSY.add("editor/plugin/list-utils/cmd",function(d,g,j,h){function f(a){this.type=a}function a(a,c){var d,e,f,i=c.blockLimit,g=c.elements;if(!i)return!1;if(g)for(f=0;f<g.length&&(d=g[f])&&d[0]!==i[0];f++)if(b[e=d.nodeName()]&&e==a)return d.css("list-style-type");return!1}var b={ol:"insertOrderedList",ul:"insertUnorderedList"},c=g.RANGE,e=g.ElementPath,k=g.Walker,i=d.UA,o=d.Node,s=d.DOM,r=/^h[1-6]$/;f.prototype={constructor:f,changeListType:function(a,c,b,d,e){for(var f=j.listToArray(c.root,b,h,h,
h),i=[],a=0;a<c.contents.length;a++){var g=c.contents[a];if((g=g.closest("li",h))&&g[0]&&!g.data("list_item_processed"))i.push(g),g._4e_setMarker(b,"list_item_processed",!0,h)}g=new o(c.root[0].ownerDocument.createElement(this.type));g.css("list-style-type",e);for(a=0;a<i.length;a++)e=i[a].data("listarray_index"),f[e].parent=g;for(var b=j.arrayToList(f,b,null,"p"),k,e=b.listNode.childNodes.length,a=0;a<e&&(k=new o(b.listNode.childNodes[a]));a++)k.nodeName()==this.type&&d.push(k);c.root.before(b.listNode);
c.root.remove()},createList:function(a,c,b,d){var e=c.contents,a=c.root[0].ownerDocument,f=[];if(1==e.length&&e[0][0]===c.root[0]){var g=new o(a.createElement("div"));e[0][0].nodeType!=s.NodeType.TEXT_NODE&&e[0]._4e_moveChildren(g,h,h);e[0][0].appendChild(g[0]);e[0]=g}c=c.contents[0].parent();for(g=0;g<e.length;g++)c=c._4e_commonAncestor(e[g].parent(),h);for(g=0;g<e.length;g++)for(var k=e[g],j;j=k.parent();){if(j[0]===c[0]){f.push(k);break}k=j}if(!(1>f.length)){e=new o(f[f.length-1][0].nextSibling);
g=new o(a.createElement(this.type));g.css("list-style-type",d);for(b.push(g);f.length;)b=f.shift(),d=new o(a.createElement("li")),r.test(b.nodeName())?d[0].appendChild(b[0]):(b._4e_copyAttributes(d,h,h),b._4e_moveChildren(d,h,h),b.remove()),g[0].appendChild(d[0]),i.ie||d._4e_appendBogus(h);e[0]?g.insertBefore(e,h):c.append(g)}},removeList:function(a,c,b){function d(b){if((z=new o(r[b?"firstChild":"lastChild"]))&&!(z[0].nodeType==s.NodeType.ELEMENT_NODE&&z._4e_isBlockBoundary(h,h))&&(x=c.root[b?"prev":
"next"](k.whitespaces(!0),1))&&!(z[0].nodeType==s.NodeType.ELEMENT_NODE&&x._4e_isBlockBoundary({br:1},h)))z[b?"before":"after"](a.get("document")[0].createElement("br"))}for(var e=j.listToArray(c.root,b,h,h,h),f=[],g=0;g<c.contents.length;g++){var i=c.contents[g];if((i=i.closest("li",h))&&!i.data("list_item_processed"))f.push(i),i._4e_setMarker(b,"list_item_processed",!0,h)}i=null;for(g=0;g<f.length;g++)i=f[g].data("listarray_index"),e[i].indent=-1;for(g=i+1;g<e.length;g++)if(e[g].indent>Math.max(e[g-
1].indent,0)){f=e[g-1].indent+1-e[g].indent;for(i=e[g].indent;e[g]&&e[g].indent>=i;)e[g].indent+=f,g++;g--}var r=j.arrayToList(e,b,null,"p").listNode,z,x;d(!0);d(h);c.root.before(r);c.root.remove()},exec:function(d,f){var i=d.getSelection(),j=i&&i.getRanges();if(j&&!(1>j.length)){for(var l=i.getStartElement(),l=new g.ElementPath(l),o=a(this.type,l),l=i.createBookmarks(!0),r=[],w={};0<j.length;){var v=j.shift(),z=v.getBoundaryNodes(),x=z.startNode,y=z.endNode;x[0].nodeType==s.NodeType.ELEMENT_NODE&&
"td"==x.nodeName()&&v.setStartAt(z.startNode,c.POSITION_AFTER_START);y[0].nodeType==s.NodeType.ELEMENT_NODE&&"td"==y.nodeName()&&v.setEndAt(z.endNode,c.POSITION_BEFORE_END);v=v.createIterator();for(v.forceBrBreak=!1;z=v.getNextParagraph();)if(!z.data("list_block")){z._4e_setMarker(w,"list_block",1,h);for(var y=new e(z),B=y.elements,C=null,D=!1,C=y.blockLimit,A,x=B.length-1;0<=x&&(A=B[x]);x--)if(b[A.nodeName()]&&C.contains(A)){C.removeData("list_group_object");(x=A.data("list_group_object"))?x.contents.push(z):
(x={root:A,contents:[z]},r.push(x),A._4e_setMarker(w,"list_group_object",x,h));D=!0;break}D||(y=C||y.block,y.data("list_group_object")?y.data("list_group_object").contents.push(z):(x={root:y,contents:[z]},y._4e_setMarker(w,"list_group_object",x,h),r.push(x)))}}for(j=[];0<r.length;)x=r.shift(),o?b[x.root.nodeName()]&&(x.root.css("list-style-type")==f?this.removeList(d,x,w):x.root.css("list-style-type",f)):b[x.root.nodeName()]?this.changeListType(d,x,w,j,f):(g.Utils.clearAllMarkers(w),this.createList(d,
x,j,f));for(var F=this,x=0;x<j.length;x++)C=j[x],A=function(a,c){var b=c[a?"prev":"next"](k.whitespaces(!0),1);b&&b[0]&&b.nodeName()==F.type&&b.css("list-style-type")==f&&(b.remove(),b._4e_moveChildren(c,a?!0:!1,h))},A(h,C),A(!0,C);g.Utils.clearAllMarkers(w);i.selectBookmarks(l)}}};return{ListCommand:f,queryActive:a}},{requires:["editor","../list-utils/"]});
KISSY.add("editor/plugin/list-utils/index",function(d){var g={ol:1,ul:1},j=d.Node,h=d.DOM,f=h.NodeType,a=d.UA,b={listToArray:function(a,d,f,i,o){if(!g[a.nodeName()])return[];i||(i=0);f||(f=[]);for(var s=0,r=a[0].childNodes.length;s<r;s++){var n=new j(a[0].childNodes[s]);if("li"==n.nodeName()){var m={parent:a,indent:i,element:n,contents:[]};o?m.grandparent=o:(m.grandparent=a.parent(),m.grandparent&&"li"==m.grandparent.nodeName()&&(m.grandparent=m.grandparent.parent()));d&&n._4e_setMarker(d,"listarray_index",
f.length,void 0);f.push(m);for(var q=0,t=n[0].childNodes.length,l;q<t;q++)l=new j(n[0].childNodes[q]),l[0].nodeType==h.NodeType.ELEMENT_NODE&&g[l.nodeName()]?b.listToArray(l,d,f,i+1,m.grandparent):m.contents.push(l)}}return f},arrayToList:function(c,d,k,i){k||(k=0);if(!c||c.length<k+1)return null;for(var o=c[k].parent[0].ownerDocument,s=o.createDocumentFragment(),r=null,n=k,m=Math.max(c[k].indent,0),q=null;;){var t=c[n];if(t.indent==m){if(!r||c[n].parent.nodeName()!=r.nodeName())r=c[n].parent.clone(!1),
s.appendChild(r[0]);for(var q=r[0].appendChild(t.element.clone(!1)[0]),l=0;l<t.contents.length;l++)q.appendChild(t.contents[l].clone(!0)[0]);n++}else if(t.indent==Math.max(m,0)+1)n=b.arrayToList(c,null,n,i),q.appendChild(n.listNode),n=n.nextIndex;else if(-1==t.indent&&!k&&t.grandparent){g[t.grandparent.nodeName()]?q=t.element.clone(!1)[0]:"td"!=t.grandparent.nodeName()?(q=o.createElement(i),t.element._4e_copyAttributes(new j(q))):q=o.createDocumentFragment();for(l=0;l<t.contents.length;l++)r=t.contents[l].clone(!0),
q.nodeType==f.DOCUMENT_FRAGMENT_NODE&&t.element._4e_copyAttributes(new j(r)),q.appendChild(r[0]);q.nodeType==f.DOCUMENT_FRAGMENT_NODE&&n!=c.length-1&&(q.lastChild&&q.lastChild.nodeType==h.NodeType.ELEMENT_NODE&&"_moz"==q.lastChild.getAttribute("type")&&h._4e_remove(q.lastChild),h._4e_appendBogus(q));q.nodeType==h.NodeType.ELEMENT_NODE&&h.nodeName(q)==i&&q.firstChild&&(h._4e_trim(q),r=q.firstChild,r.nodeType==h.NodeType.ELEMENT_NODE&&h._4e_isBlockBoundary(r)&&(r=o.createDocumentFragment(),h._4e_moveChildren(q,
r),q=r));r=h.nodeName(q);!a.ie&&("div"==r||"p"==r)&&h._4e_appendBogus(q);s.appendChild(q);r=null;n++}else return null;if(c.length<=n||Math.max(c[n].indent,0)<m)break}if(d)for(c=new j(s.firstChild);c&&c[0];)c[0].nodeType==h.NodeType.ELEMENT_NODE&&c._4e_clearMarkers(d,!0),c=c._4e_nextSourceNode();return{listNode:s,nextIndex:n}}};return b},{requires:["editor"]});
KISSY.add("editor/plugin/local-storage/index",function(d,g,j,h){if(!d.UA.ie&&window.localStorage)return window.localStorage;var f=g.Utils.debugUrl("plugin/local-storage/swfstore.swf?t="+ +new Date),a={width:215,border:"1px solid red"},b={width:0,border:"none"},c=new j({prefixCls:"ks-editor-",elStyle:{background:"white"},width:"0px",content:"<h1 style='text-align:center;'>\u8bf7\u70b9\u51fb\u5141\u8bb8</h1><div class='storage-container'></div>",zIndex:g.baseZIndex(g.zIndexManager.STORE_FLASH_SHOW)});c.render();c.show();var e=
new h({src:f,render:c.get("contentEl").one(".storage-container"),params:{flashVars:{useCompression:!0}},attrs:{height:138,width:"100%"},methods:["setItem","removeItem","getItem","setMinDiskSpace","getValueOf"]});d.ready(function(){setTimeout(function(){c.center()},0)});e.on("pending",function(){c.get("el").css(a);c.center();c.show();setTimeout(function(){e.retrySave()},1E3)});e.on("save",function(){c.get("el").css(b)});var k=e.setItem;d.mix(e,{_ke:1,getItem:function(a){return this.getValueOf(a)},
retrySave:function(){this.setItem(this.lastSave.k,this.lastSave.v)},setItem:function(a,c){this.lastSave={k:a,v:c};k.call(this,a,c)}});e.on("contentReady",function(){e._ready=1});return e},{requires:["editor","overlay","../flash-bridge/"]});
KISSY.add("editor/plugin/maximize/cmd",function(d,g){function j(a){this.editor=a}var h=d.UA,f=h.ie,a=document,b=d.Node,c=d.Event,e=d.DOM,k;d.augment(j,{restoreWindow:function(){var a=this,b=a.editor;!1!==b.fire("beforeRestoreWindow")&&a._resize&&(c.remove(window,"resize",a._resize),a._resize.stop(),a._resize=0,a._saveEditorStatus(),a._restoreState(),setTimeout(function(){a._restoreEditorStatus();b.notifySelectionChange();b.fire("afterRestoreWindow")},30))},_restoreState:function(){var c=this.editor,
b=c.get("textarea"),d=this._savedParents;if(d){for(var g=0;g<d.length;g++){var h=d[g];h.el.css("position",h.position)}this._savedParents=null}b.parent().css({height:this.iframeHeight});b.css({height:this.iframeHeight});e.css(a.body,{width:"",height:"",overflow:""});a.documentElement.style.overflow="";b=c.get("el")[0].style;b.position="static";b.width=this.editorElWidth;k.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);8>f&&c.get("toolBarEl").removeClass(c.get("prefixCls")+
"editor-toolbar-padding",void 0)},_saveSate:function(){var a=this.editor,c=[],b=a.get("el");this.iframeHeight=a.get("textarea").parent().style("height");this.editorElWidth=b.style("width");this.scrollLeft=e.scrollLeft();this.scrollTop=e.scrollTop();window.scrollTo(0,0);for(b=b.parent();b;){var d=b.css("position");"static"!=d&&(c.push({el:b,position:d}),b.css("position","static"));b=b.parent()}this._savedParents=c;8>f&&a.get("toolBarEl").addClass(a.get("prefixCls")+"editor-toolbar-padding",void 0)},
_saveEditorStatus:function(){var a=this.editor;this.savedRanges=null;h.gecko&&a.__iframeFocus&&(this.savedRanges=(a=a.getSelection())&&a.getRanges())},_restoreEditorStatus:function(){var a=this.editor,c=a.getSelection(),b=this.savedRanges;h.gecko&&a.activateGecko();b&&c&&c.selectRanges(b);a.__iframeFocus&&c&&(a=c.getStartElement())&&a.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})},_maximize:function(c){var b=this.editor,d=b.get("el"),h=e.viewportHeight(),
j=e.viewportWidth(),m=b.get("textarea"),q=b.get("statusBarEl")?b.get("statusBarEl")[0].offsetHeight:0,b=b.get("toolBarEl")[0].offsetHeight;f?a.body.style.overflow="hidden":e.css(a.body,{width:0,height:0,overflow:"hidden"});a.documentElement.style.overflow="hidden";d.css({position:"absolute",zIndex:g.baseZIndex(g.zIndexManager.MAXIMIZE),width:j+"px"});k.css({zIndex:g.baseZIndex(g.zIndexManager.MAXIMIZE-5),height:h+"px",width:j+"px"});d.offset({left:0,top:0});k.css({left:0,top:0});m.parent().css({height:h-
q-b+"px"});m.css({height:h-q-b+"px"});!0!==c&&arguments.callee.call(this,!0)},_real:function(){var a=this,b=a.editor;a._resize||(a._saveEditorStatus(),a._saveSate(),a._maximize(),a._resize||(a._resize=d.buffer(function(){a._maximize();b.fire("afterMaximizeWindow")},100)),c.on(window,"resize",a._resize),setTimeout(function(){a._restoreEditorStatus();b.notifySelectionChange();b.fire("afterMaximizeWindow")},30))},maximizeWindow:function(){!1!==this.editor.fire("beforeMaximizeWindow")&&(k||(k=(new b("<iframe  style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(a.body,
void 0)),this._real())},destroy:function(){this._resize&&(c.remove(window,"resize",this._resize),this._resize.stop(),this._resize=0)}});return{init:function(a){if(!a.hasCommand("maximizeWindow")){var c=new j(a);a.addCommand("maximizeWindow",{exec:function(){c.maximizeWindow()}});a.addCommand("restoreWindow",{exec:function(){c.restoreWindow()}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/maximize/index",function(d,g,j){function h(){}d.augment(h,{pluginRenderUI:function(d){j.init(d);d.addButton("maximize",{tooltip:"\u5168\u5c4f",listeners:{click:function(){this.get("checked")?(d.execCommand("maximizeWindow"),this.set("tooltip","\u53d6\u6d88\u5168\u5c4f"),this.set("contentCls","restore")):(d.execCommand("restoreWindow"),this.set("tooltip","\u5168\u5c4f"),this.set("contentCls","maximize"));d.focus()}},checkable:!0})}});return h},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/menubutton/index",function(d,g,j){g.prototype.addSelect=function(h,f,a){var a=a||j.Select,b=this.get("prefixCls")+"editor-";if(f&&(f.editor=this,f.menu&&(f.menu.zIndex=g.baseZIndex(g.zIndexManager.SELECT)),f.elCls))f.elCls=b+f.elCls;var c=(new a(d.mix({render:this.get("toolBarEl"),prefixCls:b},f))).render();c.get("el").unselectable();f.mode==g.WYSIWYG_MODE&&(this.on("wysiwygMode",function(){c.set("disabled",!1)}),this.on("sourceMode",function(){c.set("disabled",!0)}));this.addControl(h+
"/select",c);return c};return j},{requires:["editor","menubutton"]});KISSY.add("editor/plugin/multiple-upload/index",function(d,g,j){function h(d){this.config=d||{}}d.augment(h,{pluginRenderUI:function(d){var a=this;d.addButton("multipleUpload",{tooltip:"\u6279\u91cf\u63d2\u56fe",listeners:{click:function(){j.useDialog(d,"multiple-upload",a.config)}},mode:g.WYSIWYG_MODE})}});return h},{requires:["editor","../dialog-loader/"]});
KISSY.add("editor/plugin/ordered-list/cmd",function(d,g,j){var h=j.queryActive,f=new j.ListCommand("ol");return{init:function(a){a.hasCommand("insertOrderedList")||a.addCommand("insertOrderedList",{exec:function(a,b){a.focus();f.exec(a,b)}});var b=g.Utils.getQueryCmd("insertOrderedList");a.hasCommand(b)||a.addCommand(b,{exec:function(a){if((a=a.getSelection())&&!a.isInvalid)return a=a.getStartElement(),a=new g.ElementPath(a),h("ol",a)}})}}},{requires:["editor","../list-utils/cmd"]});
KISSY.add("editor/plugin/ordered-list/index",function(d,g,j,h){function f(){}d.augment(f,{pluginRenderUI:function(a){h.init(a);j.init(a,{cmdType:"insertOrderedList",buttonId:"orderedList",menu:{width:75,children:[{content:"1,2,3...",value:"decimal"},{content:"a,b,c...",value:"lower-alpha"},{content:"A,B,C...",value:"upper-alpha"},{content:"i,ii,iii...",value:"lower-roman"},{content:"I,II,III...",value:"upper-roman"}]},tooltip:"\u6709\u5e8f\u5217\u8868"})}});return f},{requires:["editor","../list-utils/btn","./cmd"]});
KISSY.add("editor/plugin/outdent/cmd",function(d,g,j){var h=j.addCommand,f=j.checkOutdentActive;return{init:function(a){h(a,"outdent");var b=g.Utils.getQueryCmd("outdent");a.hasCommand(b)||a.addCommand(b,{exec:function(a){if((a=a.getSelection())&&!a.isInvalid)return a=a.getStartElement(),a=new g.ElementPath(a),f(a)}})}}},{requires:["editor","../dent-utils/cmd"]});
KISSY.add("editor/plugin/outdent/index",function(d,g,j){function h(){}d.augment(h,{pluginRenderUI:function(d){j.init(d);d.addButton("outdent",{tooltip:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",listeners:{click:function(){d.execCommand("outdent");d.focus()},afterSyncUI:function(){var a=this;d.on("selectionChange",function(){d.get("mode")!=g.SOURCE_MODE&&(d.queryCommandValue("outdent")?a.set("disabled",!1):a.set("disabled",!0))})}},mode:g.WYSIWYG_MODE})}});return h},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/overlay/index",function(d,g,j,h){return j.extend({bindUI:function(){h.init(this)}},{ATTRS:{prefixCls:{value:"ks-editor-"},zIndex:{value:g.baseZIndex(g.zIndexManager.OVERLAY)}}})},{requires:["editor","overlay","../focus-fix/"]});
KISSY.add("editor/plugin/page-break/index",function(d,g,j){function h(){}var f=d.Node;d.augment(h,{pluginRenderUI:function(a){j.init(a);var b=a.htmlDataProcessor;(b&&b.dataFilter).addRules({tags:{div:function(a){var d=a.getAttribute("style"),f;if(d)for(var g=a.childNodes,h=0;h<g.length;h++)1==g[h].nodeType&&(f=g[h]);if((f=f&&"span"==f.nodeName&&f.getAttribute("style"))&&/page-break-after\s*:\s*always/i.test(d)&&/display\s*:\s*none/i.test(f))return b.createFakeParserElement(a,"ke_pagebreak","div")}}});
a.addButton("pageBreak",{tooltip:"\u5206\u9875",listeners:{click:function(){var c=new f('<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>',null,a.get("document")[0]),c=a.createFakeElement(c,"ke_pagebreak","div",!1,'<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>');a.focus();var b=a.getSelection();if(b=b&&b.getRanges()[0]){a.execCommand("save");for(var d=b.startContainer,g=d;"body"!==d.nodeName();)g=d,d=d.parent();b.collapse(!0);b.splitElement(g);
c.insertAfter(g);a.execCommand("save")}}},mode:g.WYSIWYG_MODE})}});return h},{requires:["editor","../fake-objects/"]});
KISSY.add("editor/plugin/preview/index",function(d){function g(){}var j=window;d.augment(g,{pluginRenderUI:function(d){d.addButton("preview",{tooltip:"\u9884\u89c8",listeners:{click:function(){try{var f=j.screen,a=Math.round(0.8*f.width),b=Math.round(0.7*f.height),c=Math.round(0.1*f.width)}catch(e){a=640,b=420,c=80}f=d.getDocHtml().replace(/\${title}/,"\u9884\u89c8");a=j.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+a+",height="+b+",left="+c);b=a.document;b.open();b.write(f);
b.close();a.focus()}}})}});return g});
KISSY.add("editor/plugin/progressbar/index",function(d){function g(){g.superclass.constructor.apply(this,arguments);this._init()}var j=d.Node;g.ATTRS={container:{},width:{},height:{},progress:{value:0},prefixCls:{value:"ks-"}};d.extend(g,d.Base,{destroy:function(){this.detach();this.el.remove()},_init:function(){var g=this.get("height"),f=this.get("prefixCls"),a=new j(d.substitute("<div class='{prefixCls}editor-progressbar'  style='width:"+this.get("width")+";height:"+g+";'></div>",{prefixCls:f})),
b=this.get("container"),g=(new j(d.substitute("<div style='overflow:hidden;'><div class='{prefixCls}editor-progressbar-inner' style='height:"+(parseInt(g)-4)+"px'><div class='{prefixCls}editor-progressbar-inner-bg'></div></div></div>",{prefixCls:f}))).appendTo(a),f=(new j("<span class='"+f+"editor-progressbar-title'></span>")).appendTo(a);b&&a.appendTo(b);this.el=a;this._title=f;this._p=g;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},
_progressChange:function(d){d=d.newVal;this._p.css("width",d+"%");this._title.html(d+"%")}});return g});
KISSY.add("editor/plugin/remove-format/cmd",function(d,g){function j(a,c){for(var b=0;b<c.length;b++)a.removeAttr(c[b])}var h=g.RANGE,f=g.ElementPath,a=d.DOM,b="class,style,lang,width,height,align,hspace,valign".split(/,/),c=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i");return{init:function(d){d.hasCommand("removeFormat")||d.addCommand("removeFormat",{exec:function(){d.focus();c.lastIndex=0;var g=d.getSelection().getRanges();
d.execCommand("save");for(var i=0,o;o=g[i];i++)if(!o.collapsed){o.enlarge(h.ENLARGE_ELEMENT);var s=o.createBookmark(),r=s.startNode,n=s.endNode,m=function(a){for(var b=new f(a),d=b.elements,e=1,g;(g=d[e])&&!g.equals(b.block)&&!g.equals(b.blockLimit);e++)c.test(g.nodeName())&&a._4e_breakParent(g)};m(r);m(n);for(r=r._4e_nextSourceNode(!0,a.NodeType.ELEMENT_NODE,void 0,void 0);r&&!r.equals(n);)m=r._4e_nextSourceNode(!1,a.NodeType.ELEMENT_NODE,void 0,void 0),"img"==r.nodeName()&&(r.attr("_ke_realelement")||
/\bke_/.test(r[0].className))||(c.test(r.nodeName())?r._4e_remove(!0):j(r,b)),r=m;o.moveToBookmark(s)}d.getSelection().selectRanges(g);d.execCommand("save")}})}}},{requires:["editor"]});KISSY.add("editor/plugin/remove-format/index",function(d,g,j){function h(){}d.augment(h,{pluginRenderUI:function(d){j.init(d);d.addButton("removeFormat",{tooltip:"\u6e05\u9664\u683c\u5f0f",listeners:{click:function(){d.execCommand("removeFormat")}},mode:g.WYSIWYG_MODE})}});return h},{requires:["editor","./cmd","../button/"]});
KISSY.add("editor/plugin/resize/index",function(d,g,j){function h(a){this.config=a||{}}var f=d.Node;d.augment(h,{pluginRenderUI:function(a){var b=j.Draggable,c=a.get("statusBarEl");a.get("textarea");var e=this.config.direction||["x","y"],g="se-resize";1==e.length&&(g="x"==e[0]?"e-resize":"s-resize");var h=(new f("<div class='"+a.get("prefixCls")+"editor-resizer' style='cursor: "+g+"'></div>")).appendTo(c);a.on("maximizeWindow",function(){h.css("display","none")});a.on("restoreWindow",function(){h.css("display",
"")});var o=new b({node:h,groups:!1}),s=0,r=0,n,m=a.get("el"),q=a.get("el");o.on("dragstart",function(){s=m.height();r=q.width();a.fire("resizeStart");n=h.offset()});o.on("drag",function(c){var b=c.left-n.left,c=c.top-n.top;d.inArray("y",e)&&a.set("height",s+c);d.inArray("x",e)&&a.set("width",r+b);a.fire("resize")});a.on("destroy",function(){o.destroy();h.remove()})}});return h},{requires:["editor","dd/base"]});
KISSY.add("editor/plugin/separator/index",function(d){function g(){}d.augment(g,{pluginRenderUI:function(g){d.all('<span class="'+g.get("prefixCls")+'editor-toolbar-separator">&nbsp;</span>').appendTo(g.get("toolBarEl"))}});return g},{requires:["editor"]});
KISSY.add("editor/plugin/smiley/index",function(d,g,j){function h(){}for(var f="<div class='{prefixCls}editor-smiley-sprite'>",a=0;98>=a;a++)f+="<a href='javascript:void(0)' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+a+".gif'></a>";f+="</div>";d.augment(h,{pluginRenderUI:function(a){var c=a.get("prefixCls");a.addButton("smiley",{tooltip:"\u63d2\u5165\u8868\u60c5",checkable:!0,listeners:{afterSyncUI:function(){var a=this;a.on("blur",function(){setTimeout(function(){a.smiley&&a.smiley.hide()},150)})},click:function(){var e=
this,h;if(e.get("checked")){if(!(h=e.smiley))h=e.smiley=(new j({content:d.substitute(f,{prefixCls:c}),focus4e:!1,width:300,elCls:c+"editor-popup",zIndex:g.baseZIndex(g.zIndexManager.POPUP_MENU),mask:!1})).render(),h.get("el").on("click",function(c){var c=new d.Node(c.target),e;if("a"==c.nodeName()&&(e=c.attr("data-icon")))e=new d.Node("<img alt='' src='"+e+"'/>",null,a.get("document")[0]),a.insertElement(e)}),h.on("hide",function(){e.set("checked",!1)});h.set("align",{node:this.get("el"),points:["bl",
"tl"],overflow:{adjustX:1,adjustY:1}});h.show()}else e.smiley&&e.smiley.hide()},destroy:function(){this.smiley&&this.smiley.destroy()}},mode:g.WYSIWYG_MODE})}});return h},{requires:["editor","../overlay/"]});
KISSY.add("editor/plugin/source-area/index",function(d,g){function j(){}var h=g.SOURCE_MODE,f=g.WYSIWYG_MODE;d.augment(j,{pluginRenderUI:function(a){a.addButton("sourceArea",{tooltip:"\u6e90\u7801",listeners:{afterSyncUI:function(){var b=this;a.on("wysiwygMode",function(){b.set("checked",!1)});a.on("sourceMode",function(){b.set("checked",!0)})},click:function(){this.get("checked")?a.set("mode",h):a.set("mode",f)}},checkable:!0})}});return j},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/strike-through/cmd",function(d,g,j){var h=new g.Style({element:"del",overrides:[{element:"span",attributes:{style:"text-decoration: line-through;"}},{element:"s"},{element:"strike"}]});return{init:function(d){j.addButtonCmd(d,"strikeThrough",h)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/strike-through/index",function(d,g,j,h){function f(){}d.augment(f,{pluginRenderUI:function(a){h.init(a);a.addButton("strikeThrough",{cmdType:"strikeThrough",tooltip:"\u5220\u9664\u7ebf "},j.Button)}});return f},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/table/index",function(d,g,j){function h(a){function c(a){!(0<e.length)&&a[0].nodeType==n.NodeType.ELEMENT_NODE&&t.test(a.nodeName())&&!a.data("selected_cell")&&(a._4e_setMarker(f,"selected_cell",!0,void 0),e.push(a))}for(var b=a.createBookmarks(),d=a.getRanges(),e=[],f={},h=0;h<d.length;h++){var i=d[h];if(i.collapsed)i=i.getCommonAncestor(),(i=i.closest("td",void 0)||i.closest("th",void 0))&&e.push(i);else{var i=new Walker(i),j;for(i.guard=c;j=i.next();)if((j=j.parent())&&
t.test(j.nodeName())&&!j.data("selected_cell"))j._4e_setMarker(f,"selected_cell",!0,void 0),e.push(j)}}g.Utils.clearAllMarkers(f);a.selectBookmarks(b);return e}function f(a,c){var b=a.getStartElement().parent("tr");if(b){var d=b.clone(!0);d.insertBefore(b);b=(c?d[0]:b[0]).cells;for(d=0;d<b.length;d++)b[d].innerHTML="",r.ie||(new m(b[d]))._4e_appendBogus(void 0)}}function a(c){if(c instanceof g.Selection){for(var b=h(c),d=b.length,c=[],e,f,i=0;i<d;i++){var j=b[i].parent(),k=j[0].rowIndex;!i&&(e=k-
1);c[k]=j;i==d-1&&(f=k+1)}i=j.parent("table");e=new m(f<i[0].rows.length&&i[0].rows[f]||0<e&&i[0].rows[e]||i[0].parentNode);for(i=c.length;0<=i;i--)c[i]&&a(c[i]);return e}c instanceof m&&(i=c.parent("table"),1==i[0].rows.length?i.remove():c.remove());return 0}function b(a,c){var b=a.getStartElement();if(b=b.closest("td",void 0)||b.closest("th",void 0))for(var d=b.parent("table"),e=b[0].cellIndex,f=0;f<d[0].rows.length;f++){var g=d[0].rows[f];g.cells.length<e+1||(b=new m(g.cells[e].cloneNode(void 0)),
r.ie||b._4e_appendBogus(void 0),g=new m(g.cells[e]),c?b.insertBefore(g):b.insertAfter(g))}}function c(b){if(b instanceof g.Selection){var d=h(b),e,f=[],b=d[0]&&d[0].parent("table"),i,j,k;i=0;for(j=d.length;i<j;i++)f.push(d[i][0].cellIndex);f.sort();i=1;for(j=f.length;i<j;i++)if(1<f[i]-f[i-1]){k=f[i-1]+1;break}k||(k=0<f[0]?f[0]-1:f[f.length-1]+1);f=b[0].rows;i=0;for(j=f.length;i<j&&!(e=f[i].cells[k]);i++);e=e?new m(e):b.prev();for(k=d.length-1;0<=k;k--)d[k]&&c(d[k]);return e}if(b instanceof m){d=b.parent("table");
if(!d)return null;e=b[0].cellIndex;for(k=d[0].rows.length-1;0<=k;k--)b=new m(d[0].rows[k]),!e&&1==b[0].cells.length?a(b):b[0].cells[e]&&b[0].removeChild(b[0].cells[e])}return null}function e(a,c){var b=new g.Range(a[0].ownerDocument);if(!b.moveToElementEditablePosition(a,c?!0:void 0))b.selectNodeContents(a),b.collapse(c?!1:!0);b.select(!0)}function k(a){var c=(a=a.getSelection())&&a.getStartElement(),b=c&&c.closest("table",void 0);if(b)return a=c.closest(function(a){var c=n.nodeName(a);return b.contains(a)&&
("td"==c||"th"==c)},void 0),c=c.closest(function(a){var c=n.nodeName(a);return b.contains(a)&&"tr"==c},void 0),{table:b,td:a,tr:c}}function i(a){return(a=k(a))&&a.td}function o(a){return(a=k(a))&&a.tr}function s(a){this.config=a||{}}var r=d.UA,n=d.DOM,m=d.Node,q=["tr","th","td","tbody","table"],t=/^(?:td|th)$/,l={"\u8868\u683c\u5c5e\u6027":k,"\u5220\u9664\u8868\u683c":i,"\u5220\u9664\u5217":i,"\u5220\u9664\u884c":o,"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":o,"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":o,"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":i,"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":i},u=(6===r.ie?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:" table.%2,; table.%2 > tr > td,  table.%2 > tr > th,; table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,; table.%2 > thead > tr > td,  table.%2 > thead > tr > th,; table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th;{;border : #d3d3d3 1px dotted;}".split(";")).join("").replace(/%2/g,
"ke_show_border"),p={tags:{table:function(a){var c=a.getAttribute("class"),b=parseInt(a.getAttribute("border"),10);if(!b||0>=b)a.setAttribute("class",d.trim((c||"")+" ke_show_border"))}}},w={tags:{table:function(a){var c=a.getAttribute("class");c&&((c=d.trim(c.replace("ke_show_border","")))?a.setAttribute("class",c):a.removeAttribute("class"))}}};d.augment(s,{pluginRenderUI:function(h){h.addCustomStyle(u);var i=h.htmlDataProcessor,m=i&&i.htmlFilter;(i&&i.dataFilter).addRules(p);m.addRules(w);var r=
this,o={"\u8868\u683c\u5c5e\u6027":function(){this.hide();var a=k(h);a&&j.useDialog(h,"table",r.config,{selectedTable:a.table,selectedTd:a.td})},"\u5220\u9664\u8868\u683c":function(){this.hide();var a=h.getSelection(),c=a&&a.getStartElement();if(c=c&&c.closest("table",void 0)){h.execCommand("save");a.selectElement(c);var b=a.getRanges()[0];b.collapse();a.selectRanges([b]);a=c.parent();1==a[0].childNodes.length&&"body"!=a.nodeName()&&"td"!=a.nodeName()?a.remove():c.remove();h.execCommand("save")}},"\u5220\u9664\u884c ":function(){this.hide();h.execCommand("save");
var c=h.getSelection();e(a(c),void 0);h.execCommand("save")},"\u5220\u9664\u5217 ":function(){this.hide();h.execCommand("save");var a=h.getSelection();(a=c(a))&&e(a,!0);h.execCommand("save")},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(){this.hide();h.execCommand("save");var a=h.getSelection();f(a,!0);h.execCommand("save")},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(){this.hide();h.execCommand("save");var a=h.getSelection();f(a,void 0);h.execCommand("save")},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(){this.hide();h.execCommand("save");var a=h.getSelection();b(a,!0);h.execCommand("save")},
"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(){this.hide();h.execCommand("save");var a=h.getSelection();b(a,void 0);h.execCommand("save")}},s=[];d.each(o,function(a,c){s.push({content:c})});h.addContextMenu("table",function(a){if(d.inArray(n.nodeName(a),q))return!0},{width:"120px",children:s,listeners:{click:function(a){a=a.target.get("content");o[a]&&o[a].apply(this)},beforeVisibleChange:function(a){if(a.newVal){var c=this,a=c.get("children"),b=c.get("editor");d.each(a,function(a){var d=a.get("content");!l[d]||l[d].call(c,
b)?a.set("disabled",!1):a.set("disabled",!0)})}}}});h.addButton("table",{mode:g.WYSIWYG_MODE,listeners:{click:function(){j.useDialog(h,"table",r.config,{selectedTable:0,selectedTd:0})}},tooltip:"\u63d2\u5165\u8868\u683c"})}});return s},{requires:["editor","../dialog-loader/","../contextmenu/"]});
KISSY.add("editor/plugin/underline/cmd",function(d,g,j){var h=new g.Style({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]});return{init:function(d){j.addButtonCmd(d,"underline",h)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/underline/index",function(d,g,j,h){function f(){}d.augment(f,{pluginRenderUI:function(a){h.init(a);a.addButton("underline",{cmdType:"underline",tooltip:"\u4e0b\u5212\u7ebf "},j.Button);a.docReady(function(){a.get("document").on("keydown",function(b){b.ctrlKey&&b.keyCode==d.Node.KeyCodes.U&&(a.execCommand("underline"),b.preventDefault())})})}});return f},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/undo/btn",function(d,g,j){d=j.extend({__lock:!0,bindUI:function(){var d=this,f=d.get("editor");d.on("click",function(){f.execCommand("undo")});f.on("afterUndo afterRedo afterSave",function(a){0<a.index?d.set("disabled",d.__lock=!1):d.set("disabled",d.__lock=!0)})}},{ATTRS:{mode:{value:g.WYSIWYG_MODE},disabled:{value:!0,setter:function(d){this.__lock&&(d=!0);return d}}}});return{RedoBtn:j.extend({__lock:!0,bindUI:function(){var d=this,f=d.get("editor");d.on("click",function(){f.execCommand("redo")});
f.on("afterUndo afterRedo afterSave",function(a){a.index<a.history.length-1?d.set("disabled",d.__lock=!1):d.set("disabled",d.__lock=!0)})}},{ATTRS:{mode:{value:g.WYSIWYG_MODE},disabled:{value:!0,setter:function(d){this.__lock&&(d=!0);return d}}}}),UndoBtn:d}},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/undo/cmd",function(d,g){function j(a){var b=a.get("document")[0].body.innerHTML,d;b&&(d=a.getSelection());this.contents=b;this.bookmarks=d&&d.createBookmarks2(!0)}function h(a){this.history=[];this.index=-1;this.editor=a;this.bufferRunner=d.buffer(this.save,500,this);this._init()}var f=d.UA;d.augment(j,{equals:function(a){return this.contents==a.contents}});var a={16:1,17:1,18:1},b={37:1,38:1,39:1,40:1,33:1,34:1};d.augment(h,{_keyMonitor:function(){var c=this,d=c.editor;d.docReady(function(){d.get("document").on("keydown",
function(f){var g=f.keyCode;g in b||g in a||(90===g&&(f.ctrlKey||f.metaKey)?(!1!==d.fire("beforeRedo")&&c.restore(-1),f.halt()):89===g&&(f.ctrlKey||f.metaKey)?(!1!==d.fire("beforeUndo")&&c.restore(1),f.halt()):!1!==d.fire("beforeSave",{buffer:1})&&c.save(1))})})},_init:function(){var a=this,b=a.editor;a._keyMonitor();setTimeout(function(){if(b.get("mode")==g.WYSIWYG_MODE)if(b.isDocReady())a.save();else b.on("docReady",function(){a.save();b.detach("docReady",arguments.callee)})},0)},save:function(a){var b=
this.editor;if(b.get("mode")==g.WYSIWYG_MODE&&b.get("document"))if(a)this.bufferRunner();else{var a=this.history,d=a.length,f=this.index,d=Math.min(d,f+1),f=a[d-1],h=new j(b);if(!f||!f.equals(h))a.length=d,30===d&&(a.shift(),d--),a.push(h),this.index=f=d,b.fire("afterSave",{history:a,index:f})}},restore:function(a){if(this.editor.get("mode")==g.WYSIWYG_MODE){var b=this.history,d=this.editor,h=d.get("document")[0].body,j=b[this.index+a];j&&(h.innerHTML=j.contents,j.bookmarks?d.getSelection().selectBookmarks(j.bookmarks):
f.ie&&(h=h.createTextRange(),h.collapse(!0),h.select()),(h=d.getSelection())&&h.scrollIntoView(),this.index+=a,d.fire(0>a?"afterUndo":"afterRedo",{history:b,index:this.index}),d.notifySelectionChange());return j}}});return{init:function(a){if(!a.hasCommand("save")){var b=new h(a);a.addCommand("save",{exec:function(d,f){a.focus();b.save(f)}});a.addCommand("undo",{exec:function(){a.focus();b.restore(-1)}});a.addCommand("redo",{exec:function(){a.focus();b.restore(1)}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/undo/index",function(d,g,j,h){function f(){}d.augment(f,{pluginRenderUI:function(a){a.addButton("undo",{mode:g.WYSIWYG_MODE,tooltip:"\u64a4\u9500",editor:a},j.UndoBtn);a.addButton("redo",{mode:g.WYSIWYG_MODE,tooltip:"\u91cd\u505a",editor:a},j.RedoBtn);h.init(a)}});return f},{requires:["editor","./btn","./cmd"]});
KISSY.add("editor/plugin/unordered-list/cmd",function(d,g,j){var h=j.queryActive,f=new j.ListCommand("ul");return{init:function(a){a.hasCommand("insertUnorderedList")||a.addCommand("insertUnorderedList",{exec:function(a,b){a.focus();f.exec(a,b)}});var b=g.Utils.getQueryCmd("insertUnorderedList");a.hasCommand(b)||a.addCommand(b,{exec:function(a){if((a=a.getSelection())&&!a.isInvalid)return a=a.getStartElement(),a=new g.ElementPath(a),h("ul",a)}})}}},{requires:["editor","../list-utils/cmd"]});
KISSY.add("editor/plugin/unordered-list/index",function(d,g,j,h){function f(){}d.augment(f,{pluginRenderUI:function(a){h.init(a);j.init(a,{cmdType:"insertUnorderedList",buttonId:"unorderedList",menu:{width:75,children:[{content:"\u25cf \u5706\u70b9",value:"disc"},{content:"\u25cb \u5706\u5708",value:"circle"},{content:"\u25a0 \u65b9\u5757",value:"square"}]},tooltip:"\u65e0\u5e8f\u5217\u8868"})}});return f},{requires:["editor","../list-utils/btn","./cmd"]});
KISSY.add("editor/plugin/video/index",function(d,g,j,h,f){function a(a){this.config=a}d.augment(a,{pluginRenderUI:function(a){function c(a){for(var b=0;b<i.length;b++){var c=i[b];if(c.reg.test(a))return c}}f.init(a);var d=a.htmlDataProcessor,k=d&&d.dataFilter,i=[],o=this.config;o.providers&&i.push.apply(i,o.providers);o.getProvider=c;k&&k.addRules({tags:{object:function(a){var b=a.getAttribute("classid"),f=a.childNodes;if(!b){for(b=0;b<f.length;b++)if("embed"==f[b].nodeName){if(!j.isFlashEmbed(f[b]))break;
if(c(f[b].getAttribute("src")))return d.createFakeParserElement(a,"ke_video","video",!0)}return null}for(b=0;b<f.length;b++){var g=f[b];if("param"==g.nodeName&&"movie"==g.getAttribute("name").toLowerCase()&&c(g.getAttribute("value")||g.getAttribute("VALUE")))return d.createFakeParserElement(a,"ke_video","video",!0)}},embed:function(a){if(!j.isFlashEmbed(a))return null;if(c(a.getAttribute("src")))return d.createFakeParserElement(a,"ke_video","video",!0)}}},4);var s=new h({editor:a,cls:"ke_video",type:"video",
pluginConfig:this.config,bubbleId:"video",contextMenuId:"video",contextMenuHandlers:{"\u89c6\u9891\u5c5e\u6027":function(){var a=this.get("editorSelectedEl");a&&s.show(a)}}});a.addButton("video",{tooltip:"\u63d2\u5165\u89c6\u9891",listeners:{click:function(){s.show()}},mode:g.WYSIWYG_MODE})}});return a},{requires:["editor","../flash-common/utils","../flash-common/baseClass","../fake-objects/"]});
KISSY.add("editor/plugin/xiami-music/index",function(d,g,j,h,f){function a(){a.superclass.constructor.apply(this,arguments)}function b(a){this.config=a||{}}d.extend(a,j,{_updateTip:function(a,b){var d=this.get("editor").restoreRealElement(b);d&&(a.html(b.attr("title")),a.attr("href",this._getFlashUrl(d)))}});d.augment(b,{pluginRenderUI:function(b){function d(a){return/xiami\.com/i.test(a)}f.init(b);var j=b.htmlDataProcessor,i=j&&j.dataFilter;i&&i.addRules({tags:{object:function(a){var b=a.getAttribute("title"),
c,f;c=a.getAttribute("classid");var g=a.childNodes;if(!c){for(c=0;c<g.length;c++)if(f=g[c],"embed"==f.nodeName){if(!h.isFlashEmbed(f))break;if(d(f.attributes.src))return j.createFakeParserElement(a,"ke_xiami","xiami-music",!0,{title:b})}return null}for(c=0;c<g.length;c++)if(f=g[c],"param"==f.nodeName&&"movie"==f.getAttribute("name").toLowerCase()&&d(f.getAttribute("value")||f.getAttribute("VALUE")))return j.createFakeParserElement(a,"ke_xiami","xiami-music",!0,{title:b})},embed:function(a){if(h.isFlashEmbed(a)&&
d(a.getAttribute("src")))return j.createFakeParserElement(a,"ke_xiami","xiami-music",!0,{title:a.getAttribute("title")})}}},4);var o=new a({editor:b,cls:"ke_xiami",type:"xiami-music",bubbleId:"xiami",pluginConfig:this.config,contextMenuId:"xiami",contextMenuHandlers:{"\u867e\u7c73\u5c5e\u6027":function(){var a=this.get("editorSelectedEl");a&&o.show(a)}}});b.addButton("xiamiMusic",{tooltip:"\u63d2\u5165\u867e\u7c73\u97f3\u4e50",listeners:{click:function(){o.show()}},mode:g.WYSIWYG_MODE})}});return b},{requires:["editor","../flash-common/baseClass",
"../flash-common/utils","../fake-objects/"]});KISSY.add("editor/full",function(d,g){return g},{requires:["editor"]});
