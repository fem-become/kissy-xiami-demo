/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 21 10:33
*/
/*
 thanks to CKSource's intelligent work on CKEditor
 @author yiminghe@gmail.com
*/
KISSY.add("editor/core/base",function(a,i,s){i=s.Controller.extend({initializer:function(){this.__commands={};this.__controls={}}},{Config:{},XHTML_DTD:i.DTD,ATTRS:{textarea:{},iframe:{},window:{},document:{},toolBarEl:{},statusBarEl:{},handleMouseEvents:{value:!1},focusable:{value:!1},mode:{value:1},data:{getter:function(a){var i=this._getData();return void 0===i?a:i}},formatData:{getter:function(){return this._getData(1)}},customStyle:{value:""},customLink:{value:[]}}},{xclass:"editor"});i.HTML_PARSER=
{textarea:function(a){return a.one("."+this.get("prefixCls")+"editor-textarea")},data:function(a){return a.one("."+this.get("prefixCls")+"editor-textarea").val()}};a.mix(i,a.EventTarget);return KISSY.Editor=i},{requires:["htmlparser","component/base","core"]});
KISSY.add("editor/core/clipboard",function(a,i,s,q){function p(a){this.editor=a;this._init()}function e(a){var c=a.get("document")[0],b=a.getSelection(),r;if(b.getType()==q.SELECTION_ELEMENT&&(r=b.getSelectedElement())){var a=b.getRanges()[0],d=g(c.createTextNode(""));d.insertBefore(r);a.setStartBefore(d);a.setEndAfter(r);b.selectRanges([a]);setTimeout(function(){r.parent()&&(d.remove(),b.selectElement(r))},0)}}var g=a.all,l=a.UA,n=l.ie?"beforepaste":"paste",m=i.RANGE;a.augment(p,{_init:function(){var a=
this,c=a.editor,b=c.get("document"),r=b.one("body"),d=function(d){this.type=d};d.prototype={exec:function(d){var b=this.type;d.focus();setTimeout(function(){l.ie&&("cut"==b?e(d):"paste"==b&&(a._preventPasteEvent(),a._getClipboardDataFromPasteBin()));o(d,b)||alert(v[b])},0)}};r.on(n,a._getClipboardDataFromPasteBin,a);l.ie&&(r.on("paste",a._iePaste,a),b.on("keydown",a._onKeyDown,a),b.on("contextmenu",function(){a._isPreventBeforePaste=1;setTimeout(function(){a._isPreventBeforePaste=0},0)}));c.addCommand("copy",
new d("copy"));c.addCommand("cut",new d("cut"));c.addCommand("paste",new d("paste"))},_onKeyDown:function(a){this.editor.get("mode")==i.Mode.WYSIWYG_MODE&&(a.ctrlKey&&86==a.keyCode||a.shiftKey&&45==a.keyCode)&&this._preventPasteEvent()},_stateFromNamedCommand:function(a){var c,b=this.editor;if("paste"==a){this._isPreventBeforePaste=1;try{c=b.get("document")[0].queryCommandEnabled(a)}catch(r){}this._isPreventBeforePaste=0}else c=(a=(a=b.getSelection())&&a.getRanges())&&!(1==a.length&&a[0].collapsed);
return c},_preventPasteEvent:function(){var a=this;a._preventPasteTimer&&clearTimeout(a._preventPasteTimer);a._isPreventPaste=1;a._preventPasteTimer=setTimeout(function(){a._isPreventPaste=0},70)},_iePaste:function(a){var c=this.editor;this._isPreventPaste||(a.preventDefault(),c.execCommand("paste"))},_getClipboardDataFromPasteBin:function(){if(!this._isPreventBeforePaste){var j=this.editor,c=j.get("document")[0];if(!c.getElementById("ke_pastebin")){var b=j.getSelection(),r=new s(c),d=g(l.webkit?
"<body></body>":c.createElement("div"),null,c);d.attr("id","ke_pastebin");l.webkit&&d[0].appendChild(c.createTextNode("\u00a0"));c.body.appendChild(d[0]);d.css({position:"absolute",top:b.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});d.css("left","-1000px");var h=b.createBookmarks();r.setStartAt(d,m.POSITION_AFTER_START);r.setEndAt(d,m.POSITION_BEFORE_END);r.select(!0);setTimeout(function(){var c,k=d;d=l.webkit&&(c=d.first())&&c.hasClass("Apple-style-span")?c:d;b.selectBookmarks(h);
var u=d.html();k.remove();if(u=a.trim(u.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,"")))c=j.fire("paste",{html:u}),!1!==c&&(void 0!==c&&(u=c),/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(u)?a.use("editor/plugin/word-filter",function(d,b){j.insertHTML(b.toDataFormat(u,j))}):j.insertHTML(u))},0)}}}});var w=function(a,c){var b=a.get("document")[0],r=g(b.body),d=!1,h=function(){d=!0};r.on(c,h);(7<l.ie?b:b.selection.createRange()).execCommand(c);r.detach(c,h);return d},o=l.ie?
function(a,c){return w(a,c)}:function(a,c){try{return a.get("document")[0].execCommand(c)}catch(b){return!1}},v={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},y={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};return{init:function(a){var c;a.docReady(function(){c=new p(a)});var b={copy:1,cut:1,paste:1},r=["copy","cut","paste"];a.on("contextmenu",function(d){var h=d.contextmenu;if(!h.__copy_fix){h.__copy_fix=
1;for(d=0;d<r.length;d++)h.addChild({content:y[r[d]],value:r[d]});h.on("click",function(d){var c=d.target.get("value");b[c]&&(h.hide(),setTimeout(function(){a.execCommand("save");a.execCommand(c);setTimeout(function(){a.execCommand("save")},10)},30))})}for(var f=h.get("children"),d=f.length-1;d--;0<=d){var k=f[d],u;u=k.get?k.get("value"):k.value;b[u]&&(u=!c._stateFromNamedCommand(u),k.set?k.set("disabled",u):k.disabled=u)}})}}},{requires:["./base","./range","./selection"]});
KISSY.add("editor/core",function(a,i,s,q,p,e,g,l,n,m){function w(b,a){var f=b.body;E(function(){b.designMode="on";setTimeout(function(){b.designMode="off";f.focus();arguments.callee.retry||(arguments.callee.retry=c)},50)},function(){b.designMode="off";u.attr(f,"contentEditable",d);u.attr(f,"contentEditable",c);!a&&w(b,1)})}function o(b){b.get("iframe");var c=b.get("textarea")[0],t=b.get("window")[0],h=b.get("document")[0];f.webkit&&(z.on(h,"click",function(b){var d=new C(b.target);a.inArray(d.nodeName(),
["input","select"])&&b.preventDefault()}),z.on(h,"mouseup",function(b){var d=new C(b.target);a.inArray(d.nodeName(),["input","textarea"])&&b.preventDefault()}));if(f.gecko||k||f.opera){var x;x=(new C('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>')).insertAfter(c);x.on("focus",function(){b.focus()});b.activateGecko=function(){f.gecko&&b.__iframeFocus&&x[0].focus()};b.on("destroy",function(){x.detach();x.remove()})}z.on(t,"focus",function(){f.gecko?w(h,d):f.opera&&
h.body.focus();b.notifySelectionChange()});if(f.gecko)z.on(h,"mousedown",function(){b.__iframeFocus||w(h,d)});if(k&&(z.on(h,"keydown",function(d){if(d.keyCode in{8:1,46:1}){var c=b.getSelection(),a=c.getSelectedElement();if(a){b.execCommand("save");var f=c.getRanges()[0].createBookmark();a.remove();c.selectBookmarks([f]);b.execCommand("save");d.preventDefault()}}}),"CSS1Compat"==h.compatMode)){var u={33:1,34:1};z.on(h,"keydown",function(d){d.keyCode in u&&setTimeout(function(){b.getSelection().scrollIntoView()},
0)})}if(f.webkit)z.on(h,"mousedown",function(d){d=new C(d.target);a.inArray(d.nodeName(),["img","hr","input","textarea","select"])&&b.getSelection().selectElement(d)});if(f.gecko)z.on(h,"dragstart",function(b){var d=new C(b.target);d.nodeName()==="img"&&/ke_/.test(d[0].className)&&b.preventDefault()});q.add(b)}function v(b,d,c,f){var k="",x,r=s.debugUrl("theme/editor-iframe.css");for(x=0;x<c.length;x++)k+=a.substitute('<link href="{href}" rel="stylesheet" />',{href:c[x]});return a.substitute(t,{doctype:8===
h.documentMode?'<meta http-equiv="X-UA-Compatible" content="IE=7" />':"",title:"${title}",href:r,style:d,data:f||"&nbsp;",script:b?'<script id="ke_active_script">'+(u.isCustomDomain()?'document.domain="'+h.domain+'";':"")+'parent.KISSY.Editor._initIFrame("'+b+'");<\/script>':""})}function y(b,d){function c(){x=h.document;b.setInternal("document",new C(x));b.setInternal("window",new C(h));a.detach();x.open("text/html","replace");x.write(f);x.close()}var a=b.get("iframe"),f=v(b._UUID,b.get("customStyle"),
b.get("customLink"),d),t=a[0],h=t.contentWindow,x;a.__loaded=1;try{x=h.document}catch(u){if(t.src=t.src,7>k){setTimeout(c,10);return}}c()}function j(b,d){var c=u.getEmptyIframeSrc()||"";c&&(c=' src="'+c+'" ');var c=new C(a.substitute(D,{iframeSrc:c})),t=b.get("textarea");t.hasAttr("tabindex")&&c.attr("tabindex",f.webkit?-1:t.attr("tabindex"));t.parent().prepend(c);b.set("iframe",c);b.__docReady=0;if(f.gecko&&!c.__loaded)c.on("load",function(){y(b,d)},b);else y(b,d)}var c=!0,b=b,r=a.all,d=!1,h=document,
f=a.UA,k=f.ie,u=a.DOM,B=u.NodeType,C=a.Node,z=a.Event,E=s.tryThese,t='<!doctype html><html><head>{doctype}<title>{title}</title><link href="{href}" rel="stylesheet" /><style>{style}</style>{links}</head><body class="ks-editor" >{data}{script}</body></html>',D='<iframe style="width:100%;height:100%;border:none;"  frameborder="0"  title="kissy-editor"  allowTransparency="true"  {iframeSrc} ></iframe>',x=/^(?:<(p)>)?(?:(?:&nbsp;)|\s)*(?:<\/\1>)?$/i,O='<div class="{prefixCls}editor-tools"></div><div class="{prefixCls}editor-textarea-wrap" '+
(f.mobile?'style="overflow:scroll;-webkit-overflow-scrolling:touch;"':"")+'></div><div class="{prefixCls}editor-status"></div>';i.Mode={SOURCE_MODE:0,WYSIWYG_MODE:1};a.augment(i,{createDom:function(){var b,d=this.get("prefixCls"),c=this.get("textarea"),f;c?(this.set("textarea",c=r(c)),c[0].parentNode&&c.remove()):(b=this.get("data"),this.set("textarea",c=r('<textarea class="'+d+'-editor-textarea"></textarea>')),c.val(b));f=this.get("el");f.html(a.substitute(O,{prefixCls:d}));b=f.one(a.substitute(".{prefixCls}editor-textarea-wrap",
{prefixCls:d}));this._UUID=a.guid();this.set({toolBarEl:f.one(a.substitute(".{prefixCls}editor-tools",{prefixCls:d})),statusBarEl:f.one(a.substitute(".{prefixCls}editor-status",{prefixCls:d}))},{silent:1});c.css("width","100%");c.css("display","none");b.append(c);q.register(this)},renderUI:function(){g.init(this);l.init(this);n.init(this);m.init(this)},bindUI:function(){function b(){d.detach("docReady",b);if(d.get("focused"))d.focus();else{var c=d.getSelection();c&&c.removeAllRanges()}}var d=this,
c,a=d.get("prefixCls"),f=d.get("textarea");if(d.get("attachForm")&&(c=f[0].form))z.on(c,"submit",d.sync,d);d.on("docReady",b);d.on("blur",function(){d.get("el").removeClass(a+"editor-focused")});d.on("focus",function(){d.get("el").addClass(a+"editor-focused")})},syncUI:function(){this.get("rendered")&&this.get("textarea").val(this.get("data"))},_onSetHeight:function(b){var d=this.get("textarea"),c=this.get("toolBarEl"),a=this.get("statusBarEl"),b=parseInt(b,10),b=b-((c&&c.outerHeight()||0)+(a&&a.outerHeight()||
0));d.parent().css("height",b);d.css("height",b)},_onSetMode:function(b){this.get("rendered");var d=this.get("iframe"),c=this.get("textarea");1==b?(this._setData(c.val()),c.hide(),this.fire("wysiwygMode")):(d&&(c.val(this._getData(1,1)),d.hide()),c.show(),this.fire("sourceMode"))},_onSetFocused:function(b){b&&this.__docReady&&this.focus()},_onSetData:function(b){this.get("rendered")&&this._setData(b)},destructor:function(){var b,d=this.get("textarea"),c=this.get("document")[0],f=this.get("window");
this.get("attachForm")&&(b=d[0].form)&&z.detach(b,"submit",this.sync,this);q.remove(this);z.remove([c,c.documentElement,c.body,f[0]]);a.each(this.__controls,function(b){b.destroy&&b.destroy()});this.__commands={};this.__controls={}},getControl:function(b){return this.__controls[b]},getControls:function(){return this.__controls},addControl:function(b,d){this.__controls[b]=d},showDialog:function(b,d){var b=b+"/dialog",c=this.__controls[b];c.show(d);this.fire("dialogShow",{dialog:c.dialog,pluginDialog:c,
dialogName:b})},addCommand:function(b,d){this.__commands[b]=d},hasCommand:function(b){return this.__commands[b]},execCommand:function(d){var c=this.__commands[d],f=a.makeArray(arguments);f.shift();f.unshift(this);return c?c.exec.apply(c,f):b},queryCommandValue:function(b){return this.execCommand(s.getQueryCmd(b))},_getData:function(d,c){var f=this.htmlDataProcessor,t;if(!this.get("rendered"))return b;c==b&&(c=this.get("mode"));t=1==c&&this.isDocReady()?this.get("document")[0].body.innerHTML:f.toDataFormat(this.get("textarea").val());
t=d?f.toHTML(t):f.toServer(t);t=a.trim(t);x.test(t)&&(t="");return t},_setData:function(b){var d,c=b;if(1!=this.get("mode"))this.get("textarea").val(b);else{if(d=this.htmlDataProcessor)c=d.toDataFormat(b);if(this.get("iframe")){b=this.get("iframe");d=this.get("window")[0];var a=this.get("document")[0];z.remove([a,a.documentElement,a.body,d]);b.remove()}j(this,c)}},getDocHTML:function(){return v(0,this.get("customStyle"),this.get("customLink"),this.get("formatData"))},getDocHtml:function(){return this.getDocHTML()},
getSelection:function(){return i.Selection.getSelection(this.get("document")[0])},getSelectedHTML:function(){var b=this.getSelection().getRanges()[0],d;b&&(b=b.cloneContents(),d=this.get("document")[0].createElement("div"),d.appendChild(b),d=d.innerHTML);return d},focus:function(){var b=this.get("window");if(b){var d=this.get("document")[0],b=b[0];f.ie||b&&b.parent&&b.parent.focus();b&&b.focus();try{d.body.focus()}catch(c){}this.notifySelectionChange()}},blur:function(){this.get("window")[0].blur();
this.get("document")[0].body.blur()},addCustomStyle:function(b,d){var c=this.get("window"),a=this.get("customStyle")||"";this.set("customStyle",a+("\n"+b));c&&u.addStyleSheet(c,b,d)},removeCustomStyle:function(b){u.remove(u.get("#"+b,this.get("window")[0]))},addCustomLink:function(b){var d=this.get("customLink")||[],c=this.get("document")[0];d.push(b);this.set("customLink",d);d=c.createElement("link");d.rel="stylesheet";c.getElementsByTagName("head")[0].appendChild(d);d.href=b},removeCustomLink:function(b){for(var d=
this.get("document")[0],d=u.query("link",d),c=0;c<d.length;c++)u.attr(d[c],"href")==b&&u.remove(d[c]);d=this.get("customLink")||[];b=a.indexOf(b,d);-1!=b&&d.splice(b,1)},docReady:function(b){this.on("docReady",b);this.__docReady&&b.call(this)},isDocReady:function(){return this.__docReady},checkSelectionChange:function(){var b=this;b.__checkSelectionChangeId&&clearTimeout(b.__checkSelectionChangeId);b.__checkSelectionChangeId=setTimeout(function(){var d=b.getSelection();if(d&&!d.isInvalid){var c=d.getStartElement(),
a=new i.ElementPath(c);if(!b.__previousPath||!b.__previousPath.compare(a))b.__previousPath=a,b.fire("selectionChange",{selection:d,path:a,element:c})}},100)},notifySelectionChange:function(){this.__previousPath=null;this.checkSelectionChange()},insertElement:function(d){if(1!==this.get("mode"))return b;this.focus();var a,f=d.nodeName(),t=i.XHTML_DTD,h=t.$block[f],k=i.RANGE,x=(f=this.getSelection())&&f.getRanges(),u,r,D;if(!x||0==x.length)return b;this.execCommand("save");for(r=x.length-1;0<=r;r--)u=
x[r],a=!r&&d||d.clone(c),u.insertNodeByDtd(a),D||(D=a);if(!D)return b;u.moveToPosition(D,k.POSITION_AFTER_END);h&&(d=i.Walker.whitespaces(!0),(d=(D=D.next(d,1))&&D[0].nodeType==B.ELEMENT_NODE&&D.nodeName())&&t.$block[d]&&t[d]["#text"]&&u.moveToElementEditablePosition(D));f.selectRanges([u]);this.focus();a&&1==a[0].nodeType&&a.scrollIntoView(b,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0});G.call(this);return a},insertHTML:function(c,a){var f=this,t,h=f.get("document")[0];if(1===
f.get("mode")){if(t=f.htmlDataProcessor)c=t.toDataFormat(c,a);f.focus();f.execCommand("save");if(k){t=h.selection;"Control"==t.type&&t.clear();try{t.createRange().pasteHTML(c)}catch(x){}}else try{h.execCommand("inserthtml",d,c)}catch(r){setTimeout(function(){if(0==f.getSelection().getRanges().length){var a=new i.Range(h),t=u.first(h.body,function(b){return 1==b.nodeType&&"br"!=u.nodeName(b)});t||(t=new C(h.createElement("p")),t._4e_appendBogus(b),h.body.appendChild(t[0]));a.setStartAt(t,i.RANGE.POSITION_AFTER_START);
a.select()}h.execCommand("inserthtml",d,c)},50)}setTimeout(function(){f.getSelection().scrollIntoView()},50);G.call(f)}},insertHtml:function(b,d){this.insertHTML(b,d)}});i._initIFrame=function(b){var a=q.getInstance(b),t=a.get("document")[0],b=t.getElementById("ke_active_script");u.remove(b);o(a);var h=t.body;k?(h.hideFocus=c,h.disabled=c,h.contentEditable=c,h.removeAttribute("disabled")):setTimeout(function(){f.gecko||f.opera?h.contentEditable=c:f.webkit?h.parentNode.contentEditable=c:t.designMode=
"on"},0);if(f.gecko||f.opera){var x=t.documentElement;z.on(x,"mousedown",function(b){if(b.target==x){f.gecko&&w(t,d);a.activateGecko()}})}setTimeout(function(){k&&setTimeout(function(){if(t){h.runtimeStyle.marginBottom="0px";h.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){a.__docReady=1;a.fire("docReady");var b=a.get("disableObjectResizing"),c=a.get("disableInlineTableEditing");if(b||c)try{t.execCommand("enableObjectResizing",d,!b);t.execCommand("enableInlineTableEditing",d,!c)}catch(f){z.on(h,
k?"resizestart":"resize",function(d){var a=new C(d.target);(b||a.nodeName()==="table"&&c)&&d.preventDefault()})}},10)};var G=a.buffer(function(){this.execCommand("save")},50);return i},{requires:"editor/core/base,editor/core/utils,editor/core/focusManager,editor/core/styles,editor/core/zIndexManager,editor/core/clipboard,editor/core/enterKey,editor/core/htmlDataProcessor,editor/core/selectionFix".split(",")});
KISSY.add("editor/core/dom",function(a,i,s){function q(c,b){var a=c[b?"next":"prev"](p,1);if(a&&a[0].nodeType==l.ELEMENT_NODE){for(var d=[];a.attr("_ke_bookmark")||a._4e_isEmptyInlineRemovable(p);)if(d.push(a),a=b?a.next(p,1):a.prev(p,1),!a)return;if(c._4e_isIdentical(a,p)){for(var h=new m(b?c[0].lastChild:c[0].firstChild);d.length;)d.shift()._4e_move(c,!b,p);a._4e_moveChildren(c,!b,p);a.remove();h[0]&&h[0].nodeType==l.ELEMENT_NODE&&h._4e_mergeSiblings()}}}var p=p,e=i.XHTML_DTD,g=a.DOM,l=g.NodeType,
n=a.UA,m=a.Node,w={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};i.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var o=i.POSITION,v={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,
"table-column":1,"table-cell":1,"table-caption":1},y={hr:1},j=function(c){return c&&(c[0]||c)};s.injectDom({_4e_sameLevel:function(c,b){var b=j(b),a=c.parentNode;return a&&a==b.parentNode},_4e_isBlockBoundary:function(c,b){var r=a.merge(y,b);return!(!v[g.css(c,"display")]&&!r[g.nodeName(c)])},_4e_index:function(c,b){for(var a=c.parentNode.childNodes,d,h=-1,f=0;f<a.length;f++)if(d=a[f],!b||!(3==d.nodeType&&d.previousSibling&&3==d.previousSibling.nodeType))if(h++,d===c)return h;return-1},_4e_move:function(c,
b,a){b=j(b);a?b.insertBefore(c,b.firstChild):b.appendChild(c)},_4e_isIdentical:function(c,b){if(!b)return!1;b=j(b);if(g.nodeName(c)!=g.nodeName(b))return!1;var a=c.attributes,d=b.attributes,h=a.length,f=d.length;if(h!=f)return!1;for(var k=0;k<h;k++){var u=a[k],e=u.name;if(u.specified&&g.attr(c,e)!=g.attr(b,e))return!1}if(8>s.ieEngine)for(k=0;k<f;k++)if(u=d[k],e=u.name,u.specified&&g.attr(c,e)!=g.attr(b,e))return!1;return!0},_4e_isEmptyInlineRemovable:function(c){if(!e.$removeEmpty[g.nodeName(c)])return!1;
for(var c=c.childNodes,b=0,r=c.length;b<r;b++){var d=c[b],h=d.nodeType;if(!(h==l.ELEMENT_NODE&&d.getAttribute("_ke_bookmark"))&&(h==l.ELEMENT_NODE&&!g._4e_isEmptyInlineRemovable(d)||h==g.NodeType.TEXT_NODE&&a.trim(d.nodeValue)))return!1}return!0},_4e_moveChildren:function(c,b,a){b=j(b);if(c!=b)if(a)for(;a=c.lastChild;)b.insertBefore(c.removeChild(a),b.firstChild);else for(;a=c.firstChild;)b.appendChild(c.removeChild(a))},_4e_mergeSiblings:function(c){c=new m(c);w[c.nodeName()]&&(q(c,!0),q(c))},_4e_splitText:function(c,
b){var a=c.ownerDocument;if(c.nodeType==g.NodeType.TEXT_NODE){if(n.ie&&b==c.nodeValue.length){var d=a.createTextNode("");g.insertAfter(d,c);return d}d=c.splitText(b);a.documentMode&&(a=a.createTextNode(""),g.insertAfter(a,d),g.remove(a));return d}},_4e_parents:function(c,b){var a=[];a.__IS_NODELIST=1;do a[b?"push":"unshift"](c);while(c=c.parentNode);return a},_4e_nextSourceNode:function(c,b,a,d){if(d&&!d.call)var h=j(d),d=function(b){return b!==h};var b=!b&&c.firstChild,f=c;if(!b){if(c.nodeType==
l.ELEMENT_NODE&&d&&!1===d(c,!0))return null;b=c.nextSibling}for(;!b&&(f=f.parentNode);){if(d&&!1===d(f,!0))return null;b=f.nextSibling}return!b||d&&!1===d(b)?null:a&&a!=b.nodeType?g._4e_nextSourceNode(b,!1,a,d):b},_4e_previousSourceNode:function(c,b,a,d){if(d&&!d.call)var h=j(d),d=function(b){return b!==h};var b=!b&&c.lastChild,f=c;if(!b){if(c.nodeType==l.ELEMENT_NODE&&d&&!1===d(c,!0))return null;b=c.previousSibling}for(;!b&&(f=f.parentNode);){if(d&&!1===d(f,!0))return null;b=f.previousSibling}return!b||
d&&!1===d(b)?null:a&&b.nodeType!=a?g._4e_previousSourceNode(b,!1,a,d):b},_4e_commonAncestor:function(a,b){b=j(b);if(a===b)return a;if(g.contains(b,a))return b;var r=a;do if(g.contains(r,b))return r;while(r=r.parentNode);return null},_4e_hasAttributes:9>s.ieEngine?function(a){for(var b=a.attributes,g=0;g<b.length;g++){var d=b[g];switch(d.name){case "class":if(a.getAttribute("class"))return!0;break;default:if(d.specified)return!0}}return!1}:function(a){n.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},
_4e_position:function(a,b){var e=j(b);if(a.compareDocumentPosition)return a.compareDocumentPosition(e);if(a==e)return o.POSITION_IDENTICAL;if(a.nodeType==l.ELEMENT_NODE&&e.nodeType==l.ELEMENT_NODE){if(g.contains(a,e))return o.POSITION_CONTAINS+o.POSITION_PRECEDING;if(g.contains(e,a))return o.POSITION_IS_CONTAINED+o.POSITION_FOLLOWING;if("sourceIndex"in a)return 0>a.sourceIndex||0>e.sourceIndex?o.POSITION_DISCONNECTED:a.sourceIndex<e.sourceIndex?o.POSITION_PRECEDING:o.POSITION_FOLLOWING}for(var d=
g._4e_address(a),e=g._4e_address(e),h=Math.min(d.length,e.length),f=0;f<=h-1;f++)if(d[f]!=e[f])return d[f]<e[f]?o.POSITION_PRECEDING:o.POSITION_FOLLOWING;return d.length<e.length?o.POSITION_CONTAINS+o.POSITION_PRECEDING:o.POSITION_IS_CONTAINED+o.POSITION_FOLLOWING},_4e_address:function(a,b){for(var e=[],d=a.ownerDocument.documentElement,h=a;h&&h!=d;)e.unshift(g._4e_index(h,b)),h=h.parentNode;return e},_4e_remove:function(a,b){var g=a.parentNode;if(g){if(b)for(var d;d=a.firstChild;)g.insertBefore(a.removeChild(d),
a);g.removeChild(a)}return a},_4e_trim:function(a){g._4e_ltrim(a);g._4e_rtrim(a)},_4e_ltrim:function(a){for(var b;b=a.firstChild;){if(b.nodeType==g.NodeType.TEXT_NODE){var e=s.ltrim(b.nodeValue),d=b.nodeValue.length;if(e)e.length<d&&(g._4e_splitText(b,d-e.length),a.removeChild(a.firstChild));else{a.removeChild(b);continue}}break}},_4e_rtrim:function(a){for(var b;b=a.lastChild;){if(b.type==g.NodeType.TEXT_NODE){var e=s.rtrim(b.nodeValue),d=b.nodeValue.length;if(e)e.length<d&&(g._4e_splitText(b,e.length),
a.removeChild(a.lastChild));else{a.removeChild(b);continue}}break}!n.ie&&!n.opera&&(b=a.lastChild)&&1==b.nodeType&&"br"==g.nodeName(b)&&a.removeChild(b)},_4e_appendBogus:function(c){for(var b=c.lastChild;b&&b.nodeType==g.NodeType.TEXT_NODE&&!a.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==g.NodeType.TEXT_NODE||"br"!==g.nodeName(b))b=n.opera?c.ownerDocument.createTextNode(""):c.ownerDocument.createElement("br"),n.gecko&&b.setAttribute("type","_moz"),c.appendChild(b)},_4e_setMarker:function(c,
b,e,d){var c=new m(c),h=c.data("list_marker_id")||c.data("list_marker_id",a.guid()).data("list_marker_id"),f=c.data("list_marker_names")||c.data("list_marker_names",{}).data("list_marker_names");b[h]=c;f[e]=1;return c.data(e,d)},_4e_clearMarkers:function(a,b,e){var a=new m(a),d=a.data("list_marker_names"),h=a.data("list_marker_id"),f;for(f in d)a.removeData(f);a.removeData("list_marker_names");e&&(a.removeData("list_marker_id"),delete b[h])},_4e_copyAttributes:function(a,b,e){for(var b=new m(b),d=
a.attributes,e=e||{},h=0;h<d.length;h++){var f=d[h],k=f.name.toLowerCase(),u;if(!(k in e))if("checked"==k&&(u=g.attr(a,k)))b.attr(k,u);else if(f.specified||n.ie&&f.value&&"value"==k)u=g.attr(a,k),null===u&&(u=f.nodeValue),b.attr(k,u)}""!==a.style.cssText&&(b[0].style.cssText=a.style.cssText)},_4e_isEditable:function(a){a=g.nodeName(a);return(a=!e.$nonEditable[a]&&(e[a]||e.span))&&a["#text"]},_4e_getByAddress:function(a,b,e){for(var a=a.documentElement,d=0;a&&d<b.length;d++){var h=b[d];if(e)for(var f=
-1,k=0;k<a.childNodes.length;k++){var u=a.childNodes[k];if(!(!0===e&&3==u.nodeType&&u.previousSibling&&3==u.previousSibling.nodeType)&&(f++,f==h)){a=u;break}}else a=a.childNodes[h]}return a}})},{requires:["./base","./utils"]});
KISSY.add("editor/core/domIterator",function(a){function i(a){1>arguments.length||(this.range=a,this.forceBrBreak=q,this.enlargeBr=s,this.enforceRealBlocks=q,this._||(this._={}))}var s=!0,q=!1,p=a.Editor,e=a.UA,g=p.Walker,l=p.Range,n=p.RANGE,m=p.ElementPath,w=a.Node,o=a.DOM,v=/^[\r\n\t ]*$/;a.augment(i,{getNextParagraph:function(i){var j,c,b,r,d;if(!this._.lastNode){c=this.range.clone();c.shrink(n.SHRINK_ELEMENT,s);c.enlarge(this.forceBrBreak||!this.enlargeBr?n.ENLARGE_LIST_ITEM_CONTENTS:n.ENLARGE_BLOCK_CONTENTS);
var h=new g(c),f=g.bookmark(s,s);h.evaluator=f;this._.nextNode=h.next();h=new g(c);h.evaluator=f;h=h.previous();this._.lastNode=h._4e_nextSourceNode(s);this._.lastNode&&this._.lastNode[0].nodeType==o.NodeType.TEXT_NODE&&!a.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()&&(f=new l(c.document),f.moveToPosition(this._.lastNode,n.POSITION_AFTER_END),f.checkEndOfBlock()&&(f=new m(f.endContainer),this._.lastNode=(f.block||f.blockLimit)._4e_nextSourceNode(s)));this._.lastNode||
(this._.lastNode=this._.docEndMarker=new w(c.document.createTextNode("")),o.insertAfter(this._.lastNode[0],h[0]));c=null}f=this._.nextNode;h=this._.lastNode;for(this._.nextNode=null;f;){var k=q,u=f[0].nodeType!=o.NodeType.ELEMENT_NODE,B=q;if(u)f[0].nodeType==o.NodeType.TEXT_NODE&&v.test(f[0].nodeValue)&&(u=q);else{var C=f.nodeName();if(f._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if("br"==C)u=s;else if(!c&&!f[0].childNodes.length&&"hr"!=C){j=f;b=f.equals(h);break}c&&(c.setEndAt(f,n.POSITION_BEFORE_START),
"br"!=C&&(this._.nextNode=f));k=s}else{if(f[0].firstChild){c||(c=new l(this.range.document),c.setStartAt(f,n.POSITION_BEFORE_START));f=new w(f[0].firstChild);continue}u=s}}u&&!c&&(c=new l(this.range.document),c.setStartAt(f,n.POSITION_BEFORE_START));b=(!k||u)&&f.equals(h);if(c&&!k)for(;!f[0].nextSibling&&!b;){C=f.parent();if(C._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){k=s;b||C.equals(h);break}f=C;u=s;b=f.equals(h);B=s}u&&c.setEndAt(f,n.POSITION_AFTER_END);f=f._4e_nextSourceNode(B,null,h);if((b=
!f)||k&&c)break}if(!j){if(!c)return this._.docEndMarker&&this._.docEndMarker._4e_remove(),this._.nextNode=null;j=new m(c.startContainer);f=j.blockLimit;k={div:1,th:1,td:1};j=j.block;if((!j||!j[0])&&!this.enforceRealBlocks&&k[f.nodeName()]&&c.checkStartOfBlock()&&c.checkEndOfBlock())j=f;else if(!j||this.enforceRealBlocks&&"li"==j.nodeName())j=new w(this.range.document.createElement(i||"p")),j[0].appendChild(c.extractContents()),j._4e_trim(),c.insertNode(j),r=d=s;else if("li"!=j.nodeName()){if(!c.checkStartOfBlock()||
!c.checkEndOfBlock())j=j.clone(q),j[0].appendChild(c.extractContents()),j._4e_trim(),d=c.splitBlock(),r=!d.wasStartOfBlock,d=!d.wasEndOfBlock,c.insertNode(j)}else b||(this._.nextNode=j.equals(h)?null:c.getBoundaryNodes().endNode._4e_nextSourceNode(s,null,h))}r&&(c=new w(j[0].previousSibling),c[0]&&c[0].nodeType==o.NodeType.ELEMENT_NODE&&("br"==c.nodeName()?c._4e_remove():c[0].lastChild&&"br"==o.nodeName(c[0].lastChild)&&o._4e_remove(c[0].lastChild)));d&&(c=g.bookmark(q,s),r=new w(j[0].lastChild),
r[0]&&r[0].nodeType==o.NodeType.ELEMENT_NODE&&"br"==r.nodeName()&&(e.ie||r.prev(c,1)||r.next(c,1))&&r.remove());this._.nextNode||(this._.nextNode=b||j.equals(h)?null:j._4e_nextSourceNode(s,null,h));return j}});l.prototype.createIterator=function(){return new i(this)};return i},{requires:["./base","./range","./elementPath","./walker"]});
KISSY.add("editor/core/elementPath",function(a){function i(a){for(var m=e,i=e,o=[];a;){if(a[0].nodeType==q.NodeType.ELEMENT_NODE){this.lastElement||(this.lastElement=a);var v=a.nodeName();if(!i&&(!m&&g[v]&&(m=a),l[v])){var s;if(s=!m)if(s="div"==v){a:{s=a[0].childNodes;for(var j=0,c=s.length;j<c;j++){var b=s[j];if(b.nodeType==q.NodeType.ELEMENT_NODE&&p.$block[b.nodeName.toLowerCase()]){s=!0;break a}}s=!1}s=!s}s?m=a:i=a}o.push(a);if("body"==v)break}a=a.parent()}this.block=m;this.blockLimit=i;this.elements=
o}var s=a.Editor,q=a.DOM,p=s.XHTML_DTD,e=null,g={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},l={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};i.prototype={constructor:i,compare:function(a){var e=this.elements,a=a&&a.elements;if(!a||e.length!=a.length)return!1;for(var g=0;g<e.length;g++)if(!q.equals(e[g],a[g]))return!1;return!0},contains:function(a){for(var g=this.elements,l=0;l<g.length;l++)if(g[l].nodeName()in a)return g[l];return e},toString:function(){var a=
this.elements,e,g=[];for(e=0;e<a.length;e++)g.push(a[e].nodeName());return g.toString()}};return s.ElementPath=i},{requires:["./base","./dom"]});
KISSY.add("editor/core/enterKey",function(a,i,s,q){function p(e){var i;i=e.getSelection().getRanges();for(var p=i.length-1;0<p;p--)i[p].deleteContents();i=i[0];p=i.document;if(i.checkStartOfBlock()&&i.checkEndOfBlock()){var j=(new q(i.startContainer)).block;if(j&&("li"==j.nodeName()||"li"==j.parent().nodeName()))return e.hasCommand("outdent")?(e.execCommand("save"),e.execCommand("outdent"),e.execCommand("save"),!0):!1}var c=i.splitBlock("p");if(!c)return!0;var e=c.previousBlock,j=c.nextBlock,b=c.wasStartOfBlock,
r=c.wasEndOfBlock,d;if(j)d=j.parent(),"li"==d.nodeName()&&(j._4e_breakParent(d),j._4e_move(j.next(),!0));else if(e&&(d=e.parent())&&"li"==d.nodeName())e._4e_breakParent(d),i.moveToElementEditablePosition(e.next()),e._4e_move(e.prev());if(!b&&!r){if("li"==j.nodeName()&&(d=j.first(s.invisible(!0)))&&a.inArray(d.nodeName(),["ul","ol"]))(g.ie?new m(p.createTextNode("\u00a0")):new m(p.createElement("br"))).insertBefore(d);j&&i.moveToElementEditablePosition(j)}else{var h;if(e){if("li"==e.nodeName()||!l.test(e.nodeName()))h=
e.clone()}else j&&(h=j.clone());h||(h=new m("<p>",null,p));if(d=c.elementPath)for(var c=0,f=d.elements.length;c<f;c++){var k=d.elements[c];if(k.equals(d.block)||k.equals(d.blockLimit))break;n.$removeEmpty[k.nodeName()]&&(k=k.clone(),h._4e_moveChildren(k),h.append(k))}g.ie||h._4e_appendBogus();i.insertNode(h);if(g.ie&&b&&(!r||!e[0].childNodes.length))i.moveToElementEditablePosition(r?e:h),i.select();i.moveToElementEditablePosition(b&&!r?j:h)}g.ie||(j?(h=new m(p.createElement("span")),h.html("&nbsp;"),
i.insertNode(h),h.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}),i.deleteContents()):h.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}));i.select();return!0}function e(a){var e=a.get("document")[0];w.on(e,"keydown",function(e){if(13===e.keyCode&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey){a.execCommand("save");var g=a.execCommand("enterBlock");a.execCommand("save");!1!==g&&e.preventDefault()}})}var g=a.UA,l=/^h[1-6]$/,n=i.XHTML_DTD,
m=a.Node,w=a.Event;return{init:function(a){a.addCommand("enterBlock",{exec:p});a.docReady(function(){e(a)})}}},{requires:["./base","./walker","./elementPath"]});
KISSY.add("editor/core/focusManager",function(a){function i(){var a=this;a.__iframeFocus=n;l=a;g&&clearTimeout(g);g=setTimeout(function(){a.fire("focus")},30)}function s(){var a=this;a.__iframeFocus=m;l=w;g&&clearTimeout(g);g=setTimeout(function(){a.fire("blur")},30)}var q=a.Editor,p=a.Event,e={},g,l,a={refreshAll:function(){for(var a in e){var g=e[a].get("document")[0];g.designMode="off";g.designMode="on"}},currentInstance:function(){return l},getInstance:function(a){return e[a]},add:function(a){var e=
a.get("window")[0];p.on(e,"focus",i,a);p.on(e,"blur",s,a)},register:function(a){e[a._UUID]=a},remove:function(a){delete e[a._UUID];var g=a.get("window")[0];p.remove(g,"focus",i,a);p.remove(g,"blur",s,a)}},n=!0,m=!1,w=null;a.refreshAll=a.refreshAll;q.focusManager=a;q.getInstances=function(){return e};return a},{requires:["./base","./dom"]});
KISSY.add("editor/core/htmlDataProcessor",function(a,i){return{init:function(s){function q(a){if((a.getAttribute("class")+"").match(/Apple-\w+-span/)||!a.attributes.length)a.setTagName(null);else if(!a.childNodes.length&&!a.attributes.length)return!1}function p(a){return a.replace(v,function(a,b,d){return"<"+b+d.replace(y,function(a,b){return-1==d.indexOf("_ke_saved_"+b)?" _ke_saved_"+a+" "+a:a})+">"})}function e(a){return a.replace(c,function(a){return"<ke:encoded>"+encodeURIComponent(a)+"</ke:encoded>"})}
function g(d){return d.replace(b,function(b,d){return a.urlDecode(d)})}var l=a.Node,n=a.UA,m=a.require("htmlparser"),w=new m.Filter,o=new m.Filter;(function(){function b(a){a=m.serialize(a);return new m.Comment(j+encodeURIComponent(a).replace(/--/g,"%2D%2D"))}var d={tagNames:[[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]],tags:{script:b,noscript:b,span:q}},c={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(a){if(a.attributes.length)for(var b=
["name","href","src"],d,c=0;c<b.length;c++)d="_ke_saved_"+b[c],a.getAttribute(d)&&a.removeAttribute(b[c]);return a},embed:function(a){var b=a.parentNode;if(b&&"object"==b.nodeName){var d=b.getAttribute("width"),b=b.getAttribute("height");d&&a.setAttribute("width",d);b&&a.setAttribute("width",b)}},a:function(a){if(!a.childNodes.length&&!a.attributes.length)return!1},span:q},attributes:{style:function(b){if(!a.trim(b))return!1}},attributeNames:[[/^_ke_saved_/,""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,
""],[/^_ks.*/,""]],text:function(a){if(n.webkit)return a.replace(/\u200b/g,"")},comment:function(b){if(b.substr(0,j.length)==j)return b=a.trim(a.urlDecode(b.substr(j.length))),m.parse(b).childNodes[0]}};n.ie&&(c.attributes.style=function(a){return a.replace(/(^|;)([^:]+)/g,function(a){return a.toLowerCase()})});w.addRules(c);o.addRules(d)})();(function(){function b(d){for(var d=d.childNodes,c=d.length,t=d[c-1];t&&3==t.nodeType&&!a.trim(t.nodeValue);)t=d[--c];return t}function d(a,c){var t=b(a);t&&
((c||!n.ie)&&1==t.nodeType&&"br"==t.nodeName?a.removeChild(t):3==t.nodeType&&g.test(t.nodeValue)&&a.removeChild(t))}function c(a){var d=b(a);return!d||1==d.nodeType&&"br"==d.nodeName||"form"==a.nodeName&&"input"==d.nodeName}function h(a){d(a,!0);c(a)&&(n.ie?a.appendChild(new m.Text("\u00a0")):(a.appendChild(new m.Text("&nbsp;")),a.appendChild(new m.Tag("br"))))}function e(a){d(a,!1);c(a)&&a.appendChild(new m.Text("\u00a0"))}var g=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,j=i.XHTML_DTD,t=a.merge(j.$block,j.$listItem,j.$tableContent),
D;for(D in t)"br"in j[D]||delete t[D];delete t.td;delete t.pre;var j={tags:{}},x={tags:{}};for(D in t)j.tags[D]=h,x.tags[D]=e;o.addRules(j);w.addRules(x)})();w.addRules({text:function(a){return a.replace(/\xa0/g,"&nbsp;")}});var v=/<(a|area|img|input)\b([^>]*)>/gi,y=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,j="{ke_protected}",c=/(?:<textarea[^>]*>[\s\S]*<\/textarea>)|(?:<style[^>]*>[\s\S]*<\/style>)|(?:<(:?link|meta|base)[^>]*>)/gi,b=/<ke:encoded>([^<]*)<\/ke:encoded>/gi,
r=/(<\/?)((?:object|embed|param|html|body|head|title|script|noscript)[^>]*>)/gi,d=/(<\/?)ke:((?:object|embed|param|html|body|head|title|script|noscript)[^>]*>)/gi,h=/<ke:(param|embed)([^>]*?)\/?>(?!\s*<\/ke:\1)/gi;s.htmlDataProcessor={dataFilter:o,htmlFilter:w,toHTML:function(a){var b=new m.BeautifyWriter;(new m.Parser(a)).parse().writeHTML(b,w);return a=b.getHTML()},toDataFormat:function(a,b){var b=b||o,a=e(a),a=p(a),a=a.replace(r,"$1ke:$2"),a=a.replace(h,"<ke:$1$2></ke:$1>"),c=new l("<div>");c.html("a"+
a);a=c.html().substr(1);a=a.replace(d,"$1$2");a=g(a);c=new m.BasicWriter;(new m.Parser(a)).parse().writeHTML(c,b);return a=c.getHTML()},toServer:function(a){var b=new m.MinifyWriter;(new m.Parser(a)).parse().writeHTML(b,w);return b.getHTML()}}}}},{requires:["./base"]});
(function(a){a({"editor/plugin/back-color":{requires:["editor","editor/plugin/color/btn"]}});a({"editor/plugin/back-color/cmd":{requires:["editor/plugin/color/cmd"]}});a({"editor/plugin/bold":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/bold/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/bubble":{requires:["overlay","editor"]}});a({"editor/plugin/button":{requires:["editor","button"]}});a({"editor/plugin/checkbox-source-area":{requires:["editor"]}});a({"editor/plugin/code":{requires:["editor",
"editor/plugin/dialog-loader"]}});a({"editor/plugin/code/dialog":{requires:["editor","editor/plugin/dialog","menubutton"]}});a({"editor/plugin/color/btn":{requires:["editor","editor/plugin/button","editor/plugin/overlay","editor/plugin/dialog-loader"]}});a({"editor/plugin/color/cmd":{requires:["editor"]}});a({"editor/plugin/color/dialog":{requires:["editor","editor/plugin/dialog"]}});a({"editor/plugin/contextmenu":{requires:["editor","menu","editor/plugin/focus-fix"]}});a({"editor/plugin/dent-cmd":{requires:["editor",
"editor/plugin/list-utils"]}});a({"editor/plugin/dialog-loader":{requires:["overlay","editor"]}});a({"editor/plugin/dialog":{requires:["editor","overlay","editor/plugin/focus-fix","dd/plugin/constrain","component/plugin/drag"]}});a({"editor/plugin/draft":{requires:["editor","editor/plugin/local-storage","overlay","editor/plugin/menubutton"]}});a({"editor/plugin/drag-upload":{requires:["editor"]}});a({"editor/plugin/element-path":{requires:["editor"]}});a({"editor/plugin/fake-objects":{requires:["editor"]}});
a({"editor/plugin/flash-bridge":{requires:["swf","editor"]}});a({"editor/plugin/flash-common/base-class":{requires:["editor","editor/plugin/contextmenu","editor/plugin/bubble","editor/plugin/dialog-loader","editor/plugin/flash-common/utils"]}});a({"editor/plugin/flash-common/utils":{requires:["swf"]}});a({"editor/plugin/flash":{requires:["editor","editor/plugin/flash-common/base-class","editor/plugin/flash-common/utils","editor/plugin/fake-objects"]}});a({"editor/plugin/flash/dialog":{requires:["editor",
"editor/plugin/flash-common/utils","editor/plugin/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/focus-fix":{requires:["editor"]}});a({"editor/plugin/font-family":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/font-family/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/font-size":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/font-size/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/font/cmd":{requires:["editor"]}});
a({"editor/plugin/font/ui":{requires:["editor","editor/plugin/button","editor/plugin/menubutton"]}});a({"editor/plugin/fore-color":{requires:["editor","editor/plugin/color/btn"]}});a({"editor/plugin/fore-color/cmd":{requires:["editor/plugin/color/cmd"]}});a({"editor/plugin/heading":{requires:["editor"]}});a({"editor/plugin/heading/cmd":{requires:["editor"]}});a({"editor/plugin/image":{requires:["editor","editor/plugin/button","editor/plugin/bubble","editor/plugin/contextmenu","editor/plugin/dialog-loader"]}});
a({"editor/plugin/image/dialog":{requires:["io","editor","editor/plugin/dialog","tabs","editor/plugin/menubutton"]}});a({"editor/plugin/indent":{requires:["editor"]}});a({"editor/plugin/indent/cmd":{requires:["editor","editor/plugin/dent-cmd"]}});a({"editor/plugin/italic":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/italic/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/justify-center":{requires:["editor"]}});a({"editor/plugin/justify-center/cmd":{requires:["editor/plugin/justify-cmd"]}});
a({"editor/plugin/justify-cmd":{requires:["editor"]}});a({"editor/plugin/justify-left":{requires:["editor"]}});a({"editor/plugin/justify-left/cmd":{requires:["editor/plugin/justify-cmd"]}});a({"editor/plugin/justify-right":{requires:["editor"]}});a({"editor/plugin/justify-right/cmd":{requires:["editor/plugin/justify-cmd"]}});a({"editor/plugin/link":{requires:["editor","editor/plugin/bubble","editor/plugin/dialog-loader","editor/plugin/button"]}});a({"editor/plugin/link/dialog":{requires:["editor",
"editor/plugin/dialog","editor/plugin/link/utils"]}});a({"editor/plugin/link/utils":{requires:["editor"]}});a({"editor/plugin/list-utils":{requires:["editor"]}});a({"editor/plugin/list-utils/btn":{requires:["editor","editor/plugin/button","editor/plugin/menubutton"]}});a({"editor/plugin/list-utils/cmd":{requires:["editor","editor/plugin/list-utils"]}});a({"editor/plugin/local-storage":{requires:["editor","overlay","editor/plugin/flash-bridge"]}});a({"editor/plugin/maximize":{requires:["editor"]}});
a({"editor/plugin/maximize/cmd":{requires:["editor"]}});a({"editor/plugin/menubutton":{requires:["editor","menubutton"]}});a({"editor/plugin/multiple-upload":{requires:["editor","editor/plugin/dialog-loader"]}});a({"editor/plugin/multiple-upload/dialog":{requires:"editor,component/plugin/drag,editor/plugin/progressbar,editor/plugin/dialog,editor/plugin/flash-bridge,editor/plugin/local-storage,swf".split(",")}});a({"editor/plugin/ordered-list":{requires:["editor","editor/plugin/list-utils/btn"]}});
a({"editor/plugin/ordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]}});a({"editor/plugin/outdent":{requires:["editor"]}});a({"editor/plugin/outdent/cmd":{requires:["editor","editor/plugin/dent-cmd"]}});a({"editor/plugin/overlay":{requires:["editor","overlay","editor/plugin/focus-fix"]}});a({"editor/plugin/page-break":{requires:["editor","editor/plugin/fake-objects"]}});a({"editor/plugin/remove-format":{requires:["editor","editor/plugin/button"]}});a({"editor/plugin/remove-format/cmd":{requires:["editor"]}});
a({"editor/plugin/resize":{requires:["editor","dd/base"]}});a({"editor/plugin/separator":{requires:["editor"]}});a({"editor/plugin/smiley":{requires:["editor","editor/plugin/overlay"]}});a({"editor/plugin/source-area":{requires:["editor","editor/plugin/button"]}});a({"editor/plugin/strike-through":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/strike-through/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/table":{requires:["editor","editor/plugin/dialog-loader",
"editor/plugin/contextmenu"]}});a({"editor/plugin/table/dialog":{requires:["editor","editor/plugin/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/underline":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/underline/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/undo":{requires:["editor"]}});a({"editor/plugin/undo/btn":{requires:["editor","editor/plugin/button"]}});a({"editor/plugin/undo/cmd":{requires:["editor"]}});a({"editor/plugin/unordered-list":{requires:["editor",
"editor/plugin/list-utils/btn"]}});a({"editor/plugin/unordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]}});a({"editor/plugin/video":{requires:["editor","editor/plugin/flash-common/utils","editor/plugin/flash-common/base-class","editor/plugin/fake-objects"]}});a({"editor/plugin/video/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/word-filter":{requires:["htmlparser"]}});a({"editor/plugin/xiami-music":{requires:["editor",
"editor/plugin/flash-common/base-class","editor/plugin/flash-common/utils","editor/plugin/fake-objects"]}});a({"editor/plugin/xiami-music/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton"]}})})(function(a){KISSY.config("modules",a)},KISSY.Features,KISSY.UA);
KISSY.add("editor/core/range",function(a,i,s,q,p){function e(c){var h=c.nodeType!=b.NodeType.TEXT_NODE&&b.nodeName(c)in d.$removeEmpty,f=c.nodeType==b.NodeType.TEXT_NODE&&!a.trim(c.nodeValue),c=!!c.parentNode.getAttribute("_ke_bookmark");return h||f||c}function g(a){return!u(a)&&!B(a)}function l(d){var c=v;return function(h){if(B(h))return o;if(h.nodeType==b.NodeType.TEXT_NODE){if(a.trim(h.nodeValue).length)return v}else if(h.nodeType==b.NodeType.ELEMENT_NODE&&(h=b.nodeName(h),!E[h]))if(!d&&!r.ie&&
"br"==h&&!c)c=o;else return v;return o}}function n(a,d){var c=a.startContainer,f=a.endContainer,e=a.startOffset,k=a.endOffset,g,u=v,j=v,l=void 0,i=a.document,r;0<d&&(l=i.createDocumentFragment());if(a.collapsed)return l;a.optimizeBookmark();f[0].nodeType==b.NodeType.TEXT_NODE?(j=o,f=f._4e_splitText(k)):0<f[0].childNodes.length&&(k>=f[0].childNodes.length?(f=new h(f[0].appendChild(i.createTextNode(""))),r=o):f=new h(f[0].childNodes[k]));c[0].nodeType==b.NodeType.TEXT_NODE?(u=o,c._4e_splitText(e)):
e?e>=c[0].childNodes.length?(c=new h(c[0].appendChild(i.createTextNode(""))),g=o):c=new h(c[0].childNodes[e].previousSibling):(g=new h(i.createTextNode("")),c.prepend(g),c=g,g=o);var H=c._4e_parents(),J=f._4e_parents();H.each(function(a,b){H[b]=a});J.each(function(a,b){J[b]=a});for(var F,M,i=0;i<H.length&&!(F=H[i],M=J[i],!F.equals(M));i++);for(var e=l,A,I,m=i;m<H.length;m++){A=H[m];k=0<d&&!A.equals(c)?e.appendChild(A.clone()[0]):null;A=A[0].nextSibling;I=J[m];for(var B=f[0],n=I&&I[0];A&&!(n==A||B==
A);)I=A.nextSibling,2==d?e.appendChild(A.cloneNode(o)):(b._4e_remove(A),1==d&&e.appendChild(A)),A=I;k&&(e=k)}for(e=l;i<J.length;i++){A=J[i];k=0<d&&!A.equals(f)?e.appendChild(A.clone()[0]):null;if(!H[i]||!A._4e_sameLevel(H[i]))for(A=A[0].previousSibling;A;)I=A.previousSibling,2==d?e.insertBefore(A.cloneNode(o),e.firstChild):(b._4e_remove(A),1==d&&e.insertBefore(A,e.firstChild)),A=I;k&&(e=k)}if(2==d){if(u&&(F=c[0],F.nodeType==b.NodeType.TEXT_NODE&&F.nextSibling&&F.nextSibling.nodeType==b.NodeType.TEXT_NODE&&
(F.data+=F.nextSibling.data,F.parentNode.removeChild(F.nextSibling))),j)j=f[0],j.nodeType==b.NodeType.TEXT_NODE&&j.previousSibling&&j.previousSibling.nodeType==b.NodeType.TEXT_NODE&&(j.previousSibling.data+=j.data,j.parentNode.removeChild(j))}else{if(F&&M&&(!c._4e_sameLevel(F)||!f._4e_sameLevel(M)))j=F._4e_index(),g&&F._4e_sameLevel(c)&&j--,a.setStart(F.parent(),j+1);a.collapse(o)}g&&c.remove();r&&f.remove();return l}function m(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer[0]==
a.endContainer[0]&&a.startOffset==a.endOffset}function w(a){this.endOffset=this.endContainer=this.startOffset=this.startContainer=y;this.collapsed=o;this.document=a}i.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var o=!0,v=!1,y=null,j=i.RANGE,c=i.POSITION,b=a.DOM,r=a.UA,d=i.XHTML_DTD,h=a.Node,f=h.all,k={area:1,base:1,br:1,col:1,hr:1,
img:1,input:1,link:1,meta:1,param:1},u=new q.whitespaces,B=new q.bookmark,C=q.whitespaces(o),z=q.bookmark(!1,!0),E={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};a.augment(w,{toString:function(){var a=[],b=this.startContainer[0],d=this.endContainer[0];a.push((b.id||b.nodeName)+":"+this.startOffset);a.push((d.id||d.nodeName)+":"+this.endOffset);return a.join("<br/>")},optimize:function(){var a=
this.startContainer,d=this.startOffset;a[0].nodeType!=b.NodeType.ELEMENT_NODE&&(d?d>=a[0].nodeValue.length&&this.setStartAfter(a):this.setStartBefore(a));a=this.endContainer;d=this.endOffset;a[0].nodeType!=b.NodeType.ELEMENT_NODE&&(d?d>=a[0].nodeValue.length&&this.setEndAfter(a):this.setEndBefore(a))},setStartAfter:function(a){this.setStart(a.parent(),a._4e_index()+1)},setStartBefore:function(a){this.setStart(a.parent(),a._4e_index())},setEndAfter:function(a){this.setEnd(a.parent(),a._4e_index()+
1)},setEndBefore:function(a){this.setEnd(a.parent(),a._4e_index())},optimizeBookmark:function(){var a=this.startContainer,b=this.endContainer;a&&"span"==a.nodeName()&&a.attr("_ke_bookmark")&&this.setStartBefore(a);b&&"span"==b.nodeName()&&b.attr("_ke_bookmark")&&this.setEndAfter(b)},setStart:function(a,d){a[0].nodeType==b.NodeType.ELEMENT_NODE&&k[a.nodeName()]&&(a=a.parent(),d=a._4e_index());this.startContainer=a;this.startOffset=d;this.endContainer||(this.endContainer=a,this.endOffset=d);m(this)},
setEnd:function(a,d){a[0].nodeType==b.NodeType.ELEMENT_NODE&&k[a.nodeName()]&&(a=a.parent(),d=a._4e_index()+1);this.endContainer=a;this.endOffset=d;this.startContainer||(this.startContainer=a,this.startOffset=d);m(this)},setStartAt:function(a,d){switch(d){case j.POSITION_AFTER_START:this.setStart(a,0);break;case j.POSITION_BEFORE_END:a[0].nodeType==b.NodeType.TEXT_NODE?this.setStart(a,a[0].nodeValue.length):this.setStart(a,a[0].childNodes.length);break;case j.POSITION_BEFORE_START:this.setStartBefore(a);
break;case j.POSITION_AFTER_END:this.setStartAfter(a)}m(this)},setEndAt:function(a,d){switch(d){case j.POSITION_AFTER_START:this.setEnd(a,0);break;case j.POSITION_BEFORE_END:a[0].nodeType==b.NodeType.TEXT_NODE?this.setEnd(a,a[0].nodeValue.length):this.setEnd(a,a[0].childNodes.length);break;case j.POSITION_BEFORE_START:this.setEndBefore(a);break;case j.POSITION_AFTER_END:this.setEndAfter(a)}m(this)},cloneContents:function(){return n(this,2)},deleteContents:function(){return n(this,0)},extractContents:function(){return n(this,
1)},collapse:function(a){a?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,this.startOffset=this.endOffset);this.collapsed=o},clone:function(){var a=new w(this.document);a.startContainer=this.startContainer;a.startOffset=this.startOffset;a.endContainer=this.endContainer;a.endOffset=this.endOffset;a.collapsed=this.collapsed;return a},getEnclosedNode:function(){var a=this.clone();a.optimize();if(a.startContainer[0].nodeType!=b.NodeType.ELEMENT_NODE||
a.endContainer[0].nodeType!=b.NodeType.ELEMENT_NODE)return y;var d=new q(a);d.evaluator=function(a){return C(a)&&z(a)};a=d.next();d.reset();d=d.previous();return a&&a.equals(d)?a:y},shrink:function(a,d){if(!this.collapsed){var a=a||j.SHRINK_TEXT,c=this.clone(),h=this.startContainer,f=this.endContainer,e=this.startOffset,k=this.endOffset,g=o,u,l,i=o;h&&h[0].nodeType==b.NodeType.TEXT_NODE&&(e?e>=h[0].nodeValue.length?c.setStartAfter(h):(c.setStartBefore(h),g=v):c.setStartBefore(h));f&&f[0].nodeType==
b.NodeType.TEXT_NODE&&(k?k>=f[0].nodeValue.length?c.setEndAfter(f):(c.setEndAfter(f),i=v):c.setEndBefore(f));if(g||i)l=new q(c),l.evaluator=function(d){return d.nodeType==(a==j.SHRINK_ELEMENT?b.NodeType.ELEMENT_NODE:b.NodeType.TEXT_NODE)},l.guard=function(d,c){if(a==j.SHRINK_ELEMENT&&d.nodeType==b.NodeType.TEXT_NODE||c&&d==u)return v;!c&&d.nodeType==b.NodeType.ELEMENT_NODE&&(u=d);return o};g&&(c=l[a==j.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(c,d?j.POSITION_AFTER_START:j.POSITION_BEFORE_START);
i&&(l.reset(),(l=l[a==j.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(l,d?j.POSITION_BEFORE_END:j.POSITION_AFTER_END));return g||i}},createBookmark2:function(a){var d=this.startContainer,c=this.endContainer,f=this.startOffset,e=this.endOffset,k,g;if(!d||!c)return{start:0,end:0};if(a){if(d[0].nodeType==b.NodeType.ELEMENT_NODE&&(k=new h(d[0].childNodes[f]))&&k[0]&&k[0].nodeType==b.NodeType.TEXT_NODE&&0<f&&k[0].previousSibling.nodeType==b.NodeType.TEXT_NODE)d=k,f=0;for(;d[0].nodeType==
b.NodeType.TEXT_NODE&&(g=d.prev(void 0,1))&&g[0].nodeType==b.NodeType.TEXT_NODE;)d=g,f+=g[0].nodeValue.length;if(!this.collapsed){if(c[0].nodeType==b.NodeType.ELEMENT_NODE&&(k=new h(c[0].childNodes[e]))&&k[0]&&k[0].nodeType==b.NodeType.TEXT_NODE&&0<e&&k[0].previousSibling.nodeType==b.NodeType.TEXT_NODE)c=k,e=0;for(;c[0].nodeType==b.NodeType.TEXT_NODE&&(g=c.prev(void 0,1))&&g[0].nodeType==b.NodeType.TEXT_NODE;)c=g,e+=g[0].nodeValue.length}}return{start:d._4e_address(a),end:this.collapsed?y:c._4e_address(a),
startOffset:f,endOffset:e,normalized:a,is2:o}},createBookmark:function(d){var b,c,f,e,k=this.collapsed;b=new h("<span>",y,this.document);b.attr("_ke_bookmark",1);b.css("display","none");b.html("&nbsp;");d&&(f=a.guid("ke_bm_"),b.attr("id",f+"S"));k||(c=b.clone(),c.html("&nbsp;"),d&&c.attr("id",f+"E"),e=this.clone(),e.collapse(),e.insertNode(c));e=this.clone();e.collapse(o);e.insertNode(b);c?(this.setStartAfter(b),this.setEndBefore(c)):this.moveToPosition(b,j.POSITION_AFTER_END);return{startNode:d?
f+"S":b,endNode:d?f+"E":c,serializable:d,collapsed:k}},moveToPosition:function(a,b){this.setStartAt(a,b);this.collapse(o)},trim:function(a,d){var c=this.startContainer,f=this.startOffset,h=this.collapsed;if((!a||h)&&c[0]&&c[0].nodeType==b.NodeType.TEXT_NODE){if(f)if(f>=c[0].nodeValue.length)f=c._4e_index()+1,c=c.parent();else{var e=c._4e_splitText(f),f=c._4e_index()+1,c=c.parent();b.equals(this.startContainer,this.endContainer)?this.setEnd(e,this.endOffset-this.startOffset):b.equals(c,this.endContainer)&&
(this.endOffset+=1)}else f=c._4e_index(),c=c.parent();this.setStart(c,f);if(h){this.collapse(o);return}}c=this.endContainer;f=this.endOffset;!d&&!h&&c[0]&&c[0].nodeType==b.NodeType.TEXT_NODE&&(f?(f>=c[0].nodeValue.length||c._4e_splitText(f),f=c._4e_index()+1):f=c._4e_index(),c=c.parent(),this.setEnd(c,f))},insertNode:function(a){this.optimizeBookmark();this.trim(v,o);var b=this.startContainer;b[0].insertBefore(a[0],b[0].childNodes[this.startOffset]||null);b[0]==this.endContainer[0]&&this.endOffset++;
this.setStartBefore(a)},moveToBookmark:function(b){var d=f(this.document);if(b.is2){var c=d._4e_getByAddress(b.start,b.normalized),h=b.startOffset,d=b.end&&d._4e_getByAddress(b.end,b.normalized),b=b.endOffset;this.setStart(c,h);d?this.setEnd(d,b):this.collapse(o)}else c=(h=b.serializable)?a.one("#"+b.startNode,d):b.startNode,b=h?a.one("#"+b.endNode,d):b.endNode,this.setStartBefore(c),c._4e_remove(),b&&b[0]?(this.setEndBefore(b),b._4e_remove()):this.collapse(o)},getCommonAncestor:function(a,d){var c=
this.startContainer,f=this.endContainer,c=c[0]==f[0]?a&&c[0].nodeType==b.NodeType.ELEMENT_NODE&&this.startOffset==this.endOffset-1?new h(c[0].childNodes[this.startOffset]):c:c._4e_commonAncestor(f);return d&&c[0].nodeType==b.NodeType.TEXT_NODE?c.parent():c},enlarge:function(){function a(d,c,h,e){var k=d[c?"startContainer":"endContainer"],g,j=c?0:1,t=0,l=c?"previousSibling":"nextSibling";g=d[c?"startOffset":"endOffset"];if(k[0].nodeType==b.NodeType.TEXT_NODE){if(c){if(g)return}else if(g<k[0].nodeValue.length)return;
g=k[0][l];k=k[0].parentNode}else g=k[0].childNodes[g+(c?-1:1)]||null,k=k[0];for(;k;){for(;g;)if(u(g)||B(g))g=g[l];else break;if(g){if(!t)d[c?"setStartAfter":"setEndBefore"](f(g));break}k=f(k);if("body"==k.nodeName())break;if(t||k.equals(e))h[j]=k,t=1;else d[c?"setStartBefore":"setEndAfter"](k);g=k[0][l];k=k[0].parentNode}}return function(d){switch(d){case j.ENLARGE_ELEMENT:if(this.collapsed)break;var d=this.getCommonAncestor(),c=[];a(this,1,c,d);a(this,0,c,d);c[0]&&c[1]&&(d=c[0].contains(c[1])?c[1]:
c[0],this.setStartBefore(d),this.setEndAfter(d));break;case j.ENLARGE_BLOCK_CONTENTS:case j.ENLARGE_LIST_ITEM_CONTENTS:var e=new w(this.document),c=new h(this.document.body);e.setStartAt(c,j.POSITION_AFTER_START);e.setEnd(this.startContainer,this.startOffset);var e=new q(e),k,g,u=q.blockBoundary(d==j.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:y),l=function(a){var b=u(a);b||(k=f(a));return b},i=function(a){var d=l(a);!d&&"br"==b.nodeName(a)&&(g=f(a));return d};e.guard=l;e=e.lastBackward();k=k||c;this.setStartAt(k,
"br"!=k.nodeName()&&(!e&&this.checkStartOfBlock()||e&&k.contains(e))?j.POSITION_AFTER_START:j.POSITION_AFTER_END);e=this.clone();e.collapse();e.setEndAt(c,j.POSITION_BEFORE_END);e=new q(e);e.guard=d==j.ENLARGE_LIST_ITEM_CONTENTS?i:l;k=y;e=e.lastForward();k=k||c;this.setEndAt(k,!e&&this.checkEndOfBlock()||e&&k.contains(e)?j.POSITION_BEFORE_END:j.POSITION_BEFORE_START);g&&this.setEndAfter(g)}}}(),checkStartOfBlock:function(){var d=this.startContainer,c=this.startOffset;if(c&&d[0].nodeType==b.NodeType.TEXT_NODE&&
a.trim(d[0].nodeValue.substring(0,c)).length)return v;this.trim();d=new p(this.startContainer);c=this.clone();c.collapse(o);c.setStartAt(d.block||d.blockLimit,j.POSITION_AFTER_START);d=new q(c);d.evaluator=l(o);return d.checkBackward()},checkEndOfBlock:function(){var d=this.endContainer,c=this.endOffset;if(d[0].nodeType==b.NodeType.TEXT_NODE&&a.trim(d[0].nodeValue.substring(c)).length)return v;this.trim();d=new p(this.endContainer);c=this.clone();c.collapse(v);c.setEndAt(d.block||d.blockLimit,j.POSITION_BEFORE_END);
d=new q(c);d.evaluator=l(v);return d.checkForward()},checkBoundaryOfElement:function(a,d){var b=this.clone();b[d==j.START?"setStartAt":"setEndAt"](a,d==j.START?j.POSITION_AFTER_START:j.POSITION_BEFORE_END);b=new q(b);b.evaluator=e;return b[d==j.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var a=this.startContainer,d=this.endContainer,h=this.startOffset,e=this.endOffset,k;if(a[0].nodeType==b.NodeType.ELEMENT_NODE)if(k=a[0].childNodes.length,k>h)a=f(a[0].childNodes[h]);else if(0==
k)a=a._4e_previousSourceNode();else{for(a=a[0];a.lastChild;)a=a.lastChild;a=f(a);a=a._4e_nextSourceNode()||a}if(d[0].nodeType==b.NodeType.ELEMENT_NODE)if(k=d[0].childNodes.length,k>e)d=f(d[0].childNodes[e])._4e_previousSourceNode(o);else if(0==k)d=d._4e_previousSourceNode();else{for(d=d[0];d.lastChild;)d=d.lastChild;d=f(d)}a._4e_position(d)&c.POSITION_FOLLOWING&&(a=d);return{startNode:a,endNode:d}},fixBlock:function(a,d){var b=this.createBookmark(),c=f(this.document.createElement(d));this.collapse(a);
this.enlarge(j.ENLARGE_BLOCK_CONTENTS);c[0].appendChild(this.extractContents());c._4e_trim();r.ie||c._4e_appendBogus();this.insertNode(c);this.moveToBookmark(b);return c},splitBlock:function(d){var b=new p(this.startContainer),c=new p(this.endContainer),f=b.block,h=c.block,e=y;if(!b.blockLimit.equals(c.blockLimit))return y;"br"!=d&&(f||(f=this.fixBlock(o,d),h=(new p(this.endContainer)).block),h||(h=this.fixBlock(v,d)));d=f&&this.checkStartOfBlock();b=h&&this.checkEndOfBlock();this.deleteContents();
f&&f[0]==h[0]&&(b?(e=new p(this.startContainer),this.moveToPosition(h,j.POSITION_AFTER_END),h=y):d?(e=new p(this.startContainer),this.moveToPosition(f,j.POSITION_BEFORE_START),f=y):(h=this.splitElement(f),!r.ie&&!a.inArray(f.nodeName(),["ul","ol"])&&f._4e_appendBogus()));return{previousBlock:f,nextBlock:h,wasStartOfBlock:d,wasEndOfBlock:b,elementPath:e}},splitElement:function(a){if(!this.collapsed)return y;this.setEndAt(a,j.POSITION_BEFORE_END);var d=this.extractContents(),b=a.clone(v);b[0].appendChild(d);
b.insertAfter(a);this.moveToPosition(a,j.POSITION_AFTER_END);return b},moveToElementEditablePosition:function(a,d){for(var c=0;a;){if(a[0].nodeType==b.NodeType.TEXT_NODE){this.moveToPosition(a,d?j.POSITION_AFTER_END:j.POSITION_BEFORE_START);c=1;break}a[0].nodeType==b.NodeType.ELEMENT_NODE&&a._4e_isEditable()&&(this.moveToPosition(a,d?j.POSITION_BEFORE_END:j.POSITION_AFTER_START),c=1);var f=a,h=c,e=void 0;f[0].nodeType==b.NodeType.ELEMENT_NODE&&f._4e_isEditable()&&(e=f[d?"last":"first"](g,1));!h&&
!e&&(e=f[d?"prev":"next"](g,1));a=e}return!!c},selectNodeContents:function(a){var d=a[0];this.setStart(a,0);this.setEnd(a,d.nodeType==b.NodeType.TEXT_NODE?d.nodeValue.length:d.childNodes.length)},insertNodeByDtd:function(a){var b,c,f,h=a.nodeName();b=d.$block[h];this.deleteContents();if(b){for(b=this.getCommonAncestor(v,o);(c=d[b.nodeName()])&&(!c||!c[h]);){var e=b.parent();this.checkStartOfBlock()&&this.checkEndOfBlock()?(this.setStartBefore(b),this.collapse(o),b.remove()):f=b;b=e}f&&this.splitElement(f)}this.insertNode(a)}});
s.injectDom({_4e_breakParent:function(a,d){var d=f(d),a=f(a),b,c=new i.Range(a[0].ownerDocument);c.setStartAfter(a);c.setEndAfter(d);b=c.extractContents();c.insertNode(a.remove());a.after(b)}});return i.Range=w},{requires:["./base","./utils","./walker","./elementPath","./dom"]});
KISSY.add("editor/core/selection",function(a){function i(a){this.document=a;this._={cache:{}};if(o)try{var b=this.getNative().createRange();if(!b||b.item&&b.item(0).ownerDocument!=a||b.parentElement&&b.parentElement().ownerDocument!=a)this.isInvalid=p}catch(c){this.isInvalid=p}}function s(a){a=new i(a);return!a||a.isInvalid?e:a}var q=a.Editor;q.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var p=!0,e=null,g=a.UA,l=a.DOM,n=a.Node,m=q.SELECTION,w=q.RANGE,o=g.ie,v=q.Walker,y=q.Range,
j={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};a.augment(i,{getNative:!o?function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=l.getWindow(this.document).getSelection())}:function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=this.document.selection)},getType:!o?function(){var a=this._.cache;if(a.type)return a.type;var b=m.SELECTION_TEXT,c=this.getNative();if(c){if(1==c.rangeCount){var c=
c.getRangeAt(0),e=c.startContainer;e==c.endContainer&&e.nodeType==l.NodeType.ELEMENT_NODE&&1==Number(c.endOffset-c.startOffset)&&j[e.childNodes[c.startOffset].nodeName.toLowerCase()]&&(b=m.SELECTION_ELEMENT)}}else b=m.SELECTION_NONE;return a.type=b}:function(){var a=this._.cache;if(a.type)return a.type;var b=m.SELECTION_NONE;try{var c=this.getNative(),e=c.type;"Text"==e&&(b=m.SELECTION_TEXT);"Control"==e&&(b=m.SELECTION_ELEMENT);c.createRange().parentElement&&(b=m.SELECTION_TEXT)}catch(g){}return a.type=
b},getRanges:o?function(){var a=function(a,b){a=a.duplicate();a.collapse(b);for(var d=a.parentElement(),c=d.childNodes,g,j=0;j<c.length;j++){var i=c[j];if(i.nodeType==l.NodeType.ELEMENT_NODE){g=a.duplicate();g.moveToElementText(i);var i=g.compareEndPoints("StartToStart",a),r=g.compareEndPoints("EndToStart",a);g.collapse();if(0<i)break;else{if(!i||1==r&&-1==i)return{container:d,offset:j};if(!r)return{container:d,offset:j+1}}g=e}}g||(g=a.duplicate(),g.moveToElementText(d),g.collapse(!1));g.setEndPoint("StartToStart",
a);g=(""+g.text).replace(/\r\n|\r/g,"\n").length;try{for(;0<g;)g-=c[--j].nodeValue.length}catch(m){g=0}return 0===g?{container:d,offset:j}:{container:c[j],offset:-g}};return function(b){var c=this._.cache;if(c.ranges&&!b)return c.ranges;var e=this.getNative(),b=e&&e.createRange(),g=this.getType();if(!e)return[];if(g==m.SELECTION_TEXT)return e=new y(this.document),g=a(b,p),e.setStart(new n(g.container),g.offset),g=a(b),e.setEnd(new n(g.container),g.offset),c.ranges=[e];if(g==m.SELECTION_ELEMENT){c=
c.ranges=[];for(g=0;g<b.length;g++){for(var j=b.item(g),l=j.parentNode,i=0,e=new y(this.document);i<l.childNodes.length&&l.childNodes[i]!=j;i++);e.setStart(new n(l),i);e.setEnd(new n(l),i+1);c.push(e)}return c}return c.ranges=[]}}():function(a){var b=this._.cache;if(b.ranges&&!a)return b.ranges;var a=[],c=this.getNative();if(!c)return[];for(var e=0;e<c.rangeCount;e++){var g=c.getRangeAt(e),j=new y(this.document);j.setStart(new n(g.startContainer),g.startOffset);j.setEnd(new n(g.endContainer),g.endOffset);
a.push(j)}return b.ranges=a},getStartElement:function(){var a=this._.cache;if(void 0!==a.startElement)return a.startElement;var b,c=this.getNative();switch(this.getType()){case m.SELECTION_ELEMENT:return this.getSelectedElement();case m.SELECTION_TEXT:var e=this.getRanges()[0];if(e&&!e.collapsed){for(e.optimize();p;)if(b=e.startContainer,e.startOffset==(b[0].nodeType===l.NodeType.ELEMENT_NODE?b[0].childNodes.length:b[0].nodeValue.length)&&!b._4e_isBlockBoundary())e.setStartAfter(b);else break;b=e.startContainer;
if(b[0].nodeType!=l.NodeType.ELEMENT_NODE)return b.parent();b=new n(b[0].childNodes[e.startOffset]);if(!b[0]||b[0].nodeType!=l.NodeType.ELEMENT_NODE)return e.startContainer;for(e=b[0].firstChild;e&&e.nodeType==l.NodeType.ELEMENT_NODE;)b=new n(e),e=e.firstChild;return b}if(o)e=c.createRange(),e.collapse(p),b=new n(e.parentElement());else{if((b=c.anchorNode)&&b.nodeType!=l.NodeType.ELEMENT_NODE)b=b.parentNode;b&&(b=new n(b))}}return a.startElement=b},getSelectedElement:function(){var a,b=this._.cache;
if(void 0!==b.selectedElement)return b.selectedElement;o&&(a=this.getNative().createRange(),a=a.item&&a.item(0));var c;if(a)c=new n(a);else{a=this.getRanges()[0];for(var e,g=2;g&&(!(c=a.getEnclosedNode())||!(c[0].nodeType==l.NodeType.ELEMENT_NODE&&j[c.nodeName()]&&(e=c)));g--)a.shrink(w.SHRINK_ELEMENT);c=e}return b.selectedElement=c},reset:function(){this._.cache={}},selectElement:function(a){var b,c=this.document;if(o)try{b=c.body.createControlRange(),b.addElement(a[0]),b.select()}catch(e){b=c.body.createTextRange(),
b.moveToElementText(a[0]),b.select()}finally{}else b=c.createRange(),b.selectNode(a[0]),a=this.getNative(),a.removeAllRanges(),a.addRange(b);this.reset()},selectRanges:function(a){if(o){if(1<a.length){var b=a[a.length-1];a[0].setEnd(b.endContainer,b.endOffset);a.length=1}a[0]&&a[0].select()}else{b=this.getNative();if(!b)return;b.removeAllRanges();for(var c=0;c<a.length;c++){var e=a[c],j=this.document.createRange(),i=e.startContainer;if(e.collapsed&&(g.gecko&&1.09>g.gecko||g.opera||g.webkit)&&i[0].nodeType==
l.NodeType.ELEMENT_NODE&&!i[0].childNodes.length)i[0].appendChild(this.document.createTextNode(g.webkit?"\u200b":"")),e.startOffset++,e.endOffset++;j.setStart(i[0],e.startOffset);j.setEnd(e.endContainer[0],e.endOffset);b.addRange(j)}}this.reset()},createBookmarks2:function(a){for(var b=[],c=this.getRanges(),e=0;e<c.length;e++)b.push(c[e].createBookmark2(a));return b},createBookmarks:function(b,c){for(var e=[],g=this.document,j,c=c||this.getRanges(),i=c.length,r=0;r<i;r++){e.push(j=c[r].createBookmark(b,
p));var m=(b=j.serializable)?a.one("#"+j.startNode,g):j.startNode;j=b?a.one("#"+j.endNode,g):j.endNode;for(var n=r+1;n<i;n++){var t=c[n],o=t.startContainer,s=t.endContainer;l.equals(o,m.parent())&&t.startOffset++;l.equals(o,j.parent())&&t.startOffset++;l.equals(s,m.parent())&&t.endOffset++;l.equals(s,j.parent())&&t.endOffset++}}return e},selectBookmarks:function(a){for(var b=[],c=0;c<a.length;c++){var e=new y(this.document);e.moveToBookmark(a[c]);b.push(e)}this.selectRanges(b);return this},getCommonAncestor:function(){var a=
this.getRanges();return a[0].startContainer._4e_commonAncestor(a[a.length-1].endContainer)},scrollIntoView:function(){var a=this.getStartElement();a&&a.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})},removeAllRanges:function(){var a=this.getNative();o?a&&a.clear():a&&a.removeAllRanges()}});var c={table:1,tbody:1,tr:1},b=v.whitespaces(p),r=/\ufeff|\u00a0/;y.prototype.select=y.prototype.select=!o?function(){var a=this.startContainer;this.collapsed&&a[0].nodeType==
l.NodeType.ELEMENT_NODE&&!a[0].childNodes.length&&a[0].appendChild(this.document.createTextNode(""));var b=this.document.createRange();b.setStart(a[0],this.startOffset);try{b.setEnd(this.endContainer[0],this.endOffset)}catch(c){if(0<=c.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))this.collapse(p),b.setEnd(this.endContainer[0],this.endOffset);else throw c;}a=s(this.document).getNative();a.removeAllRanges();a.addRange(b)}:function(a){var e=this.collapsed,f,g;if(this.startContainer[0]===this.endContainer[0]&&
1==this.endOffset-this.startOffset){var j=this.startContainer[0].childNodes[this.startOffset];if(j.nodeType==l.NodeType.ELEMENT_NODE){(new i(this.document)).selectElement(new n(j));return}}(this.startContainer[0].nodeType==l.NodeType.ELEMENT_NODE&&this.startContainer.nodeName()in c||this.endContainer[0].nodeType==l.NodeType.ELEMENT_NODE&&this.endContainer.nodeName()in c)&&this.shrink(w.SHRINK_ELEMENT,p);var m=this.createBookmark(),j=m.startNode,o;e||(o=m.endNode);m=this.document.body.createTextRange();
m.moveToElementText(j[0]);m.moveStart("character",1);if(o)a=this.document.body.createTextRange(),a.moveToElementText(o[0]),m.setEndPoint("EndToEnd",a),m.moveEnd("character",-1);else{for(f=j[0].nextSibling;f&&!b(f);)f=f.nextSibling;f=!(f&&f.nodeValue&&f.nodeValue.match(r))&&(a||!j[0].previousSibling||j[0].previousSibling&&"br"==l.nodeName(j[0].previousSibling));g=new n(this.document.createElement("span"));g.html("&#65279;");g.insertBefore(j);f&&l.insertBefore(this.document.createTextNode("\ufeff"),j[0]||
j)}this.setStartBefore(j);j._4e_remove();if(e){if(f?(m.moveStart("character",-1),m.select(),this.document.selection.clear()):m.select(),g)this.moveToPosition(g,w.POSITION_BEFORE_START),g._4e_remove()}else this.setEndBefore(o),o._4e_remove(),m.select()};i.getSelection=s;return q.Selection=i},{requires:["./base","./walker","./range","./dom"]});
KISSY.add("editor/core/selectionFix",function(a,i){function s(a){function c(a,b){var c=f.body.createTextRange();try{c.moveToPoint(a,b)}catch(d){c=n}return c}function b(){var a=f.selection.createRange();k&&!a.item&&0===a.compareEndPoints("StartToEnd",a)&&k.select();w.remove(f,"mouseup",b);w.remove(f,"mousemove",e);k=d=0}function e(a){if(a.button){if(a=c(a.pageX,a.pageY))0<a.compareEndPoints("StartToStart",k)?a.setEndPoint("StartToStart",k):a.setEndPoint("EndToEnd",k),a.select()}else b()}var d,g=a.get("window")[0],
f=a.get("document")[0],k;w.on(f,"mousedown contextmenu",function(a){var j=f.documentElement;if(a.target===j&&(d&&b(),!(j.scrollHeight>j.clientHeight)&&(d=1,k=c(a.pageX,a.pageY))))w.on(f,"mouseup",b),w.on(f,"mousemove",e),g.focus(),k.select()})}function q(a){function c(d){if(f){var e=a.getSelection(),k=e&&e.getType(),i=e&&b.selection;if(d&&i&&k==y.SELECTION_NONE&&!b.queryCommandEnabled("InsertImage"))setTimeout(function(){c(g)},50);else{var l;if(!i||!i.type||!("Control"!=i.type&&(l=i.createRange())&&
(l=l.parentElement())&&(l=l.nodeName)&&l.toLowerCase()in{input:1,textarea:1}))h=i&&e.getRanges()[0],a.checkSelectionChange()}}}var b=a.get("document")[0],e=new v(b.body),d=new v(b.documentElement);if(8>i.Utils.ieEngine)d.on("click",function(b){"html"===(new v(b.target)).nodeName()&&a.getSelection().getNative().createRange().select()});var h,f,k=g;d.on("mousedown",function(){k=l});d.on("mouseup",function(){k=g});e.on("focusin",function(a){if("body"==(new v(a.target)).nodeName()&&h){try{k&&h.select()}catch(b){}h=
n}});e.on("focus",function(){f=g;c()});e.on("beforedeactivate",function(a){a.relatedTarget||(f=l,k=g)});e.on("mousedown",function(){f=l});e.on("mouseup",function(){f=g;setTimeout(function(){c(g)},0)});e.on("keydown",function(){f=l});e.on("keyup",function(){f=g;setTimeout(function(){c()},0)})}function p(a){var c=a.get("document")[0];w.on(c,"mouseup keyup selectionchange",function(){a.checkSelectionChange()})}function e(a){function c(a){var b=i.XHTML_DTD;return a._4e_isBlockBoundary()&&b.$empty[a.nodeName()]}
function b(a){return d(a)&&h(a)}var e=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<\!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,d=i.Walker.whitespaces(g),h=i.Walker.bookmark(l,g),f=function(a){return d(a)&&8!=a.nodeType};a.on("selectionChange",function(d){var h=d.path,n=new v(a.get("document")[0].body),d=(d=d.selection)&&d.getRanges()[0],s=h.blockLimit;if(m.gecko){var p=h.block||h.blockLimit,q=p&&p.last(b);p&&p._4e_isBlockBoundary()&&(!q||!(1==q[0].nodeType&&
q._4e_isBlockBoundary()))&&"pre"!=p.nodeName()&&!p._4e_getBogus()&&p._4e_appendBogus()}if(d&&d.collapsed&&!h.block){if("body"==s.nodeName()){if((h=d.fixBlock(g,"p"))&&h[0]!=n[0].lastChild&&h.outerHTML().match(e))if((s=h.next(f,1))&&s[0].nodeType==o.NodeType.ELEMENT_NODE&&!c[s])d.moveToElementEditablePosition(s),h._4e_remove();else if((s=h.prev(f,1))&&s[0].nodeType==o.NodeType.ELEMENT_NODE&&!c[s])d.moveToElementEditablePosition(s,s.outerHTML().match(e)?l:g),h._4e_remove();d.select();a.notifySelectionChange()}h=
a.get("document")[0];d=new i.Range(h);d.moveToElementEditablePosition(n,g);"body"!==(new i.ElementPath(d.startContainer)).blockLimit.nodeName()&&(n=(new v(h.createElement("p"))).appendTo(n),m.ie||n._4e_appendBogus())}})}var g=!0,l=!1,n=null,m=a.UA,w=a.Event,o=a.DOM,v=a.Node,y=i.SELECTION;return{init:function(a){a.docReady(function(){m.ie?(s(a),q(a)):p(a)});e(a)}}},{requires:["./base","./selection"]});
KISSY.add("editor/core/styles",function(a,i){function s(a){return!z.attr(a,"_ke_bookmark")}function q(a,b){for(var c in a)"string"==typeof a[c]?a[c]=a[c].replace(S,function(a,c){return b[c]}):q(a[c],b)}function p(b,c){c&&(b=a.clone(b),q(b,c));var d=this.element=this.element=(b.element||"*").toLowerCase();this.type=this.type="#text"==d||R[d]?E.STYLE_BLOCK:P[d]?E.STYLE_OBJECT:E.STYLE_INLINE;this._={definition:b}}function e(a,b){var c=b?this.removeFromRange:this.applyToRange;a.body.focus();for(var d=
new D(a),e=d.getRanges(),g=0;g<e.length;g++)c.call(this,e[g]);d.selectRanges(e)}function g(a,b,c){var d=a.element;"*"==d&&(d="span");b=new G(b.createElement(d));c&&c._4e_copyAttributes(b);c=a._.definition;a=c.attributes;c=p.getStyleText(c);if(a)for(var e in a)b.attr(e,a[e]);c&&(b[0].style.cssText=c);return b}function l(a){var b=a.createBookmark(k),c=a.createIterator();c.enforceRealBlocks=k;c.enlargeBr=k;for(var d,e=a.document;d=c.getNextParagraph();){var f=g(this,e,d),h=f,f="pre"==h.nodeName,j="pre"==
d.nodeName,i=!f&&j;f&&!j?(j=d,i=j.html(),i=n(i,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),i=i.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),i=i.replace(/([ \t\n\r]+|&nbsp;)/g," "),i=i.replace(/<br\b[^>]*>/gi,"\n"),L.ie?(j=j[0].ownerDocument.createElement("div"),j.appendChild(h[0]),h[0].outerHTML="<pre>"+i+"</pre>",h=new G(j.firstChild),h._4e_remove()):h.html(i)):i?h=w(m(d),h):d._4e_moveChildren(h);d[0].parentNode.replaceChild(h[0],d[0]);if(f&&(d=h,f=void 0,(f=d._4e_previousSourceNode(k,z.NodeType.ELEMENT_NODE))&&
"pre"==f.nodeName()))h=n(f.html(),/\n$/,"")+"\n\n"+n(d.html(),/^\n/,""),L.ie?d[0].outerHTML="<pre>"+h+"</pre>":d.html(h),f._4e_remove()}a.moveToBookmark(b)}function n(a,b,c){var d="",e="",a=a.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(a,b,c){b&&(d=b);c&&(e=c);return""});return d+a.replace(b,c)+e}function m(a){var b=[];n(a.outerHTML(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(a,b,c){return b+"</pre>"+c+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(a,c){b.push(c)});return b}function w(a,b){for(var c=b[0].ownerDocument.createDocumentFragment(),d=0;d<a.length;d++){var e=a[d],e=e.replace(/(\r\n|\r)/g,"\n"),e=n(e,/^[ \t]*\n/,""),e=n(e,/\n$/,""),e=n(e,/^[ \t]+|[ \t]+$/g,function(a,b){return 1==a.length?"&nbsp;":b?" "+Array(a.length).join("&nbsp;"):Array(a.length).join("&nbsp;")+" "}),e=e.replace(/\n/g,"<br>"),e=e.replace(/[ \t]{2,}/g,function(a){return Array(a.length).join("&nbsp;")+" "}),f=b.clone();f.html(e);c.appendChild(f[0])}return c}
function o(a){var b=a.document;if(a.collapsed)b=g(this,b,void 0),a.insertNode(b),a.moveToPosition(b,t.POSITION_BEFORE_END);else{var c=this.element,e=this._.definition,f,h=K[c];h||(f=k,h=K.span);var j=a.createBookmark();a.enlarge(t.ENLARGE_ELEMENT);a.trim();for(var i=a.createBookmark(),l=i.startNode,i=i.endNode,m=l,r;m&&m[0];){var n=u;if(z.equals(m,i))m=B,n=k;else{var o=m[0].nodeType,p=o==z.NodeType.ELEMENT_NODE?m.nodeName():B;if(p&&m.attr("_ke_bookmark")){m=m._4e_nextSourceNode(k);continue}if(!p||
h[p]&&(m._4e_position(i)|x.POSITION_PRECEDING|x.POSITION_IDENTICAL|x.POSITION_IS_CONTAINED)==x.POSITION_PRECEDING+x.POSITION_IDENTICAL+x.POSITION_IS_CONTAINED&&(!e.childRule||e.childRule(m))){var q=m.parent();if(q&&"a"==c&&q.nodeName()==c)o=g(this,b,void 0),q._4e_moveChildren(o),q[0].parentNode.replaceChild(o[0],q[0]),o._4e_mergeSiblings();else if(q&&q[0]&&((K[q.nodeName()]||K.span)[c]||f)&&(!e.parentRule||e.parentRule(q))){if(!r&&(!p||!K.$removeEmpty[p]||(m._4e_position(i)|x.POSITION_PRECEDING|x.POSITION_IDENTICAL|
x.POSITION_IS_CONTAINED)==x.POSITION_PRECEDING+x.POSITION_IDENTICAL+x.POSITION_IS_CONTAINED))r=new O(b),r.setStartBefore(m);if(o==z.NodeType.TEXT_NODE||o==z.NodeType.ELEMENT_NODE&&!m[0].childNodes.length){q=m;for(o=null;(n=!q.next(s,1))&&(o=q.parent())&&h[o.nodeName()]&&(o._4e_position(l)|x.POSITION_FOLLOWING|x.POSITION_IDENTICAL|x.POSITION_IS_CONTAINED)==x.POSITION_FOLLOWING+x.POSITION_IDENTICAL+x.POSITION_IS_CONTAINED&&(!e.childRule||e.childRule(o));)q=o;r.setEndAfter(q)}}else n=k}else n=k;m=m._4e_nextSourceNode()}if(n&&
r&&!r.collapsed){for(var n=g(this,b,void 0),q=r.getCommonAncestor(),o={},p={},w,v=null,y;n&&q&&n[0]&&q[0];){if(q.nodeName()==c){for(w in e.attributes)if(!p[w]&&(y=q.attr(v)))n.attr(w)==y?n.removeAttr(w):p[w]=1;for(v in e.styles)if(!o[v]&&(y=q.style(v)))n.style(v)==y?n.style(v,""):o[v]=1;if(!n._4e_hasAttributes()){n=B;break}}q=q.parent()}n?(n[0].appendChild(r.extractContents()),d(this,n),r.insertNode(n),n._4e_mergeSiblings(),L.ie||n[0].normalize()):(n=new G(b.createElement("span")),n[0].appendChild(r.extractContents()),
r.insertNode(n),d(this,n),n._4e_remove(!0));r=B}}l._4e_remove();i._4e_remove();a.moveToBookmark(j);a.shrink(t.SHRINK_TEXT)}}function v(a){a.enlarge(t.ENLARGE_ELEMENT);var d=a.createBookmark(),e=d.startNode;if(a.collapsed){for(var f=new N(e.parent()),g,j=0,i;j<f.elements.length&&(i=f.elements[j])&&!(i==f.block||i==f.blockLimit);j++)if(this.checkElementRemovable(i)){var k=a.checkBoundaryOfElement(i,t.END),l=!k&&a.checkBoundaryOfElement(i,t.START);l||k?(g=i,g.match=l?"start":"end"):(i._4e_mergeSiblings(),
i.nodeName()!=this.element?(k=c(this),h(i,k[i.nodeName()]||k["*"])):b(this,i))}if(g){i=e;for(j=0;;j++){k=f.elements[j];if(k.equals(g))break;else if(k.match)continue;else k=k.clone();k[0].appendChild(i[0]);i=k}i["start"==g.match?"insertBefore":"insertAfter"](g);f=g.html();!f||"\u200b"==f?g.remove():L.webkit&&C(a.document.createTextNode("\u200b")).insertBefore(i)}}else{var m=d.endNode,n=this;g=function(){for(var a=new N(e.parent()),b=new N(m.parent()),c=B,d=B,f=0;f<a.elements.length;f++){var g=a.elements[f];
if(g==a.block||g==a.blockLimit)break;n.checkElementRemovable(g)&&(c=g)}for(f=0;f<b.elements.length;f++){g=b.elements[f];if(g==b.block||g==b.blockLimit)break;n.checkElementRemovable(g)&&(d=g)}d&&m._4e_breakParent(d);c&&e._4e_breakParent(c)};g();for(f=new G(e[0].nextSibling);f[0]!==m[0];){j=f._4e_nextSourceNode();if(f[0]&&f[0].nodeType==z.NodeType.ELEMENT_NODE&&this.checkElementRemovable(f)&&(f.nodeName()==this.element?b(this,f):(i=c(this),h(f,i[f.nodeName()]||i["*"])),j[0].nodeType==z.NodeType.ELEMENT_NODE&&
j.contains(e)))g(),j=new G(e[0].nextSibling);f=j}}a.moveToBookmark(d)}function y(a){var b={};(""+a).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,c,d){b[c]=d});return b}function j(a,b){var c="";b!==u?(c=document.createElement("span"),c.style.cssText=a,c=c.style.cssText||""):c=a;return c.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function c(b){if(b._.overrides)return b._.overrides;var c=b._.overrides={},d=b._.definition.overrides;
if(d){a.isArray(d)||(d=[d]);for(var e=0;e<d.length;e++){var f=d[e],g,h,j;"string"==typeof f?g=f.toLowerCase():(g=f.element?f.element.toLowerCase():b.element,h=f.attributes,j=f.styles);f=c[g]||(c[g]={});if(h){g=f.attributes=f.attributes||[];for(var i in h)g.push([i.toLowerCase(),h[i]])}if(j){var f=f.styles=f.styles||[],k;for(k in j)f.push([k.toLowerCase(),j[k]])}}}return c}function b(b,d){var e=b._.definition,g=c(b),h=a.merge(e.attributes,(g[d.nodeName()]||g["*"]||{}).attributes),e=a.merge(e.styles,
(g[d.nodeName()]||g["*"]||{}).styles),g=a.isEmptyObject(h)&&a.isEmptyObject(e),j;for(j in h)("class"==j||b._.definition.fullMatch)&&d.attr(j)!=r(j,h[j])||(g=g||!!d.hasAttr(j),d.removeAttr(j));for(var i in e)b._.definition.fullMatch&&d.style(i)!=r(i,e[i],k)||(g=g||!!d.style(i),d.style(i,""));f(d)}function r(a,b,c){var d=new G("<span>");d[c?"style":"attr"](a,b);return d[c?"style":"attr"](a)}function d(a,d){for(var e=c(a),f=d.all(a.element),g=f.length;0<=--g;)b(a,new G(f[g]));for(var j in e)if(j!=a.element){f=
d.all(j);for(g=f.length-1;0<=g;g--){var i=new G(f[g]);h(i,e[j])}}}function h(a,b){var c,d=b&&b.attributes;if(d)for(c=0;c<d.length;c++){var e=d[c][0],g;if(g=a.attr(e)){var h=d[c][1];(h===B||h.test&&h.test(g)||"string"==typeof h&&g==h)&&a[0].removeAttribute(e)}}if(d=b&&b.styles)for(c=0;c<d.length;c++)if(e=d[c][0],h=a.css(e)){var j=d[c][1];(j===B||j.test&&j.test(g)||"string"==typeof j&&h==j)&&a.css(e,"")}f(a)}function f(a){if(!a._4e_hasAttributes()){var b=a[0].firstChild,c=a[0].lastChild;a._4e_remove(k);
b&&(b.nodeType==z.NodeType.ELEMENT_NODE&&z._4e_mergeSiblings(b),c&&b!=c&&c.nodeType==z.NodeType.ELEMENT_NODE&&z._4e_mergeSiblings(c))}}var k=!0,u=!1,B=null,C=a.all,z=a.DOM,E={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},t=i.RANGE,D=i.Selection,x=i.POSITION,O=i.Range,G=a.Node,L=a.UA,N=i.ElementPath,R={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},K=i.XHTML_DTD,P={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},Q=/\s*(?:;\s*|$)/g,S=/#\((.+?)\)/g;i.STYLE=
E;p.prototype={constructor:p,apply:function(a){e.call(this,a,u)},remove:function(a){e.call(this,a,k)},applyToRange:function(a){return(this.applyToRange=this.type==E.STYLE_INLINE?o:this.type==E.STYLE_BLOCK?l:B).call(this,a)},removeFromRange:function(a){return(this.removeFromRange=this.type==E.STYLE_INLINE?v:B).call(this,a)},checkElementRemovable:function(a,b){if(!a)return u;var d=this._.definition,e;if(a.nodeName()==this.element){if(!b&&!a._4e_hasAttributes())return k;var f=d._AC;if(f)d=f;else{var f=
{},g=0,h=d.attributes;if(h)for(var i in h)g++,f[i]=h[i];if(h=p.getStyleText(d))f.style||g++,f.style=h;f._length=g;d=d._AC=f}if(d._length){for(var l in d)if("_length"!=l){g=a.attr(l)||"";if("style"==l)a:{f=d[l];g=j(g,u);"string"==typeof f&&(f=y(f));"string"==typeof g&&(g=y(g));h=void 0;for(h in f)if(!(h in g&&(g[h]==f[h]||"inherit"==f[h]||"inherit"==g[h]))){f=u;break a}f=k}else f=d[l]==g;if(f){if(!b)return k}else if(b)return u}if(b)return k}else return k}l=c(this);if(l=l[a.nodeName()]||l["*"]){if(!(d=
l.attributes)&&!(e=l.styles))return k;if(d)for(f=0;f<d.length;f++)if(l=d[f][0],l=a.attr(l))if(g=d[f][1],g===B||"string"==typeof g&&l==g||g.test&&g.test(l))return k;if(e)for(f=0;f<e.length;f++)if(l=a.css(e[f][0]))if(d=e[f][1],d===B||"string"==typeof d&&l==d||d.test&&d.test(l))return k}return u},checkActive:function(a){switch(this.type){case E.STYLE_BLOCK:return this.checkElementRemovable(a.block||a.blockLimit,k);case E.STYLE_OBJECT:case E.STYLE_INLINE:for(var b=a.elements,c=0,d;c<b.length;c++)if(d=
b[c],!(this.type==E.STYLE_INLINE&&(z.equals(d,a.block)||z.equals(d,a.blockLimit))))if((this.type!=E.STYLE_OBJECT||d.nodeName()in P)&&this.checkElementRemovable(d,k))return k}return u}};p.getStyleText=function(a){var b=a._ST;if(b)return b;var b=a.styles,c=a.attributes&&a.attributes.style||"",d="";c.length&&(c=c.replace(Q,";"));for(var e in b){var f=b[e],g=(e+":"+f).replace(Q,";");"inherit"==f?d+=g:c+=g}c.length&&(c=j(c));return a._ST=c+d};return i.Style=p},{requires:["./base","./range","./selection",
"./domIterator","./elementPath"]});
KISSY.add("editor/core/utils",function(a){var i=a.Node,s=a.DOM,q=a.UA,p={debugUrl:function(e){var g=a.Config;g.debug||(e=e.replace(/\.(js|css)/i,"-min.$1"));-1==e.indexOf("?t")&&(e=-1!=e.indexOf("?")?e+"&":e+"?",e+="t="+encodeURIComponent(g.tag));return g.base+"editor/"+e},lazyRun:function(a,g,i){var n=a[g],m=a[i];a[g]=function(){n.apply(this,arguments);a[g]=a[i];return m.apply(this,arguments)}},getXY:function(a,g){var i=a.left,n=a.top,m=g.get("window")[0],i=i-s.scrollLeft(m),n=n-s.scrollTop(m),m=
g.get("iframe").offset(),i=i+m.left,n=n+m.top;return{left:i,top:n}},tryThese:function(a){for(var g,i=0,n=arguments.length;i<n;i++){var m=arguments[i];try{g=m();break}catch(p){}}return g},arrayCompare:function(a,g){if(!a&&!g)return!0;if(!a||!g||a.length!=g.length)return!1;for(var i=0;i<a.length;i++)if(a[i]!==g[i])return!1;return!0},clearAllMarkers:function(a){for(var g in a)a[g]._4e_clearMarkers(a,!0,void 0)},ltrim:function(a){return a.replace(/^\s+/,"")},rtrim:function(a){return a.replace(/\s+$/,
"")},isNumber:function(e){return/^\d+(.\d+)?$/.test(a.trim(e))},verifyInputs:function(e){for(var g=0;g<e.length;g++){var l=new i(e[g]),n=a.trim(p.valInput(l)),m=l.attr("data-verify"),l=l.attr("data-warning");if(m&&!RegExp(m).test(n))return alert(l),!1}return!0},sourceDisable:function(a,g){a.on("sourceMode",g.disable,g);a.on("wysiwygMode",g.enable,g)},resetInput:function(a){var g=a.attr("placeholder");g&&q.ie?(a.addClass("ks-editor-input-tip"),a.val(g)):q.ie||a.val("")},valInput:function(a,g){if(void 0===
g)return a.hasClass("ks-editor-input-tip")?"":a.val();a.removeClass("ks-editor-input-tip");a.val(g)},placeholder:function(e,g){e.attr("placeholder",g);q.ie&&(e.on("blur",function(){a.trim(e.val())||(e.addClass("ks-editor-input-tip"),e.val(g))}),e.on("focus",function(){e.removeClass("ks-editor-input-tip");a.trim(e.val())==g&&e.val("")}))},htmlEncode:function(a){return!a?a:(""+a).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},normParams:function(e){var e=a.clone(e),
g;for(g in e){var i=e[g];a.isFunction(i)&&(e[g]=i())}return e},map:function(a,g){for(var i=0;i<a.length;i++)a[i]=g(a[i]);return a},ieEngine:document.documentMode||q.ie,preventFocus:function(a){q.ie?a.unselectable():a.attr("onmousedown","return false;")},injectDom:function(e){a.mix(s,e);for(var g in e)(function(g){i.prototype[g]=function(){var n=[].slice.call(arguments,0);n.unshift(this[0]);return(n=e[g].apply(null,n))&&(n.nodeType||a.isWindow(n))?new i(n):a.isArray(n)&&(n.__IS_NODELIST||n[0]&&n[0].nodeType)?
new i(n):n}})(g)},addRes:function(){var e=this.__res=this.__res||[];e.push.apply(e,a.makeArray(arguments))},destroyRes:function(){for(var e=this.__res||[],g=0;g<e.length;g++){var i=e[g];a.isFunction(i)?i():i.destroy?i.destroy():i.remove&&i.remove()}this.__res=[]},getQueryCmd:function(a){return"query"+("-"+a).replace(/-(\w)/g,function(a,e){return e.toUpperCase()})+"Value"}};return a.Editor.Utils=p},{requires:["./base"]});
KISSY.add("editor/core/walker",function(a,i){function s(a,c){if(this._.end)return l;var d,h=this.range,f,i=this.guard,j=this.type,n=a?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start&&(this._.start=1,h.trim(),h.collapsed))return this.end(),l;if(!a&&!this._.guardLTR){var p=h.endContainer[0],q=p.childNodes[h.endOffset];this._.guardLTR=function(a,b){return b&&(p==a||"body"==m.nodeName(a))?!1:a!=q}}if(a&&!this._.guardRTL){var s=h.startContainer[0],t=0<h.startOffset&&s.childNodes[h.startOffset-
1]||null;this._.guardRTL=function(a,b){return b&&(s==a||"body"==m.nodeName(a))?!1:a!=t}}var v=a?this._.guardRTL:this._.guardLTR;f=i?function(a,b){return v(a,b)===g?g:i(a,b)}:v;this.current?d=this.current[n](g,j,f):a?(d=h.endContainer,0<h.endOffset?(d=new o(d[0].childNodes[h.endOffset-1]),f(d[0])===g&&(d=l)):d=f(d,e)===g?l:d._4e_previousSourceNode(e,j,f,void 0)):(d=h.startContainer,d=new o(d[0].childNodes[h.startOffset]),d.length?f(d[0])===g&&(d=l):d=f(h.startContainer,e)===g?l:h.startContainer._4e_nextSourceNode(e,
j,f,void 0));for(;d&&!this._.end;){this.current=d;if(!this.evaluator||this.evaluator(d[0])!==g){if(!c)return d}else if(c&&this.evaluator)return g;d=d[n](g,j,f)}this.end();return this.current=l}function q(a){for(var c,d=l;c=s.call(this,a);)d=c;return d}function p(a){this.range=a;this.guard=this.evaluator=l;this._={}}var e=!0,g=!1,l=null,n=a.UA,m=a.DOM,w=i.XHTML_DTD,o=a.Node;a.augment(p,{end:function(){this._.end=1},next:function(){return s.call(this)},previous:function(){return s.call(this,e)},checkForward:function(){return s.call(this,
g,e)!==g},checkBackward:function(){return s.call(this,e,e)!==g},lastForward:function(){return q.call(this)},lastBackward:function(){return q.call(this,e)},reset:function(){delete this.current;this._={}},_iterator:s});a.mix(p,{blockBoundary:function(a){return function(c){return!(c.nodeType==m.NodeType.ELEMENT_NODE&&m._4e_isBlockBoundary(c,a))}},bookmark:function(a,c){function d(a){return"span"==m.nodeName(a)&&m.attr(a,"_ke_bookmark")}return function(e){var f,g;f=e.nodeType==m.NodeType.TEXT_NODE&&(g=
e.parentNode)&&d(g);f=a?f:f||d(e);return!!(c^f)}},whitespaces:function(b){return function(c){c=c.nodeType==m.NodeType.TEXT_NODE&&!a.trim(c.nodeValue);return!!(b^c)}},invisible:function(a){var c=p.whitespaces();return function(d){d=c(d)||d.nodeType==m.NodeType.ELEMENT_NODE&&!d.offsetHeight;return!!(a^d)}}});var v=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,y=p.whitespaces(),j=p.bookmark(),c=function(a){var c=m.nodeName(a);return j(a)||y(a)||1==a.nodeType&&c in w.$inline&&!(c in w.$empty)};i.Utils.injectDom({_4e_getBogus:function(a){a=
new o(a);do a=a._4e_previousSourceNode();while(a&&c(a[0]));return a&&(!n.ie?"br"==a.nodeName():3==a[0].nodeType&&v.test(a.text()))?a[0]:!1}});return i.Walker=p},{requires:["./base","./utils","./dom"]});KISSY.add("editor/core/zIndexManager",function(a){var i=a.Editor,a=i.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};i.baseZIndex=function(a){return(i.Config.baseZIndex||1E4)+a};return a},{requires:["./base"]});
