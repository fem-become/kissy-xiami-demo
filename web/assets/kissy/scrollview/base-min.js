/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 17 01:31
*/
KISSY.add("scrollview/base",function(f,o,q,p,n,k){var e=e,r=f.all,f=f.Features.isTouchSupported(),m=k.KeyCodes;return q.Controller.extend({bindUI:function(){var a=this.get("el");a.on("mousewheel",this._onMouseWheel,this);a.on("scroll",this._onElScroll,this)},syncUI:function(){var a=this.get("el")[0],c=this.get("contentEl"),b=c[0],d=Math.max(a.scrollHeight,b.scrollHeight),g=Math.max(a.scrollWidth,b.scrollWidth),b=a.clientHeight,e,i=a.clientWidth;this.scrollHeight=d;this.scrollWidth=g;this.clientHeight=
b;this.clientWidth=i;var h=c.offset();e=this._allowScroll={};d>b&&(e.top=1);g>i&&(e.left=1);this.minScroll={left:0,top:0};var f,k;this.maxScroll={left:f=g-i,top:k=d-b};a=r(a.ownerDocument);this.scrollStep={top:Math.max(0.7*b*b/a.height(),20),left:Math.max(0.7*i*i/a.width(),20)};b=this.get("snap");a=this.get("scrollLeft");d=this.get("scrollTop");if(b){var c=this._pages="string"==typeof b?c.all(b):c.children(),b=this.get("pageIndex"),j=this._pagesXY=[];c.each(function(a,b){var c=a.offset(),d=c.left-
h.left,c=c.top-h.top;d<=f&&c<=k&&(j[b]={x:d,y:c,index:b})});if(b){this.scrollToPage(b);return}}this.scrollTo(a,d)},_onElScroll:function(){var a=this.get("el")[0],c=a.scrollTop,b=a.scrollLeft;c&&this.set("scrollTop",c+this.get("scrollTop"));b&&this.set("scrollLeft",b+this.get("scrollLeft"));a.scrollTop=a.scrollLeft=0},handleKeyEventInternal:function(a){var c=a.target,b=o.nodeName(c);if("input"==b||"textarea"==b||"select"==b||o.hasAttr(c,"contenteditable"))return e;var a=a.keyCode,d=this.isAxisEnabled("x"),
g=this.isAxisEnabled("y"),c=this.minScroll,b=this.maxScroll,l=this.scrollStep,i,h=e;if(g){var f=l.top,k=this.clientHeight,j=this.get("scrollTop"),g=j==b.top;i=j==c.top;if(a==m.DOWN){if(g)return e;this.scrollTo(e,j+f);h=!0}else if(a==m.UP){if(i)return e;this.scrollTo(e,j-f);h=!0}else if(a==m.PAGE_DOWN){if(g)return e;this.scrollTo(e,j+k);h=!0}else if(a==m.PAGE_UP){if(i)return e;this.scrollTo(e,j-k);h=!0}}if(d)if(d=l.left,l=this.get("scrollLeft"),g=l==b.left,i=l==c.left,a==m.RIGHT){if(g)return e;this.scrollTo(l+
d);h=!0}else if(a==m.LEFT){if(i)return e;this.scrollTo(l-d);h=!0}return h},_onMouseWheel:function(a){if(!this.get("disabled")){var c,b,d=this.scrollStep,g,l=this.maxScroll,i=this.minScroll;if((g=a.deltaY)&&this.isAxisEnabled("y")){var h=this.get("scrollTop");c=l.top;b=i.top;h<=b&&0<g||h>=c&&0>g||(this.scrollTo(e,h-a.deltaY*d.top),a.preventDefault())}if((g=a.deltaX)&&this.isAxisEnabled("x"))h=this.get("scrollLeft"),c=l.left,b=i.left,h<=b&&0<g||h>=c&&0>g||(this.scrollTo(h-a.deltaX*d.left),a.preventDefault())}},
isAxisEnabled:function(a){return this._allowScroll["x"==a?"left":"top"]},stopAnimation:function(){this.get("contentEl").stop()},_uiSetPageIndex:function(a){this.scrollToPage(a)},_getPageIndexFromXY:function(a,c,b){var d=this._pagesXY.concat([]),g=c?"x":"y";d.sort(function(a,b){return a[g]-b[g]});if(0<b)for(c=0;c<d.length;c++){if(b=d[c],b[g]>=a)return b.index}else for(c=d.length-1;0<=c;c--)if(b=d[c],b[g]<=a)return b.index;return e},scrollToPage:function(a,c){var b;if((b=this._pagesXY)&&b[a])this.setInternal("pageIndex",
a),this.scrollTo(b[a].x,b[a].y,c)},scrollTo:function(a,c,b){var d=this,g=d._allowScroll,f,i,h=d.maxScroll,k=d.minScroll;d.stopAnimation();a!=e&&g.left&&(a=Math.min(Math.max(a,k.left),h.left),f=1);c!=e&&g.top&&(c=Math.min(Math.max(c,k.top),h.top),i=1);if(b){var m=d.get("scrollLeft"),j=d.get("scrollTop");d.get("contentEl").stop(0,1).animate({xx:{fx:{frame:function(b,e){f&&d.set("scrollLeft",m+e.pos*(a-m));i&&d.set("scrollTop",j+e.pos*(c-j))}}}},b)}else f&&d.set("scrollLeft",a),i&&d.set("scrollTop",
c)}},{ATTRS:{contentEl:{view:1},scrollLeft:{view:1},scrollTop:{view:1},focusable:{value:!f},allowTextSelection:{value:!0},handleMouseEvents:{value:!1},snap:{value:!1},snapDuration:{value:0.3},snapEasing:{value:"easeOut"},pageIndex:{value:0},xrender:{value:n}}},{xclass:"scrollview"})},{requires:["dom","component/base","component/extension","./base/render","event"]});
KISSY.add("scrollview/base/render",function(f,o,q){var p,n={_onSetScrollLeft:function(f){this.get("contentEl")[0].style.left=-f+"px"},_onSetScrollTop:function(f){this.get("contentEl")[0].style.top=-f+"px"}};f.Features.isTransformSupported()&&(p=(f=f.Features.getTransformPrefix())?f+"Transform":"transform",n._onSetScrollLeft=function(f){var e=this.get("scrollTop");this.get("contentEl")[0].style[p]="translate3d("+-f+"px,"+-e+"px,0)"},n._onSetScrollTop=function(f){var e=this.get("scrollLeft");this.get("contentEl")[0].style[p]=
"translate3d("+-e+"px,"+-f+"px,0)"});return o.Render.extend([q.ContentRender],n,{ATTRS:{scrollLeft:{value:0},scrollTop:{value:0}}})},{requires:["component/base","component/extension"]});
