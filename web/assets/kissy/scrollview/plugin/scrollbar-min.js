/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 23 00:54
*/
KISSY.add("scrollview/plugin/scrollbar/control",function(f,i,h,g,e){var d=i.Gesture;return g.Controller.extend({bindUI:function(){var a=this,b=a.get("autoHide"),c=a.get("scrollview");a._xAxis="x"==a.get("axis");b?a._hideFn=function(){a.hide()}:(f.each([a.get("downBtn"),a.get("upBtn")],function(b){b.on(d.start,a._onUpDownBtnMouseDown,a).on(d.end,a._onUpDownBtnMouseUp,a)}),a.get("trackEl").on(d.start,a._onTrackElMouseDown,a),a.dd=(new h.Draggable({node:a.get("dragEl"),groups:!1,halt:!0})).on("drag",
a._onDrag,a).on("dragstart",a._onDragStart,a));c.on("afterScroll"+(a._xAxis?"Left":"Top")+"Change.ks-scrollbar",a.afterScrollChange,a).on("scrollEnd.ks-scrollbar",a._onScrollEnd,a).on("afterDisabledChange",a._onScrollViewDisabled,a)},syncUI:function(){var a=this.get("scrollview"),b=this.get("trackEl");this.get("dragEl");var c=this.get("rendered");this.scrollview=a;if(this._xAxis){if(c&&!a.isAxisEnabled("x")){this.hide();return}this._scrollLength=a.scrollWidth;b=this._trackElSize=b.width();a=a.clientWidth/
this._scrollLength;this.set("dragWidth",this.barSize=a*b)}else{if(c&&!a.isAxisEnabled("y")){this.hide();return}this._scrollLength=a.scrollHeight;b=this._trackElSize=b.height();a=a.clientHeight/this._scrollLength;this.set("dragHeight",this.barSize=a*b)}this._syncAndReRender()},destructor:function(){this.get("scrollview").detach(".ks-scrollbar");this._clearHideTimer()},_onScrollViewDisabled:function(a){this.set("disabled",a.newVal)},_onDragStart:function(){var a=this.scrollview,b=this._xAxis;this._startMousePos=
this.dd.get("startMousePos")[b?"left":"top"];this._startScroll=a.get(b?"scrollLeft":"scrollTop")},_onDrag:function(a){var b=this._xAxis,c=this.scrollview,a=this._startScroll+(a[b?"pageX":"pageY"]-this._startMousePos)/this._trackElSize*this._scrollLength;b?c.scrollTo(a):c.scrollTo(void 0,a)},_startHideTimer:function(){this._clearHideTimer();this._hideTimer=setTimeout(this._hideFn,1E3*this.get("hideDelay"))},_clearHideTimer:function(){this._hideTimer&&(clearTimeout(this._hideTimer),this._hideTimer=
null)},_onUpDownBtnMouseDown:function(a){if(!this.get("disabled")){a.halt();var b=this.scrollview,c=this._xAxis,d=c?"scrollLeft":"scrollTop",f=b.scrollStep[c?"left":"top"],j=this.get("downBtn"),a=a.target,e=a==j[0]||j.contains(a)?1:-1,c=c?function(){b.scrollTo(b.get(d)+e*f)}:function(){b.scrollTo(void 0,b.get(d)+e*f)};clearInterval(this.mouseInterval);this.mouseInterval=setInterval(c,100);c()}},_onTrackElMouseDown:function(a){if(!this.get("disabled")){var b=a.target,c=this.get("dragEl");if(!(c[0]==
b||c.contains(b))){var d=(b=this._xAxis)?"left":"top",f=b?"pageX":"pageY",e=this.get("trackEl"),g=-1!=a.type.indexOf("touch")?a.touches[0]:a,c=this.scrollview,d=Math.max(0,(g[f]-e.offset()[d]-this.barSize/2)/this._trackElSize)*this._scrollLength;b?c.scrollTo(d):c.scrollTo(void 0,d);a.halt()}}},_onUpDownBtnMouseUp:function(){clearInterval(this.mouseInterval)},_onScrollEnd:function(a){this._hideFn&&this.get("axis")==a.axis&&this._startHideTimer()},afterScrollChange:function(){var a=this.scrollview;
this._clearHideTimer();this.show();this._hideFn&&!a.dd.get("dragging")&&this._startHideTimer();this._syncAndReRender()},_syncAndReRender:function(){var a=this._xAxis,b=this.scrollview,c=a?"dragLeft":"dragTop",d=a?"dragWidth":"dragHeight",f=this.barSize,e=this._scrollLength,g=this._trackElSize,h=b.get(a?"scrollLeft":"scrollTop"),i=b.maxScroll,b=b.minScroll,b=a?b.left:b.top,a=a?i.left:i.top;h>a?(e=a/e*g,this.set(d,f-(h-a)),this.set(c,e+f-this.get(d))):h<b?(e=b/e*g,this.set(d,f-(b-h)),this.set(c,e)):
(this.set(c,h/e*g),this.set(d,f))},_onSetDisabled:function(a){this.dd&&this.dd.set("disabled",a)}},{ATTRS:{minLength:{value:20},scrollview:{view:1},axis:{view:1},autoHide:{value:f.UA.ios},visible:{valueFn:function(){return!this.get("autoHide")}},hideDelay:{value:0.1},dragWidth:{setter:function(a){var b=this.get("minLength");return a<b?b:a},view:1},dragHeight:{setter:function(a){var b=this.get("minLength");return a<b?b:a},view:1},dragLeft:{view:1},dragTop:{view:1},dragEl:{view:1},downBtn:{view:1},
upBtn:{view:1},trackEl:{view:1},focusable:{value:!1},xrender:{value:e}}},{xclass:"scrollbar"})},{requires:["event","dd/base","component/base","./render"]});
KISSY.add("scrollview/plugin/scrollbar/render",function(f,i,h){var g=f.Features.isTransformSupported(),e=f.Features.getTransformPrefix(),d={initializer:function(){var a=this.get("axis"),c=this.prefixCls;this.get("elCls").push(c+"scrollbar-"+a);f.mix(this.get("childrenElSelectors"),{dragEl:"#ks-scrollbar-drag{id}",downBtn:"#ks-scrollbar-arrow-down{id}",upBtn:"#ks-scrollbar-arrow-up{id}",trackEl:"#ks-scrollbar-track{id}"})},_onSetDragHeight:function(a){this.get("dragEl")[0].style.height=a+"px"},_onSetDragWidth:function(a){this.get("dragEl")[0].style.width=
a+"px"},_onSetDragLeft:function(a){this.get("dragEl")[0].style.left=a+"px"},_onSetDragTop:function(a){this.get("dragEl")[0].style.top=a+"px"}},a=e?e+"Transform":"transform";g&&(d._onSetDragLeft=function(b){this.get("dragEl")[0].style[a]="translateX("+b+"px) translateZ(0)"},d._onSetDragTop=function(b){this.get("dragEl")[0].style[a]="translateY("+b+"px) translateZ(0)"});return i.Render.extend(d,{ATTRS:{contentTpl:{value:h},axis:{},scrollview:{},dragWidth:{},dragHeight:{},dragLeft:{},dragTop:{},dragEl:{},
downBtn:{},upBtn:{},trackEl:{}}})},{requires:["component/base","./scrollbar-tpl"]});KISSY.add("scrollview/plugin/scrollbar/scrollbar-tpl",function(){return'<div id="ks-scrollbar-track{{id}}" class="{{getBaseCssClasses axis+"-track"}}"> <div id="ks-scrollbar-drag{{id}}" class="{{getBaseCssClasses axis+"-drag"}}"> <div class="{{getBaseCssClasses axis+"-drag-top"}}"> </div> <div class="{{getBaseCssClasses axis+"-drag-center"}}"> </div> <div class="{{getBaseCssClasses axis+"-drag-bottom"}}"> </div> </div> </div> <div id="ks-scrollbar-arrow-up{{id}}" class="{{getBaseCssClasses axis+"-arrow-up"}}"> <a href="javascript:void(\'up\')">up</a> </div> <div id="ks-scrollbar-arrow-down{{id}}" class="{{getBaseCssClasses axis+"-arrow-down"}}"> <a href="javascript:void(\'down\')">down</a> </div>'});
KISSY.add("scrollview/plugin/scrollbar",function(f,i,h){function g(){g.superclass.constructor.apply(this,arguments)}f.extend(g,i,{pluginId:"scrollview/plugin/scrollbar",pluginSyncUI:function(e){var d=this.get("minLength"),a=this.get("autoHideX"),b=this.get("autoHideY"),c={scrollview:e,elBefore:e.get("contentEl")};void 0!==d&&(c.minLength=d);this.scrollBarX?this.scrollBarX.sync():e.isAxisEnabled("x")&&(d={axis:"x"},void 0!==a&&(c.autoHide=a),this.scrollBarX=(new h(f.merge(c,d))).render());this.scrollBarY?
this.scrollBarY.sync():e.isAxisEnabled("y")&&(d={axis:"y"},void 0!==b&&(c.autoHide=b),this.scrollBarY=(new h(f.merge(c,d))).render())},pluginDestructor:function(){this.scrollBarX&&(this.scrollBarX.destroy(),this.scrollBarX=null);this.scrollBarY&&(this.scrollBarY.destroy(),this.scrollBarY=null)}});return g},{requires:["base","./scrollbar/control"]});
