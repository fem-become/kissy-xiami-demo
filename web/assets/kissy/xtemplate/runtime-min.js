/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 20 10:45
*/
KISSY.add("xtemplate/runtime/base",function(e){function c(b,a){this.tpl=b;a=e.merge(h,a);a.subTpls=e.merge(a.subTpls,c.subTpls);a.commands=e.merge(a.commands,c.commands);this.option=a}var h={silent:!0,name:"",utils:{getProperty:function(b,a,d){if("this"==b||"."==b)return a.length?[a[0]]:!1;for(var b=b.split("."),h=b.length,c=d||0,f,e,j,k=a.length;c<k;c++){f=a[c];j=1;for(d=0;d<h;d++){e=b[d];if("object"!=typeof f||!(e in f)){j=0;break}f=f[e]}if(j)return"function"==typeof f&&(f=f.call(a[k-1])),[f]}return!1}}};
c.prototype={constructor:c,removeSubTpl:function(b){delete this.option.subTpls[b]},removeCommand:function(b){delete this.option.commands[b]},addSubTpl:function(b,a){this.option.subTpls[b]=a},addCommand:function(b,a){this.option.commands[b]=a},render:function(b,a){a||(b=[b]);return this.tpl(b,this.option)}};return c});
KISSY.add("xtemplate/runtime/commands",function(e,c){return{each:function(c,b){var a=b.params[0],d="",g;if(a){var i=[0,0].concat(c);if(e.isArray(a)){g=a.length;for(var f=0;f<g;f++)i[0]=a[f],i[1]={xcount:g,xindex:f},d+=b.fn(i)}else for(g in a)i[0]=a[g],i[1]={xkey:g},d+=b.fn(i)}else b.inverse&&(d=b.inverse(c));return d},"with":function(c,b){var a=b.params[0],d=[0].concat(c),g="";a?(d[0]=a,g=b.fn(d)):b.inverse&&(g=b.inverse(c));return g},"if":function(c,b){var a="";b.params[0]?b.fn&&(a=b.fn(c)):b.inverse&&
(a=b.inverse(c));return a},set:function(c,b){for(var a=c.length-1;0<=a;a--)if("object"==typeof c[a]){e.mix(c[a],b.hash);break}return""},include:c.include}},{requires:["./include-command"]});
KISSY.add("xtemplate/runtime/include-command",function(e,c){var h={invokeEngine:function(b,a,d){return(new c(b,e.merge(d))).render(a,!0)},include:function(b,a){var c=a.params;if(!c||1!=c.length)return e[a.silent?"log":"error"]("include must has one param"),"";var c=c[0],g;if(!(g=a.subTpls[c]))return e[a.silent?"log":"error"]('does not include sub template "'+c+'"'),"";a.name=c;return h.invokeEngine(g,b,a)}};return h},{requires:["./base"]});
KISSY.add("xtemplate/runtime",function(e,c,h,b){c.addCommand=function(a,b){h[a]=b};c.removeCommand=function(a){delete h[a]};c.commands=h;c.includeCommand=b;var a={};c.subTpls=a;c.addSubTpl=function(b,c){a[b]=c};c.removeSubTpl=function(b){delete a[b]};return c.IncludeEngine=c},{requires:["./runtime/base","./runtime/commands","./runtime/include-command"]});
