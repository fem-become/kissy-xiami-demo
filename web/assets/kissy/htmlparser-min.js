/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Apr 17 00:21
*/
KISSY.add("htmlparser/Parser",function(a,d,h,g,b,f,j,i){function e(c,k){this.originalHTML=c=a.trim(c);c=/^(<!doctype|<html|<body)/i.test(c)?"<document>"+c+"</document>":"<body>"+c+"</body>";this.lexer=new f(c);this.opts=k||{}}function m(c){var k=q(c,"body",3);if(k){var c=k.parentNode,e=c.childNodes,b=a.indexOf(k,e);if(b!=e.length-1){e=e.slice(b+1,e.length);for(b=0;b<e.length;b++)c.removeChild(e[b]),"body"==e[b].tagName?a.each(e[b].childNodes,function(c){k.appendChild(c)}):k.appendChild(e[b])}}return k}
function c(c){var k=c.childNodes,e,b,a=d.p,f=0;for(b=0;b<k.length;b++)if(e=k[b],3==e.nodeType||1==e.nodeType&&a[e.nodeName]){f=1;break}if(f){var f=[],q=new h;q.nodeName=q.tagName="p";for(b=0;b<k.length;b++)e=k[b],3==e.nodeType||1==e.nodeType&&a[e.nodeName]?q.appendChild(e):(q.childNodes.length&&(f.push(q),q=q.clone()),f.push(e));q.childNodes.length&&f.push(q);c.empty();for(b=0;b<f.length;b++)c.appendChild(f[b])}}function q(c,k,e){if(0===e)return 0;a.isNumber(e)&&e--;var b=c.childNodes;if(b)for(var f=
0;f<b.length;f++){if(b[f].tagName===k)return b[f];if(c=q(b[f],k,e))return c}return 0}function k(c){for(var k=[].concat(c.childNodes),e=0;e<k.length;e++)if("html"==k[e].nodeName){for(var b=k[e],f=0;f<e;f++)3==k[f].nodeType&&!a.trim(k[f].toHTML())&&c.removeChild(k[f]);for(;b.firstChild&&3==b.firstChild.nodeType&&!a.trim(b.firstChild.toHTML());)b.removeChild(b.firstChild);break}}e.prototype={constructor:e,elements:function(){var e,b,f=this.lexer,q=this.opts;b=e=f.nextNode();"document"!=e.tagName&&(b=
new j,b.appendChild(e));b.nodeType=9;i.getScanner("div").scan(e,f,q);(e=m(b))&&q.autoParagraph&&c(e);k(b);var q=this.originalHTML,d=new g;b=/^(<!doctype|<html|<body)/i.test(q)?b.childNodes:e.childNodes;a.each(b,function(c){d.appendChild(c)});return d},parse:function(){return this.elements()}};return e},{requires:"./dtd,./nodes/Tag,./nodes/Fragment,./lexer/Cursor,./lexer/Lexer,./nodes/Document,./Scanner".split(",")});
KISSY.add("htmlparser/Scanner",function(a,d,h){return{getScanner:function(a){return h[a]||d}}},{requires:["./scanners/TagScanner","./scanners/SpecialScanners","./scanners/QuoteCdataScanner","./scanners/TextareaScanner"]});
KISSY.add("htmlparser/Utils",function(){return{collapseWhitespace:function(a){return a.replace(/[\s\xa0]+/g," ")},isLetter:function(a){return"a"<=a&&"z">=a||"A"<=a&&"Z">=a},isValidAttributeNameStartChar:function(a){return!this.isWhitespace(a)&&'"'!=a&&"'"!=a&&">"!=a&&"<"!=a&&"/"!=a&&"="!=a},isWhitespace:function(a){return/^[\s\xa0]$/.test(a)}}});
KISSY.add("htmlparser/dtd",function(a){var a=a.merge,d={isindex:1,fieldset:1},h={input:1,button:1,select:1,textarea:1,label:1},g=a({a:1},h),b=a({iframe:1},g),f={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},j={ins:1,del:1,script:1,style:1},i=a({b:1,acronym:1,bdo:1,"var":1,"#text":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},j),e=a({sub:1,img:1,object:1,
sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},i),m=a({p:1},e),h=a({iframe:1},e,h),e={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#text":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,
u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1},c=a({a:1},h),q={tr:1},k={"#text":1},n=a({param:1},e),l=a({form:1},d,b,f,m),o={li:1},s={base:1,link:1,meta:1,title:1},r=a(s,{style:1,script:1}),t={head:1,body:1},p={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},a={$nonBodyContent:a({html:1},t,s),$block:p,$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:c,$body:a({script:1,style:1},
p),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,
select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:t,head:r,style:k,body:l,base:{},link:{},meta:{},title:k,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:l,td:l,br:{},th:l,center:l,kbd:c,button:a(m,f),basefont:{},h5:c,h4:c,samp:c,h6:c,ol:o,h1:c,h3:c,option:k,h2:c,form:a(d,b,f,m),select:{optgroup:1,option:1},font:c,ins:c,menu:o,abbr:c,label:c,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:c,script:k,tfoot:q,cite:c,
li:l,input:{},iframe:l,strong:c,textarea:k,noframes:l,big:c,small:c,span:c,hr:{},dt:c,sub:c,optgroup:{option:1},param:{},bdo:c,"var":c,div:l,object:n,sup:c,dd:l,strike:c,area:{},dir:o,map:a({area:1,form:1,p:1},d,j,f),applet:n,dl:{dt:1,dd:1},del:c,isindex:{},fieldset:a({legend:1},e),thead:q,ul:o,acronym:c,b:c,a:h,blockquote:l,caption:c,i:c,u:c,tbody:q,s:c,address:a(b,m),tt:c,legend:c,q:c,pre:a(i,g),p:c,em:c,dfn:c},g="article,figure,nav,aside,section,footer".split(","),u;for(u in a)for(var v in a[u])if("div"==
v)for(d=0;d<g.length;d++)a[u][g[d]]=a[u][v];for(d=0;d<g.length;d++)a[g[d]]=a.div;a.$empty["!doctype"]=1;return a});KISSY.add("htmlparser",function(a,d,h,g,b,f,j,i,e,m,c,q,k){return{CData:e,Comment:m,Node:c,Tag:q,Text:k,Lexer:h,Parser:g,BasicWriter:b,BeautifyWriter:f,MinifyWriter:j,Filter:i,DTD:d,serialize:function(c,e){var k=new b;c.writeHTML(k,e);return k.getHTML()},parse:function(c){return(new g(c)).parse()}}},{requires:"htmlparser/dtd,htmlparser/lexer/Lexer,htmlparser/Parser,htmlparser/writer/basic,htmlparser/writer/beautify,htmlparser/writer/minify,htmlparser/writer/filter,htmlparser/nodes/CData,htmlparser/nodes/Comment,htmlparser/nodes/Node,htmlparser/nodes/Tag,htmlparser/nodes/Text".split(",")});
KISSY.add("htmlparser/lexer/Cursor",function(){function a(a){this.position=a||0}a.prototype={constructor:a,advance:function(){this.position++},retreat:function(){this.position=Math.max(--this.position,0)}};return a});
KISSY.add("htmlparser/lexer/Index",function(){function a(){this.lineCursors=[]}function d(a,b){for(var f=0;f<a.length;f++)if(a[f].position===b.position)return f;return-1}function h(a,b){for(var f=0;f<a.length&&!(a[f].position>b.position);f++);return f}a.prototype={constructor:a,add:function(a){-1==d(this.lineCursors,a)&&this.lineCursors.splice(h(this.lineCursors,a),0,a)},remove:function(a){var b=this.lineCursors,a=d(this.lineCursors,a);-1!=a&&b.splice(a,1)},row:function(a){return h(this.lineCursors,
a)-1},col:function(a){var b=h(this.lineCursors,a)-1;return a.position-this.lineCursors[b]}};return a});
KISSY.add("htmlparser/lexer/Lexer",function(a,d,h,g,b,f,j,i,e){function m(c){this.page=new h(c);this.cursor=new d;this.nodeFactory=this}m.prototype={constructor:m,setPosition:function(c){this.cursor.position=c},getPosition:function(){return this.cursor.position},nextNode:function(c){var e,k,b=this.cursor,a=this.page;e=b.position;k=a.getChar(b);switch(k){case -1:c=null;break;case "<":k=a.getChar(b);-1==k?c=this.makeString(e,b.position):"/"==k||f.isLetter(k)?(a.ungetChar(b),c=this.parseTag(e)):"!"==
k||"?"==k?(k=a.getChar(b),-1==k?c=this.makeString(e,b.position):">"==k?c=this.makeComment(e,b.position):(a.ungetChar(b),"-"==k?c=this.parseComment(e,c):(a.ungetChar(b),c=this.parseTag(e)))):(a.ungetChar(b),c=this.parseString(e,c));break;default:a.ungetChar(b),c=this.parseString(e,c)}return c},makeComment:function(c,e){var b;b=e-c;if(0!=b){if(2>b)return this.makeString(c,e);b=this.nodeFactory.createCommentNode(this.page,c,e)}else b=null;return b},makeString:function(c,e){var b=null;0<e-c&&(b=this.nodeFactory.createStringNode(this.page,
c,e));return b},makeCData:function(c,e){var b=null;0<e-c&&(b=this.nodeFactory.createCDataNode(this.page,c,e));return b},makeTag:function(c,e,b){var a;a=e-c;if(0!=a){if(2>a)return this.makeString(c,e);c=this.nodeFactory.createTagNode(this.page,c,e,b)}else c=null;return c},createTagNode:function(c,e,b,a){return new i(c,e,b,a)},createStringNode:function(c,e,b){return new g(c,e,b)},createCDataNode:function(c,e,a){return new b(c,e,a)},createCommentNode:function(c,b,a){return new e(c,b,a)},parseTag:function(c){var e,
b=[],a=[],l,m=this.page,g=0,d=this.cursor;for(b[0]=d.position;!e;)switch(b[g+1]=d.position,l=m.getChar(d),g){case 0:if(-1==l||">"==l||"<"==l)"<"==l&&(m.ungetChar(d),b[g+1]=d.position),e=!0;else if("/"==l||f.isValidAttributeNameStartChar(l))g=1;break;case 1:-1==l||">"==l||"<"==l?("<"==l&&(m.ungetChar(d),b[g+1]=d.getPosition),this.standalone(a,b),e=!0):f.isWhitespace(l)?(b[6]=b[2],g=6):"="==l&&(g=2);break;case 2:-1==l||">"==l?(this.standalone(a,b),e=!0):"'"==l?(g=4,b[4]=b[3]):'"'==l?(g=5,b[5]=b[3]):
f.isWhitespace(l)||(g=3);break;case 3:-1==l||">"==l?(this.naked(a,b),e=!0):f.isWhitespace(l)&&(this.naked(a,b),b[0]=b[4],g=0);break;case 4:-1==l?(this.single_quote(a,b),e=!0):"'"==l&&(this.single_quote(a,b),b[0]=b[5]+1,g=0);break;case 5:-1==l?(this.double_quote(a,b),e=!0):'"'==l&&(this.double_quote(a,b),b[0]=b[6]+1,g=0);break;case 6:-1==l?(this.standalone(a,b),b[0]=b[6],m.ungetChar(d),g=0):f.isWhitespace(l)||("="==l?(b[2]=b[6],b[3]=b[7],g=2):(this.standalone(a,b),b[0]=b[6],m.ungetChar(d),g=0));break;
default:throw Error("how ** did we get in state "+g);}return this.makeTag(c,d.position,a)},parseComment:function(c,b){var e,a,g=this.page,m=this.cursor,d;e=!1;for(d=0;!e;)if(a=g.getChar(m),-1==a)e=!0;else switch(d){case 0:">"==a&&(e=!0);if("-"==a)d=1;else return this.parseString(c,b);break;case 1:if("-"==a)a=g.getChar(m),-1==a?e=!0:">"==a?e=!0:(g.ungetChar(m),d=2);else return this.parseString(c,b);break;case 2:if("-"==a)d=3;else if(-1==a)return this.parseString(c,b);break;case 3:d="-"==a?4:2;break;
case 4:">"==a?e=!0:f.isWhitespace(a)||(d=2);break;default:throw Error("how ** did we get in state "+d);}return this.makeComment(c,m.position)},parseString:function(b,e){for(var a=0,g,d=this.page,m=this.cursor,i=0;!a;)if(g=d.getChar(m),-1==g)a=1;else if(e&&0==i&&("'"==g||'"'==g))i=g;else if(e&&0!=i&&"\\"==g)g=d.getChar(m),-1!=g&&"\\"!=g&&g!=i&&d.ungetChar(m);else if(e&&g==i)i=0;else if(e&&0==i&&"/"==g)if(g=d.getChar(m),-1==g)a=1;else if("/"==g){do g=d.getChar(m);while(-1!=g&&"\n"!=g)}else if("*"==
g){do{do g=d.getChar(m);while(-1!=g&&"*"!=g);g=d.getChar(m);"*"==g&&d.ungetChar(m)}while(-1!=g&&"/"!=g)}else d.ungetChar(m);else if(0==i&&"<"==g)if(g=d.getChar(m),-1==g)a=1;else{if("/"==g||f.isLetter(g)||"!"==g||"?"==g)a=1,d.ungetChar(m);d.ungetChar(m)}return this.makeString(b,m.position)},parseCDATA:function(b,e){var a,g,m,d,i,h,j=this.cursor,p=this.page;a=j.position;g=0;m=!1;d="";for(h=!1;!m;)switch(i=p.getChar(j),g){case 0:switch(i){case -1:m=!0;break;case "'":b&&!h&&(""==d?d="'":"'"==d&&(d=""));
break;case '"':b&&!h&&(""==d?d='"':'"'==d&&(d=""));break;case "\\":b&&""!=d&&(i=p.getChar(j),-1==i?m=!0:"\\"!=i&&i!=d&&p.ungetChar(j));break;case "/":if(b&&""==d)if(i=p.getChar(j),-1==i)m=!0;else if("/"==i)h=!0;else if("*"==i){do{do i=p.getChar(j);while(-1!=i&&"*"!=i);i=p.getChar(j);"*"==i&&p.ungetChar(j)}while(-1!=i&&"/"!=i)}else p.ungetChar(j);break;case "\n":h=!1;break;case "<":b?""==d&&(g=1):g=1}break;case 1:switch(i){case -1:m=!0;break;case "/":g=!e||p.getText(j.position,j.position+e.length)===
e&&!p.getText(j.position+e.length,j.position+e.length+1).match(/\w/)?2:0;break;case "!":i=p.getChar(j);-1==i?m=!0:"-"==i?(i=p.getChar(j),-1==i?m=!0:g="-"==i?3:0):g=0;break;default:g=0}break;case 2:h=!1;-1==i?m=!0:f.isLetter(i)?(m=!0,p.ungetChar(j),p.ungetChar(j),p.ungetChar(j)):g=0;break;case 3:h=!1;-1==i?m=!0:"-"==i&&(i=p.getChar(j),-1==i?m=!0:"-"==i?(i=p.getChar(j),-1==i?m=!0:">"==i?g=0:(p.ungetChar(j),p.ungetChar(j))):p.ungetChar(j));break;default:throw Error("unexpected "+g);}return this.makeCData(a,
j.position)},single_quote:function(b,e){var a=this.page;b.push(new j(a.getText(e[1],e[2]),"=",a.getText(e[4]+1,e[5]),"'"))},double_quote:function(b,e){var a=this.page;b.push(new j(a.getText(e[1],e[2]),"=",a.getText(e[5]+1,e[6]),'"'))},standalone:function(b,e){b.push(new j(this.page.getText(e[1],e[2])))},naked:function(b,e){var a=this.page;b.push(new j(a.getText(e[1],e[2]),"=",a.getText(e[3],e[4])))}};return m},{requires:"./Cursor,./Page,../nodes/Text,../nodes/CData,../Utils,../nodes/Attribute,../nodes/Tag,../nodes/Comment".split(",")});
KISSY.add("htmlparser/lexer/Page",function(a,d){function h(a){this.source=a;this.lineIndex=new d}h.prototype={constructor:h,getChar:function(a){var b=this.source,f=a.position;if(f>=b.length)return-1;var d=b.charAt(f);a.advance();"\r"===d&&(d="\n",f=a.position,"\n"===b.charAt(f)&&a.advance());"\n"===d&&this.lineIndex.add(a);return d},ungetChar:function(a){var b=this.source;a.retreat();var f=a.position,d=b.charAt(f);"\n"===d&&0!=f&&(d=b.charAt(f-1),"\r"===d&&a.retreat())},getText:function(a,b){return this.source.slice(a,
b)},row:function(a){return this.lineIndex.row(a)},col:function(a){return this.lineIndex.col(a)}};return h},{requires:["./Index"]});KISSY.add("htmlparser/nodes/Attribute",function(a){function d(a,g,b,f){this.nodeType=2;this.name=a;this.assignMent=g;this.value=b;this.quote=f}a.augment(d,{clone:function(){var h=new d;a.mix(h,this);return h},equals:function(a){return this.name==a.name&&this.value==a.value&&this.nodeType==a.nodeType}});d.prototype.clone=function(){var h=new d;a.mix(h,this);return h};return d});
KISSY.add("htmlparser/nodes/CData",function(a,d){function h(){h.superclass.constructor.apply(this,arguments);this.nodeType=4;this.nodeName="#cdata"}a.extend(h,d,{writeHTML:function(a,b){var f;if(!b||!1!==(f=b.onCData(this)))f&&this!==f?f.writeHTML(a,b):a.cdata(this.toHTML())}});return h},{requires:["./Text"]});
KISSY.add("htmlparser/nodes/Comment",function(a,d){function h(){h.superclass.constructor.apply(this,arguments);this.nodeType=8;this.nodeName="#comment"}a.extend(h,d,{writeHTML:function(a,b){var f;if(!b||!1!==(f=b.onComment(this)))f&&this!==f?f.writeHTML(a,b):a.comment(this.toHTML())},toHTML:function(){if(this.nodeValue)return this.nodeValue;var a=d.superclass.toHTML.apply(this,arguments);return a.substring(4,a.length-3)}});return h},{requires:["./Text"]});
KISSY.add("htmlparser/nodes/Document",function(a,d){function h(){this.childNodes=[];this.nodeType=9;this.nodeName="#document"}a.extend(h,d,{writeHTML:function(a,b){this.__filter=b;this._writeChildrenHTML(a)}});return h},{requires:["./Tag"]});
KISSY.add("htmlparser/nodes/Fragment",function(a,d){function h(){this.childNodes=[];this.nodeType=9;this.nodeName="#fragment"}a.extend(h,d,{writeHTML:function(a,b){this.__filter=b;this.isChildrenFiltered=0;if(b)b.onFragment(this);this._writeChildrenHTML(a)}});return h},{requires:["./Tag"]});
KISSY.add("htmlparser/nodes/Node",function(a){function d(a){var b=0;a.replace(/\n/g,function(){b++});return b}function h(g,b,f){this.parentNode=null;this.page=g;this.startPosition=b;this.endPosition=f;this.nextSibling=this.previousSibling=this.nodeName=null;g&&(this.startLine=d(this.page.getText(0,b)),this.endLine=d(this.page.getText(0,f)));a.Config.debug&&(this.toHTMLContent=this.toHTML())}h.prototype={constructor:h,toHTML:function(){if(this.page&&this.page.getText)return this.page.getText(this.startPosition,
this.endPosition)},toString:function(){var a=[];a.push(this.nodeName+"  [ "+this.startPosition+"|"+this.startLine+" : "+this.endPosition+"|"+this.endLine+" ]\n");a.push(this.toHTML());return a.join("")}};return h});
KISSY.add("htmlparser/nodes/Tag",function(a,d,h,g){function b(b,f,c){b.nodeName=b.tagName=f.toLowerCase();b._updateSelfClosed();a.each(c,function(a,c){b.setAttribute(c,a)})}function f(e,d,c,i){this.childNodes=[];this.lastChild=this.firstChild=null;this.attributes=i||[];this.nodeType=1;if("string"==typeof e)b.apply(null,[this].concat(a.makeArray(arguments)));else{f.superclass.constructor.apply(this,arguments);i=this.attributes;i[0]&&(this.nodeName=i[0].name.toLowerCase(),this.tagName=this.nodeName.replace(/\//,
""),this._updateSelfClosed(),i.splice(0,1));var g=i[i.length-1];if(g=!(!g||!/\/$/.test(g.name)))i.length-=1;this.closed=this.isSelfClosed=this.isSelfClosed||g}this.closedEndPosition=this.closedStartPosition=-1}function j(b){var a=b.childNodes;b.firstChild=a[0];b.lastChild=a[a.length-1];1<=a.length&&(a[0].nextSibling=a[0].nextSibling=null,a[0].parentNode=b);if(1<a.length){for(var c=0;c<a.length-1;c++)a[c].nextSibling=a[c+1],a[c+1].previousSibling=a[c],a[c+1].parentNode=b;a[a.length-1].nextSibling=
null}}function i(b,a){for(var c=0;c<b.length;c++)if(b[c].name==a)return b[c];return null}a.extend(f,d,{_updateSelfClosed:function(){this.isSelfClosed=!!g.$empty[this.nodeName];this.isSelfClosed||(this.isSelfClosed=/\/$/.test(this.nodeName));this.closed=this.isSelfClosed},clone:function(){var b=new f,d=[];a.each(this.attributes,function(b){d.push(b.clone())});a.mix(b,{childNodes:[],firstChild:null,lastChild:null,attributes:d,nodeType:this.nodeType,nodeName:this.nodeName,tagName:this.tagName,isSelfClosed:this.isSelfClosed,
closed:this.closed,closedStartPosition:this.closedStartPosition,closedEndPosition:this.closedEndPosition});return b},setTagName:function(b){(this.nodeName=this.tagName=b)&&this._updateSelfClosed()},equals:function(b){if(!b||this.nodeName!=b.nodeName||this.nodeType!=b.nodeType||this.attributes.length!=b.attributes.length)return 0;for(var a=0;a<this.attributes.length;a++)if(!this.attributes[a].equals(b.attributes[a]))return 0;return 1},isEndTag:function(){return/^\//.test(this.nodeName)},appendChild:function(b){this.childNodes.push(b);
j(this)},replace:function(b){var f=b.parentNode.childNodes,c=a.indexOf(b,f);f[c]=this;j(b.parentNode)},replaceChild:function(b,f){var c=this.childNodes,d=a.indexOf(f,c);c[d]=b;j(this)},prepend:function(b){this.childNodes.unshift(b);j(this)},insertBefore:function(b){var f=b.parentNode.childNodes,c=a.indexOf(b,f);f.splice(c,0,this);j(b.parentNode)},insertAfter:function(b){var f=b.parentNode.childNodes,c=a.indexOf(b,f);c==f.length-1?b.parentNode.appendChild(this):this.insertBefore(b.parentNode.childNodes[[c+
1]])},empty:function(){this.childNodes=[];j(this)},removeChild:function(b){var f=b.parentNode.childNodes,c=a.indexOf(b,f);f.splice(c,1);j(b.parentNode)},getAttribute:function(b){return(b=i(this.attributes,b))&&b.value},setAttribute:function(b,a){var c=i(this.attributes,b);c?c.value=a:this.attributes.push(new h(b,"=",a,'"'))},removeAttribute:function(b){(b=i(this.attributes,b))&&this.attributes.splice(a.indexOf(b,this.attributes),1)},filterChildren:function(){var b=this;if(!b.isChildrenFiltered){var f=
new (a.require("htmlparser/writer/basic"));b._writeChildrenHTML(f);f=(new (a.require("htmlparser/Parser"))(f.getHTML())).parse().childNodes;b.empty();a.each(f,function(a){b.appendChild(a)});b.isChildrenFiltered=1}},writeHTML:function(b,a){var c=this,f;f=c.tagName;if("!doctype"==f)b.append(this.toHTML()+"\n");else{c.__filter=a;c.isChildrenFiltered=0;if(a){if(!(f=a.onTagName(f)))return;c.tagName=f;f=a.onTag(c);if(!1===f)return;f&&(c=f);if(1!==c.nodeType){c.writeHTML(b,a);return}if(!c.tagName){c._writeChildrenHTML(b);
return}}b.openTag(c);for(var d=c.attributes,i=0;i<d.length;i++){var g=d[i];f=g.name;if(a){if(!(f=a.onAttributeName(f,c)))continue;g.name=f;if(!1===a.onAttribute(g,c))continue}b.attribute(g,c)}b.openTagClose(c);c.isSelfClosed||(c._writeChildrenHTML(b),b.closeTag(c))}},_writeChildrenHTML:function(b){var f=this.isChildrenFiltered?0:this.__filter;a.each(this.childNodes,function(a){a.writeHTML(b,f)})}});return f},{requires:["./Node","./Attribute","../dtd"]});
KISSY.add("htmlparser/nodes/Text",function(a,d){function h(a){"string"==typeof a?(this.nodeValue=a,h.superclass.constructor.apply(this,[null,-1,-1])):(h.superclass.constructor.apply(this,arguments),this.nodeValue=this.toHTML());this.nodeType=3;this.nodeName="#text"}a.extend(h,d,{writeHTML:function(a,b){var f;if(!b||!1!==(f=b.onText(this)))f&&this!==f?f.writeHTML(a,b):a.text(this.toHTML())},toHTML:function(){return this.nodeValue?this.nodeValue:h.superclass.toHTML.apply(this,arguments)}});return h},
{requires:["./Node"]});KISSY.add("htmlparser/scanners/CDataScanner",function(){return{scan:function(a,d,h){var h=d.parseCDATA(h.quoteSmart,a.nodeName),g=d.getPosition(),b=d.nextNode();b&&(1!=b.nodeType||!(b.isEndTag()&&b.tagName==a.tagName))&&d.setPosition(g);a.closed=!0;h&&a.appendChild(h)}}});
KISSY.add("htmlparser/scanners/QuoteCdataScanner",function(a,d,h,g){var a={scan:function(b,a,i){i=i||{};i.quoteSmart=1;d.scan(b,a,i);i.quoteSmart=0}},b;for(b in h.$cdata)g[b]=a;return a},{requires:["./CDataScanner","../dtd","./SpecialScanners"]});KISSY.add("htmlparser/scanners/SpecialScanners",function(){return{}});
KISSY.add("htmlparser/scanners/TagScanner",function(a,d,h,g){function b(e,i){function c(){n.childNodes.length&&(n.insertAfter(l),l=n,n=e.clone())}e.closed=1;if(!i.fixByDtd)return 0;var g=1,k=[].concat(e.childNodes);a.each(k,function(b){if(!f(e,b))return g=0,!1});if(g)return 0;for(var n=e.clone(),l=e,o=[],s=0;s<k.length;s++){var r=k[s];if(f(n,r))n.appendChild(r);else if(1==r.nodeType){var t=r.tagName;if(d.$listItem[t]){c();var r=j[r.tagName],p=new h;for(p.nodeName=p.tagName=r;s<k.length;){if(k[s].tagName==
t)p.appendChild(k[s]);else if((3!=k[s].nodeType||a.trim(k[s].toHTML()))&&3==k[s].nodeType)break;s++}p.insertAfter(l);l=p;s--}else c(),r.equals(n)?(r.insertAfter(l),l=r):f(r,n)?(n=e.clone(),a.each(r.childNodes,function(b){n.appendChild(b)}),r.empty(),r.insertAfter(l),l=r,r.appendChild(n),o.push(n),n=e.clone()):(r.insertAfter(l),l=r)}}n.childNodes.length&&n.insertAfter(l);e.parentNode.removeChild(e);a.each(o,function(a){b(a,i)});return 1}function f(b,a){return 9==b.nodeType||8==a.nodeType?1:!!d[b.tagName][a.tagName||
a.nodeName]}var j={li:"ul",dt:"dl",dd:"dl"},i={dd:{dl:1},dt:{dl:1},li:{ul:1,ol:1},option:{select:1},optgroup:{select:1}};return{scan:function(a,f,c){function d(f,i){for(h=f;h>i;h--){var g=o[h];o[h-1].appendChild(g);b(g,c)}a=o[i];o.length=i}function k(b){var a=0,c;if(c=i[b.tagName]){for(var f=o.length-1,e=o[f];e&&!(e.tagName in c);){if(e.tagName==b.tagName){a=1;break}f--;e=o[f]}a&&d(o.length-1,f-1)}return a}var j,h,o;o=c.stack=c.stack||[];do{if(j=f.nextNode())if(1===j.nodeType)if(j.isEndTag()&&j.tagName==
a.tagName)j=null;else if(j.isEndTag()){if(j.isEndTag()){var s=-1;for(h=o.length-1;0<=h;h--)if(o[h].tagName===j.tagName){s=h;break}-1!=s&&(o[o.length-1].appendChild(a),b(a,c),d(o.length-1,s),j=null)}}else g[j.tagName]?(g[j.tagName].scan(j,f,c),a.appendChild(j)):j.isSelfClosed?a.appendChild(j):(o.push(a),k(j)&&o.push(a),a=j);else a.appendChild(j);null==j&&0<o.length&&(j=o[o.length-1],g[j.tagName]?j=null:(o.length-=1,j.appendChild(a),b(a,c),a=j))}while(j);b(a,c)}}},{requires:["../dtd","../nodes/Tag",
"./SpecialScanners"]});KISSY.add("htmlparser/scanners/TextareaScanner",function(a,d,h){return h.textarea={scan:function(a,b,f){f=f||{};d.scan(a,b,f)}}},{requires:["./CDataScanner","./SpecialScanners"]});
KISSY.add("htmlparser/writer/basic",function(){function a(){this.output=[]}a.prototype={constructor:a,append:function(){for(var a=this.output,h=arguments,g,b=0;b<h.length;b++)if(g=h[b],1<g.length)for(var f=0;f<g.length;f++)a.push(g.charAt(f));else a.push(g);return this},openTag:function(a){this.append("<",a.tagName)},openTagClose:function(a){a.isSelfClosed&&this.append(" ","/");this.append(">")},closeTag:function(a){this.append("</",a.tagName,">")},attribute:function(a){this.append(" ",a.name,'="',
(""+(a.value||a.name)).replace(/"/g,"&quote;"),'"')},text:function(a){this.append(a)},cdata:function(a){this.append(a)},comment:function(a){this.append("<\!--"+a+"--\>")},getHTML:function(){return this.output.join("")}};return a});
KISSY.add("htmlparser/writer/beautify",function(a,d,h,g){function b(){b.superclass.constructor.apply(this,arguments);this.inPre=0;this.indentChar="\t";this.allowIndent=this.indentLevel=0;this.rules={};for(var f in a.merge(h.$nonBodyContent,h.$block,h.$listItem,h.$tableContent,{select:1,script:1,style:1}))this.setRules(f,{allowIndent:1,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});this.setRules("option",{breakBeforeOpen:1});this.setRules("optiongroup",{breakBeforeOpen:1});
this.setRules("br",{breakAfterOpen:1});this.setRules("title",{allowIndent:0,breakBeforeClose:0,breakAfterOpen:0});this.setRules("pre",{allowIndent:0})}a.extend(b,d,{indentation:function(){this.inPre||this.append(Array(this.indentLevel+1).join(this.indentChar));this.allowIndent=0},lineBreak:function(){var b=this.output;if(!this.inPre&&b.length){for(var a=b.length-1;0<=a&&/[\r\n\t ]/.test(b[a]);a--);b.length=a+1;this.append("\n")}this.allowIndent=1},setRules:function(b,d){this.rules[b]||(this.rules[b]=
{});a.mix(this.rules[b],d)},openTag:function(a){var d=this.rules[a.tagName]||{};this.allowIndent?this.indentation():d.breakBeforeOpen&&(this.lineBreak(),this.indentation());b.superclass.openTag.apply(this,arguments)},openTagClose:function(b){var a=b.tagName,i=this.rules[a]||{};b.isSelfClosed?this.append(" />"):(this.append(">"),i.allowIndent&&this.indentLevel++);i.breakAfterOpen&&this.lineBreak();"pre"===a&&(this.inPre=1)},closeTag:function(a){var d=a.tagName,i=this.rules[d]||{};i.allowIndent&&this.indentLevel--;
this.allowIndent?this.indentation():i.breakBeforeClose&&(this.lineBreak(),this.indentation());b.superclass.closeTag.apply(this,arguments);"pre"===d&&(this.inPre=0);i.breakAfterClose&&this.lineBreak()},text:function(b){this.allowIndent&&this.indentation();this.inPre||(b=g.collapseWhitespace(b));this.append(b)},comment:function(b){this.allowIndent&&this.indentation();this.append("<\!--"+b+"--\>")},cdata:function(b){this.allowIndent&&this.indentation();this.append(a.trim(b))}});return b},{requires:["./basic",
"../dtd","../Utils"]});
KISSY.add("htmlparser/writer/filter",function(a){function d(){this.tagNames=[];this.attributeNames=[];this.tags=[];this.comment=[];this.text=[];this.cdata=[];this.attributes=[];this.root=[]}function h(b,f){for(var d=0;b&&d<b.length;d++)a.each(b[d].value,function(b){f=f.replace(b[0],b[1])});return f}function g(b,a,d){var i,e;for(e=0;b&&e<b.length;e++){i=b[e].value;if(!1===(i=i.apply(null,a)))return!1;if(d&&i&&i!=d){if("string"==typeof i){if(d.toHTML()==i)break;d.nodeValue=i;i=d}return this.onNode(i)}}return d}
d.prototype={constructor:d,addRules:function(b,a){var a=a||10,d;for(d in b){var i=this[d];if(i){var e;a:{for(e=0;i&&e<i.length;e++)if(i[e].priority>a)break a;e=i.length}i.splice(e,0,{value:b[d],priority:a})}}},onTagName:function(b){return h(this.tagNames,b)},onAttributeName:function(b){return h(this.attributeNames,b)},onText:function(b){return g.call(this,this.text,[b.toHTML(),b],b)},onCData:function(b){return g.call(this,this.cdata,[b.toHTML(),b],b)},onAttribute:function(b,a){var d;a:{d=this.attributes;
for(var i=0;d&&i<d.length;i++){var e=d[i].value,g,c=b.name;if(e[c]&&!1===(g=e[c].call(null,b.value,a))){d=g;break a}"string"==typeof g&&(b.value=g)}d=b}return d},onComment:function(b){return g.call(this,this.comment,[b.toHTML(),b],b)},onNode:function(b){var a=b.nodeType;if(1===a)return this.onTag(b);if(3===a)return this.onText(b);if(8===a)return this.onComment(b)},onFragment:function(b){return g.call(this,this.root,[b],b)},onTag:function(b){for(var a=["^",b.tagName,"$"],d=this.tags,i,e=0;e<a.length;e++)for(var g=
a[e],c=0;c<d.length;c++)if(i=d[c].value,i[g]){if(!1===(i=i[g](b)))return!1;if(i&&i!=b)return this.onNode(i);if(!b.tagName)return b}return b}};return d});
KISSY.add("htmlparser/writer/minify",function(a,d,h){function g(){g.superclass.constructor.apply(this,arguments);this.inPre=0}var b=a.trim,f=h.collapseWhitespace,j=RegExp("^(?:class|id|style|title|lang|dir|on(?:focus|blur|change|click|dblclick|mouse(?:down|up|over|move|out)|key(?:press|down|up)))$");a.extend(g,d,{comment:function(a){/\[if[^\]]+\]/.test(a)&&(a=a.replace(/^(\[[^\]]+\]>)[\s\xa0]*/,"$1").replace(/[\s\xa0]*(<!\[endif\])$/,"$1"),g.superclass.comment.call(this,a))},openTag:function(a){"pre"==
a.tagName&&(this.inPre=1);g.superclass.openTag.apply(this,arguments)},closeTag:function(a){"pre"==a.tagName&&(this.inPre=0);g.superclass.closeTag.apply(this,arguments)},cdata:function(a){a=b(a).replace(/^(?:[\s\xa0]*\/\*[\s\xa0]*<!\[CDATA\[[\s\xa0]*\*\/|[\s\xa0]*\/\/[\s\xa0]*<!\[CDATA\[.*)/,"").replace(/(?:\/\*[\s\xa0]*\]\]>[\s\xa0]*\*\/|\/\/[\s\xa0]*\]\]>)[\s\xa0]*$/,"");g.superclass.cdata.call(this,a)},attribute:function(a,e){var d=a.name,c,g=a.value||"";c=a.name;if(!(c=!b(a.value||"")?"input"===
e&&"value"===c||j.test(c):0)){c=e.nodeName;var h=a.name,n=a.value||"",n=b(n.toLowerCase());c="script"===c&&"language"===h&&"javascript"===n||"form"===c&&"method"===h&&"get"===n||"input"===c&&"type"===h&&"text"===n||"script"===c&&"type"===h&&"text/javascript"===n||"style"===c&&"type"===h&&"text/css"===n||"area"===c&&"shape"===h&&"rect"===n}if(!c)if(/^(?:checked|disabled|selected|readonly|defer|multiple|nohref|noshape|nowrap|noresize|compact|ismap)$/i.test(d))this.append(" ",d);else{c=e.nodeName;h=
a.name;n=a.value||"";/^on[a-z]+/.test(h)?n=b(n).replace(/^javascript:[\s\xa0]*/i,"").replace(/[\s\xa0]*;$/,""):"class"===h?n=f(b(n)):/^(?:a|area|link|base)$/.test(c)&&"href"===h||"img"===c&&/^(?:src|longdesc|usemap)$/.test(h)||"object"===c&&/^(?:classid|codebase|data|usemap)$/.test(h)||"q"===c&&"cite"===h||"blockquote"===c&&"cite"===h||("ins"===c||"del"===c)&&"cite"===h||"form"===c&&"action"===h||"input"===c&&("src"===h||"usemap"===h)||"head"===c&&"profile"===h||"script"===c&&("src"===h||"for"===
h)||/^(?:a|area|object|button)$/.test(c)&&"tabindex"===h||"input"===c&&("maxlength"===h||"tabindex"===h)||"select"===c&&("size"===h||"tabindex"===h)||"textarea"===c&&/^(?:rows|cols|tabindex)$/.test(h)||"colgroup"===c&&"span"===h||"col"===c&&"span"===h||("th"===c||"td"==c)&&("rowspan"===h||"colspan"===h)?n=b(n):"style"===h&&(n=b(n).replace(/[\s\xa0]*;[\s\xa0]*$/,""));c=(""+n).replace(/"/g,"&quote;");if(!g||/[ "'=<>`]/.test(g))c='"'+c+'"';this.append(" ",d,"=",c)}},text:function(a){this.inPre||(a=f(a));
this.append(a)}});return g},{requires:["./basic","../Utils"]});
