/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Mar 13 14:53
*/
KISSY.add("io/base",function(f,g,h,k){function j(a){var l=a.context;delete a.context;a=f.mix(f.clone(t),a,{deep:!0});a.context=l||a;var b,m=a.type,d=a.dataType,l=a.uri=i.resolve(a.url);a.uri.setQuery("");"crossDomain"in a||(a.crossDomain=!a.uri.isSameOriginAs(i));m=a.type=m.toUpperCase();a.hasContent=!e.test(m);if(a.processData&&(b=a.data)&&"string"!=typeof b)a.data=f.param(b,k,k,a.serializeArray);d=a.dataType=f.trim(d||"*").split(c);!("cache"in a)&&f.inArray(d[0],["script","jsonp"])&&(a.cache=!1);
a.hasContent||(a.data&&l.query.add(f.unparam(a.data)),!1===a.cache&&l.query.set("_ksTS",f.now()+"_"+f.guid()));return a}function d(e,i){a.fire(e,{ajaxConfig:i.config,io:i})}function a(e){function i(a){return function(i){if(t=b.timeoutTimer)clearTimeout(t),b.timeoutTimer=0;var l=e[a];l&&l.apply(q,i);d(a,b)}}var b=this;if(!(b instanceof a))return new a(e);m.call(b);e=j(e);f.mix(b,{responseData:null,config:e||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,
requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new f.Defer(this)});var c;d("start",b);c=new (l[e.dataType[0]]||l["*"])(b);b.transport=c;e.contentType&&b.setRequestHeader("Content-Type",e.contentType);var g=e.dataType[0],t,h,k=e.timeout,q=e.context,y=e.headers,x=e.accepts;b.setRequestHeader("Accept",g&&x[g]?x[g]+("*"===g?"":", */*; q=0.01"):x["*"]);for(h in y)b.setRequestHeader(h,y[h]);if(e.beforeSend&&!1===e.beforeSend.call(q,b,e))return b;b.done(i("success"),
i("error"));b.fin(i("complete"));b.readyState=1;d("send",b);e.async&&0<k&&(b.timeoutTimer=setTimeout(function(){b.abort("timeout")},1E3*k));try{b.state=1,c.send()}catch(z){2>b.state&&b._ioReady(-1,z.message)}return b}var b=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,c=/\s+/,g=function(e){return e},m=f.Promise,e=/^(?:GET|HEAD)$/,i=new f.Uri((f.Env.host.location||{}).href),b=i&&b.test(i.getScheme()),l={},t={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,
serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:f.parseJSON,html:g,text:g,xml:f.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};t.converters.html=t.converters.text;f.mix(a,h.Target);f.mix(a,{isLocal:b,setupConfig:function(e){f.mix(t,e,{deep:!0})},setupTransport:function(e,a){l[e]=a},getTransport:function(e){return l[e]},getConfig:function(){return t}});return a},
{requires:["json","event"]});
KISSY.add("io/form-serializer",function(f,g){function h(a){return a.replace(j,"\r\n")}var k=/^(?:select|textarea)/i,j=/\r?\n/g,d,a=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return d={serialize:function(a,c){return f.param(d.getFormData(a),void 0,void 0,c||!1)},getFormData:function(b){var c=[],m={};f.each(g.query(b),function(e){e=e.elements?f.makeArray(e.elements):[e];c.push.apply(c,e)});c=f.filter(c,function(e){return e.name&&!e.disabled&&
(e.checked||k.test(e.nodeName)||a.test(e.type))});f.each(c,function(e){var a=g.val(e),b;null!==a&&(a=f.isArray(a)?f.map(a,h):h(a),(b=m[e.name])?(b&&!f.isArray(b)&&(b=m[e.name]=[b]),b.push.apply(b,f.makeArray(a))):m[e.name]=a)});return m}}},{requires:["dom"]});
KISSY.add("io/form",function(f,g,h,k){var j=Array.prototype.slice,d=f.Env.host.FormData;g.on("start",function(a){var b,c,a=a.io.config;if(c=a.form){b=h.get(c);c=a.data;for(var m=!1,e={},i=h.query("input",b),l=0,g=i.length;l<g;l++){var w=i[l];if("file"==w.type.toLowerCase()){m=!0;if(!d)break;var o=j.call(w.files,0);e[h.attr(w,"name")]=1<o.length?o:o[0]||null}}m&&d&&(a.files=a.files||{},f.mix(a.files,e),delete a.contentType);!m||d?(b=k.getFormData(b),a.hasContent?(b=f.param(b,void 0,void 0,a.serializeArray),
a.data=c?a.data+("&"+b):b):a.uri.query.add(b)):(c=a.dataType,a=c[0],"*"==a&&(a="text"),c.length=2,c[0]="iframe",c[1]=a)}});return g},{requires:["./base","dom","./form-serializer"]});
KISSY.add("io/iframe-transport",function(f,g,h,k){function j(a){var e=f.guid("io-iframe"),i=g.getEmptyIframeSrc(),a=a.iframe=g.create("<iframe "+(i?' src="'+i+'" ':"")+' id="'+e+'" name="'+e+'" style="position:absolute;left:-9999px;top:-9999px;"/>');g.prepend(a,b.body||b.documentElement);return a}function d(a,e,i){var c=[],d,h,k,j;f.each(a,function(a,m){d=f.isArray(a);h=f.makeArray(a);for(k=0;k<h.length;k++)j=b.createElement("input"),j.type="hidden",j.name=m+(d&&i?"[]":""),j.value=h[k],g.append(j,
e),c.push(j)});return c}function a(a){this.io=a}var b=f.Env.host.document,c=f.clone(k.getConfig().converters.text);c.json=function(a){return f.parseJSON(f.unEscapeHTML(a))};k.setupConfig({converters:{iframe:c,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});f.augment(a,{send:function(){function a(){h.on(k,"load error",e._callback,e);n.submit()}var e=this,b=e.io,c=b.config,t,k,o,r=c.data,n=g.get(c.form);e.attrs={target:g.attr(n,"target")||"",action:g.attr(n,"action")||"",encoding:g.attr(n,
"encoding"),enctype:g.attr(n,"enctype"),method:g.attr(n,"method")};e.form=n;k=j(b);g.attr(n,{target:k.id,action:b._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});r&&(o=f.unparam(r));o&&(t=d(o,n,c.serializeArray));e.fields=t;6==f.UA.ie?setTimeout(a,0):a()},_callback:function(a){var e=this,b=e.form,c=e.io,a=a.type,d,k=c.iframe;if(k)if("abort"==a&&6==f.UA.ie?setTimeout(function(){g.attr(b,e.attrs)},0):g.attr(b,e.attrs),g.remove(this.fields),h.detach(k),setTimeout(function(){g.remove(k)},
30),c.iframe=null,"load"==a)try{if((d=k.contentWindow.document)&&d.body)c.responseText=g.html(d.body),f.startsWith(c.responseText,"<?xml")&&(c.responseText=void 0);c.responseXML=d&&d.XMLDocument?d.XMLDocument:d;d?c._ioReady(200,"success"):c._ioReady(500,"parser error")}catch(j){c._ioReady(500,"parser error")}else"error"==a&&c._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});k.setupTransport("iframe",a);return k},{requires:["dom","event","./base"]});
KISSY.add("io",function(f,g,h){function k(d,a,b,c,m){f.isFunction(a)&&(c=b,b=a,a=j);return h({type:m||"get",url:d,data:a,success:b,dataType:c})}var j=void 0;f.mix(h,{serialize:g.serialize,get:k,post:function(d,a,b,c){f.isFunction(a)&&(c=b,b=a,a=j);return k(d,a,b,c,"post")},jsonp:function(d,a,b){f.isFunction(a)&&(b=a,a=j);return k(d,a,b,"jsonp")},getScript:f.getScript,getJSON:function(d,a,b){f.isFunction(a)&&(b=a,a=j);return k(d,a,b,"json")},upload:function(d,a,b,c,m){f.isFunction(b)&&(m=c,c=b,b=j);
return h({url:d,type:"post",dataType:m,form:a,data:b,success:c})}});f.mix(f,{Ajax:h,IO:h,ajax:h,io:h,jsonp:h.jsonp});return h},{requires:"io/form-serializer,io/base,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(",")});
KISSY.add("io/jsonp",function(f,g){var h=f.Env.host;g.setupConfig({jsonp:"callback",jsonpCallback:function(){return f.guid("jsonp")}});g.on("start",function(g){var j=g.io,d=j.config,g=d.dataType;if("jsonp"==g[0]){var a,b=d.jsonpCallback,c=f.isFunction(b)?b():b,m=h[c];d.uri.query.set(d.jsonp,c);h[c]=function(e){1<arguments.length&&(e=f.makeArray(arguments));a=[e]};j.fin(function(){h[c]=m;if(void 0===m)try{delete h[c]}catch(e){}else a&&m(a[0])});j=d.converters;j.script=j.script||{};j.script.json=function(){return a[0]};
g.length=2;g[0]="script";g[1]="json"}});return g},{requires:["./base"]});
KISSY.add("io/methods",function(f,g,h){function k(d){var a=d.responseText,b=d.responseXML,c=d.config,m=c.converters,e,i,l=c.contents,g=c.dataType;if(a||b){for(c=d.mimeType||d.getResponseHeader("Content-Type");"*"==g[0];)g.shift();if(!g.length)for(e in l)if(l[e].test(c)){g[0]!=e&&g.unshift(e);break}g[0]=g[0]||"text";for(e=0;e<g.length;e++)if("text"==g[e]&&a!==h){i=a;break}else if("xml"==g[e]&&b!==h){i=b;break}if(!i){var k={text:a,xml:b};f.each(["text","xml"],function(e){var c=g[0];return m[e]&&m[e][c]&&
k[e]?(g.unshift(e),i="text"==e?a:b,!1):h})}}l=g[0];for(c=1;c<g.length;c++){e=g[c];var j=m[l]&&m[l][e];if(!j)throw"no covert for "+l+" => "+e;i=j(i);l=e}d.responseData=i}var j=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;f.extend(g,f.Promise,{setRequestHeader:function(d,a){this.requestHeaders[d]=a;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(d){var a,b;if(2===this.state){if(!(b=this.responseHeaders))for(b=this.responseHeaders={};a=
j.exec(this.responseHeadersString);)b[a[1]]=a[2];a=b[d]}return a===h?null:a},overrideMimeType:function(d){this.state||(this.mimeType=d);return this},abort:function(d){d=d||"abort";this.transport&&this.transport.abort(d);this._ioReady(0,d);return this},getNativeXhr:function(){var d;return(d=this.transport)?d.nativeXhr:null},_ioReady:function(d,a){if(2!=this.state){this.state=2;this.readyState=4;var b;if(200<=d&&300>d||304==d)if(304==d)a="not modified",b=!0;else try{k(this),a="success",b=!0}catch(c){a=
"parser error"}else 0>d&&(d=0);this.status=d;this.statusText=a;this._defer[b?"resolve":"reject"]([this.responseData,a,this])}},_getUrlForSend:function(){var d=this.config,a=d.uri,b=f.Uri.getComponents(d.url).query||"";return a.toString.call(a,d.serializeArray)+(b?(a.query.has()?"&":"?")+b:b)}})},{requires:["./base"]});
KISSY.add("io/script-transport",function(f,g,h,k){function j(a){if(!a.config.crossDomain)return new (g.getTransport("*"))(a);this.io=a;return this}var d=f.Env.host,a=d.document;g.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(a){f.globalEval(a);return a}}}});f.augment(j,{send:function(){var b=this,c,f=b.io,e=f.config,i=a.head||a.getElementsByTagName("head")[0]||
a.documentElement;b.head=i;c=a.createElement("script");b.script=c;c.async=!0;e.scriptCharset&&(c.charset=e.scriptCharset);c.src=f._getUrlForSend();c.onerror=c.onload=c.onreadystatechange=function(a){a=a||d.event;b._callback((a.type||"error").toLowerCase())};i.insertBefore(c,i.firstChild)},_callback:function(a,c){var d=this.script,e=this.io,i=this.head;if(d&&(c||!d.readyState||/loaded|complete/.test(d.readyState)||"error"==a))d.onerror=d.onload=d.onreadystatechange=null,i&&d.parentNode&&i.removeChild(d),
this.head=this.script=k,!c&&"error"!=a?e._ioReady(200,"success"):"error"==a&&e._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});g.setupTransport("script",j);return g},{requires:["./base","./xhr-transport"]});
KISSY.add("io/sub-domain-transport",function(f,g,h,k){function j(a){var b=a.config;this.io=a;b.crossDomain=!1}function d(){var a=this.io.config.uri.getHostname(),a=b[a];a.ready=1;h.detach(a.iframe,"load",d,this);this.send()}var a=f.Env.host.document,b={};f.augment(j,g.proto,{send:function(){var c=this.io.config,m=c.uri,e=m.getHostname(),i;i=b[e];var l="/sub_domain_proxy.html";c.xdr&&c.xdr.subDomain&&c.xdr.subDomain.proxy&&(l=c.xdr.subDomain.proxy);i&&i.ready?(this.nativeXhr=g.nativeXhr(0,i.iframe.contentWindow))&&
this.sendInternal():(i?c=i.iframe:(i=b[e]={},c=i.iframe=a.createElement("iframe"),k.css(c,{position:"absolute",left:"-9999px",top:"-9999px"}),k.prepend(c,a.body||a.documentElement),i=new f.Uri,i.setScheme(m.getScheme()),i.setPort(m.getPort()),i.setHostname(e),i.setPath(l),c.src=i.toString()),h.on(c,"load",d,this))}});return j},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("io/xdr-flash-transport",function(f,g,h){function k(e,b,d){m||(m=!0,e='<object id="'+a+'" type="application/x-shockwave-flash" data="'+e+'" width="0" height="0"><param name="movie" value="'+e+'" /><param name="FlashVars" value="yid='+b+"&uid="+d+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',b=c.createElement("div"),h.prepend(b,c.body||c.documentElement),b.innerHTML=e)}function j(a){this.io=a}var d={},a="io_swf",b,c=f.Env.host.document,m=!1;f.augment(j,{send:function(){var a=
this,c=a.io,g=c.config;k((g.xdr||{}).src||f.Config.base+"io/io.swf",1,1);b?(a._uid=f.guid(),d[a._uid]=a,b.send(c._getUrlForSend(),{id:a._uid,uid:a._uid,method:g.type,data:g.hasContent&&g.data||{}})):setTimeout(function(){a.send()},200)},abort:function(){b.abort(this._uid)},_xdrResponse:function(a,b){var c,f=b.id,g,m=b.c,h=this.io;if(m&&(g=m.responseText))h.responseText=decodeURI(g);switch(a){case "success":c={status:200,statusText:"success"};delete d[f];break;case "abort":delete d[f];break;case "timeout":case "transport error":case "failure":delete d[f],
c={status:"status"in m?m.status:500,statusText:m.statusText||a}}c&&h._ioReady(c.status,c.statusText)}});g.applyTo=function(a,b,c){var a=b.split(".").slice(1),d=g;f.each(a,function(a){d=d[a]});d.apply(null,c)};g.xdrReady=function(){b=c.getElementById(a)};g.xdrResponse=function(a,b){var c=d[b.uid];c&&c._xdrResponse(a,b)};return j},{requires:["./base","dom"]});
KISSY.add("io/xhr-transport-base",function(f,g){function h(a,b){try{return new (b||j).XMLHttpRequest}catch(c){}}function k(a){var b;a.ifModified&&(b=a.uri,!1===a.cache&&(b=b.clone(),b.query.remove("_ksTS")),b=b.toString());return b}var j=f.Env.host,d=7<f.UA.ie&&j.XDomainRequest,a={proto:{}},b={},c={};g.__lastModifiedCached=b;g.__eTagCached=c;a.nativeXhr=j.ActiveXObject?function(b,c){var f;if(!a.supportCORS&&b&&d)f=new d;else if(!(f=!g.isLocal&&h(b,c)))a:{try{f=new (c||j).ActiveXObject("Microsoft.XMLHTTP");
break a}catch(l){}f=void 0}return f}:h;a._XDomainRequest=d;a.supportCORS="withCredentials"in a.nativeXhr();f.mix(a.proto,{sendInternal:function(){var a=this,e=a.io,g=e.config,l=a.nativeXhr,h=g.files,j=h?"post":g.type,o=g.async,r,n=e.mimeType,p=e.requestHeaders||{},e=e._getUrlForSend(),v=k(g),s,u;if(v){if(s=b[v])p["If-Modified-Since"]=s;if(s=c[v])p["If-None-Match"]=s}(r=g.username)?l.open(j,e,o,r,g.password):l.open(j,e,o);r=0;if(j=g.xhrFields)for(u in j)"withCredentials"==u&&(r=1),l[u]=j[u];r||(l.withCredentials=
!0);n&&l.overrideMimeType&&l.overrideMimeType(n);p["X-Requested-With"]||(p["X-Requested-With"]="XMLHttpRequest");if("undefined"!==typeof l.setRequestHeader)for(u in p)l.setRequestHeader(u,p[u]);var q=g.hasContent&&g.data||null;h&&(n=q,p={},n&&(p=f.unparam(n)),p=f.mix(p,h),q=new FormData,f.each(p,function(a,b){f.isArray(a)?f.each(a,function(a){q.append(b+(g.serializeArray?"[]":""),a)}):q.append(b,a)}));l.send(q);!o||4==l.readyState?a._callback():d&&l instanceof d?(l.onload=function(){l.readyState=
4;l.status=200;a._callback()},l.onerror=function(){l.readyState=4;l.status=500;a._callback()}):l.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,e){var i=this.nativeXhr,h=this.io,j,w,o,r,n,p=h.config;try{if(e||4==i.readyState)if(d&&i instanceof d?(i.onerror=f.noop,i.onload=f.noop):i.onreadystatechange=f.noop,e)4!==i.readyState&&i.abort();else{j=k(p);var v=i.status;d&&i instanceof d||(h.responseHeadersString=i.getAllResponseHeaders());j&&(w=
i.getResponseHeader("Last-Modified"),o=i.getResponseHeader("ETag"),w&&(b[j]=w),o&&(c[o]=o));if((n=i.responseXML)&&n.documentElement)h.responseXML=n;var s=h.responseText=i.responseText;if(p.files&&s){var u,q;if(-1!=(u=s.indexOf("<body>")))q=s.lastIndexOf("</body>"),-1==q&&(q=s.length),s=s.slice(u+6,q);h.responseText=f.unEscapeHTML(s)}try{r=i.statusText}catch(y){r=""}!v&&g.isLocal&&!p.crossDomain?v=h.responseText?200:404:1223===v&&(v=204);h._ioReady(v,r)}}catch(x){i.onreadystatechange=f.noop,e||h._ioReady(-1,
x)}}});return a},{requires:["./base"]});
KISSY.add("io/xhr-transport",function(f,g,h,k,j){function d(c){var d=c.config,e=d.crossDomain,g=d.xdr||{},l=g.subDomain=g.subDomain||{};this.io=c;if(e&&!h.supportCORS){d=d.uri.getHostname();if(a.domain&&f.endsWith(d,a.domain)&&!1!==l.proxy)return new k(c);if("flash"===""+g.use||!b)return new j(c)}this.nativeXhr=h.nativeXhr(e);return this}var a=f.Env.host.document,b=h._XDomainRequest;f.augment(d,h.proto,{send:function(){this.sendInternal()}});g.setupTransport("*",d);return g},{requires:["./base","./xhr-transport-base",
"./sub-domain-transport","./xdr-flash-transport"]});
