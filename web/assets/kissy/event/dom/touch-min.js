/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Apr 17 00:21
*/
KISSY.add("event/dom/touch/double-tap",function(g,b,e,a){function c(){}g.extend(c,a,{onTouchStart:function(a){if(!1===c.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var c=this.lastEndTime,b=a.timeStamp,g=a.target,d=a.changedTouches[0],f=b-this.startTime;this.lastEndTime=b;if(c&&(f=b-c,300>f)){this.lastEndTime=0;e.fire(g,"doubleTap",
{touch:d,duration:f/1E3});return}f=b-this.startTime;300<f?e.fire(g,"singleTap",{touch:d,duration:f/1E3}):this.singleTapTimer=setTimeout(function(){e.fire(g,"singleTap",{touch:d,duration:f/1E3})},300)}});b.singleTap=b.doubleTap={handle:new c};return c},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/gesture",function(g,b){var e=b.Gesture,a,c,h;g.Features.isTouchSupported()&&(a="touchstart",c="touchmove",h="touchend");a&&(e.start=a,e.move=c,e.end=h,e.tap="tap",e.doubleTap="doubleTap");return e},{requires:["event/dom/base"]});KISSY.add("event/dom/touch/handle-map",function(){return{}});
KISSY.add("event/dom/touch/handle",function(g,b,e,a,c){function h(d){this.doc=d;this.eventHandle={};this.init()}var i=g.guid("touch-handle"),k=g.Features,j={};j[c.start]="onTouchStart";j[c.move]="onTouchMove";j[c.end]="onTouchEnd";j.touchcancel="onTouchEnd";h.prototype={constructor:h,init:function(){var d=this.doc,f,n;for(f in j)n=j[f],a.on(d,f,this[n],this)},normalize:function(d){var f=d.type,a;if(!k.isTouchSupported()){if(-1!=f.indexOf("mouse")&&1!=d.which)return;a=[d];f=!f.match(/up$/i);d.touches=
f?a:[];d.targetTouches=f?a:[];d.changedTouches=a}return d},onTouchMove:function(d){this.callEventHandle("onTouchMove",d)},onTouchStart:function(d){var f,a,c=this.eventHandle;for(f in c)a=c[f].handle,a.isActive=1;this.callEventHandle("onTouchStart",d)},onTouchEnd:function(d){this.callEventHandle("onTouchEnd",d)},callEventHandle:function(d,f){var a=this.eventHandle,c,b;if(f=this.normalize(f)){for(c in a)b=a[c].handle,b.processed||(b.processed=1,b.isActive&&!1===b[d](f)&&(b.isActive=0));for(c in a)b=
a[c].handle,b.processed=0}},addEventHandle:function(d){var f=this.eventHandle,a=e[d].handle;f[d]?f[d].count++:f[d]={count:1,handle:a}},removeEventHandle:function(d){var f=this.eventHandle;f[d]&&(f[d].count--,f[d].count||delete f[d])},destroy:function(){var d=this.doc,f,c;for(f in j)c=j[f],a.detach(d,f,this[c],this)}};return{addDocumentHandle:function(d,f){var a=b.getWindow(d.ownerDocument||d).document,c=b.data(a,i);c||b.data(a,i,c=new h(a));c.addEventHandle(f)},removeDocumentHandle:function(d,f){var a=
b.getWindow(d.ownerDocument||d).document,c=b.data(a,i);c&&(c.removeEventHandle(f),g.isEmptyObject(c.eventHandle)&&(c.destroy(),b.removeData(a,i)))}}},{requires:"dom,./handle-map,event/dom/base,./gesture,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate,./single-touch-start".split(",")});
KISSY.add("event/dom/touch/multi-touch",function(g,b){function e(){}e.prototype={constructor:e,requiredTouchCount:2,onTouchStart:function(a){var c=this.requiredTouchCount,b=a.touches.length;b===c?this.start():b>c&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:g.noop,getCommonTarget:function(a){var c=a.touches,a=c[0].target,c=c[1].target;if(a==c||b.contains(a,c))return a;for(;;){if(b.contains(c,a))return c;c=c.parentNode}},
end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return e},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(g,b,e,a,c){function h(){}function i(a){(!a.touches||2==a.touches.length)&&a.preventDefault()}g.extend(h,a,{onTouchMove:function(a){if(this.isTracking){var c=a.touches,d,f=c[0],b=c[1];d=f.pageX-b.pageX;f=f.pageY-b.pageY;d=Math.sqrt(d*d+f*f);this.lastTouches=c;this.isStarted?e.fire(this.target,"pinch",g.mix(a,{distance:d,scale:d/this.startDistance})):(this.isStarted=!0,this.startDistance=d,c=this.target=this.getCommonTarget(a),e.fire(c,"pinchStart",g.mix(a,
{distance:d,scale:1})))}},fireEnd:function(a){e.fire(this.target,"pinchEnd",g.mix(a,{touches:this.lastTouches}))}});a=new h;b.pinchStart=b.pinchEnd={handle:a};b.pinch={handle:a,add:function(){e.on(this,c.move,i)},remove:function(){e.detach(this,c.move,i)}};return h},{requires:["./handle-map","event/dom/base","./multi-touch","./gesture"]});
KISSY.add("event/dom/touch/rotate",function(g,b,e,a,c,h){function i(){}function k(d){(!d.touches||2==d.touches.length)&&d.preventDefault()}var j=180/Math.PI;g.extend(i,e,{onTouchMove:function(d){if(this.isTracking){var c=d.touches,b=c[0],e=c[1],i=this.lastAngle,b=Math.atan2(e.pageY-b.pageY,e.pageX-b.pageX)*j;if(i!==h){var e=Math.abs(b-i),k=(b+360)%360,l=(b-360)%360;Math.abs(k-i)<e?b=k:Math.abs(l-i)<e&&(b=l)}this.lastTouches=c;this.lastAngle=b;this.isStarted?a.fire(this.target,"rotate",g.mix(d,{angle:b,
rotation:b-this.startAngle})):(this.isStarted=!0,this.startAngle=b,this.target=this.getCommonTarget(d),a.fire(this.target,"rotateStart",g.mix(d,{angle:b,rotation:0})))}},end:function(){this.lastAngle=h;i.superclass.end.apply(this,arguments)},fireEnd:function(d){a.fire(this.target,"rotateEnd",g.mix(d,{touches:this.lastTouches}))}});e=new i;b.rotateEnd=b.rotateStart={handle:e};b.rotate={handle:e,add:function(){a.on(this,c.move,k)},remove:function(){a.detach(this,c.move,k)}};return i},{requires:["./handle-map",
"./multi-touch","event/dom/base","./gesture"]});KISSY.add("event/dom/touch/single-touch-start",function(g,b,e,a){function c(){}g.extend(c,a,{onTouchStart:function(a){if(!1!==c.superclass.onTouchStart.apply(this,arguments))e.fire(a.target,"singleTouchStart",{touch:a.touches[0],touches:a.touches});else return!1}});b.singleTouchStart={handle:new c};return c},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/single-touch",function(g){function b(){}b.prototype={constructor:b,requiredTouchCount:1,onTouchStart:function(b){if(b.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=b.touches},onTouchMove:g.noop,onTouchEnd:g.noop};return b});
KISSY.add("event/dom/touch/swipe",function(g,b,e,a){function c(d,a,b){var c=a.changedTouches[0],g=c.pageX-d.startX,h=c.pageY-d.startY,l=Math.abs(g),m=Math.abs(h);if(b)d.isVertical&&d.isHorizontal&&(m>l?d.isHorizontal=0:d.isVertical=0);else if(d.isVertical&&m<j&&(d.isVertical=0),d.isHorizontal&&l<j)d.isHorizontal=0;if(d.isHorizontal)g=0>g?"left":"right";else if(d.isVertical)g=0>h?"up":"down",l=m;else return!1;e.fire(a.target,b?k:i,{originalEvent:a.originalEvent,touch:c,direction:g,distance:l,duration:(a.timeStamp-
d.startTime)/1E3})}function h(){}var i="swipe",k="swiping",j=50;g.extend(h,a,{onTouchStart:function(a){if(!1===h.superclass.onTouchStart.apply(this,arguments))return!1;var c=a.touches[0];this.startTime=a.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=c.pageX;this.startY=c.pageY;-1!=a.type.indexOf("mouse")&&a.preventDefault()},onTouchMove:function(a){var b=a.changedTouches[0],e=b.pageY-this.startY,b=Math.abs(b.pageX-this.startX),e=Math.abs(e);if(1E3<a.timeStamp-this.startTime)return!1;this.isVertical&&
35<b&&(this.isVertical=0);this.isHorizontal&&35<e&&(this.isHorizontal=0);return c(this,a,1)},onTouchEnd:function(a){return!1===this.onTouchMove(a)?!1:c(this,a,0)}});b[i]=b[k]={handle:new h};return h},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/tap-hold",function(g,b,e,a,c){function h(){}function i(a){(!a.touches||1==a.touches.length)&&a.preventDefault()}g.extend(h,e,{onTouchStart:function(b){if(!1===h.superclass.onTouchStart.call(this,b))return!1;this.timer=setTimeout(function(){a.fire(b.target,"tapHold",{touch:b.touches[0],duration:(g.now()-b.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});b.tapHold={setup:function(){a.on(this,
c.start,i)},tearDown:function(){a.detach(this,c.start,i)},handle:new h};return h},{requires:["./handle-map","./single-touch","event/dom/base","./gesture"]});KISSY.add("event/dom/touch/tap",function(g,b,e,a){function c(){}g.extend(c,a,{onTouchMove:function(){return!1},onTouchEnd:function(a){e.fire(a.target,"tap",{touch:a.changedTouches[0]})}});b.tap={handle:new c};return c},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch",function(g,b,e,a){function c(b){a.addDocumentHandle(this,b);e[b].setup.apply(this,arguments)}function h(b){a.addDocumentHandle(this,b)}function i(b){a.removeDocumentHandle(this,b);e[b].tearDown.apply(this,arguments)}function k(b){a.removeDocumentHandle(this,b)}var g=b._Special,j,d;for(j in e)b={},d=e[j],b.setup=d.setup?c:h,b.tearDown=d.tearDown?i:k,d.add&&(b.add=d.add),d.remove&&(b.remove=d.remove),g[j]=b},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
