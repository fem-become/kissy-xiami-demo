/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Mar 19 11:12
*/
KISSY.add("event/dom/touch/double-tap",function(g,c,f,a){function b(){}g.extend(b,a,{onTouchStart:function(a){if(!1===b.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var e=this.lastEndTime,j=a.timeStamp,h=a.target,b=a.changedTouches[0],d=j-this.startTime;this.lastEndTime=j;if(e&&(d=j-e,300>d)){this.lastEndTime=0;f.fire(h,"doubleTap",
{touch:b,duration:d/1E3});return}d=j-this.startTime;300<d?f.fire(h,"singleTap",{touch:b,duration:d/1E3}):this.singleTapTimer=setTimeout(function(){f.fire(h,"singleTap",{touch:b,duration:d/1E3})},300)}});c.singleTap=c.doubleTap={handle:new b};return b},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/gesture",function(g,c){var f=c.Gesture,a,b,i;g.Features.isTouchSupported()&&(a="touchstart",b="touchmove",i="touchend");a&&(f.start=a,f.move=b,f.end=i,f.tap="tap",f.doubleTap="doubleTap");return f},{requires:["event/dom/base"]});KISSY.add("event/dom/touch/handle-map",function(){return{}});
KISSY.add("event/dom/touch/handle",function(g,c,f,a,b){function i(d){this.doc=d;this.eventHandle={};this.init()}var e=g.guid("touch-handle"),j=g.Features,h={};h[b.start]="onTouchStart";h[b.move]="onTouchMove";h[b.end]="onTouchEnd";h.touchcancel="onTouchEnd";var k=g.throttle(function(d){this.callEventHandle("onTouchMove",d)},30);i.prototype={constructor:i,init:function(){var d=this.doc,e,b;for(e in h)b=h[e],a.on(d,e,this[b],this)},normalize:function(d){var e=d.type,a;if(!j.isTouchSupported()){if(-1!=
e.indexOf("mouse")&&1!=d.which)return;a=[d];e=!e.match(/up$/i);d.touches=e?a:[];d.targetTouches=e?a:[];d.changedTouches=a}return d},onTouchMove:function(d){k.call(this,d)},onTouchStart:function(d){var e,a,b=this.eventHandle;for(e in b)a=b[e],a.isActive=1;this.callEventHandle("onTouchStart",d)},onTouchEnd:function(d){this.callEventHandle("onTouchEnd",d)},callEventHandle:function(d,e){var a=this.eventHandle,b,h;if(e=this.normalize(e)){for(b in a)h=a[b],h.processed||(h.processed=1,h.isActive&&!1===h[d](e)&&
(h.isActive=0));for(b in a)h=a[b],h.processed=0}},addEventHandle:function(d){var e=f[d].handle;this.eventHandle[d]||(this.eventHandle[d]=e)},removeEventHandle:function(d){delete this.eventHandle[d]},destroy:function(){var d=this.doc,e,b;for(e in h)b=h[e],a.detach(d,e,this[b],this)}};return{addDocumentHandle:function(d,a){var b=c.getWindow(d.ownerDocument||d).document,h=c.data(b,e);h||c.data(b,e,h=new i(b));h.addEventHandle(a)},removeDocumentHandle:function(d,a){var b=c.getWindow(d.ownerDocument||
d).document,h=c.data(b,e);h&&(h.removeEventHandle(a),g.isEmptyObject(h.eventHandle)&&(h.destroy(),c.removeData(b,e)))}}},{requires:"dom,./handle-map,event/dom/base,./gesture,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(",")});
KISSY.add("event/dom/touch/multi-touch",function(g,c){function f(){}f.prototype={constructor:f,requiredTouchCount:2,onTouchStart:function(a){var b=this.requiredTouchCount,f=a.touches.length;f===b?this.start():f>b&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:g.noop,getCommonTarget:function(a){var b=a.touches,a=b[0].target,b=b[1].target;if(a==b||c.contains(a,b))return a;for(;;){if(c.contains(b,a))return b;b=b.parentNode}},
end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return f},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(g,c,f,a,b){function i(){}g.extend(i,a,{onTouchMove:function(e){if(this.isTracking){var a=e.touches,b,c=a[0],d=a[1];b=c.pageX-d.pageX;c=c.pageY-d.pageY;b=Math.sqrt(b*b+c*c);this.lastTouches=a;this.isStarted?f.fire(this.target,"pinch",g.mix(e,{distance:b,scale:b/this.startDistance})):(this.isStarted=!0,this.startDistance=b,a=this.target=this.getCommonTarget(e),f.fire(a,"pinchStart",g.mix(e,{distance:b,scale:1})))}},fireEnd:function(b){f.fire(this.target,"pinchEnd",
g.mix(b,{touches:this.lastTouches}))}});a=new i;c.pinchStart=c.pinchEnd={handle:a};c.pinch={handle:a,add:function(a){if(!1!==a.preventDefaultMove)f.on(this,b.move,a.__preventPinchDefault=function(a){(!a.touches||2==a.touches.length)&&a.preventDefault()})},remove:function(a){a.__preventPinchDefault&&f.detach(this,b.move,a.__preventPinchDefault)}};return i},{requires:["./handle-map","event/dom/base","./multi-touch","./gesture"]});
KISSY.add("event/dom/touch/rotate",function(g,c,f,a,b,i){function e(){}var j=180/Math.PI;g.extend(e,f,{onTouchMove:function(b){if(this.isTracking){var e=b.touches,d=e[0],c=e[1],f=this.lastAngle,d=Math.atan2(c.pageY-d.pageY,c.pageX-d.pageX)*j;if(f!==i){var c=Math.abs(d-f),l=(d+360)%360,m=(d-360)%360;Math.abs(l-f)<c?d=l:Math.abs(m-f)<c&&(d=m)}this.lastTouches=e;this.lastAngle=d;this.isStarted?a.fire(this.target,"rotate",g.mix(b,{angle:d,rotation:d-this.startAngle})):(this.isStarted=!0,this.startAngle=
d,this.target=this.getCommonTarget(b),a.fire(this.target,"rotateStart",g.mix(b,{angle:d,rotation:0})))}},end:function(){this.lastAngle=i;e.superclass.end.apply(this,arguments)},fireEnd:function(b){a.fire(this.target,"rotateEnd",g.mix(b,{touches:this.lastTouches}))}});f=new e;c.rotateEnd=c.rotateStart={handle:f};c.rotate={handle:f,add:function(e){if(!1!==e.preventDefaultMove)a.on(this,b.move,e.__preventRotateDefault=function(a){(!a.touches||2==a.touches.length)&&a.preventDefault()})},remove:function(e){e.__preventRotateDefault&&
a.detach(this,b.move,e.__preventRotateDefault)}};return e},{requires:["./handle-map","./multi-touch","event/dom/base","./gesture"]});KISSY.add("event/dom/touch/single-touch",function(g){function c(){}c.prototype={constructor:c,requiredTouchCount:1,onTouchStart:function(c){if(c.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=c.touches},onTouchMove:g.noop,onTouchEnd:g.noop};return c});
KISSY.add("event/dom/touch/swipe",function(g,c,f,a,b){function i(){}g.extend(i,a,{onTouchStart:function(a){if(!1===i.superclass.onTouchStart.apply(this,arguments))return!1;var b=a.touches[0];this.startTime=a.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=b.pageX;this.startY=b.pageY;-1!=a.type.indexOf("mouse")&&a.preventDefault()},onTouchMove:function(a){var b=a.changedTouches[0],c=b.pageY,b=Math.abs(b.pageX-this.startX),c=Math.abs(c-this.startY);if(1E3<a.timeStamp-this.startTime)return!1;
this.isVertical&&35<b&&(this.isVertical=0);this.isHorizontal&&35<c&&(this.isHorizontal=0);if(!this.isHorizontal&&!this.isVertical)return!1},onTouchEnd:function(a){if(!1===this.onTouchMove(a))return!1;var b=a.changedTouches[0],c=b.pageX-this.startX,g=b.pageY-this.startY,d=Math.abs(c),i=Math.abs(g);this.isVertical&&50>i&&(this.isVertical=0);this.isHorizontal&&50>d&&(this.isHorizontal=0);if(this.isHorizontal)c=0>c?"left":"right";else if(this.isVertical)c=0>g?"up":"down",d=i;else return!1;f.fire(a.target,
"swipe",{touch:b,direction:c,distance:d,duration:(a.timeStamp-this.startTime)/1E3})}});c.swipe={add:function(a){if(!1!==a.preventDefaultMove)f.on(this,b.move,a.__preventSwipeDefault=function(a){(!a.touches||1==a.touches.length)&&a.preventDefault()})},remove:function(a){a.__preventSwipeDefault&&f.detach(this,b.move,a.__preventSwipeDefault)},handle:new i};return i},{requires:["./handle-map","event/dom/base","./single-touch","./gesture"]});
KISSY.add("event/dom/touch/tap-hold",function(g,c,f,a,b){function i(){}function e(a){(!a.touches||1==a.touches.length)&&a.preventDefault()}g.extend(i,f,{onTouchStart:function(b){if(!1===i.superclass.onTouchStart.call(this,b))return!1;this.timer=setTimeout(function(){a.fire(b.target,"tapHold",{touch:b.touches[0],duration:(g.now()-b.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});c.tapHold={setup:function(){a.on(this,
b.start,e)},tearDown:function(){a.detach(this,b.start,e)},handle:new i};return i},{requires:["./handle-map","./single-touch","event/dom/base","./gesture"]});KISSY.add("event/dom/touch/tap",function(g,c,f,a){function b(){}g.extend(b,a,{onTouchMove:function(){return!1},onTouchEnd:function(a){f.fire(a.target,"tap",{touch:a.changedTouches[0]})}});c.tap={handle:new b};return b},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch",function(g,c,f,a){function b(b){a.addDocumentHandle(this,b);f[b].setup.apply(this,arguments)}function i(b){a.addDocumentHandle(this,b)}function e(b){a.removeDocumentHandle(this,b);f[b].tearDown.apply(this,arguments)}function j(b){a.removeDocumentHandle(this,b)}var g=c._Special,h,k;for(h in f)c={},k=f[h],c.setup=k.setup?b:i,c.tearDown=k.tearDown?e:j,k.add&&(c.add=k.add),k.remove&&(c.remove=k.remove),g[h]=c},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
